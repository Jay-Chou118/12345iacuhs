import{H as x}from"./Header-d9b2717a.js";import{B as C}from"./Button-4645ffc4.js";import{_ as L,k as D,j as m,e as v,r as y,l as F,c as i,h as c,d as t,F as P,m as R,i as p,a as l,w as u,t as _,v as f,o as n,n as S,p as B,b as q}from"./index-dbc434b4.js";let b=0;const I={props:["store","closeFlag"],components:{Button:C,Header:x},data(){return{pullType:"blf",chartDataLoaded:!0,directory:window.downloadPath,recList:{csv:{label:"csv",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},asc:{label:"asc",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"},blf:{label:"blf",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},recLoading:!1,recLoadingProgress:"",recordTime:"00:00:00",consoleText:"",message:{visible:!1,level:"",content:""},modal:{visible:!1},onFlag:!0}},watch:{closeFlag(e){console.log("2222",e,this.onFlag),this.onFlag==!1&&(this.modal.visible=!0)},chartDataLoaded(e,o){e?(document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor=""):(document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".record-header").style.cursor="wait")}},mounted(){m.report("trackPage",{page:"录制报文",tip:"1174.8.0.1.27758"});const e=window.driver.js.driver({doneBtnText:"知道了",closeBtnText:"关闭",nextBtnText:"继续",prevBtnText:"后退",steps:[{element:"#el-record-form",popover:{title:"配置和录制",description:"填写格式和目录信息，点击开始"}},{element:"#el-record-console",popover:{title:"进度提示",description:"此区域提示录制进度"}}]});this.$ls.get("driverRecord")||(e.drive(),this.$ls.set("driverRecord",!0))},unmounted(){},computed:{pullDataValid(){return!!(this.directory&&this.pullType)},quitConfirm(){return this.recLoading}},methods:{showInfo(){this.modal.visible=!0},choosePath(){D.choosePath({directory:this.directory,dialogType:"FOLDER_DIALOG",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then(({data:e})=>{e.directory&&(this.directory=e.directory)})},startRec(){m.report("track","click",{element_name:"开始录制",asset_name:this.directory+";"+this.pullType,tip:"1174.8.0.1.27759"}),this.consoleText="录制中...\n",this.onFlag=!1,this.chartDataLoaded=!1,b=setInterval(()=>{this.recordTime=""},1e3),v.record.start({type:[this.pullType],path:this.directory}).then(e=>{console.log(e,"444444");let o=e.data;this.chartDataLoaded=!0,e.status==200&&(this.consoleText+=o+"\n",o&&(this.onFlag=!0)),console.log(o,"resp22222")}).catch(e=>{this.consoleText+="录制中断\n",this.onFlag=!0})},endRec(){m.report("track","click",{element_name:"停止录制",asset_name:this.directory+";"+this.pullType,tip:"1174.8.0.1.27760"}),clearInterval(b),this.onFlag=!0,this.chartDataLoaded=!0,v.record.end().then(e=>{let o=e.data;e.status==200&&(this.consoleText+="停止成功\n"),console.log(o,"resp22222")}).catch(e=>{this.consoleText+="停止失败\n",this.onFlag=!1})},cannel(){this.modal.visible=!1},submit(){this.modal.visible=!1,this.endRec(),this.onFlag=!0}}},a=e=>(B("data-v-848231fb"),e=e(),q(),e),N=["data-disabled"],V={class:"o-pul-er",id:"el-record-form"},M=a(()=>t("div",{class:"o-pul-title"},"报文录制配置",-1)),z={class:"o-pul-p"},E=a(()=>t("span",{style:{color:"red"}},"* ",-1)),H=a(()=>t("span",{class:"record-header-message"},"录制文件格式：",-1)),j=["value"],O={class:"o-pul-p"},A=a(()=>t("span",{style:{color:"red"}},"* ",-1)),G=a(()=>t("span",{class:"record-header-message"},"保存目录：",-1)),U={class:"o-pul-path"},J={key:0,class:"o-pul-p start-rec"},K=a(()=>t("i",{class:"play-icon"},null,-1)),Q={key:1,class:"o-pul-p start-rec"},W=a(()=>t("i",{class:"stop-icon"},null,-1)),X=["data-empty"],Y=a(()=>t("div",{class:"o-console-title"},"录制报文内容",-1)),Z=["data-loading"],$={class:"o-modal-wrap"},ee={class:"o-modal-header"},te={class:"o-modal-header-wrap"},se=a(()=>t("div",{class:"o-modal-title"},"提示",-1)),oe=a(()=>t("div",{class:"o-modal-container"},[t("span",{class:"record-header-message"},"任务还在录制中，此时关闭TSP助手会终断此任务，确认要继续关闭吗？")],-1)),ae={class:"o-modal-footer"},re={class:"o-modal-footer-wrap"};function le(e,o,ie,ce,s,r){const T=y("Header"),d=y("Button"),k=F("tooltip");return n(),i("div",{class:"record-page","data-disabled":!s.chartDataLoaded},[c(T,{title:"录制报文",quitConfirm:r.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),t("div",V,[M,t("div",z,[E,H,(n(!0),i(P,null,R(s.recList,(h,g)=>(n(),i("label",{class:"o-input record-header-message-imp",key:g},[u(t("input",{name:"pull_type",type:"radio","onUpdate:modelValue":o[0]||(o[0]=w=>s.pullType=w),value:g},null,8,j),[[S,s.pullType]]),l(_(h.label)+" "+_(h.size)+" ",1)]))),128))]),t("div",O,[A,G,c(d,{onClick:r.choosePath,class:"choose-path"},{default:p(()=>[l("选择路径")]),_:1},8,["onClick"]),l("  "),u((n(),i("span",U,[l(_(s.directory),1)])),[[k,{content:s.directory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),s.onFlag?(n(),i("div",J,[c(d,{type:"primary",disabled:!1,progress:s.recLoadingProgress,loading:s.recLoading,onClick:r.startRec},{default:p(()=>[K,l(" 开始录制")]),_:1},8,["disabled","progress","loading","onClick"])])):(n(),i("div",Q,[c(d,{type:"primary",disabled:!1,progress:s.recLoadingProgress,loading:s.recLoading,onClick:r.endRec},{default:p(()=>[W,l(" 暂停录制")]),_:1},8,["disabled","progress","loading","onClick"])]))]),t("div",{class:"o-console-er","data-empty":s.consoleText==="",id:"el-record-console"},[Y,u(t("div",{class:"o-console-body","data-loading":!s.chartDataLoaded},_(s.consoleText),9,Z),[[f,s.consoleText]])],8,X),u(t("div",$,[t("div",ee,[t("div",te,[se,t("i",{class:"o-modal-title-close",onClick:o[1]||(o[1]=(...h)=>r.cannel&&r.cannel(...h))})]),oe,t("div",ae,[t("div",re,[c(d,{style:{width:"52px"},onClick:r.cannel},{default:p(()=>[l("取消")]),_:1},8,["onClick"]),c(d,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:r.submit},{default:p(()=>[l("确定")]),_:1},8,["onClick"])])])])],512),[[f,this.modal.visible]])],8,N)}const he=L(I,[["render",le],["__scopeId","data-v-848231fb"]]);export{he as default};
