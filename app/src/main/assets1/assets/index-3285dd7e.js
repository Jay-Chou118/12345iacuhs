import{B as P}from"./Button-36ca0f57.js";import{A as le,W as re,P as ne}from"./ev-timeplot-3b0092e1.js";import{M as K}from"./Message-b842a8db.js";import{H as oe}from"./Header-91752035.js";import{I as de}from"./ImportFileDialog-73a5b088.js";import{M as ce}from"./index-bd510485.js";import{c as he}from"./index.es-78133944.js";import{q as pe,S as E,u as ue,_ as Q,r as y,l as N,w as _,o as f,c as g,d as n,g as fe,h as k,i as F,t as D,x as L,a as w,f as b,y as me,p as Y,b as Z,s as R,e as u,k as j,j as H,z as ge,A as x,B as ye,F as W,C as be,n as G,v as q,m as _e}from"./index-14475613.js";import{t as $}from"./signal-577d7bc6.js";import{S as Ce}from"./Spin-c7e13da3.js";import{n as I}from"./index-15c66db4.js";import{b as De,s as we}from"./CopyPath-9f15f234.js";import{s as ve}from"./time-4b339df6.js";import{b as B}from"./num-b2a97d52.js";import{D as Te}from"./DownloadMessage-acbf9960.js";import{B as ke}from"./ButtonGroup-21d51e80.js";import"./Cascader-3f3674f0.js";let V=[],J=0;const Se={props:["signals","carType","sdb","fileType","defaultOptions","filledOptions","loading"],emits:["signalsChange","cancel"],components:{Button:P,RecycleScroller:pe,Spin:Ce,Message:K},data(){var s,a,l;const e=this.$ls.get("blfread_sdbData")||[];if(this.carType==="custom"){let t=(s=e.find(i=>i.sdb===this.sdb))==null?void 0:s.comments;t&&(V=["",...t])}else V=((l=(a=E.DEFAULT.find(t=>t.value===this.$props.carType))==null?void 0:a.children.find(t=>t.value===this.$props.sdb))==null?void 0:l.comments)||[];return V=V.map((t,i)=>"".concat("⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[i]).concat(t)),{inputStr:"",treeData:[],checkedList:[],isFilled:!1,message:{visible:!1,level:"",content:""}}},computed:{list(){let e=[];for(let s=0;s<this.treeData.length;s++){let a=this.treeData[s];a.id!=-1&&e.push({_id:a.id,id:a.id,node_type:a.node_type,text:a.text});for(let l=0;l<a.children.length;l++){let t=a.children[l];t.id[0]!="-"&&e.push({_id:a.id+"-"+t.id,id:t.id,node_type:t.node_type,text:t.text});for(let i=0;i<t.children.length;i++){let r=t.children[i];e.push({...r,_id:a.id+"-"+t.id+"-"+r.id})}}}return e}},watch:{isFilled(e,s){this.dataInit()}},async created(){this.dataInit()},mounted(){this.$refs.chsInputRef.focus(),this.checkedList=this.$props.signals,this.updateChecked(),setTimeout(()=>{document.body.addEventListener("mousedown",this.clickHandler)},300)},beforeUnmount(){},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{onFilledChange(e){this.inputStr=e,this.onChange(),console.log("91992",e),this.isFilled=!this.isFilled},title4node(e){return $(e)},clickHandler(e){var s;((s=this.$refs.root)==null?void 0:s.contains(e.target))==!1&&this.$emit("cancel")},dataInit(){let e=[],s=this.isFilled?this.$props.filledOptions:this.$props.defaultOptions;for(let a in s){let l={id:+a,text:V[a],node_type:"channel",children:[]};for(let t in s[a]){let i={id:a+"_"+t,text:t=="-1"?"":t,node_type:"msg",channel:l.id,children:s[a][t].map(r=>{var o;return{id:r[0],msg:t=="-1"?"-1":+((o=t.match(/0x\w+/))==null?void 0:o[0])||t,channel:l.id,text:r[0],node_type:"signal",comment:r[1],remark:r[2]}})};l.children.push(i)}e.push(l)}this.treeData=Object.freeze(e)},selectNode(e){console.log("selectNode",e,this.checkedList);let s=this.checkedList.map(a=>({...a}));s.some(a=>a._id===e._id)?(console.log("s1"),this.checkedList=s.filter(a=>a._id!==e._id)):(console.log("s2"),s.length<30?this.checkedList=[...s.filter(a=>a._id!==e._id),e]:this.showMessage({level:"error",content:"选择不能超过".concat(s.length,"项"),timeout:2e3}))},showMessage({level:e,content:s,timeout:a}){clearTimeout(J),e!=null&&(this.message.level=e),s!=null&&(this.message.content=s),this.message.visible=!0,a>0&&(J=setTimeout(()=>{this.message.visible=!1},a))},submit(){this.$emit("signalsChange",this.checkedList)},updateChecked(){},highlightWord(e){if(!e)return e;const s=this.inputStr;if(!s)return e;const a=s.split(/\s+/g);var l,t=a.length,i;for(l=0;l<t;l++)try{i=new RegExp(a[l],"gi"),i.test(e)&&(e=e.replace(i,"<strong>$&</strong>"))}catch(r){i=a[l],e=e.replace(i,"<strong>$&</strong>")}return e},onChange:ue(function(){let s=!1,a=this.inputStr.toLowerCase();a.startsWith("0x")&&(s=!0);let l;try{l=new RegExp(a,"i")}catch(r){l={test(o){return~o.toLowerCase().indexOf(o.toLowerCase())}}}let t=[],i=this.isFilled?this.$props.filledOptions:this.$props.defaultOptions;for(let r in i){let o={id:+r,text:V[r],node_type:"channel",children:[]};for(let h in i[r]){let m=s&&h.includes(a),c={id:r+"_"+h,text:h=="-1"?"":h,node_type:"msg",channel:o.id,children:i[r][h].filter(d=>m||l.test(d[0])||l.test(d[1])).map(d=>({id:d[0],msg:h=="-1"?"-1":+h.match(/0x\w+/)[0],channel:o.id,text:d[0],node_type:"signal",comment:d[1],remark:d[2]}))};c.children.length>0&&o.children.push(c)}(o.children.length>0||l.test(o.text)||l.test(o.comment))&&t.push(o)}this.treeData=t,console.log(this.treeData),this.updateChecked()},500,{leading:!1})}},ee=e=>(Y("data-v-d2c82486"),e=e(),Z(),e),xe={class:"chs-er",ref:"root"},Ve={class:"chs-list-er"},Me={key:0,class:"chs-node"},Fe=["innerHTML"],Le=["onMousedown","for"],Ae=["id","checked"],Be=["innerHTML"],Oe=["innerHTML"],Ie={key:0,class:"chs-ft-label pointer"},Pe=["checked"],Ee=ee(()=>n("i",{class:"icon-ques"},null,-1)),Ne={key:1,class:"spin-loding-style"},Ue=ee(()=>n("div",null,null,-1));function ze(e,s,a,l,t,i){const r=y("RecycleScroller"),o=y("Spin"),h=y("Message"),m=N("tooltip"),c=N("esc");return _((f(),g("div",xe,[_(n("input",{class:"chs-input-er",ref:"chsInputRef",placeholder:"搜索信号名称/信号描述","onUpdate:modelValue":s[0]||(s[0]=d=>t.inputStr=d),onInput:s[1]||(s[1]=(...d)=>i.onChange&&i.onChange(...d)),draggable:!1},null,544),[[fe,t.inputStr]]),n("div",Ve,[k(r,{class:"chs-list",items:i.list,"item-size":28,"key-field":"_id"},{default:F(({item:d})=>[d.node_type=="channel"?(f(),g("div",Me,D(d.text),1)):d.node_type=="msg"?(f(),g("div",{key:1,class:"chs-node",style:{"text-indent":"1em"},innerHTML:i.highlightWord(d.text)},null,8,Fe)):d.node_type=="signal"?_((f(),g("div",{key:2,onMousedown:L(v=>i.selectNode(d),["prevent","stop"]),for:d._id,style:{"text-indent":"2em"},class:"chs-node chs-node-item"},[n("input",{id:d._id,type:"checkbox",class:"chs-node-checkbox",checked:t.checkedList.some(v=>v._id===d._id)},null,8,Ae),n("span",{class:"chs-node-signal",innerHTML:i.highlightWord(d.text)},null,8,Be),w(" "),n("span",{class:"chs-node-comment",innerHTML:i.highlightWord(d.comment)},null,8,Oe)],40,Le)),[[m,{content:i.title4node(d),html:!0},void 0,{right:!0}]]):b("",!0)]),_:1},8,["items"]),n("div",{class:me(t.checkedList.length==30?"chs-ft-label-len":"chs-ft-label")},"（"+D(t.checkedList.length)+"/30）",3),a.fileType!="mdf"?_((f(),g("label",Ie,[n("input",{class:"chs-node-checkboxAll",type:"checkbox",checked:t.isFilled,onClick:s[2]||(s[2]=d=>i.onFilledChange(t.inputStr))},null,8,Pe),w("有数据"),Ee])),[[m,"仅显示有数据的信号"]]):b("",!0),n("div",{class:"chs-btn confirm","data-cy":"chooseSignalSubmit",onClick:s[3]||(s[3]=(...d)=>i.submit&&i.submit(...d))},"确定"),n("div",{class:"chs-btn cancel",onClick:s[4]||(s[4]=d=>e.$emit("cancel"))},"取消"),e.$props.loading?(f(),g("div",Ne,[Ue,k(o)])):b("",!0),k(h,{message:t.message},null,8,["message"])])])),[[c,()=>e.$emit("cancel")]])}const Re=Q(Se,[["render",ze],["__scopeId","data-v-d2c82486"]]);let X=0;const je={props:["store","closeFlag"],emits:["connect","showMessage","getCarCode"],components:{Button:P,Header:oe,ImportFileDialog:de,ManageViewsGroup:ce,Draggable:he,ChooseSignal:Re,AddOrSelector:le,TimePlotMulti:re,ProgressBar:ne,Message:K,DownloadMessage:Te,ButtonGroup:ke,Button:P},data(){var s,a,l;let e=(s=this.$ls.get("blfread_treeData"))==null?void 0:s.map(t=>({...t,carType:t.carType||"MS11",sdb:t.sdb||"E4U1",children:t.children.map(i=>({...i,warning:!1,pid:t.id,color:i.color||"blue"}))}));if((!e||(e==null?void 0:e.length)===0)&&(e=[]),e=e.filter(t=>!(t.carType==="MS11"&&t.sdb==="E4U1"&&t.text==="默认视图"&&t.children.length===0)),!e.some(t=>t.carType==="MS11"&&t.sdb==="E4U1")){let t=Date.now();e.push({id:t,text:"默认视图",type:"view",editable:!1,carType:"MS11",sdb:"E4U1",deleteConfirm:!1,children:[{id:"PwrModSts",msg:198,channel:3,text:"PwrModSts",node_type:"signal",comment:"PowerMode Status",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::PwrModSts::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-PwrModSts",pid:t,color:"purple"},{id:"VCUActGearLvr",msg:198,channel:3,text:"VCUActGearLvr",node_type:"signal",comment:"Actual gear level 车辆实际档位\\\\nP R N D挡位",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUActGearLvr::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUActGearLvr",pid:t,color:"blue",warning:!1},{id:"VCUAccrPedlRat",msg:198,channel:3,text:"VCUAccrPedlRat",node_type:"signal",comment:"加速油门踏板开度",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUAccrPedlRat::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUAccrPedlRat",pid:t,color:"cerulean",warning:!1},{id:"HvBattSoCAct",msg:449,channel:5,text:"HvBattSoCAct",node_type:"signal",comment:"HV battery SoC actual",remark:"BMS::VCCD/VECU::BMS_PTCANFD_0x1C1::HvBattSoCAct::CANFD signal",checked:!0,_id:"5-5_BMS_PTCANFD_0x1C1(0x1c1)-HvBattSoCAct",pid:t,color:"cyan",warning:!1},{id:"VehSpd",msg:179,channel:3,text:"VehSpd",node_type:"signal",comment:"Vehicle speed",remark:"BCS::ADD/VCCD/BCP/EPS/SCUC/SWM::BCS_ChassisCANFD_0xB3::VehSpd::CANFD signal",checked:!0,_id:"3-3_BCS_ChassisCANFD_0xB3(0xb3)-VehSpd",pid:t,color:"green",warning:!1},{id:"SwtHiBeam",msg:419,channel:3,text:"SwtHiBeam",node_type:"signal",comment:"组合开关远光灯请求命令",remark:"SWM::BCP/BCS/VCCD::SWM_ChassisCANFD_0x1A3::SwtHiBeam::CANFD signal",checked:!0,_id:"3-3_SWM_ChassisCANFD_0x1A3(0x1a3)-SwtHiBeam",pid:t,color:"lime",warning:!1}]})}return this.$ls.set("blfread_treeData",e),{system:R,modeOptions:[{label:"分散",value:"single"},{label:"对齐",value:"same"},{label:"聚合",value:"shifted"}],chartMode:"single",timeFilterOptions:[{label:"绝对时间",value:"absolute"},{label:"相对时间",value:"relative"}],timeFilterMode:{label:"绝对时间",value:"absolute"},startTime:0,showDotsFrame:!1,fileType:"blf",blfcpp:"cpp",isBigFile:!1,chooseSignalAble:!1,downloadMessage:{show:!1,path:""},message:{visible:!1,level:"",content:""},modal:{title:"导入文件",visible:!1},manageModal:{title:"管理视图",manageVisible:!1},treeData:e.map(t=>(t.children.forEach(i=>{i.warning=!1}),t)),curView:{label:(a=e[0])==null?void 0:a.text,value:0,tag:(l=e[0])==null?void 0:l.sdb},C2C:[],colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],sdb:"E4U3_1115",directory:"",carType:"MS11",directorySize:{label:"",value:0,durationMaybe:0,durationMaybeLabel:"0秒"},backBlock:!1,chartDataLoaded:!0,waitChart:{},fileChoosed:!1,traceList:new Map,timeData:{},tableList:[],channelVersion:[{label:"全部",value:""}],channelVal:"全部",ECUVersion:[{label:"全部",value:""}],ECUVal:"全部",canIdsVersion:[{label:"全部",value:""}],canIdsVal:"全部",filterTableList:[],columnDefs:[{headerName:"Time",field:"timeTabData"},{headerName:"Chn",field:"chnTabData",width:80},{headerName:"ID",field:"idTabData",width:80},{headerName:"Name",field:"nameTabData",width:300},{headerName:"Event Type",field:"eventTabData"},{headerName:"Dir",field:"dirTabData",width:80},{headerName:"DLC",field:"dlcTabData",width:80},{headerName:"文本ECU",field:"dataTabData"}],debug:window._debug,signalLoading:!1,defaultOptions:{},filledOptions:{},exportTypeOptions:[{label:"mdf(*.mdf)",value:"mdf"},{label:"csv(*.csv)",value:"csv"},{label:"blf(*.blf)",value:"blf"},{label:"mat(*.mat)",value:"mat"}],exportTypeValue:"blf"}},computed:{sdbVal(){return[this.carType,this.sdb]},quitConfirm(){return!!this.directory.trim()},treeDataDbc(){return this.treeData.map((e,s)=>({...e,label:e.text,value:s,tag:e.sdb})).filter(e=>e.carType===this.carType&&e.sdb===this.sdb)},carTypeLabel(){return this.carType&&this.carType!=="custom"?this.carType+" / ":""},view(){return this.treeData[this.curView.value]},directoryLabel(){let e=this.directory.split("/").pop();return e.length>25?e.slice(0,10)+"..."+e.slice(-15):e},fileType_CarType(){return[this.fileType,this.carType]}},mounted(){this.debug=!!window._debug,this.fillEmptyTreeData(),this.curView=this.treeDataDbc[0],H.report("trackPage",{page:"查看报文",tip:"1174.10.0.1.27765"})},beforeUnmount(){this.timeData={}},unmounted(){u.blf.freeSpace(),u.ascReader.freeSpace(),u.logReader.freeSpace()},watch:{fileType_CarType(){this.fileType==="mdf"?this.blfcpp="cpp":this.debug||(this.carType==="custom"?this.blfcpp="python":this.blfcpp="cpp")},blfcpp:{handler(e){window._blfcpp=e},immediate:!0},sdbVal:{handler(e){var l,t,i;let s=[];const a=this.$ls.get("blfread_sdbData")||[];if(this.carType==="custom"){let r=(l=a.find(o=>o.sdb===this.sdb))==null?void 0:l.comments;r&&(s=["",...r])}else s=((i=(t=E.DEFAULT.find(r=>r.value===this.carType))==null?void 0:t.children.find(r=>r.value===this.sdb))==null?void 0:i.comments)||[];this.C2C=s.map((r,o)=>"".concat("⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[o]).concat(r))},immediate:!0},chartDataLoaded(e,s){e?(this.backBlock=!1,document.querySelector(".o-body").style.cursor=""):(this.backBlock=!0,document.querySelector(".o-body").style.cursor="wait")},treeData:{handler(e,s){JSON.stringify(this.$ls.get("blfread_treeData"))!==JSON.stringify(e)&&this.$ls.set("blfread_treeData",e)},deep:!0},directory:{async handler(e){const s=await j.getFileSize(e),a=.83*.2;let l=Math.round((1678e-19*s*s+1768e-10*s+.5581)*a);e.endsWith("mdf")&&(l=25),this.directorySize={label:De(s),value:s,durationMaybe:l*1e3,durationMaybeLabel:ve(l)}}}},methods:{onUpdateDefaultOptions(e){this.defaultOptions=Object.freeze(e)},title4node(e){return $(e)},showMessage({level:e,content:s,timeout:a}){clearTimeout(X),e!=null&&(this.message.level=e),s!=null&&(this.message.content=s),this.message.visible=!0,a>0&&(X=setTimeout(()=>{this.message.visible=!1},a))},hideMessage(){this.message.visible=!1},onTreeDataChange(){this.treeData=this.$ls.get("blfread_treeData")},fillEmptyTreeData(){E.DEFAULT.forEach(e=>{e.children.forEach(s=>{this.treeData.some(a=>a.carType===e.value&&a.sdb===s.value)||this.treeData.push({id:+Math.random().toString().replace(".",""),text:"默认视图",type:"view",editable:!1,carType:e.value,sdb:s.value,deleteConfirm:!1,children:[]})})})},deleteView(e){let s=this.treeData.filter(a=>a.id!==e.id);this.curView.value=s.findIndex(a=>a.id===this.view.id),this.treeData=s},updateView(e){this.treeData=this.treeData.map(s=>s.id===e.id?e:s)},onImportView(e){this.addView(e)},resetTimeData(){this.directory="",this.backBlock=!1,this.chartDataLoaded=!0,this.waitChart={},this.fileChoosed=!1,this.traceList=new Map,this.timeData={}},choosePath(){this.fileType==="blf"?(this.chartDataLoaded=!1,this.clearTimeData(),u.blf.getBLFdata({blfFile:this.directory,mode:this.isBigFile?"bigFile":void 0}).then(async e=>{this.startTime=e.data.startTime,this.fileChoosed=!0,this.treeData.forEach(a=>{this.waitChart[a.id]=!0});let s=this.treeData.slice();s.splice(this.curView.value,1),s.unshift(this.treeData[this.curView.value]),s=s.filter(a=>a.carType===this.carType&&a.sdb===this.sdb),u.blf.haveDataSignal({}).then(a=>{this.filledOptions=Object.freeze(a.data),this.signalLoading=!1});for(let a=0;a<s.length;a++)await this.play(s[a]),a===0&&(this.chartDataLoaded=!0)}).catch(()=>{}).finally(()=>{this.chartDataLoaded=!0,this.signalLoading=!1})):this.fileType==="mdf"?(async()=>{this.chartDataLoaded=!1,this.clearTimeData(),this.fileChoosed=!0,this.treeData.forEach(s=>{this.waitChart[s.id]=!0});let e=this.treeData.slice();e.splice(this.curView.value,1),e.unshift(this.treeData[this.curView.value]),e=e.filter(s=>s.carType===this.carType&&s.sdb===this.sdb),await this.play(this.treeData[this.curView.value]),this.signalLoading=!1;for(let s=0;s<e.length;s++)await this.play(e[s]),s===0&&(this.chartDataLoaded=!0)})():this.fileType==="asc"?(this.chartDataLoaded=!1,this.clearTimeData(),u.ascReader.getAscdata({ascFile:this.directory}).then(async e=>{var a,l;this.startTime=((l=(a=e.data)==null?void 0:a.data)==null?void 0:l.startTime)||0,this.fileChoosed=!0,this.treeData.forEach(t=>{this.waitChart[t.id]=!0});let s=this.treeData.slice();s.splice(this.curView.value,1),s.unshift(this.treeData[this.curView.value]),s=s.filter(t=>t.carType===this.carType&&t.sdb===this.sdb),u.ascReader.haveDataSignal({ascFile:this.directory}).then(t=>{this.filledOptions=Object.freeze(t.data),this.signalLoading=!1});for(let t=0;t<s.length;t++)await this.play(s[t]),t===0&&(this.chartDataLoaded=!0)}).catch(()=>{}).finally(()=>{this.chartDataLoaded=!0,this.signalLoading=!1})):this.fileType==="log"&&(this.chartDataLoaded=!1,this.clearTimeData(),u.logReader.getLogData({logFile:this.directory}).then(async e=>{var a,l;this.startTime=((l=(a=e.data)==null?void 0:a.data)==null?void 0:l.startTime)||0,this.fileChoosed=!0,this.treeData.forEach(t=>{this.waitChart[t.id]=!0});let s=this.treeData.slice();s.splice(this.curView.value,1),s.unshift(this.treeData[this.curView.value]),s=s.filter(t=>t.carType===this.carType&&t.sdb===this.sdb),u.logReader.haveDataSignal({ascFile:this.directory}).then(t=>{this.filledOptions=Object.freeze(t.data),this.signalLoading=!1});for(let t=0;t<s.length;t++)await this.play(s[t]),t===0&&(this.chartDataLoaded=!0)}).catch(()=>{}).finally(()=>{this.chartDataLoaded=!0,this.signalLoading=!1}))},clearTimeData(){for(let e in this.timeData)this.timeData[e]=[];this.treeData.forEach(e=>{e.children.forEach(s=>{s.warning=void 0})})},hideSignal(e,s){this.waitChart[e.pid]||(e.hidden=!e.hidden,this.play(s,!0))},deleteSignal(e){this.waitChart[e.pid]||(this.treeData=this.treeData.map(s=>{if(s.id==e.pid){let a={...s,children:s.children.filter(l=>!(l.id==e.id&&l.msg==e.msg&&l.channel==e.channel))};return this.$nextTick(()=>this.play(a,!0)),a}return{...s}}))},async play(e,s){if(this.blfcpp==="python"){if(!this.fileChoosed)return;if(s){this.loadChart(e,s);return}this.waitChart[e.id]=!0;let t;if(this.fileType==="blf")try{t=await u.blf.getAnalysisByParams({params:e.children.map(r=>[r.channel,r.msg,r.text])})}catch(r){this.waitChart[e.id]=!1;return}if(this.fileType==="asc")try{t=await u.ascReader.getAnalysisByParams({params:e.children.map(r=>[r.channel,r.msg,r.text])})}catch(r){this.waitChart[e.id]=!1;return}if(this.fileType==="log")try{t=await u.logReader.getAnalysisByParams(e.children.map(r=>({busId:+r.channel,canId:+r.msg,name:r.text})))}catch(r){this.waitChart[e.id]=!1;return}const i={};for(let r in t.data){const o=t.data[r];let h=!o[6],m=Object.freeze(o[3].map(c=>{if(h)return parseFloat(c[1]);{let d=parseFloat(c[1]),v=new Number(d);return v.valueOf=()=>d,v.toString=()=>"0x"+B(c[1]),v}}));this.traceList.set(o[0]+"_"+o[2],{name:this.C2C[+o[0]]+"-"+o[2],t:Object.freeze(o[3].map(c=>Math.round(c[0][0]*1e3)/1e3)),v:m,enums:o[4],cycle:o[5],safe:h}),i[o[0]+"_"+o[2]]=o[3].length}e.children=e.children.map(r=>{let o=!1;switch(i[r.channel+"_"+r.text]){case 0:o=!0;break;case void 0:o=null;break}return{...r,warning:o}}),this.loadChart(e),this.waitChart[e.id]=!1;return}if(!this.fileChoosed)return;if(s){this.loadChart(e,s);return}this.waitChart[e.id]=!0;let a;try{if(this.fileType==="mdf")a=await u.mdf.getAnalysisByParams({signals:e.children.map(t=>({busId:+t.channel,canId:+t.msg,name:t.text}))}),a&&(this.chartDataLoaded=!0);else if(this.fileType==="blf")a=await u.blf.getAnalysisByParams(e.children.map(t=>({busId:+t.channel,canId:+t.msg,name:t.text})));else if(this.fileType==="log")try{a=await u.logReader.getAnalysisByParams(e.children.map(t=>({busId:+t.channel,canId:+t.msg,name:t.text})))}catch(t){this.waitChart[e.id]=!1;return}else try{a=await u.ascReader.getAnalysisByParams({params:e.children.map(t=>[t.channel,t.msg,t.text])})}catch(t){this.waitChart[e.id]=!1;return}}catch(t){this.waitChart[e.id]=!1;return}const l={};if(this.fileType==="mdf")for(let t in a.data.data){const i=a.data.data[t];let r=!i.overLenData,o=Object.freeze(i.values.map(h=>{if(r)return parseFloat(h);{let m=parseFloat(h),c=new Number(m);return c.valueOf=()=>m,c.toString=()=>"0x"+B(h),c}}));this.traceList.set(i.busId+"_"+i.name,{name:this.C2C[+i.busId]!=null?this.C2C[+i.busId]+"-"+i.name:i.name,t:Object.freeze(i.times),v:o,enums:i.enums,cycle:i.cycle}),l[i.busId+"_"+i.name]=i.times.length}else if(this.fileType==="blf")for(let t in a.data){const i=a.data[t];let r=!i.overLenData,o=Object.freeze(i.values.map(h=>{if(r)return parseFloat(h);{let m=parseFloat(h),c=new Number(m);return c.valueOf=()=>m,c.toString=()=>"0x"+B(h),c}}));this.traceList.set(i.busId+"_"+i.name,{name:this.C2C[+i.busId]+"-"+i.name,t:Object.freeze(i.times),v:o,enums:i.enums,cycle:i.cycle}),l[i.busId+"_"+i.name]=i.times.length}else for(let t in a.data){const i=a.data[t];let r=!i[6],o=Object.freeze(i[3].map(h=>{if(r)return parseFloat(h[1]);{let m=parseFloat(h[1]),c=new Number(m);return c.valueOf=()=>m,c.toString=()=>"0x"+B(h[1]),c}}));this.traceList.set(i[0]+"_"+i[2],{name:this.C2C[+i[0]]+"-"+i[2],t:Object.freeze(i[3].map(h=>Math.round(h[0][0]*1e3)/1e3)),v:o,enums:i[4],cycle:i[5],safe:r}),l[i[0]+"_"+i[2]]=i[3].length}e.children=e.children.map(t=>{switch(l[t.channel+"_"+t.text]){case 0:t.warning=!0;break;case void 0:t.warning=null;break;default:t.warning=!1;break}return{...t}}),this.loadChart(e),this.waitChart[e.id]=!1},loadChart(e){const s={blue:"#2266ff",cerulean:"#00c7f2",cyan:"#00e0b8",green:"#3fd926",lime:"#add900",purple:"#8125ff",pink:"#ff4475",red:"#ff3838",orange:"#ffad4d",yellow:"#f1d900"},a=e.children.filter(l=>{var t;return!l.hidden&&((t=this.traceList.get(l.channel+"_"+l.text))==null?void 0:t.t.length)>0}).map(l=>{const t=this.traceList.get(l.channel+"_"+l.text);return Object.assign(t,{color:s[l.color]})});this.timeData[e.id]=a},updateSignal(e){const s=this.view;this.treeData=this.treeData.map(a=>{if(a.id==s.id){let l=e.map((i,r)=>{let o=a.children.find(h=>i.id==h.id&&i.msg==h.msg&&i.channel==h.channel);return o?{...o,pid:a.id,color:this.colorList[r%9]}:{_id:i._id,pid:a.id,id:i.id,text:i.text,comment:i.comment,remark:i.remark,msg:i.msg,channel:i.channel,type:"signal",color:this.colorList[r%9],colorEditable:!1}});const t={...a,children:l};return this.play(t),t}return a}),this.chooseSignalAble=!1},goBackHome(){this.$router.push({path:"/"})},importFile(){this.modal.visible=!0},addView(e){let s=e.label||"新建视图"+(this.treeData.length+1);if(this.treeData=[...this.treeData,{id:e.id||Date.now(),text:s,type:"view",editable:!1,deleteConfirm:!1,children:(e==null?void 0:e.children)||[],carType:(e==null?void 0:e.carType)||this.carType,sdb:(e==null?void 0:e.sdb)||this.sdb}],(e==null?void 0:e.from)==="AddOrSelector"){let a=this.treeData.length-1;this.curView={label:this.treeData[a].text,value:a}}},onSwitchView({fromNode:e,toNode:s}){this.view.id===e.id?this.curView.value=this.treeData.findIndex(a=>a.id===s.id):this.view.id===s.id&&(this.curView.value=this.treeData.findIndex(a=>a.id===e.id)),this.treeData=this.treeData.map(a=>a.id===e.id?s:a.id===s.id?e:a)},manageShow(){this.manageModal.manageVisible=!0},onCancelImportFile(){this.modal.visible=!1},async onCancelSelect(e){this.manageModal.manageVisible=!1;const s=this.treeData.findIndex(l=>l.id===e),a=this.treeData[s];if(this.curView={label:this.treeData[s].text,value:s,tag:a.sdb},this.carType!==a.carType||this.sdb!==a.sdb){let l=[],t=[];if(a.carType==="custom"){const r=(this.$ls.get("blfread_sdbData")||[]).find(o=>o.sdb===a.sdb);l=r.files,t=r.comments}this.onCheckView({curId:a.id,carType:a.carType,sdb:a.sdb,directory:this.directory,files:l,comments:t})}else this.$nextTick(()=>{const l=a,t=l.id;this.waitChart[t]===void 0&&this.directory&&this.play(l)}),this.fileType=="mdf"&&this.play(this.treeData[this.curView.value])},onCheckView(e){this.signalLoading=!0,this.resetTimeData(),this.$nextTick(()=>{this.modal.visible=!1;let a=this.treeData.filter(l=>l.id===e.curId).map(l=>({label:l.text,value:this.treeData.findIndex(t=>t.id===e.curId)}));this.curView=a[0],this.carType=e.carType,this.sdb=e.sdb,this.directory=I(e.directory),this.files=e.files.length?e.files:void 0,this.comments=e.comments.length?e.comments:void 0,this.fileType=e.fileType,e.isBigFile!==void 0&&(this.isBigFile=e.isBigFile),e.fileType==="mdf"?(this.chartDataLoaded=!1,u.mdf.getSignals({mdfPath:e.directory}).then(l=>{this.defaultOptions=[],this.defaultOptions=Object.freeze(l.data.data)}).then(()=>{this.choosePath()})):this.$nextTick(async()=>{this.carType==="custom"?this.fileType==="blf"?await u.blf.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then(l=>{this.defaultOptions=Object.freeze(l.data)}):this.fileType==="log"?await u.logReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then(l=>{this.defaultOptions=Object.freeze(l.data)}):await u.ascReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then(l=>{this.defaultOptions=Object.freeze(l.data)}):this.fileType==="blf"?await u.blf.reAdjust(e.sendReAdjust):this.fileType==="log"?(e.adaptedType=="noAdapted"&&await u.logReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then(l=>{this.defaultOptions=Object.freeze(l.data)}),await u.logReader.reAdjust(e.sendReAdjust)):(e.adaptedType=="noAdapted"&&await u.ascReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then(l=>{this.defaultOptions=Object.freeze(l.data)}),await u.ascReader.reAdjust(e.sendReAdjust)),this.choosePath()})}),H.report("track","click",{element_name:"查看报文",asset_name:this.directory+";",tip:"1174.10.0.1.27766"})},onExportArea(e){const s=this.view.children.filter(i=>i.warning===!1),a=this.timeData[this.view.id];let l="csv",t="CSV文件 (*.csv;*.CSV)";switch(e.type){case"blf":l="blf",t="BLF文件 (*.blf;*.BLF)";break;case"mdf":l="mf4",t="MDF文件 (*.mf4;*.MF4)";break;case"mat":l="mat",t="MAT文件 (*.mat;*.MAT)";break}j.choosePath({directory:this.directory.replace(/\/[^\/]+$/,""),saveFilename:this.directory.match(/\/([^\/]+)$/)[1].replace(/.blf|.dat|.mdf|.mf4|.asc|.log/i,"_cut-".concat(e.start,"-").concat(e.end,".").concat(l)),dialogType:"SAVE_DIALOG",fileTypes:[t],allow_multiple:!1}).then(i=>{if(i.data.directory){const r=I(i.data.directory),o=I(this.directory),h=a.map((c,d)=>{const v=c.t.findIndex(M=>M>=e.start),A=c.t.length-c.t.slice().reverse().findIndex(M=>M<=e.end);return{busId:s[d].channel,busName:(this.C2C[+s[d].channel]||"").slice(1),canId:s[d].msg,cycle:c.cycle,enums:c.enums,name:s[d].text,times:c.t.slice(v,A),values:c.v.slice(v,A)}});this.showMessage({level:"loading",content:"导出中..."});let m="";R=="mac"?r.includes(e.type)?m=r:m=r+e.type:m=r,this.fileType==="log"?u.logReader.exportFile({filePath:o,outputFilePath:m,type:e.type,resampleRate:e.resampleRate,startTime:e.startTime,endTime:e.endTime,data:h}).then(c=>{this.showMessage({level:"success",content:"导出成功",timeout:2e3}),this.downloadMessage.path=m,this.downloadMessage.show=!0}).catch(c=>{this.showMessage({level:"error",content:"导出失败",timeout:2e3})}):u.blf.exportFile({filePath:o,outputFilePath:m,type:e.type,resampleRate:e.resampleRate,startTime:e.startTime,endTime:e.endTime,data:h}).then(c=>{this.showMessage({level:"success",content:"导出成功",timeout:2e3}),this.downloadMessage.path=m,this.downloadMessage.show=!0}).catch(c=>{this.showMessage({level:"error",content:"导出失败",timeout:2e3})})}})},onExportDotsData(e){const s=e.map(a=>a.join("	")).join("\n");we(s,"tspa-打点-"+ge()+".txt")}}},C=e=>(Y("data-v-d501986f"),e=e(),Z(),e),He={class:"blf-check"},We=C(()=>n("i",{class:"lead-icon"},null,-1)),Ge={key:0},qe={key:1},Je={class:"record-header-message"},Xe={class:"record-header-message-imp"},Ke={class:"record-header-message-imp"},Qe={class:"o-pul-er"},Ye={key:0,class:"o-column"},Ze={class:"o-column-left"},$e=C(()=>n("div",{class:"o-resize-bar"},null,-1)),et=C(()=>n("div",{class:"o-resize-line"},null,-1)),tt={class:"o-resize-save"},st={class:"o-pul-board"},it={class:"o-pul-select-wrap"},at={class:"o-pul-button-wrap"},lt=C(()=>n("i",{class:"t-icon chooseSignal"},null,-1)),rt=C(()=>n("span",null,"选择信号",-1)),nt=[lt,rt],ot=C(()=>n("span",{style:{color:"#D9D9D9","font-size":"18px",transform:"scaleX(0.5)"}},"|",-1)),dt=C(()=>n("i",{class:"t-icon manageView"},null,-1)),ct=C(()=>n("span",null,"管理视图",-1)),ht=[dt,ct],pt=["data-empty"],ut=["data-hidden"],ft=["data-open","onClick"],mt=["data-color","onClick"],gt=["onMouseleave"],yt=["title","data-color","onClick"],bt={class:"t-node-text"},_t={key:0,class:"t-node-warning"},Ct={key:1,class:"t-node-error"},Dt=["onClick"],wt=["onClick"],vt=C(()=>n("div",{class:"drag-icon"},null,-1)),Tt={class:"o-column-right"},kt=["data-loading"],St={class:"tch-tool-er"},xt={class:"tch-tool-hotkey-er"},Vt={class:"timechart-hotkey"},Mt={class:"hotkey-more"},Ft=C(()=>n("div",{class:"hotkey-icon-book"},null,-1)),Lt={class:"hotkey-more-body"},At=be('<li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>缩放横轴 <span class="hotkey-btn" data-v-d501986f>ctrl+滚轮</span></div></li><li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>平移横轴 <span class="hotkey-btn" data-v-d501986f>shift+滚轮</span></div></li><li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>缩放纵轴 <span class="hotkey-btn" data-v-d501986f>alt+ctrl+滚轮</span></div></li><li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>平移纵轴 <span class="hotkey-btn" data-v-d501986f>alt+shift+滚轮</span></div></li><li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>框选放大 <span class="hotkey-btn" data-v-d501986f>左键拖拽</span></div></li><li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>复位轴 <span class="hotkey-btn" data-v-d501986f>左键双击</span></div></li><li data-v-d501986f><div class="timechart-hotkey-it" data-v-d501986f>选择帧 <span class="hotkey-btn" data-v-d501986f>左键单击</span></div></li>',7),Bt={class:"timechart-hotkey-it"},Ot={class:"hotkey-btn"},It=C(()=>n("li",null,[n("div",{class:"timechart-hotkey-it"},[w("框选时段 "),n("span",{class:"hotkey-btn"},"shift+左键")])],-1)),Pt={class:"tch-tool-blank-er"},Et=C(()=>n("div",{class:"tch-tool-span"},null,-1)),Nt=C(()=>n("div",{class:"tch-tool-span"},null,-1)),Ut=["id"],zt={key:1,class:"board-spin-er"},Rt={class:"board-spin-progress"},jt={class:"board-spin-text"};function Ht(e,s,a,l,t,i){var U,z;const r=y("Button"),o=y("Header"),h=y("AddOrSelector"),m=y("ChooseSignal"),c=y("Draggable"),d=y("v-select"),v=y("ButtonGroup"),A=y("TimePlotMulti"),M=y("ProgressBar"),te=y("ImportFileDialog"),se=y("ManageViewsGroup"),ie=y("Message"),ae=y("DownloadMessage"),S=N("tooltip");return f(),g(W,null,[n("div",He,[k(o,{title:"查看报文-信号分析",quitConfirm:i.quitConfirm,backBlock:t.backBlock},{default:F(()=>[k(r,{type:"primary",class:"header-import-btn",onClick:i.importFile},{default:F(()=>[We,w("导入文件")]),_:1},8,["onClick"]),t.debug?(f(),g("label",Ge,[_(n("input",{type:"radio","onUpdate:modelValue":s[0]||(s[0]=p=>t.blfcpp=p),value:"python"},null,512),[[G,t.blfcpp]]),w("python")])):b("",!0),t.debug?(f(),g("label",qe,[_(n("input",{type:"radio","onUpdate:modelValue":s[1]||(s[1]=p=>t.blfcpp=p),value:"cpp"},null,512),[[G,t.blfcpp]]),w("cpp")])):b("",!0),n("span",Je,[w(" 文件："),n("span",Xe,D(i.directoryLabel||"--"),1),_(n("span",{style:{color:"#333","text-shadow":"0 0.3px currentColor"}},"（"+D(t.directorySize.label)+"）",513),[[q,t.directorySize.value]]),w("  DBC配置："),n("span",Ke,D(i.carTypeLabel)+D(t.sdb||"--"),1)])]),_:1},8,["quitConfirm","backBlock"]),n("div",Qe,[i.view?(f(),g("div",Ye,[n("div",Ze,[$e,et,n("div",tt,[n("div",st,[n("div",it,[k(h,{options:i.treeDataDbc,placeholder:"输入视图名称",modelValue:t.curView,"onUpdate:modelValue":s[2]||(s[2]=p=>t.curView=p),onAdd:i.addView},null,8,["options","modelValue","onAdd"])]),n("div",at,[n("div",{class:"head-btn",onClick:s[3]||(s[3]=L(()=>t.chooseSignalAble=!t.chooseSignalAble,["prevent","stop"]))},nt),ot,n("div",{class:"head-btn",id:"delete_module",onClick:s[4]||(s[4]=p=>i.manageShow())},ht),t.chooseSignalAble?(f(),x(m,{key:0,defaultOptions:t.defaultOptions,filledOptions:t.filledOptions,signals:i.view.children,onSignalsChange:i.updateSignal,loading:t.signalLoading,carType:t.carType,fileType:t.fileType,sdb:t.sdb,onCancel:s[5]||(s[5]=()=>t.chooseSignalAble=!1)},null,8,["defaultOptions","filledOptions","signals","onSignalsChange","loading","carType","fileType","sdb"])):b("",!0)]),n("div",{class:"o-pul-tree-er","data-empty":i.view.children.length===0},[i.view?(f(),x(c,{key:0,onDrag:s[6]||(s[6]=L(()=>{},["stop"])),onDragstart:s[7]||(s[7]=L(()=>{},["stop"])),maxLevel:1,class:"t-list",modelValue:i.view.children,"onUpdate:modelValue":s[8]||(s[8]=p=>i.view.children=p),onAfterDrop:s[9]||(s[9]=p=>i.play(i.view,!0))},{default:F(({node:p,stat:O})=>[n("div",{class:"t-node","data-type":"signal","data-hidden":p.hidden},[n("i",{class:"t-node-exp","data-open":O.open,onClick:T=>O.open=!O.open},null,8,ft),w(),_((f(),g("i",{class:"t-node-icon","data-color":p.color,onClick:L(T=>p.colorEditable=!0,["stop","prevent"])},[_(n("div",{class:"color-picker",onMouseleave:T=>p.colorEditable=!1},[(f(!0),g(W,null,_e(t.colorList,T=>(f(),g("div",{class:"color-item",title:T,"data-color":T,key:T,onClick:Wt=>{p.color=T,i.play(i.view,!0)}},null,8,yt))),128))],40,gt),[[q,p.colorEditable]])],8,mt)),[[S,"更改颜色"]]),_((f(),g("span",bt,[n("span",null,D(t.fileType!=="mdf"?t.C2C[p.channel]+"-":"")+D(p.text),1),p.warning===!0?_((f(),g("div",_t,null,512)),[[S,"信号无数据"]]):b("",!0),!p.hidden&&p.warning===null?_((f(),g("div",Ct,null,512)),[[S,"文件内无此信号"]]):b("",!0)])),[[S,{content:i.title4node(p),html:!0},void 0,{right:!0}]]),_(n("div",{class:"t-node-delete",onClick:T=>i.deleteSignal(p)},null,8,Dt),[[S,"删除"]]),_(n("div",{class:"t-node-watch",onClick:T=>{i.hideSignal(p,i.view)}},null,8,wt),[[S,"显示|隐藏"]])],8,ut)]),_:1},8,["modelValue"])):b("",!0)],8,pt)])]),vt]),n("div",Tt,[n("div",{class:"timechart-er","data-loading":t.waitChart[i.view.id]},[n("div",St,[n("div",xt,[n("div",Vt,[n("div",Mt,[Ft,w("快捷键 "),n("div",Lt,[n("ul",null,[At,n("li",null,[n("div",Bt,[w("打点 "),n("span",Ot,D(t.system==="mac"?"option":"alt")+"+左键",1)])]),It])])])])]),n("div",Pt,[_((f(),x(r,{class:"tch-tool-btn",onClick:s[10]||(s[10]=p=>t.showDotsFrame=!t.showDotsFrame)},{default:F(()=>[w("打点")]),_:1})),[[S,"alt+左键"]]),Et,_(k(d,{options:t.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:t.timeFilterMode,"onUpdate:modelValue":s[11]||(s[11]=p=>t.timeFilterMode=p),class:"tch-tool-select"},null,8,["options","modelValue"]),[[S,"时间显示"]]),Nt,k(v,{options:t.modeOptions,modelValue:t.chartMode,"onUpdate:modelValue":s[12]||(s[12]=p=>t.chartMode=p)},null,8,["options","modelValue"])])]),(f(),g("div",{id:"timechart_"+i.view.id,style:ye("width: 100%; height: calc(100% - 50px);min-height: ".concat(t.chartMode==="single"?(((U=t.timeData[i.view.id])==null?void 0:U.length)||0)*50+1:1,"px;")),key:i.view.id},[((z=t.timeData[i.view.id])==null?void 0:z.length)>0?(f(),x(A,{key:0,"data-cy":"timePlotMulti",fileType:t.fileType,exportTypeValue:t.exportTypeValue,exportTypeOptions:t.exportTypeOptions,timeData:t.timeData[i.view.id],onExportAreaData:i.onExportArea,mode:t.chartMode,startTime:t.startTime,timeFilter:t.timeFilterMode.value,showDotsFrame:t.showDotsFrame,"onUpdate:showDotsFrame":s[13]||(s[13]=p=>t.showDotsFrame=p)},null,8,["fileType","exportTypeValue","exportTypeOptions","timeData","onExportAreaData","mode","startTime","timeFilter","showDotsFrame"])):b("",!0)],12,Ut))],8,kt)])])):b("",!0),t.chartDataLoaded?b("",!0):(f(),g("div",zt,[n("div",Rt,[t.directorySize.durationMaybe?(f(),x(M,{key:0,second:t.directorySize.durationMaybe},null,8,["second"])):b("",!0)]),n("div",jt,"正在解析文件 "+D(i.directoryLabel)+"（"+D(t.directorySize.label)+"），约"+D(t.directorySize.durationMaybeLabel)+"…",1)]))]),t.modal.visible?(f(),x(te,{key:0,curViewInx:t.curView.value,from:"reader",title:t.modal.title,onCancel:i.onCancelImportFile,onImportFileSubmit:i.onCheckView,hisDirectory:t.directory,carType:t.carType,sdb:t.sdb,onTreeDataChange:i.onTreeDataChange,onUpdateDefaultOptions:i.onUpdateDefaultOptions},null,8,["curViewInx","title","onCancel","onImportFileSubmit","hisDirectory","carType","sdb","onTreeDataChange","onUpdateDefaultOptions"])):b("",!0),t.manageModal.manageVisible?(f(),x(se,{key:1,fileType:t.fileType,propTreeData:t.treeData,curViewInx:t.curView.value,title:t.manageModal.title,onCancel:i.onCancelSelect,onDelete:i.deleteView,onUpdate:i.updateView,onImport:i.onImportView,onAdd:i.addView,onSwitch:i.onSwitchView},null,8,["fileType","propTreeData","curViewInx","title","onCancel","onDelete","onUpdate","onImport","onAdd","onSwitch"])):b("",!0)]),k(ie,{message:t.message},null,8,["message"]),t.downloadMessage.show?(f(),x(ae,{key:0,path:t.downloadMessage.path,onClose:s[14]||(s[14]=p=>t.downloadMessage.show=!1)},null,8,["path"])):b("",!0)],64)}const os=Q(je,[["render",Ht],["__scopeId","data-v-d501986f"]]);export{os as default};
