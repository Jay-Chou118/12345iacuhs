import{H as x}from"./Header-47db3939.js";import{C as q}from"./CopyPath-5fe967ab.js";import{B as L}from"./Button-41eb78ea.js";import{M as B}from"./Message-a2ed2e47.js";import{_ as E,k as g,e as C,r as p,c as l,h as c,d as o,i as m,a as n,F as P,m as V,t as v,f as D,w as k,v as b,o as d,p as F,b as N}from"./index-6a1d12a0.js";import{n as M}from"./index-2f1ffef1.js";let y=0;const W={props:["store"],components:{Button:L,Header:x,CopyPath:q,Message:B},data(){return{consoleText:"",errorNumber:0,directory:"",onFlag:!0,chartDataLoaded:!0,fileDirectory:[],fileDirectoryStr:"",inputFiles:[],fileTypesList:[],dbcCheckValid:!1,recLoading:!1,recLoadingProgress:"",showWaitWarn:!1,showWaitWarnMsg:"",consoleText:"",respData:[],message:{visible:!1,level:"",content:""}}},watch:{chartDataLoaded(e,s){e?(document.querySelector("#app").style.cursor="",document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor="",document.querySelector(".o-pul-er").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".o-pul-er").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none")}},computed:{quitConfirm(){return!!this.directory.trim()}},mounted(){},methods:{choosePath(){let e=[];const s=this.directory.split("/").slice(0,-1).join("/");this.fileTypesList=["DBC文件 (*.dbc;*.DBC)"],g.choosePath({directory:s,dialogType:"OPEN_DIALOG",fileTypes:this.fileTypesList,allow_multiple:!0}).then(r=>{if(r.data.directory){this.fileDirectory=r.data.directory.sort((t,i)=>t.split("/").pop()>i.split("/").pop()?1:-1).map(t=>M(t)),this.fileDirectoryStr=this.fileDirectory.join(",");var _=/[,]/g;this.fileDirectoryStr=this.fileDirectoryStr.toString().replace(_,"$&\r\n"),this.fileDirectory.forEach((t,i)=>{let h={file_name:t};e.push(h)}),console.log("this.inputFiles",e),this.inputFiles=e,this.dbcCheckValid=!0,this.consoleText=""}})},async startCheck(){console.log("导入文件",this.fileDirectory),this.dbcCheckValid=!1,this.consoleText="检测中...\n",await C.DBCCheck.start_check({dbc_paths:this.fileDirectory}).then(e=>{this.dbcCheckValid=!0,this.consoleText="",this.respData=e.data.data,console.log("res>>",this.respData),this.respData&&this.respData.forEach(s=>{this.consoleText+=s+"\n"})})},async exportResult(){let e=this.fileDirectory[0].split("/").slice(0,-1).join("/");console.log("this.directory2222222",e),await g.choosePath({directory:e,dialogType:"SAVE_DIALOG",saveFilename:"check_result.txt",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then(s=>{s.data.directory&&C.DBCCheck.export({data:this.respData,path:s.data.directory}).then(r=>{console.log("res111",r.data),r.data.code=="0"&&this.showMessage({timeout:5e3,level:"success",content:"导出成功"})})})},showMessage({level:e,content:s,timeout:r}){clearTimeout(y),e!=null&&(this.message.level=e),s!=null&&(this.message.content=s),this.message.visible=!0,r>0&&(y=setTimeout(()=>{console.log(y,"msgTimer"),this.message.visible=!1},r))}}},a=e=>(F("data-v-7bd2e333"),e=e(),N(),e),I={class:"diagnostics-data"},j={class:"o-pul-er",id:"el-record-form"},H=a(()=>o("div",{class:"o-pul-title"},"文件导入配置",-1)),A={class:"o-pul-p"},O=a(()=>o("span",{style:{color:"red"}},"* ",-1)),R=a(()=>o("span",{class:"record-header-message"},"对象文件：",-1)),G={key:0,class:"o-warn"},z=a(()=>o("i",{class:"warn-icon"},null,-1)),J={key:0,class:"o-pul-p start-rec"},K=a(()=>o("i",{class:"play-icon"},null,-1)),Q=["data-empty"],U={class:"o-console-wrap"},X=a(()=>o("div",{class:"o-console-title"},"检测结果",-1)),Y=["data-loading"];function Z(e,s,r,_,t,i){const h=p("Header"),u=p("Button"),T=p("CopyPath"),S=p("Message");return d(),l("div",I,[c(h,{title:"DBC检查",quitConfirm:i.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),o("div",j,[H,o("div",A,[O,R,c(u,{onClick:i.choosePath,class:"choose-path"},{default:m(()=>[n("选择文件")]),_:1},8,["onClick"]),n("  "),(d(!0),l(P,null,V(t.fileDirectory,(f,w)=>(d(),l("div",{class:"o-pul-file",key:w},[c(T,{path:f,length:60},null,8,["path"])]))),128)),t.showWaitWarn?(d(),l("div",G,[z,n(v(t.showWaitWarnMsg),1)])):D("",!0)]),t.onFlag?(d(),l("div",J,[c(u,{type:"primary",disabled:!t.dbcCheckValid,progress:t.recLoadingProgress,loading:t.recLoading,onClick:i.startCheck},{default:m(()=>[K,n("开始检测")]),_:1},8,["disabled","progress","loading","onClick"])])):D("",!0)]),o("div",{class:"o-console-er","data-empty":t.consoleText==="",id:"el-record-console"},[o("div",U,[X,k(c(u,{onClick:s[0]||(s[0]=f=>i.exportResult()),class:"export-result"},{default:m(()=>[n("导出结果")]),_:1},512),[[b,t.consoleText]])]),k(o("div",{class:"o-console-body","data-loading":!t.chartDataLoaded},v(t.consoleText),9,Y),[[b,t.consoleText]])],8,Q),c(S,{message:t.message},null,8,["message"])])}const ie=E(W,[["render",Z],["__scopeId","data-v-7bd2e333"]]);export{ie as default};
