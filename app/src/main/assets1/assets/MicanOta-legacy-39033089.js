System.register(["./Header-legacy-c1bbc3dd.js","./Button-legacy-e57cd1da.js","./Message-legacy-2a8c9483.js","./index-legacy-0403042b.js"],(function(e,a){"use strict";var s,t,o,l,i,n,d,r,c,u,p,h,g,m,v,V,M,T;return{setters:[e=>{s=e.H},e=>{t=e.B},e=>{o=e.M},e=>{l=e._,i=e.e,n=e.r,d=e.c,r=e.h,c=e.d,u=e.t,p=e.i,h=e.w,g=e.v,m=e.j,v=e.o,V=e.a,M=e.p,T=e.b}],execute:function(){let a=0,y=0;const f={components:{Button:t,Header:s,Message:o},data:()=>({updateVersionOptions:[],updateVersionMode:{},softWareVer:"",hardWareVer:"",consoleText:"",chartDataLoaded:!0,updateVersionValid:!1,message:{visible:!1,level:"",content:""}}),computed:{updateVersionValid(){return!!(this.softWareVer.startsWith("CR")&&this.hardWareVer&&this.updateVersionMode.value)}},mounted(){m.report("trackPage",{page:"MICAN软件更新",tip:"1174.19.0.1.34801"}),this.getSnSw(),this.getSWPackages()},unmounted(){this.removeProcess()},methods:{async getSnSw(){clearTimeout(0),await i.miCANOTA.getSnSw().then((e=>{console.log("获取软件号和设备号",e.data),"200"==e.status&&(this.softWareVer=e.data.data.sn,this.hardWareVer=e.data.data.sw)})).catch((()=>{console.log("超时3000"),this.showMessage({level:"error",content:"获取软件号和设备号失败",timeout:3e3})}))},async getSWPackages(){await i.miCANOTA.getSWPackages().then((e=>{console.log("获取软件列表",e);let a=e.data,s={};"200"==e.status&&a.forEach((e=>{s={label:e,value:e},this.updateVersionOptions.push(s)}))}))},async removeProcess(){await i.miCANOTA.removeProcess()},async updateVersion(){clearTimeout(0),clearTimeout(y),console.log("updateVersionMode",this.updateVersionMode),this.consoleText="软件更新中...\n",await i.miCANOTA.miCANUpdata({binName:this.updateVersionMode.value}).then((e=>{console.log("软件刷写",e.data),this.consoleText=e.data.msg,y=setTimeout((()=>{this.getSnSw()}),1e3)})).catch((()=>{console.log("超时5000"),this.showMessage({level:"error",content:"更新软件失败",timeout:5e3}),this.consoleText="更新软件失败"})),m.report("track","click",{element_name:"更新软件",tip:"1174.19.0.1.34803"})},showMessage({level:e,content:s,timeout:t}){clearTimeout(a),null!=e&&(this.message.level=e),null!=s&&(this.message.content=s),this.message.visible=!0,t>0&&(a=setTimeout((()=>{this.message.visible=!1}),t))}}},w=e=>(M("data-v-a0effe8d"),e=e(),T(),e),b={class:"pull-dt-page"},A={class:"o-pul-er"},S=w((()=>c("div",{class:"o-pul-title"},"MICAN软件更新",-1))),W={class:"o-pul-p input-cation"},C=w((()=>c("span",{class:"ota-header-message"},"当前软/硬件号：",-1))),x={class:"ota-header-message-gray"},N={class:"o-pul-p input-cation"},k=w((()=>c("span",{style:{color:"red"}},"* ",-1))),O=w((()=>c("span",{class:"ota-header-message"},"更新的软件号：",-1))),P={class:"o-pul-p update-software"},j=w((()=>c("i",{class:"lead-icon"},null,-1))),_=["data-empty"],B=w((()=>c("div",{class:"o-console-title"},"软件更新结果",-1))),H=["data-loading"];e("default",l(f,[["render",function(e,a,s,t,o,l){const i=n("Header"),m=n("v-select"),M=n("Button"),T=n("Message");return v(),d("div",b,[r(i,{title:"MICAN 固件升级",showRight:!1}),c("div",A,[S,c("div",W,[C,c("span",null,u(o.softWareVer),1),c("span",x,"("+u(o.hardWareVer)+") ",1)]),c("div",N,[k,O,r(m,{options:o.updateVersionOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:o.updateVersionMode,"onUpdate:modelValue":a[0]||(a[0]=e=>o.updateVersionMode=e),class:"tch-tool-select"},null,8,["options","modelValue"])]),c("div",P,[r(M,{type:"primary",disabled:!l.updateVersionValid,onClick:l.updateVersion},{default:p((()=>[j,V("更新软件")])),_:1},8,["disabled","onClick"])])]),c("div",{class:"o-console-er","data-empty":""===o.consoleText,id:"el-record-console"},[B,h(c("div",{class:"o-console-body","data-loading":!o.chartDataLoaded},u(o.consoleText),9,H),[[g,o.consoleText]])],8,_),r(T,{message:o.message},null,8,["message"])])}],["__scopeId","data-v-a0effe8d"]]))}}}));
