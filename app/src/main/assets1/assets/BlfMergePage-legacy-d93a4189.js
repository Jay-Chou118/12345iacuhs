System.register(["./Header-legacy-be6512fa.js","./CopyPath-legacy-3b9f8096.js","./Button-legacy-96fa1df9.js","./index-legacy-16fc9642.js","./index-legacy-bdfd3672.js"],(function(e,t){"use strict";var s,i,o,a,l,r,n,c,d,p,h,u,y,g,f,m,v,w,F,T,L,D,S,b,C,P;return{setters:[e=>{s=e.H},e=>{i=e.C},e=>{o=e.B},e=>{a=e._,l=e.z,r=e.k,n=e.j,c=e.e,d=e.r,p=e.l,h=e.c,u=e.h,y=e.d,g=e.F,f=e.m,m=e.i,v=e.a,w=e.t,F=e.f,T=e.w,L=e.v,D=e.o,S=e.n,b=e.p,C=e.b},e=>{P=e.n}],execute:function(){let t=0;const M={props:["store","closeFlag"],components:{Button:o,Header:s,CopyPath:i},data:()=>({pullType:"blf",chartDataLoaded:!0,directory:"",fileDirectory:[],fileDirectoryStr:"",recList:{csv:{label:"csv",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},asc:{label:"asc",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"},blf:{label:"blf",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},recLoading:!1,recLoadingProgress:"",recordTime:"00:00:00",consoleText:"",message:{visible:!1,level:"",content:""},fileName:"",saveFilename:"",inputFiles:[],mergeDataValid:!1,showWaitWarn:!1,showWaitWarnMsg:"",showPathWarn:!1,showPathWarnMsg:"",computedArr:[],seletFileList:{noAdapted:{label:"blf",value:"blf"},adapted:{label:"asc",value:"asc"}},fileType:"noAdapted",fileTypesList:[]}),watch:{chartDataLoaded(e,t){e?(document.querySelector("#app").style.cursor="",document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor="",document.querySelector(".waitMergeFile").style.pointerEvents="",document.querySelector(".outputFilePath").style.pointerEvents="",document.querySelector(".o-pul-er").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".waitMergeFile").style.pointerEvents="none",document.querySelector(".outputFilePath").style.pointerEvents="none",document.querySelector(".o-pul-er").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none")},inputChanged:{handler(e,t){if(console.log("newVal,oldVal",e,t),e){let e="noAdapted"==this.fileType?[e=>!/.blf$/i.test(e),"输出文件要以.blf结尾"]:[e=>!/.asc$/i.test(e),"输出文件要以.asc结尾"],t=[[e=>!e.length,"请选择待合并文件"],[e=>e.some((e=>/[\s]/g.test(e.file_name))),"路径中不能包含空格"],[e=>e.some((e=>e.file_name.toLowerCase()==this.directory.toLowerCase())),"输出文件不能与输入文件重名"]].find((e=>e[0](this.inputFiles)));this.showWaitWarn=!!t,this.mergeDataValid=!t,this.showWaitWarnMsg=t?t[1]:"",console.log("wait",t),t=[[e=>!e,"请选择路径"],e,[e=>/[\s]/g.test(e),"路径中不能包含空格"],[e=>this.inputFiles.some((t=>t.file_name.toLowerCase()==e.toLowerCase())),"输出文件不能与输入文件重名"]].find((e=>e[0](this.directory))),this.showPathWarn=!!t,this.mergeDataValid=!t,this.showPathWarnMsg=t?t[1]:"",console.log("path",t)}},deep:!0}},mounted(){const e=window.driver.js.driver({doneBtnText:"知道了",closeBtnText:"关闭",nextBtnText:"继续",prevBtnText:"后退",steps:[{element:"#el-record-form",popover:{title:"配置和录制",description:"填写格式和目录信息，点击开始"}},{element:"#el-record-console",popover:{title:"进度提示",description:"此区域提示录制进度"}}]});this.$ls.get("driverRecord")||(e.drive(),this.$ls.set("driverRecord",!0)),n.report("trackPage",{page:"合并报文",tip:"1174.1.0.1.27747"})},computed:{inputChanged(){return[this.directory,this.inputFiles]},quitConfirm(){return!!this.directory.trim()}},unmounted(){},methods:{choosePath(){console.log(this.directory),"noAdapted"==this.fileType?(this.fileTypesList=["BLF文件 (*.blf;*.BLF)"],this.saveFilename="tspa-merge-"+l()+".blf"):(this.saveFilename="tspa-merge-"+l()+".asc",this.fileTypesList=["ASC文件 (*.asc;*.ASC)"]),r.choosePath({directory:this.directory.split("/").slice(0,-1).join("/")||window.downloadPath,saveFilename:this.saveFilename,dialogType:"SAVE_DIALOG",fileTypes:this.fileTypesList,allow_multiple:!1}).then((({data:e})=>{console.log("9292929",e),e.directory&&(this.directory=P(e.directory))}))},fileListFun(){this.directory="",this.fileDirectory=[],this.consoleText=""},chooseFile(){let e=[];const t=this.directory.split("/").slice(0,-1).join("/");"noAdapted"==this.fileType?this.fileTypesList=["BLF文件 (*.blf;*.BLF)"]:this.fileTypesList=["ASC文件 (*.asc;*.ASC)"],r.choosePath({directory:t,dialogType:"OPEN_DIALOG",fileTypes:this.fileTypesList,allow_multiple:!0}).then((t=>{t.data.directory&&(console.log("这里this.directory",this.directory),this.fileDirectory=t.data.directory.sort(((e,t)=>e.split("/").pop()>t.split("/").pop()?1:-1)).map((e=>P(e))),this.fileDirectoryStr=this.fileDirectory.join(","),this.fileDirectoryStr=this.fileDirectoryStr.toString().replace(/[,]/g,"$&\r\n"),this.fileDirectory.forEach(((t,s)=>{0===s&&(this.directory||("noAdapted"==this.fileType?this.directory=P(t.split("/").slice(0,-1).join("/")+"/merge-"+l()+".blf"):this.directory=P(t.split("/").slice(0,-1).join("/")+"/merge-"+l()+".asc")));let i={file_name:t};e.push(i)})),console.log("this.inputFiles",e),this.inputFiles=e)}))},checkPath:e=>!/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/g.test(e)&&!/\s/g.test(e),async startMerge(){if(n.report("track","click",{element_name:"开始合并",asset_name:this.fileDirectory.join(","),tip:"1174.1.0.1.27733"}),0==this.showWaitWarn&&0==this.showPathWarn){this.consoleText="合并中...\n",this.chartDataLoaded=!1,this.mergeDataValid=!1;let e=this.directory;t=setInterval((()=>{this.wheelMergeFile()}),1e3),"noAdapted"==this.fileType?await c.blfMerge.mergeFile({input_files:JSON.parse(JSON.stringify(this.inputFiles)),output_file:e}).finally((()=>{clearInterval(t),setTimeout((async()=>{await this.wheelMergeFile(),this.consoleText+="合并结束\n",this.chartDataLoaded=!0,this.mergeDataValid=!0}),1e3)})):await c.ascMerge.mergeAscFile({input_files:JSON.parse(JSON.stringify(this.inputFiles)),output_file:e}).finally((()=>{clearInterval(t),setTimeout((async()=>{await this.wheelMergeFile(),this.consoleText+="合并结束\n",this.chartDataLoaded=!0,this.mergeDataValid=!0}),1e3)}))}else this.mergeDataValid=!1},async wheelMergeFile(){let e="noAdapted"==this.fileType?c.blfMerge.getExeLog():c.ascMerge.getExeAscLog(),t=await e;console.log("res",t);let s=t.data.data;"200"==t.status&&s.forEach((e=>{this.consoleText+=e+"\n"}))}}},W=e=>(b("data-v-4aaf7e0f"),e=e(),C(),e),_=["data-disabled"],A={class:"o-pul-er",id:"el-record-form"},x=W((()=>y("div",{class:"o-pul-title"},"文件合并配置",-1))),k={class:"o-pul-p"},E=W((()=>y("span",{style:{color:"red"}},"* ",-1))),q=W((()=>y("span",{class:"record-header-message"},"待合并文件格式：",-1))),j=["value"],B={class:"o-pul-p"},V=W((()=>y("span",{style:{color:"red"}},"* ",-1))),N=W((()=>y("span",{class:"record-header-message"},"待合并文件：",-1))),$={key:0,class:"o-warn"},O=W((()=>y("i",{class:"warn-icon"},null,-1))),I={class:"o-pul-p ="},z=W((()=>y("span",{style:{color:"red"}},"* ",-1))),H=W((()=>y("span",{class:"record-header-message"},"输出文件路径：",-1))),J={class:"o-pul-path"},R={key:0,class:"o-warn"},G=W((()=>y("i",{class:"warn-icon"},null,-1))),U={class:"o-pul-p start-rec"},K=W((()=>y("i",{class:"play-icon"},null,-1))),Q=["data-empty"],X=W((()=>y("div",{class:"o-console-title"},"合并结果",-1))),Y=["data-loading"];e("default",a(M,[["render",function(e,t,s,i,o,a){const l=d("Header"),r=d("Button"),n=d("CopyPath"),c=p("tooltip");return D(),h("div",{class:"record-page","data-disabled":!o.chartDataLoaded},[u(l,{title:"合并报文",quitConfirm:a.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),y("div",A,[x,y("div",k,[E,q,(D(!0),h(g,null,f(o.seletFileList,((e,s)=>(D(),h("label",{class:"o-input record-header-message-imp",onChange:t[1]||(t[1]=(...e)=>a.fileListFun&&a.fileListFun(...e)),key:s},[v(" "),T(y("input",{name:"pull_type",type:"radio","onUpdate:modelValue":t[0]||(t[0]=e=>o.fileType=e),value:s},null,8,j),[[S,o.fileType]]),v(w(e.label),1)],32)))),128))]),y("div",B,[V,N,u(r,{onClick:a.chooseFile,class:"choose-path waitMergeFile"},{default:m((()=>[v("选择文件")])),_:1},8,["onClick"]),v("  "),(D(!0),h(g,null,f(o.fileDirectory,((e,t)=>(D(),h("div",{class:"o-pul-file",key:t},[u(n,{path:e,length:60},null,8,["path"])])))),128)),o.showWaitWarn?(D(),h("div",$,[O,v(w(o.showWaitWarnMsg),1)])):F("",!0)]),y("div",I,[z,H,u(r,{onClick:a.choosePath,class:"choose-path outputFilePath"},{default:m((()=>[v("选择路径")])),_:1},8,["onClick"]),v("  "),y("span",J,[T((D(),h("span",null,[v(w(o.directory),1)])),[[c,{content:o.directory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),o.showPathWarn?(D(),h("div",R,[G,v(w(o.showPathWarnMsg),1)])):F("",!0)]),y("div",U,[u(r,{type:"primary",disabled:!o.mergeDataValid,progress:o.recLoadingProgress,loading:o.recLoading,onClick:a.startMerge},{default:m((()=>[K,v(" 开始合并")])),_:1},8,["disabled","progress","loading","onClick"])])]),y("div",{class:"o-console-er","data-empty":""===o.consoleText,id:"el-record-console"},[X,T(y("div",{class:"o-console-body","data-loading":!o.chartDataLoaded},w(o.consoleText),9,Y),[[L,o.consoleText]])],8,Q)],8,_)}],["__scopeId","data-v-4aaf7e0f"]]))}}}));
