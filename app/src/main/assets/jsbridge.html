<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
    (function () {
        if (window.JSBridge) {
            return;
        }
        var messageHandlers = {};

        function send(message, responseCallback) {
            if (responseCallback) {
                var callback = 'cb_' + new Date().getTime();
                message.callback = callback;
                messageHandlers[callback] = responseCallback;
            }
            window.Android.send(JSON.stringify(message));
        }

        function registerHandler(handlerName, handler) {
            messageHandlers[handlerName] = handler;
        }

        function handleNativeResponse(responseData) {
            var response = JSON.parse(responseData);
            var callback = response.callback;
            if (callback) {
                var responseCallback = messageHandlers[callback];
                if (responseCallback) {
                    responseCallback(response.data);
                    if(~callback.indexOf('cb_')){
                        delete messageHandlers[callback];
                    }
                }
            }
        }

        window.JSBridge = {
            send: send,
            registerHandler: registerHandler,
            handleNativeResponse: handleNativeResponse
        };

    })();


    // 发送消息到native
    JSBridge.send({ method: 'method', data: { key: 'value' } }, function (response) {
        console.log(response);
    });

    // 注册native调用的handler
    JSBridge.registerHandler('heartbeat', function (data) {
        console.log(data);
        responseCallback({ key: 'value' });
    });

        function showAndroidToast(toast) {
<!--              JSBridge.send({ method: 'getDeviceInfo', data: { key: 'value' } }, function (res) {-->
<!--                            console.log("111111111",res.sn,res.version);-->
<!--            });-->
                JSBridge.send({ method: 'initDevice', data: { key: 'value' } }, function (res) {
                            console.log("111111111",res.sn,res.version);
            });

        }
        function getCAN() {
                JSBridge.send({ method: 'showLoggingMessage', data: { key: 'value' } }, function (res) {
                            if(res.code == 200)
                            {
                                console.log("recv num ",res.data.frame_data.length);
                                console.log(JSON.stringify(res.data));
                            }
            });

        }


    </script>
</head>
<body>
<input type="button" value="连接设备" onClick="showAndroidToast('Hello Android!')" />
<input type="button" value="获取CAN报文" onClick="getCAN()" />
</body>
</html>