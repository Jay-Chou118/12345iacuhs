System.register(["./Header-legacy-d4dcf97c.js","./Button-legacy-89bc013f.js","./Message-legacy-92dc8029.js","./index-legacy-e5c395b4.js"],(function(e,t){"use strict";var s,o,l,a,i,r,d,n,c,p,u,h,g,m,y,v,L,b,w,D,C,T,f;return{setters:[e=>{s=e.H},e=>{o=e.B},e=>{l=e.M},e=>{a=e._,i=e.k,r=e.e,d=e.j,n=e.r,c=e.l,p=e.c,u=e.h,h=e.d,g=e.F,m=e.m,y=e.i,v=e.a,L=e.w,b=e.t,w=e.v,D=e.o,C=e.n,T=e.p,f=e.b}],execute:function(){let t=0,k=0;const S={props:["store"],components:{Button:o,Header:s,Message:l},data(){let e={pullType:"total",chartDataLoaded:!0,directory:window.downloadPath,pullList:{total:{sshURL:1,label:"MS11全量采集数据",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool,/vde/pool/base,/vde/pool"},MX11DataLog:{sshURL:3,label:"MX11全量采集数据",size:"",paths:"/vde/pool"},dialogMaster:{sshURL:1,label:"DialogMaster日志",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"},dcd:{sshURL:2,label:"DCD日志",size:"",paths:"/var/log"},vdeLog:{sshURL:1,label:"vde日志",size:"",paths:"/log/vde,/persistence/vde/log/mgr,/vde/log/mgr"},shadowLog:{sshURL:1,label:"shadow日志",size:"",paths:"/log/shadow,/persistence/vde/log/shadow,/vde/log/shadow"},OTALog:{sshURL:1,label:"OTA日志",size:"",paths:"/persistence/otamaster,/log/A-core/OTA"}},pullLoading:!1,pullLoadingProgress:"",consoleText:"",message:{visible:!1,level:"",content:""},modal:{visible:!1},clearDataLoaded:!0};return window._debug||delete e.pullList.totalClearVccd,e},watch:{chartDataLoaded(e,t){e?(document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor=""):(document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".record-header").style.cursor="wait")},clearDataLoaded(e,t){e?(document.querySelector("#app").style.cursor="",document.querySelector(".o-body").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".o-body").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none")}},computed:{pullDataValid(){return!(!this.directory||!this.pullType)},quitConfirm(){return!!this.pullLoading}},mounted(){console.log(this.$props.store),d.report("trackPage",{page:"拉取日志&数据",tip:"1174.6.0.1.27753"})},unmounted(){},methods:{showInfo(){this.modal.visible=!0},choosePath(){i.choosePath({directory:this.directory,dialogType:"FOLDER_DIALOG",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then((({data:e})=>{e.directory&&(this.directory=e.directory)}))},heartConsole(){r.pullData.getExeLog().then((({data:e})=>{this.consoleText+=e.data.join("\n").replace(/Active code page: 65001/g,"").replace(/^\s+/g,""),setTimeout((()=>{window.document.querySelector(".o-console-body")&&(window.document.querySelector(".o-console-body").scrollTop=99999999)}))}))},async pullFile(){this.pullLoading=!0,this.chartDataLoaded=!1,d.report("track","click",{element_name:"拉取数据",asset_name:this.directory+";"+JSON.stringify(this.pullType.label),tip:"1174.6.0.1.27754"}),k=setInterval(this.heartConsole,1500),this.pullLoadingProgress="0%";const e=this.pullList[this.pullType].sshURL,t=this.pullList[this.pullType].paths.split(",");let s=t.length,o=0;for(let a in t){let i=t[a],d=+a+1;this.showMessage({level:"loading",content:`下载中（${d}/${t.length}）${i}`});try{(await r.pullData.pullDestinationFolder({sshURL:e,destinationFolderPath:i,directory:this.directory})).data.code&&o++}catch(l){o++}this.pullLoadingProgress=Math.round((a+1)/s*100)+"%"}this.chartDataLoaded=!0,this.showMessage({level:o==s?"error":"success",content:o==s?"下载失败，请查看日志详情":"下载成功",timeout:1e4}),this.pullLoading=!1,this.pullLoadingProgress="",clearInterval(k)},showMessage({level:e,content:s,timeout:o}){clearTimeout(t),null!=e&&(this.message.level=e),null!=s&&(this.message.content=s),this.message.visible=!0,o>0&&(t=setTimeout((()=>{this.message.visible=!1}),o))},hideMessage(){this.message.visible=!1},clearVdeFolder(){this.modal.visible=!0,console.log("111")},cannel(){this.modal.visible=!1},submit(){this.clearDataLoaded=!1,this.modal.visible=!1,r.pullData.clearVdeFolder().then((e=>{this.clearDataLoaded=!0,console.log("clearVde>>",e.data.msg),"成功"==e.data.msg||"执行成功"==e.data.msg?this.consoleText+="\n清除VCCD报文缓存成功\n":this.consoleText+="\n清除VCCD报文缓存失败\n"})).finally((()=>{this.clearDataLoaded=!0}))}}},q=e=>(T("data-v-ebc4f5e9"),e=e(),f(),e),M={class:"pull-dt-page"},x={class:"o-pul-er"},_=q((()=>h("div",{class:"o-pul-title"},"数据拉取",-1))),P={class:"o-pul-p"},R=q((()=>h("span",{style:{color:"red"}},"* ",-1))),U=q((()=>h("span",{class:"record-header-message"},"数采类型：",-1))),V=["value"],z={class:"o-pul-p"},E=q((()=>h("span",{style:{color:"red"}},"* ",-1))),F=q((()=>h("span",{class:"record-header-message"},"保存目录：",-1))),$={class:"o-pul-path"},j={class:"o-pul-p start-rec"},A=["data-empty"],O=q((()=>h("div",{class:"o-console-title"},"拉取进度 ",-1))),I=["data-loading"],B={class:"o-modal-wrap"},H={class:"o-modal-header"},N={class:"o-modal-header-wrap"},X=q((()=>h("div",{class:"o-modal-title"},"提示",-1))),G=q((()=>h("div",{class:"o-modal-container"},[h("span",{class:"record-header-message"},"清除不可逆，确定要清除VCCD报文缓存吗？")],-1))),J={class:"o-modal-footer"},K={class:"o-modal-footer-wrap"};e("default",a(S,[["render",function(e,t,s,o,l,a){const i=n("Header"),r=n("Button"),d=n("Message"),T=c("tooltip");return D(),p("div",M,[u(i,{title:"拉取日志&数据",quitConfirm:a.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),h("div",x,[_,h("div",P,[R,U,(D(!0),p(g,null,m(e.pullList,((s,o)=>(D(),p("label",{class:"o-input",key:o},[L(h("input",{name:"pull_type",type:"radio","onUpdate:modelValue":t[0]||(t[0]=t=>e.pullType=t),value:o},null,8,V),[[C,e.pullType]]),v(b(s.label)+" "+b(s.size)+" ",1)])))),128))]),h("div",z,[E,F,u(r,{onClick:a.choosePath,class:"choose-path"},{default:y((()=>[v("选择路径")])),_:1},8,["onClick"]),v("  "),L((D(),p("span",$,[v(b(e.directory),1)])),[[T,{content:e.directory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),h("div",j,[u(r,{type:"primary",disabled:!a.pullDataValid,progress:e.pullLoadingProgress,loading:e.pullLoading,onClick:a.pullFile},{default:y((()=>[v("拉取数据")])),_:1},8,["disabled","progress","loading","onClick"])])]),h("div",{class:"o-console-er","data-empty":""===e.consoleText},[O,L(h("div",{class:"o-console-body","data-loading":!e.chartDataLoaded},b(e.consoleText),9,I),[[w,e.consoleText]])],8,A),L(h("div",B,[h("div",H,[h("div",N,[X,h("i",{class:"o-modal-title-close",onClick:t[1]||(t[1]=(...e)=>a.cannel&&a.cannel(...e))})]),G,h("div",J,[h("div",K,[u(r,{style:{width:"52px"},onClick:a.cannel},{default:y((()=>[v("取消")])),_:1},8,["onClick"]),u(r,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:a.submit},{default:y((()=>[v("确定")])),_:1},8,["onClick"])])])])],512),[[w,this.modal.visible]]),u(d,{message:e.message},null,8,["message"])])}],["__scopeId","data-v-ebc4f5e9"]]))}}}));
