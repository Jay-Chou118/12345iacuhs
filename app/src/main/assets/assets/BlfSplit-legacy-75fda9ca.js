System.register(["./Header-legacy-21aaa926.js","./Button-legacy-b9e1fb11.js","./Message-legacy-940dfddc.js","./Cascader-legacy-31102dd1.js","./CopyPath-legacy-d23a8444.js","./index-legacy-5257d21e.js","./time-legacy-9e872c4a.js","./index-legacy-f2ac33ea.js"],(function(e,t){"use strict";var i,l,a,s,o,n,r,c,p,d,u,m,h,b,g,f,v,T,y,S,D,F,E,x,C,A,L,M,_,k;return{setters:[e=>{i=e.H},e=>{l=e.B},e=>{a=e.M},e=>{s=e.C},e=>{o=e.C,n=e.b},e=>{r=e._,c=e.S,p=e.k,d=e.e,u=e.j,m=e.r,h=e.c,b=e.h,g=e.d,f=e.i,v=e.a,T=e.t,y=e.f,S=e.F,D=e.m,F=e.w,E=e.g,x=e.v,C=e.o,A=e.n,L=e.p,M=e.b},e=>{_=e.t},e=>{k=e.n}],execute:function(){let t=0;const w={props:["store","closeFlag"],components:{Button:l,Header:i,Cascader:s,CopyPath:o,Message:a},data(){return{pullType:"",chartDataLoaded:!0,recLoading:!1,recList:{time_length:{label:"时间长度",val:"time_length",paths:"",unit:"min"},file_size:{label:"文件大小",val:"file_size",paths:"/persistence/vde/pool,/tmp/vde/pool",unit:"M"},start_time:{label:"起止时间",val:"start_time",paths:"/log/DiagMaster,/persistence/DiagMaster",unit:""},split_number:{label:"拆分个数",val:"split_number",paths:"/log/DiagMaster,/persistence/DiagMaster",unit:"个"}},selectList:{time_length:{label:"时间长度",val:"time_length",paths:"",unit:"min",min:0,max:60},file_size:{label:"文件大小",val:"file_size",paths:"/persistence/vde/pool,/tmp/vde/pool",unit:"M",min:0,max:1024},split_number:{label:"拆分个数",val:"split_number",paths:"/log/DiagMaster,/persistence/DiagMaster",unit:"个",min:0,max:100}},timeFilterOptions:[{label:"绝对时间",value:"absolute"},{label:"相对时间",value:"relative"}],consoleText:"",blfDirectory:"",outputDirectory:"",onFlag:!0,recLoadingProgress:"",dbcVal:[c.DEFAULT[0].value,c.DEFAULT[0].children[0].value],sdbCustom:this.$ls.get("blfread_sdbData")||[],fileSize:0,fileStartTime:0,fileEndTime:0,splitConditionOption:[{label:5,value:5},{label:10,value:10},{label:15,value:15},{label:20,value:20},{label:30,value:30},{label:60,value:60}],blfCondition:1,timeFilterMode:{label:"绝对时间",value:"absolute"},splitAbsoluteStartTime:"",splitAbsoluteEndTime:"",splitRelativeStartTime:0,splitRelativeEndTime:0,limitRelativeTime:0,blfDirectorySize:{label:"",value:0,durationMaybe:0},otherLimitVal:0,startDateString:"",endDateString:"",minAbsoluteStartTime:"",maxAbsoluteEndTime:"",fileSplitFlag:!0,getBackFileSize:0,message:{visible:!1,level:"",content:""}}},watch:{splitAbsoluteStartTime(e){e||(this.splitAbsoluteStartTime="1970-01-01T08:00:00")},splitAbsoluteEndTime(e){e||(this.splitAbsoluteEndTime="1970-01-01T08:00:00")},pullType(e){if(this.blfCondition=1,"start_time"===e&&"absolute"===this.timeFilterMode.value){const e=_(1e3*this.fileStartTime);this.startDateString=e.replace(/\//g,"-"),console.log("this.startDateString2222",this.startDateString);const t=_(1e3*this.fileEndTime);this.endDateString=t.replace(/\//g,"-"),console.log("this.startDateString3333",this.endDateString),this.fileStartTime?this.splitAbsoluteStartTime=this.startDateString:this.splitAbsoluteStartTime="1970-01-01T08:00:00",this.fileEndTime?this.splitAbsoluteEndTime=this.endDateString:this.splitAbsoluteEndTime="1970-01-01T08:00:00"}"time_length"===e?(this.splitConditionOption=[{label:5,value:5},{label:10,value:10},{label:15,value:15},{label:20,value:20},{label:30,value:30},{label:60,value:60}],this.otherLimitVal=Math.trunc(this.limitRelativeTime/60),this.blfCondition=this.otherLimitVal,console.log("时间长度",this.otherLimitVal)):"file_size"===e?(this.splitConditionOption=[{label:10,value:10},{label:20,value:20},{label:50,value:50},{label:100,value:100},{label:200,value:200}],console.log("this.blfDirectorySize",Math.trunc(this.getBackFileSize)),this.otherLimitVal=Math.trunc(this.getBackFileSize),this.blfCondition=this.otherLimitVal):(this.splitConditionOption=[{label:1,value:1},{label:2,value:2},{label:5,value:5},{label:10,value:10},{label:20,value:20}],this.otherLimitVal=30,this.blfCondition=1,console.log("没选拆分方式"))},chartDataLoaded(e,t){e?(document.querySelector("body").style.cursor="",document.querySelector("#app").style.pointerEvents=""):(document.querySelector("body").style.cursor="wait",document.querySelector("#app").style.pointerEvents="none")},blfDirectory:{async handler(e){const t=await p.getFileSize(e),i=Math.round(.166*(1678e-19*t*t+1.768e-7*t+.5581));if(this.blfDirectorySize={label:n(t),value:t,durationMaybe:1e3*i},e&&"start_time"===this.pullType&&"absolute"===this.timeFilterMode.value){const e=_(1e3*this.fileStartTime);this.startDateString=e.replace(/\//g,"-");const t=_(1e3*this.fileEndTime);this.endDateString=t.replace(/\//g,"-"),this.fileStartTime?this.splitAbsoluteStartTime=this.startDateString:this.splitAbsoluteStartTime="1970-01-01T08:00:00",this.fileEndTime?this.splitAbsoluteEndTime=this.endDateString:this.splitAbsoluteEndTime="1970-01-01T08:00:00"}}},timeFilterMode:{handler(e){"relative"===e.value&&this.fileStartTime&&this.fileEndTime&&console.log("相对时间",this.splitRelativeEndTime)}}},computed:{timeWarnLabel(){if("absolute"===this.timeFilterMode.value){if(this.splitAbsoluteStartTime>this.splitAbsoluteEndTime)return"开始时间需小于结束时间"}else if(this.splitRelativeStartTime>this.splitRelativeEndTime)return"开始时间需小于结束时间";return"值必须在起止时间范围内"},pullDataValid(){return!!(this.blfDirectory&&this.outputDirectory&&this.pullType)},quitConfirm(){return this.recLoading},dbcVerOpts(){return[...c.DEFAULT,{label:"自定义模板",value:"自定义模板",children:this.sdbCustom.length>0?this.sdbCustom.map((e=>({label:e.sdb,value:e.sdb,files:e.files,comments:e.comments}))):null}]},curTpl(){if("自定义模板"===this.dbcVal[0]){let e=this.sdbCustom.find((e=>e.sdb===this.dbcVal[1]));return{carType:"custom",sdb:this.dbcVal[1],files:e?.files,comments:e?.comments}}return{carType:this.dbcVal[0],sdb:this.dbcVal[1]}},endRec(){}},mounted(){u.report("trackPage",{page:"拆解报文",tip:"1174.16.0.1.31378"})},methods:{min:(e,t)=>e<t?e:t,max:(e,t)=>e>t?e:t,chooseBlfPath(){this.blfCondition="",this.pullType="",this.outputDirectory="",p.choosePath({directory:this.blfDirectory.split("/").slice(0,-1).join("/")||window.downloadPath,dialogType:"OPEN_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then((e=>{e.data.directory&&(this.blfDirectory=k(e.data.directory),d.blfSplit.getFileInfo({blfFile:this.blfDirectory}).then((e=>{this.getBackFileSize=e.data.data.fileSize;const t=1024*this.getBackFileSize;p.getFileSize(this.blfDirectory),this.fileSize=n(t),this.fileStartTime=e.data.data.startTime,this.fileEndTime=e.data.data.endTime,console.log("this.fileStartTime",this.fileStartTime);const i=_(1e3*this.fileStartTime);console.log("this.fileStartToFixedDate332",i),this.startDateString=i.replace(/\//g,"-");const l=_(1e3*this.fileEndTime);this.endDateString=l.replace(/\//g,"-"),this.minAbsoluteStartTime=this.startDateString,this.maxAbsoluteEndTime=this.endDateString,this.limitRelativeTime=Math.trunc(this.fileEndTime)-Math.trunc(this.fileStartTime),this.splitRelativeEndTime=this.limitRelativeTime,this.limitRelativeTime>=60||this.getBackFileSize>=1?this.fileSplitFlag=!0:this.fileSplitFlag=!1})).catch((e=>{})).finally((()=>{this.onFlag=!0})))}))},chooseOutputPath(){const e=k(this.blfDirectory).split("/").filter((e=>!e.includes(".")));console.log("输出路径filteredArr",e.join("/")),p.choosePath({directory:e.join("/")||window.downloadPath,dialogType:"FOLDER_DIALOG"}).then((({data:e})=>{e.directory&&(this.outputDirectory=k(e.directory))})),console.log("92929",this.outputDirectory,this.blfDirectory,this.pullType)},async startSplit(){this.onFlag=!1,this.chartDataLoaded=!1,this.consoleText="拆分中...";let e={};"time_length"===this.pullType?e.timeLen=this.blfCondition:"file_size"===this.pullType?e.fileSize=this.blfCondition:"split_number"===this.pullType?e.fileNum=this.blfCondition:(e.timeSpan={},e.timeSpan.data=[],"relative"===this.timeFilterMode.value?(e.timeSpan.data.push(this.splitRelativeStartTime,this.splitRelativeEndTime),e.timeSpan.mode="relative"):(e.timeSpan.data.push(Date.parse(this.splitAbsoluteStartTime)/1e3,Date.parse(this.splitAbsoluteEndTime)/1e3),e.timeSpan.mode="abosulute")),await d.blfSplit.Spliter({inFile:this.blfDirectory,outFile:this.outputDirectory,condition:e}).then((e=>{let t=e.data;this.consoleText="",t.data.length>0&&t.data.forEach((e=>{this.consoleText+=e+"\n"})),"-1"==t.code&&this.showMessage({level:"error",content:t.msg,timeout:2e3}),this.onFlag=!0,this.chartDataLoaded=!0})).catch(),u.report("track","click",{element_name:"拆解报文-click",asset_name:this.blfDirectory+";"+this.outputDirectory+";",tip:"1174.16.0.1.31379"})},timestampToDateString(e){const t=new Date(e);return`${t.getFullYear()}-${this.addZero(t.getMonth()+1)}-${this.addZero(t.getDate())} ${this.addZero(t.getHours())}:${this.addZero(t.getMinutes())}:${this.addZero(t.getSeconds())}`},addZero:e=>e<10?`0${e}`:e,showMessage({level:e,content:i,timeout:l}){clearTimeout(t),null!=e&&(this.message.level=e),null!=i&&(this.message.content=i),this.message.visible=!0,l>0&&(t=setTimeout((()=>{this.message.visible=!1}),l))},hideMessage(){this.message.visible=!1}}},V=e=>(L("data-v-9e8165de"),e=e(),M(),e),z=["data-disabled"],R={class:"o-pul-er"},q=V((()=>g("div",{class:"o-pul-title"},"文件拆解配置",-1))),P={class:"o-pul-p choose-cation"},B=V((()=>g("span",{style:{color:"red"}},"* ",-1))),O=V((()=>g("span",{class:"record-header-message"},"待拆解文件：",-1))),j={class:"o-pul-path"},$={key:0,class:"o-pul-p"},U={class:"blf-file-info"},Z={class:"blf-file-size"},H=V((()=>g("span",null,"文件大小：",-1))),N=V((()=>g("span",{style:{color:"#D9D9D9","font-size":"16px",margin:"0 20px"}},"|",-1))),I={class:"blf-file-duration"},W=V((()=>g("span",null,"文件起止时间：",-1))),G={key:1,class:"tip-pul-p"},Y=[V((()=>g("div",{class:"blf-file-info"},[g("div",{class:"tip-label"},[g("i",{class:"i-warning"}),g("span",{style:{color:"#ff5555"}},"文件过小，不需要拆解 (文件需大于等于1M或大于等于1分钟)")])],-1)))],J={key:2,class:"o-pul-p input-cation"},K=V((()=>g("span",{style:{color:"red"}},"* ",-1))),Q=V((()=>g("span",{class:"record-header-message"},"拆解方式：",-1))),X=["value"],ee={key:0,class:"blf-split-condition"},te=V((()=>g("span",{style:{color:"red"}},"* ",-1))),ie={class:"record-header-message"},le=["max"],ae={style:{"margin-left":"6px"}},se={class:"other-warn-label"},oe=V((()=>g("i",{class:"i-warning"},null,-1))),ne={key:4,class:"o-pul-p input-cation",style:{"min-width":"636px"}},re={class:"blf-split-condition"},ce=V((()=>g("span",{style:{color:"red"}},"* ",-1))),pe=V((()=>g("span",{class:"record-header-message"},"起止时间：",-1))),de={key:0,class:"o-split-input"},ue=["min","max"],me=V((()=>g("span",null,"  至  ",-1))),he=["min","max"],be={class:"warn-label"},ge=V((()=>g("i",{class:"i-warning"},null,-1))),fe={key:1,class:"o-split-input"},ve=["max"],Te=V((()=>g("span",null,"  至  ",-1))),ye=["min","max"],Se={class:"warn-label"},De=V((()=>g("i",{class:"i-warning"},null,-1))),Fe={key:5,class:"o-pul-p choose-out-cation"},Ee=V((()=>g("span",{style:{color:"red"}},"* ",-1))),xe=V((()=>g("span",{class:"record-header-message"},"输出文件夹路径：",-1))),Ce=["title"],Ae={key:6,class:"o-pul-p start-rec"},Le=V((()=>g("i",{class:"play-icon"},null,-1))),Me=["data-empty"],_e=V((()=>g("div",{class:"o-console-title"},"文件拆解转换结果",-1))),ke=["data-loading"];e("default",r(w,[["render",function(e,t,i,l,a,s){const o=m("Header"),n=m("Button"),r=m("CopyPath"),c=m("v-select"),p=m("Message");return C(),h("div",{class:"blf-split","data-disabled":!a.chartDataLoaded},[b(o,{title:"拆解报文",quitConfirm:s.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),g("div",R,[q,g("div",P,[B,O,b(n,{onClick:s.chooseBlfPath,class:"choose-path"},{default:f((()=>[v("选择文件")])),_:1},8,["onClick"]),v("  "),g("span",j,[b(r,{path:a.blfDirectory,length:45},null,8,["path"])])]),a.blfDirectory?(C(),h("div",$,[g("div",U,[g("div",Z,[H,g("span",null,T(a.blfDirectorySize.label),1)]),N,g("div",I,[W,g("span",null,T(this.startDateString.replace("T"," "))+" ~ "+T(this.endDateString.replace("T"," ")),1)])])])):y("",!0),a.fileSplitFlag?y("",!0):(C(),h("div",G,Y)),a.fileSplitFlag?(C(),h("div",J,[K,Q,(C(!0),h(S,null,D(a.recList,((e,i)=>(C(),h("label",{class:"o-input record-header-message-imp",key:i},[F(g("input",{required:"",name:"pull_type",type:"radio","onUpdate:modelValue":t[0]||(t[0]=e=>a.pullType=e),value:i},null,8,X),[[A,a.pullType]]),v(T(e.label)+" "+T(e.size)+" ",1)])))),128))])):y("",!0),"start_time"!==a.pullType&&a.fileSplitFlag?(C(!0),h(S,{key:3},D(a.selectList,((e,i)=>(C(),h("div",{class:"o-pul-p input-cation",key:i},[a.pullType===e.val&&a.pullType?(C(),h("div",ee,[te,g("span",ie,T(e.label)+"：",1),F(g("input",{required:"",list:"ice-cream-flavors",placeholder:"请输入",type:"number","onUpdate:modelValue":t[1]||(t[1]=e=>a.blfCondition=e),id:"ice-cream-choice",min:"1",max:a.otherLimitVal,style:{width:"70px"},name:"ice-cream-choice",class:"o-selected-input"},null,8,le),[[E,a.blfCondition]]),g("span",ae,T(e.unit),1),g("div",se,[oe,g("span",null,"值必须在1~"+T(a.otherLimitVal)+"范围内",1)])])):y("",!0)])))),128)):y("",!0),"start_time"===a.pullType&&a.fileSplitFlag?(C(),h("div",ne,[g("div",re,[ce,pe,b(c,{options:a.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:a.timeFilterMode,"onUpdate:modelValue":t[2]||(t[2]=e=>a.timeFilterMode=e),class:"tch-tool-select"},null,8,["options","modelValue"]),"absolute"===a.timeFilterMode.value&&a.fileSplitFlag?(C(),h("div",de,[F(g("input",{required:"",type:"datetime-local",min:a.minAbsoluteStartTime,max:s.min(a.maxAbsoluteEndTime,a.maxAbsoluteEndTime),"onUpdate:modelValue":t[3]||(t[3]=e=>a.splitAbsoluteStartTime=e),class:"chf-input-time",step:"1"},null,8,ue),[[E,a.splitAbsoluteStartTime]]),me,F(g("input",{required:"",type:"datetime-local",min:s.max(a.minAbsoluteStartTime,a.splitAbsoluteStartTime),max:a.maxAbsoluteEndTime,"onUpdate:modelValue":t[4]||(t[4]=e=>a.splitAbsoluteEndTime=e),class:"chf-input-time",step:"1"},null,8,he),[[E,a.splitAbsoluteEndTime]]),g("div",be,[ge,g("span",null,T(s.timeWarnLabel),1)])])):y("",!0),"relative"===a.timeFilterMode.value&&a.fileSplitFlag?(C(),h("div",fe,[F(g("input",{required:"",type:"number",min:0,max:s.min(a.limitRelativeTime,a.splitRelativeEndTime),"onUpdate:modelValue":t[5]||(t[5]=e=>a.splitRelativeStartTime=e),class:"chf-input-time",step:"1",style:{width:"70px"}},null,8,ve),[[E,a.splitRelativeStartTime]]),Te,F(g("input",{required:"",type:"number",min:s.max(0,a.splitRelativeStartTime),max:a.limitRelativeTime,"onUpdate:modelValue":t[6]||(t[6]=e=>a.splitRelativeEndTime=e),class:"chf-input-time",style:{width:"70px"},step:"1"},null,8,ye),[[E,a.splitRelativeEndTime]]),g("div",Se,[De,g("span",null,T(s.timeWarnLabel),1)])])):y("",!0)])])):y("",!0),a.fileSplitFlag?(C(),h("div",Fe,[Ee,xe,b(n,{onClick:s.chooseOutputPath,class:"choose-path"},{default:f((()=>[v("选择路径")])),_:1},8,["onClick"]),v("  "),g("span",{class:"o-pul-path",title:a.outputDirectory},T(a.outputDirectory),9,Ce)])):y("",!0),a.fileSplitFlag?(C(),h("div",Ae,[b(n,{type:"primary",disabled:!s.pullDataValid&&a.fileSplitFlag,progress:a.recLoadingProgress,loading:a.recLoading,onClick:s.startSplit},{default:f((()=>[Le,v(" 开始拆解")])),_:1},8,["disabled","progress","loading","onClick"])])):y("",!0)]),g("div",{class:"o-console-er","data-empty":""===a.consoleText,id:"el-record-console"},[_e,F(g("div",{class:"o-console-body","data-loading":!a.chartDataLoaded},T(a.consoleText),9,ke),[[x,a.consoleText]])],8,Me),b(p,{message:a.message},null,8,["message"])],8,z)}],["__scopeId","data-v-9e8165de"]]))}}}));
