System.register(["./Button-legacy-ecf877d0.js","./index-legacy-bbb76e68.js","./Message-legacy-e536e494.js","./CopyPath-legacy-4b37dff4.js","./Cascader-legacy-192c677d.js"],(function(e,t){"use strict";var a,i,l,s,o,d,r,n,c,p,u,m,h,g,y,v,w,f,b,x,k,A,C,V,I,D,N;return{setters:[e=>{a=e.B},e=>{i=e._,l=e.r,s=e.l,o=e.w,d=e.o,r=e.c,n=e.d,c=e.g,p=e.h,u=e.i,m=e.a,h=e.x,g=e.B,y=e.p,v=e.b,w=e.F,f=e.m,b=e.K,x=e.y,k=e.S,A=e.t,C=e.A,V=e.f},e=>{I=e.M},e=>{D=e.s},e=>{N=e.C}],execute:function(){const t={components:{Button:a},emits:["cancel"],props:["cardIndex","cardName"],data(){return{titleName:this.$props.cardName}},methods:{reSet(){this.renameStr=""}}},T={class:"tool-picker-contianer-wrap"},E=(e=>(y("data-v-059d0938"),e=e(),v(),e))((()=>n("div",{class:"tool-picker-arrow"},null,-1))),$={class:"tool-picker-footer-wrap"},S={class:"o-dialog-footer"},F=i(t,[["render",function(e,t,a,i,y,v){const w=l("Button"),f=s("esc");return o((d(),r("div",{class:"tool-picker-wrap",style:g("--cardIndex:"+e.$props.cardIndex),onClick:t[3]||(t[3]=h((()=>{}),["stop"]))},[n("div",T,[o(n("input",{class:"o-table-remark chs-input-er",placeholder:"编辑视图名称","onUpdate:modelValue":t[0]||(t[0]=e=>y.titleName=e),maxlength:"20"},null,512),[[c,y.titleName]])]),E,n("div",$,[n("div",S,[p(w,{style:{width:"30px"},onClick:t[1]||(t[1]=h((t=>e.$emit("cancel")),["stop"]))},{default:u((()=>[m("取消")])),_:1}),p(w,{type:"primary",style:{width:"30px",margin:"0 20px 0 10px"},onClick:t[2]||(t[2]=h((t=>e.$emit("ok",y.titleName)),["stop"]))},{default:u((()=>[m("确定")])),_:1})])])],4)),[[f,()=>e.$emit("cancel")]])}],["__scopeId","data-v-059d0938"]]),B={emits:["cancel"],components:{Button:a},props:["cardIndex","cardName","cardId"],data(){return{titleName:this.$props.cardName,titleId:this.$props.cardId}},methods:{reSet(){this.renameStr=""}},mounted(){console.log("删除提示",this.$props)}},L=e=>(y("data-v-08841c08"),e=e(),v(),e),U=L((()=>n("div",{class:"tool-picker-contianer-wrap"},[n("i",{class:"i-warning"}),n("span",null,"确认要删除视图吗")],-1))),_=L((()=>n("div",{class:"tool-picker-arrow"},null,-1))),M={class:"tool-picker-footer-wrap"},j={class:"o-dialog-footer"},H=i(B,[["render",function(e,t,a,i,c,y){const v=l("Button"),w=s("esc");return o((d(),r("div",{class:"tool-picker-wrap",style:g("--cardIndex:"+e.$props.cardIndex),onClick:t[2]||(t[2]=h((()=>{}),["stop"]))},[U,_,n("div",M,[n("div",j,[p(v,{style:{width:"30px"},onClick:t[0]||(t[0]=h((t=>e.$emit("cancel")),["stop"]))},{default:u((()=>[m("取消")])),_:1}),p(v,{type:"primary",style:{width:"30px",margin:"0 20px 0 10px"},onClick:t[1]||(t[1]=h((t=>e.$emit("ok",c.titleId)),["stop"]))},{default:u((()=>[m("确定")])),_:1})])])],4)),[[w,()=>e.$emit("cancel")]])}],["__scopeId","data-v-08841c08"]]);
/**
             * @description  draggable polyfill
             * @author       XboxYan
             * @email        yanwenbin1991@live.com
             * @github       https://github.com/XboxYan/draggable-polyfill
             * @license      MIT
             */
!function(){if("setDragImage"in window.DataTransfer.prototype&&document.body.animate){var e,t,a=null,i=0,l=0,s=0,o=0,d=null,r=null,n=new Image;n.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAQSURBVHgBAQUA+v8AAAAAAAAFAAFkeJU4AAAAAElFTkSuQmCC";var c=document.createElement("style");c.textContent="[dragging]{position:static!important;box-sizing:border-box!important;margin:0!important;}        .drag-obj{position:fixed;left:0;top:0;z-index:999;pointer-events:none;}",document.querySelector("head").appendChild(c),document.addEventListener("dragstart",(function(r){if(r.target.nodeType===Node.ELEMENT_NODE){(d=r.target).dragData={},e=d.getAttribute("axis"),t=e,r.dataTransfer.setData("text",""),r.dataTransfer.setDragImage(n,0,0);var c=d.getBoundingClientRect(),p=c.left,u=c.top;s=r.clientX,o=r.clientY,i=s-p,l=o-u,d.style.transition="none",a=document.createElement("DIV");var m=d.cloneNode(!0);m.style.width=d.offsetWidth+"px",m.style.height=d.offsetHeight+"px",m.style.transform="translate3d(0,0,0)",m.setAttribute("dragging",""),a.appendChild(m),a.className="drag-obj",a.style="transform:translate3d( "+p+"px ,"+u+"px,0);",document.body.appendChild(a)}})),document.addEventListener("dragend",(function(e){if(a){var t=e.target.getBoundingClientRect(),i=t.left,l=t.top;a.animate([{transform:a.style.transform},{transform:"translate3d("+i+"px,"+l+"px,0)"}],{duration:150,easing:"ease-in-out"}).onfinish=function(){document.body.removeChild(a),a=null,d.dragData=null,d.style.visibility="visible"}}})),document.addEventListener("drop",(function(e){const t=e.target.closest("[allowdrop]");e.preventDefault(),t&&(e.stopPropagation(),t.removeAttribute("over"))})),document.addEventListener("dragenter",(function(e){r&&r.toggleAttribute("over",!1);const t=e.target.closest("[allowdrop]");t&&(t.toggleAttribute("over",!0),r=t)})),document.addEventListener("dragover",(function(r){r.preventDefault();const n=r.target.closest("[allowdrop]");if(r.dataTransfer.dropEffect=n?"copy":"move",a){d.style.visibility="hidden";var c=~~(r.clientX-i),p=~~(r.clientY-l);r.shiftKey||e?"X"===t?p=~~(o-l):"Y"===t?c=~~(s-i):t=(~~Math.abs(r.clientX-s)>~~Math.abs(r.clientY-o)?"X":~~Math.abs(r.clientX-s)<~~Math.abs(r.clientY-o)&&"Y")||"":t="",s=c+i,o=p+l,a.style.transform="translate3d( "+c+"px ,"+p+"px,0)",d.dragData.left=c,d.dragData.top=p}}))}}();let O,R=0;const X={props:["manageShow","title","curViewInx","propTreeData","fileType"],emits:["cancel","import","add","delete","update","switch","showMessage"],components:{EditViewName:F,DeleteName:H,Button:a,Cascader:N,DraggableCard:i({props:["modelValue","wrapClass","keyName"],emits:["update:modelValue","switch"],data:()=>({fromNode:null,toNode:null,curElement:null}),methods:{onDragStart(e){this.$props.keyName&&(this.curKey=""+e[this.$props.keyName],this.fromNode=e)},onDrop(e){let t=e.target.dataset.key;this.toNode=this.$props.modelValue.find((e=>e[this.$props.keyName]==t)),t&&this.$emit("switch",{fromNode:this.fromNode,toNode:this.toNode}),this.fromNode=null,this.toNode=null}}},[["render",function(e,t,a,i,l,s){return d(),r("div",{class:x(e.$props.wrapClass),onDrop:t[0]||(t[0]=(...e)=>s.onDrop&&s.onDrop(...e))},[(d(!0),r(w,null,f(e.$props.modelValue,((t,a)=>b(e.$slots,"default",{index:a,node:t,onDragStart:s.onDragStart,fromNode:l.fromNode}))),256)),b(e.$slots,"footer")],34)}]]),Message:I},data(){let e=this.$ls.get("blfread_sdbData")||[];return{editIndex:-1,delIndex:-1,copyIndex:-1,curIndex:-1,treeData:this.$props.propTreeData,curId:-1,curCarVersion:"Modena/E3U1",sdbCustom:e,treeExpendData:[...k.DEFAULT.map(((e,t)=>({carType:k.DEFAULT[t].value,children:e.children.map(((e,t)=>({sdb:e.value})))}))),{carType:"custom",children:e.map((e=>({sdb:e.sdb})))}],carType:k.DEFAULT[0].value,sdb:k.DEFAULT[0].children[0].value,dbcValue:[k.DEFAULT[0].value,k.DEFAULT[0].children[0].value],copyAppointVerFlag:!1,colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],sdbNew:"",message:{visible:!1,level:"",content:""}}},watch:{propTreeData:{handler(e){console.log("propTreeData",e),this.treeData=JSON.parse(JSON.stringify(e))},deep:!0,immediate:!0},curViewInx:{handler(e,t){this.$nextTick((()=>{if(this.treeData[e]){let t=this.cardView.find((t=>t.id===this.treeData[e].id));t&&(this.curId=t.id)}}))},deep:!0}},computed:{cardView(){return this.treeData.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)).map((e=>({...e,content:e.children.map((e=>e.text)).join(", ")})))},cardViewHash(){return document.body.querySelectorAll(".drag-obj").forEach((e=>{e.parentNode.removeChild(e)})),this.cardView.map((e=>e.id)).join()},dbcVerOpts(){return[...k.DEFAULT,{label:"自定义模板",value:"自定义模板",children:this.sdbCustom.length>0?this.sdbCustom.map((e=>({label:e.sdb,value:e.sdb,files:e.files,comments:e.comments}))):null}]},dbcVal(){return[this.carType,this.sdb]}},mounted(){this.curIndex=this.$props.curViewInx;let e=this.treeData[this.curIndex];this.sdb=e.sdb,this.sdbNew=this.sdb,this.carType=e.carType,this.curId=e.id,this.showSdbVer(),console.log("cardView",this.cardView)},methods:{clickWrapHandler(e){document.querySelector(".o-dialog-card ."+(e.target.className||"a"))||(this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1)},showSdbVer(){document.querySelectorAll("details").forEach((e=>{e.addEventListener("toggle",(e=>{console.log("1707",e)}))}))},exportHandler(e){let t=this.cardView[e],a=t.text+"\n"+t.children?.map((e=>"- "+[e.channel,e.msg,e.text,(e.comment||"").replace(/\n/g," "),e.remark].join("|"))).join("\n");D(a,"tspa-"+(t.text||"视图")+".txt")},importHandler(e){let t=e.target.files?.[0];if(console.log(t),t){const a=new FileReader;a.readAsText(t,"utf-8"),a.onload=e=>{let t=Date.now(),a={id:t,label:"",children:[],carType:this.carType,sdb:this.sdb};e.target.result.replace(/\r\n/g,"\n").replace(/\n([^-])/g," $1").split("\n").forEach(((e,i)=>{if(0===i)a.label=e;else{let[l,s,o,d,r]=e.replace(/^- /,"").split("|");a.children.push({pid:t,channel:+l,msg:+s,id:o,text:o,comment:d,remark:r,color:this.colorList[i%9]})}})),console.log("import",a),this.$emit("import",a)},e.target.value=""}},addView(){this.$emit("add",{carType:this.carType,sdb:this.sdb})},editEditView(e){this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1,this.editIndex=e},clickCancel(){this.editIndex=-1},clickRename(e){let t=this.treeData.find((e=>e.id===this.cardView[this.editIndex].id));t.text=e,this.$emit("update",t),this.editIndex=-1},copyView(e){this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1,this.copyIndex=e},copyCurVer(e,t,a){let i=JSON.parse(JSON.stringify(e));i.text=(i.text+"-复制").slice(-20),i.id=Date.now(),i.children.forEach((e=>e.pid=i.id)),i.carType=t,i.sdb=a,this.$emit("add",i),this.copyIndex=-1,this.copyAppointVerFlag=!1},copyAppointVer(){this.copyAppointVerFlag=!0},deleteView(e){this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1,this.delIndex=e},clickCancelDelete(){this.delIndex=-1},clickDelete(){this.$emit("delete",this.cardView[this.delIndex]),this.delIndex=-1},showMessage({level:e,content:t,timeout:a}){clearTimeout(R),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(R=setTimeout((()=>{this.message.visible=!1}),a))},checkView(e){this.sdbNew==e.sdb?(this.$emit("cancel",e.id),console.log("双击")):this.showMessage({level:"error",content:"禁止跨区切换视图",timeout:2e3})},chooseVer(e,t){this.carType=e,this.sdb=t},dragenter(e){O=e.target,console.log("dragenterFn",O)}}},Y=e=>(y("data-v-3b624670"),e=e(),v(),e),J={class:"o-dialog-wrap"},Q={class:"o-dialog-header-wrap"},q={class:"o-dialog-title"},W={class:"o-dialog-container-wrap"},z={class:"o-dialog-tree-wrap"},K=Y((()=>n("i",{class:"i-car"},null,-1))),P=["onClick"],G=Y((()=>n("i",{class:"i-list"},null,-1))),Z={class:"o-dialog-modal-wrap"},ee={class:"cur-version-tit"},te=["data-key","data-dragging","data-dragactive","data-active","onDragstart","onDblclick"],ae={class:"o-dialog-card-header"},ie={class:"o-card-left"},le={class:"o-dialog-card-tit"},se=["onClick"],oe={class:"o-card-right"},de=["onClick"],re=["onClick"],ne={key:0,class:"copy-picker-wrap"},ce=Y((()=>n("div",{class:"tool-picker-arrow"},null,-1))),pe=["onClick"],ue=["onClick"],me={class:"o-modal-card-container"},he={key:0,class:"o-card-footer-wrap"},ge=[Y((()=>n("div",{class:"o-cur-card-footer"},[n("i",{class:"i-cur-checkview"}),n("span",null,"当前视图")],-1)))],ye=["onClick"],ve=[Y((()=>n("i",{class:"i-checkview"},null,-1))),Y((()=>n("span",null,"切换视图",-1)))],we={class:"o-add-card"},fe=[Y((()=>n("i",{class:"i-add-view"},null,-1))),Y((()=>n("span",null,"新建视图",-1)))],be=Y((()=>n("span",{style:{"font-size":"0",height:"21px",width:"1px",display:"inline-block",background:"#bbb"}},null,-1))),xe={class:"o-add-card-right"},ke=Y((()=>n("i",{class:"i-import-view"},null,-1))),Ae=Y((()=>n("span",null,"导入视图",-1))),Ce={key:0,class:"o-modal-wrap"},Ve={class:"o-modal-header"},Ie={class:"o-modal-header-wrap"},De=Y((()=>n("div",{class:"o-dialog-title"},"复制视图到指定版本",-1))),Ne={class:"o-modal-container"},Te=Y((()=>n("span",{style:{color:"red"}},"* ",-1))),Ee=Y((()=>n("span",{class:"record-header-message"},"DBC 版本：",-1))),$e={class:"o-che-input"},Se={class:"o-modal-footer"},Fe={class:"o-modal-footer-wrap"};e("M",i(X,[["render",function(e,t,a,i,c,g){const y=l("EditViewName"),v=l("DeleteName"),b=l("DraggableCard"),k=l("Cascader"),I=l("Button"),D=l("Message"),N=s("tooltip"),T=s("esc");return d(),r(w,null,[o((d(),r("div",{class:"o-manage-dialog",onClick:t[9]||(t[9]=(...e)=>g.clickWrapHandler&&g.clickWrapHandler(...e))},[n("div",J,[n("div",Q,[n("div",q,A(e.$props.title),1),n("i",{class:"o-dialog-title-close",onClick:t[0]||(t[0]=t=>e.$emit("cancel",c.curId))})]),n("div",W,[n("div",z,[(d(!0),r(w,null,f(c.treeExpendData,((e,t)=>(d(),r("details",{key:t,open:""},[n("summary",null,[K,m(A("custom"===e.carType?"自定义模板":e.carType),1)]),(d(!0),r(w,null,f(e.children,((t,a)=>(d(),r("div",{class:"list-wrap",key:a},[n("div",{class:x(e.carType===this.carType&&t.sdb===this.sdb?"list-item-active":"list-item"),onClick:a=>g.chooseVer(e.carType,t.sdb)},[G,m(A(t.sdb),1)],10,P)])))),128))])))),128))]),n("div",Z,[n("div",ee,[m(" 当前配置: "),n("span",null,A("custom"===c.carType?"自定义模板":c.carType)+"/"+A(c.sdb),1)]),(d(),C(b,{modelValue:g.cardView,key:g.cardViewHash,wrapClass:"o-dialog-card-wrap",keyName:"id",onSwitch:t[8]||(t[8]=t=>e.$emit("switch",t))},{default:u((({node:a,index:i,onDragStart:l,fromNode:s})=>[n("div",{class:"o-dialog-card",draggable:"true","data-key":a.id,"data-dragging":!!s,"data-dragactive":s?.id===a.id,"data-active":c.curId===a.id,onDragstart:e=>l(a),onDblclick:e=>this.sdbNew==a.sdb&&c.curId!==a.id&&g.checkView(a)},[n("div",ae,[n("div",ie,[n("span",le,A(a.text),1),o((d(),r("i",{class:"i-edit",onDblclick:t[1]||(t[1]=h((()=>{}),["stop"])),onClick:h((e=>g.editEditView(i)),["stop"])},[c.editIndex===i?(d(),C(y,{key:0,onOk:g.clickRename,onCancel:g.clickCancel,cardName:a.text},null,8,["onOk","onCancel","cardName"])):V("",!0)],40,se)),[[N,"修改名称"]])]),n("div",oe,[o(n("i",{class:"i-export",onClick:h((e=>g.exportHandler(i)),["stop"])},null,8,de),[[N,"导出"]]),o((d(),r("i",{class:"i-copy",onClick:h((e=>g.copyView(i)),["stop"])},[c.copyIndex===i?(d(),r("div",ne,[ce,n("div",{class:"copy-picker-item",onClick:h((e=>g.copyCurVer(a,c.carType,c.sdb)),["stop"])}," 复制到当前配置 ",8,pe),n("div",{class:"copy-picker-item",onClick:t[2]||(t[2]=h((e=>g.copyAppointVer()),["stop"]))}," 复制到指定配置 ")])):V("",!0)],8,re)),[[N,"复制"]]),c.curId!==a.id&&g.cardView.length>0?o((d(),r("i",{key:0,class:"i-delete",onDblclick:t[3]||(t[3]=h((()=>{}),["stop"])),onClick:h((e=>g.deleteView(i)),["stop"]),onBlur:t[4]||(t[4]=(...e)=>g.clickCancelDelete&&g.clickCancelDelete(...e))},[c.delIndex===i?(d(),C(v,{key:0,onOk:g.clickDelete,onCancel:g.clickCancelDelete,cardId:a.id},null,8,["onOk","onCancel","cardId"])):V("",!0)],40,ue)),[[N,"删除"]]):V("",!0)])]),n("div",me,A(a.content),1),c.curId===a.id?(d(),r("div",he,ge)):"mdf"===e.$props.fileType^0==("custom"===c.carType&&"mdf"===c.sdb)?(d(),r("div",{key:1,class:"o-card-footer-wrap",onDblclick:t[5]||(t[5]=h((()=>{}),["stop"])),onClick:e=>g.checkView(a)},[n("div",{class:x(this.sdbNew!=a.sdb?"o-card-footer-disable":"o-card-footer")},ve,2)],40,ye)):V("",!0)],40,te)])),footer:u((()=>[n("div",we,[n("div",{class:"o-add-card-left",onClick:t[6]||(t[6]=(...e)=>g.addView&&g.addView(...e))},fe),be,n("div",xe,[ke,Ae,n("input",{type:"file",onInput:t[7]||(t[7]=(...e)=>g.importHandler&&g.importHandler(...e))},null,32)])])])),_:1},8,["modelValue"]))])])])])),[[T,()=>e.$emit("cancel",c.curId)]]),c.copyAppointVerFlag?(d(),r("div",Ce,[n("div",Ve,[n("div",Ie,[De,n("i",{class:"o-dialog-title-close",onClick:t[10]||(t[10]=e=>c.copyAppointVerFlag=!1)})]),n("div",Ne,[Te,Ee,n("div",$e,[p(k,{options:g.dbcVerOpts,modelValue:c.dbcValue,"onUpdate:modelValue":t[11]||(t[11]=e=>c.dbcValue=e)},null,8,["options","modelValue"])])]),n("div",Se,[n("div",Fe,[p(I,{style:{width:"30px"},onClick:t[12]||(t[12]=e=>c.copyAppointVerFlag=!1)},{default:u((()=>[m("取消")])),_:1}),p(I,{type:"primary",style:{width:"30px",margin:"0 20px 0 10px"},onClick:t[13]||(t[13]=e=>g.copyCurVer(g.cardView[c.copyIndex],"自定义模板"===c.dbcValue[0]?"custom":c.dbcValue[0],c.dbcValue[1]))},{default:u((()=>[m("确定")])),_:1})])])])])):V("",!0),p(D,{style:{"z-index":"100"},message:c.message},null,8,["message"])],64)}],["__scopeId","data-v-3b624670"]]))}}}));
