import{H as w}from"./Header-966ab1fd.js";import{B}from"./Button-c0317572.js";import{C as x}from"./Cascader-18a68841.js";import{_ as k,S as y,k as C,j as D,e as V,r as b,l as P,c as n,h as p,d as o,i as g,a as i,w as f,t as h,f as A,F as z,m as N,v as q,o as d,n as E,p as M,b as O}from"./index-f24995f1.js";import{n as m}from"./index-3458cb9c.js";const I={props:["store","closeFlag"],components:{Button:B,Header:w,Cascader:x},data(){return{pullType:"mdf",chartDataLoaded:!0,recLoading:!1,recList:{mdf:{label:"mdf",size:"",paths:""},csv:{label:"csv",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},asc:{label:"asc",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},consoleText:"",blfDirectory:"",outputDirectory:"",onFlag:!0,recLoadingProgress:"",dbcVal:[y.DEFAULT[0].value,y.DEFAULT[0].children[0].value],sdbCustom:this.$ls.get("blfread_sdbData")||[],fileType:"",dbcShow:!0}},watch:{pullType(e){console.log("dacval",e),e&&(this.outputDirectory="")},chartDataLoaded(e,t){e?(document.querySelector("body").style.cursor="",document.querySelector("#app").style.pointerEvents=""):(document.querySelector("body").style.cursor="wait",document.querySelector("#app").style.pointerEvents="none")}},computed:{pullDataValid(){return!!(this.blfDirectory&&this.outputDirectory&&this.onFlag)},quitConfirm(){return this.recLoading},dbcVerOpts(){return[...y.DEFAULT,{label:"自定义模板",value:"自定义模板",children:this.sdbCustom.length>0?this.sdbCustom.map(t=>({label:t.sdb,value:t.sdb,files:t.files,comments:t.comments})):null}]},curTpl(){if(this.dbcVal[0]==="自定义模板"){console.log("this.dbcVal",this.dbcVal);let e=this.sdbCustom.find(t=>t.sdb===this.dbcVal[1]);return{carType:"custom",sdb:this.dbcVal[1],files:e==null?void 0:e.files,comments:e==null?void 0:e.comments}}return{carType:this.dbcVal[0],sdb:this.dbcVal[1]}},endRec(){}},mounted(){D.report("trackPage",{page:"BLF文件格式转换",tip:"1174.11.0.1.29255"})},methods:{chooseBlfPath(){C.choosePath({directory:this.blfDirectory,dialogType:"OPEN_DIALOG",fileTypes:["支持的文件类型 (*.blf;*.BLF;*.asc;*.ASC)","BLF文件 (*.blf;*.BLF)","ASC文件 (*.asc;*.ASC)"],allow_multiple:!1}).then(e=>{e.data.directory&&(/\.dat$|\.mf4$|\.mdf$/i.test(e.data.directory)?this.fileType="mdf":/\.asc$/i.test(e.data.directory)?(this.fileType="asc",this.recList={blf:{label:"blf",size:"",paths:""}},this.dbcShow=!1,this.pullType="blf"):(this.fileType="blf",this.recList={mdf:{label:"mdf",size:"",paths:""},csv:{label:"csv",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},asc:{label:"asc",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},this.dbcShow=!0,this.pullType="mdf"),this.blfDirectory=m(e.data.directory))})},chooseOutputPath(){let e="",t="",a="",c="";this.pullType==="mdf"?(a=["MF4文件 (*.mf4;*.MF4)"],c="mf4"):this.pullType==="csv"?(a=["CSV文件 (*.csv;*.CSV)"],c="csv"):this.pullType==="blf"?(a=["BLF文件 (*.blf;*.BLF)"],c="blf"):(a=["ASC文件 (*.asc;*.ASC)"],c="asc"),console.log("fileTypes",a),console.log("fileTypes222",c),this.blfDirectory?(e=this.blfDirectory.replace(/[^\/]+$/,""),t=this.blfDirectory.split("/").pop().replace(/\.blf|\.asc$/,"."+c)):(e=window.downloadPath,t="tspa-convert."+c),console.log(1627,e,t),C.choosePath({directory:e,saveFilename:t,dialogType:"SAVE_DIALOG",fileTypes:a,allow_multiple:!1}).then(({data:s})=>{console.log("res>>>2",s),s.directory&&(this.outputDirectory=m(s.directory))})},async startFormat(){this.onFlag=!1,this.chartDataLoaded=!1,this.consoleText="转换中...",D.report("track","click",{element_name:"开始转换",asset_name:this.directory+";"+this.dbcVal.join(),tip:"1174.11.0.1.29256"}),console.log("this.dbcVal>>>11",this.dbcVal),console.log("this.sdbCustom>>>11",this.sdbCustom),console.log("...this.curTpl>>>11",this.curTpl),this.pullType==="mdf"?await V.blfConvert.getDBC({...this.curTpl}).then(e=>{console.log("获取dbc信息",e.data);let t=e.data;t.code==0?this.startConvert():(this.consoleText+=t.msg+"\n",this.onFlag=!0,this.chartDataLoaded=!0)}).finally(()=>{this.consoleText=this.consoleText.replace(/^\s+/g,"")}):this.startConvert()},async startConvert(){await V.blfConvert.start_convert({in_path:m(this.blfDirectory),fmt:this.pullType,out_path:m(this.outputDirectory)}).then(e=>{let t=e.data;this.consoleText="",t.code=="-1"?this.consoleText+="\n"+t.msg+"\n":this.consoleText+="\n"+t.msg+"\n",console.log("开始转换",e.data)}).catch(e=>{this.consoleText+="\n转换中断\n"}).finally(()=>{this.onFlag=!0,this.consoleText=this.consoleText.replace(/^\s+/g,"")}),this.chartDataLoaded=!0}}},l=e=>(M("data-v-af588396"),e=e(),O(),e),U=["data-disabled"],j={class:"o-pul-er",id:"el-record-form"},H=l(()=>o("div",{class:"o-pul-title"},"格式转换配置",-1)),R={class:"o-pul-p choose-cation"},G=l(()=>o("span",{style:{color:"red"}},"* ",-1)),J=l(()=>o("span",{class:"record-header-message"},"源 文 件：",-1)),K={class:"o-pul-path"},Q={key:0,class:"o-pul-p input-dbc-cation"},W=l(()=>o("span",{style:{color:"red"}},"* ",-1)),X=l(()=>o("span",{class:"record-header-message"},"DBC 版本：",-1)),Y={class:"o-che-input"},Z={class:"o-pul-p input-cation"},$=l(()=>o("span",{style:{color:"red"}},"* ",-1)),ee=l(()=>o("span",{class:"record-header-message"},"输出格式：",-1)),te=["value"],se={class:"o-pul-p choose-out-cation"},oe=l(()=>o("span",{style:{color:"red"}},"* ",-1)),le=l(()=>o("span",{class:"record-header-message"},"输出路径：",-1)),ae={class:"o-pul-path"},ce={class:"o-pul-p start-rec"},ie=l(()=>o("i",{class:"play-icon"},null,-1)),re=["data-empty"],ne=l(()=>o("div",{class:"o-console-title"},"文件格式转换结果",-1)),de=["data-loading"];function pe(e,t,a,c,s,r){const L=b("Header"),_=b("Button"),F=b("Cascader"),v=P("tooltip");return d(),n("div",{class:"format-conversion","data-disabled":!s.chartDataLoaded},[p(L,{title:"格式转换",quitConfirm:r.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),o("div",j,[H,o("div",R,[G,J,p(_,{onClick:r.chooseBlfPath,class:"choose-path"},{default:g(()=>[i("选择文件（*.blf,*.asc）")]),_:1},8,["onClick"]),i("  "),f((d(),n("span",K,[i(h(s.blfDirectory),1)])),[[v,{content:s.blfDirectory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),s.pullType==="mdf"&&s.fileType==="blf"?(d(),n("div",Q,[W,X,o("div",Y,[p(F,{options:r.dbcVerOpts,modelValue:s.dbcVal,"onUpdate:modelValue":t[0]||(t[0]=u=>s.dbcVal=u)},null,8,["options","modelValue"])])])):A("",!0),o("div",Z,[$,ee,(d(!0),n(z,null,N(s.recList,(u,T)=>(d(),n("label",{class:"o-input record-header-message-imp",key:T},[f(o("input",{name:"pull_type",type:"radio","onUpdate:modelValue":t[1]||(t[1]=S=>s.pullType=S),value:T},null,8,te),[[E,s.pullType]]),i(h(u.label)+" "+h(u.size)+" ",1)]))),128))]),o("div",se,[oe,le,p(_,{onClick:r.chooseOutputPath},{default:g(()=>[i("选择路径")]),_:1},8,["onClick"]),i("  "),f((d(),n("span",ae,[i(h(s.outputDirectory),1)])),[[v,{content:s.outputDirectory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),o("div",ce,[p(_,{type:"primary",disabled:!r.pullDataValid,progress:s.recLoadingProgress,loading:s.recLoading,onClick:r.startFormat},{default:g(()=>[ie,i(" 开始转换")]),_:1},8,["disabled","progress","loading","onClick"])])]),o("div",{class:"o-console-er","data-empty":s.consoleText==="",id:"el-record-console"},[ne,f(o("div",{class:"o-console-body","data-loading":!s.chartDataLoaded},h(s.consoleText),9,de),[[q,s.consoleText]])],8,re)],8,U)}const ye=k(I,[["render",pe],["__scopeId","data-v-af588396"]]);export{ye as default};
