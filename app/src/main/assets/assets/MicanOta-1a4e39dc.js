import{H as w}from"./Header-fcac04d6.js";import{B as T}from"./Button-2ee978ff.js";import{M}from"./Message-055a4b12.js";import{_ as S,e as n,r as l,c as b,h as c,d as s,t as d,i as y,w as x,v as C,j as u,o as A,a as N,p as W,b as k}from"./index-128de56f.js";let h=0,O=0,B=0,m=0;const I={components:{Button:T,Header:w,Message:M},data(){return{updateVersionOptions:[],updateVersionMode:{},softWareVer:"",hardWareVer:"",consoleText:"",chartDataLoaded:!0,updateVersionValid:!1,message:{visible:!1,level:"",content:""}}},computed:{updateVersionValid(){return!!(this.softWareVer.startsWith("CR")&&this.hardWareVer&&this.updateVersionMode.value)}},mounted(){u.report("trackPage",{page:"MICAN软件更新",tip:"1174.19.0.1.34801"}),this.getSnSw(),this.getSWPackages()},unmounted(){this.removeProcess()},methods:{async getSnSw(){clearTimeout(O),await n.miCANOTA.getSnSw().then(e=>{console.log("获取软件号和设备号",e.data),e.status=="200"&&(this.softWareVer=e.data.data.sn,this.hardWareVer=e.data.data.sw)}).catch(()=>{console.log("超时3000"),this.showMessage({level:"error",content:"获取软件号和设备号失败",timeout:3e3})})},async getSWPackages(){await n.miCANOTA.getSWPackages().then(e=>{console.log("获取软件列表",e);let o=e.data,a={};e.status=="200"&&o.forEach(r=>{a={label:r,value:r},this.updateVersionOptions.push(a)})})},async removeProcess(){await n.miCANOTA.removeProcess()},async updateVersion(){clearTimeout(B),clearTimeout(m),console.log("updateVersionMode",this.updateVersionMode),this.consoleText="软件更新中...\n",await n.miCANOTA.miCANUpdata({binName:this.updateVersionMode.value}).then(e=>{console.log("软件刷写",e.data),this.consoleText=e.data.msg,m=setTimeout(()=>{this.getSnSw()},1e3)}).catch(()=>{console.log("超时5000"),this.showMessage({level:"error",content:"更新软件失败",timeout:5e3}),this.consoleText="更新软件失败"}),u.report("track","click",{element_name:"更新软件",tip:"1174.19.0.1.34803"})},showMessage({level:e,content:o,timeout:a}){clearTimeout(h),e!=null&&(this.message.level=e),o!=null&&(this.message.content=o),this.message.visible=!0,a>0&&(h=setTimeout(()=>{this.message.visible=!1},a))}}},i=e=>(W("data-v-a0effe8d"),e=e(),k(),e),P={class:"pull-dt-page"},D={class:"o-pul-er"},H=i(()=>s("div",{class:"o-pul-title"},"MICAN软件更新",-1)),j={class:"o-pul-p input-cation"},E=i(()=>s("span",{class:"ota-header-message"},"当前软/硬件号：",-1)),L={class:"ota-header-message-gray"},R={class:"o-pul-p input-cation"},U=i(()=>s("span",{style:{color:"red"}},"* ",-1)),q=i(()=>s("span",{class:"ota-header-message"},"更新的软件号：",-1)),z={class:"o-pul-p update-software"},F=i(()=>s("i",{class:"lead-icon"},null,-1)),G=["data-empty"],J=i(()=>s("div",{class:"o-console-title"},"软件更新结果",-1)),K=["data-loading"];function Q(e,o,a,r,t,p){const _=l("Header"),g=l("v-select"),f=l("Button"),v=l("Message");return A(),b("div",P,[c(_,{title:"MICAN 固件升级",showRight:!1}),s("div",D,[H,s("div",j,[E,s("span",null,d(t.softWareVer),1),s("span",L,"("+d(t.hardWareVer)+") ",1)]),s("div",R,[U,q,c(g,{options:t.updateVersionOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:t.updateVersionMode,"onUpdate:modelValue":o[0]||(o[0]=V=>t.updateVersionMode=V),class:"tch-tool-select"},null,8,["options","modelValue"])]),s("div",z,[c(f,{type:"primary",disabled:!p.updateVersionValid,onClick:p.updateVersion},{default:y(()=>[F,N("更新软件")]),_:1},8,["disabled","onClick"])])]),s("div",{class:"o-console-er","data-empty":t.consoleText==="",id:"el-record-console"},[J,x(s("div",{class:"o-console-body","data-loading":!t.chartDataLoaded},d(t.consoleText),9,K),[[C,t.consoleText]])],8,G),c(v,{message:t.message},null,8,["message"])])}const ee=S(I,[["render",Q],["__scopeId","data-v-a0effe8d"]]);export{ee as default};
