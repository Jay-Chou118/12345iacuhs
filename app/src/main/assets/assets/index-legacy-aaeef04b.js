System.register(["./Header-legacy-154af0af.js","./Button-legacy-7d99f814.js","./Message-legacy-3abea692.js","./index-legacy-c813e7b0.js","./Cascader-legacy-8269e316.js","./Spin-legacy-f8a0c537.js","./ev-timeplot-legacy-14ed5fc3.js","./index-legacy-d4249be1.js","./index.es-legacy-dc6d5acd.js","./signal-legacy-1ac1ca13.js","./index-legacy-5c5deacc.js","./CopyPath-legacy-3c3dd71d.js","./time-legacy-9e872c4a.js","./ButtonGroup-legacy-8a4833a4.js","./num-legacy-b60967d7.js"],(function(e,t){"use strict";var a,l,i,s,n,o,d,r,c,h,m,p,u,g,b,f,y,v,w,C,k,S,T,D,V,x,L,I,F,R,$,M,E,_,N,A,O,P,U,H,B,j,z,q,K,W,X,G,Y,J,Q,Z,ee,te,ae,le,ie,se,ne;return{setters:[e=>{a=e.H},e=>{l=e.B},e=>{i=e.M},e=>{s=e._,n=e.S,o=e.k,d=e.s,r=e.r,c=e.l,h=e.w,m=e.o,p=e.c,u=e.d,g=e.t,b=e.h,f=e.F,y=e.i,v=e.a,w=e.f,C=e.p,k=e.b,S=e.L,T=e.m,D=e.q,V=e.H,x=e.I,L=e.u,I=e.g,F=e.x,R=e.y,$=e.B,M=e.j,E=e.e,_=e.z,N=e.A,A=e.v,O=e.C,P=e.J,U=e.E,H=e.K,B=e.M,j=e.N,z=e.n},e=>{q=e.C},e=>{K=e.S},e=>{W=e.A,X=e.W,G=e.P},e=>{Y=e.M},e=>{J=e.c},e=>{Q=e.t},e=>{Z=e.n},e=>{ee=e.b,te=e.s,ae=e.C},e=>{le=e.s,ie=e.a},e=>{se=e.B},e=>{ne=e.b}],execute:function(){let t=0;const oe={props:["title","curViewInx","carType","sdb","tinyBatteryFlag","loading"],emits:["cancel","importFileSubmit","treeDataChange"],components:{Button:l,Cascader:q,Message:i,Spin:K},data:()=>(window.messageHandlers={},{dbcVal:[n.DEFAULT[0].value,n.DEFAULT[0].children[0].value],channelVal:{label:"(不加载)",value:0},channelValTwo:{label:"(不加载)",value:0},blfDirectory:"",dbcDirectory:"",dbcDirectoryTwo:"",filePath1:"",filePath2:"",channelNo:{label:1,value:1},channelNoTwo:{label:2,value:2},message:{visible:!1,level:"",content:""},filesList:["","","","","","","","","","","","","","","",""]}),watch:{dbcVal:{handler(e){this.channelVal={label:"(不加载)",value:0},this.channelValTwo={label:"(不加载)",value:0}},immediate:!0}},mounted(){},computed:{dbcVerOpts:()=>[...n.DEFAULT,{label:"自定义模板",value:"自定义模板"}],channelOptions(){let e=[];if(""!==this.dbcVal[0]&&""!==this.dbcVal[1]){e=n.DEFAULT.find((e=>e.value===this.dbcVal[0]))?.children.find((e=>e.value===this.dbcVal[1]))?.comments||[];let t=e.map(((e,t)=>e?`${t}-${e}`:e)).filter((e=>""!==e)).map(((e,t)=>({label:e,value:Number(e.split("-")[0])})));return t.unshift({label:"(不加载)",value:0}),t}}},methods:{choosePath(){o.choosePath({directory:window.downloadPath,saveFilename:"tspa-Record.blf",dialogType:"SAVE_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then((({data:e})=>{console.log("res>>>",e),e.directory&&(this.blfDirectory=e.filename)}))},chooseDbcPath(){JSBridge.send({method:"getUserDBC"},(e=>{console.log("res",e),this.filePath1=e.data;const t=e.data.split("/").pop();console.log("fileName",t),this.dbcDirectory=t})),o.choosePath({dialogType:"OPEN_DIALOG",fileTypes:["DBC文件 (*.dbc;*.DBC)"],allow_multiple:!1}).then((({data:e})=>{e.directory&&(this.blfDirectory=e.filename)}))},chooseDbcPathTwo(){JSBridge.send({method:"getUserDBC"},(e=>{console.log("res",e),this.filePath2=e.data;const t=e.data.split("/").pop();console.log("fileName",t),this.dbcDirectoryTwo=t})),o.choosePath({dialogType:"OPEN_DIALOG",fileTypes:["DBC文件 (*.dbc;*.DBC)"],allow_multiple:!1}).then((({data:e})=>{e.directory&&(this.dbcDirectoryTwo=e.filename)}))},submit(){"android"===d&&("自定义模板"!==this.dbcVal[0]?this.channelVal.value===this.channelValTwo.value&&0!==this.channelVal.value?this.showMessage({timeout:5e3,level:"error",content:"不可重复选择相同通道"}):this.$emit("submitToShow",this.dbcVal,[this.channelVal.label,this.channelValTwo.label],["(不加载)","(不加载)"],this.blfDirectory):this.channelNo===this.channelNoTwo?this.showMessage({timeout:5e3,level:"error",content:"不可重复选择相同通道"}):this.$emit("submitToShow",this.dbcVal,[this.channelNo.value+"-"+this.filePath1,this.channelNoTwo.value+"-"+this.filePath2],[],this.blfDirectory),console.log("android"))},showMessage({level:e,content:a,timeout:l}){clearTimeout(t),null!=e&&(this.message.level=e),null!=a&&(this.message.content=a),this.message.visible=!0,l>0&&(t=setTimeout((()=>{this.message.visible=!1}),l))}}},de=e=>(C("data-v-7aff0277"),e=e(),k(),e),re={class:"o-import-dialog"},ce={class:"o-dialog-wrap"},he={class:"o-dialog-header-wrap"},me={class:"o-dialog-title"},pe={class:"o-dialog-container-wrap"},ue={class:"o-import-configuration"},ge={class:"o-dialog-item-wrap"},be=de((()=>u("span",{class:"o-dialog-item"},"车型/DBC：",-1))),fe={class:"o-dialog-item-select"},ye={class:"o-dialog-item-wrap edit-modal-channel"},ve=de((()=>u("span",{class:"o-dialog-item"},"通道1：",-1))),we={class:"o-dialog-item-wrap edit-modal-channel-two"},Ce=de((()=>u("span",{class:"o-dialog-item"},"通道2：",-1))),ke={class:"o-dialog-item-wrap"},Se=de((()=>u("span",{style:{color:"red"}},null,-1))),Te=de((()=>u("span",{class:"o-dialog-item"},"通道1：",-1))),De={class:"o-dialog-tab"},Ve={class:"o-dialog-choose-dbc"},xe=["title"],Le={class:"o-dialog-item-wrap"},Ie=de((()=>u("span",{style:{color:"red"}},null,-1))),Fe=de((()=>u("span",{class:"o-dialog-item"},"通道2：",-1))),Re={class:"o-dialog-tab"},$e={class:"o-dialog-choose-dbc"},Me=["title"],Ee={class:"o-dialog-footer-wrap"},_e={class:"o-dialog-footer"},Ne={key:0,class:"o-dialog-loading"},Ae=s(oe,[["render",function(e,t,a,l,i,s){const n=r("Cascader"),o=r("v-select"),d=r("Button"),C=r("Spin"),k=r("Message"),S=c("esc");return h((m(),p("div",re,[u("div",ce,[u("div",he,[u("div",me,g(e.$props.title),1),u("i",{class:"o-dialog-title-close",onClick:t[0]||(t[0]=t=>e.$emit("cancel"))})]),u("div",pe,[u("div",ue,[u("div",ge,[be,u("div",fe,[b(n,{options:s.dbcVerOpts,modelValue:i.dbcVal,"onUpdate:modelValue":t[1]||(t[1]=e=>i.dbcVal=e)},null,8,["options","modelValue"])])]),"自定义模板"!=i.dbcVal[0]?(m(),p(f,{key:0},[u("div",ye,[ve,b(o,{options:s.channelOptions,clearable:!1,label:"label",value:"value",modelValue:i.channelVal,"onUpdate:modelValue":t[2]||(t[2]=e=>i.channelVal=e),class:"chf-input-ecu"},null,8,["options","modelValue"])]),u("div",we,[Ce,b(o,{options:s.channelOptions,clearable:!1,label:"label",value:"value",modelValue:i.channelValTwo,"onUpdate:modelValue":t[3]||(t[3]=e=>i.channelValTwo=e),class:"chf-input-ecu"},null,8,["options","modelValue"])])],64)):(m(),p(f,{key:1},[u("div",ke,[Se,Te,u("div",De,[u("div",Ve,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.dbcDirectory||"--"},g(i.dbcDirectory||"--"),9,xe),u("a",{class:"chose-file chose-dbc-file",onClick:t[4]||(t[4]=e=>s.chooseDbcPath())},"选择DBC文件")])])]),u("div",Le,[Ie,Fe,u("div",Re,[u("div",$e,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.dbcDirectoryTwo||"--"},g(i.dbcDirectoryTwo||"--"),9,Me),u("a",{class:"chose-file chose-dbc-file",onClick:t[5]||(t[5]=e=>s.chooseDbcPathTwo())},"选择DBC文件")])])])],64))])]),u("div",Ee,[u("div",_e,[b(d,{style:{width:"52px"},onClick:t[6]||(t[6]=t=>e.$emit("cancel"))},{default:y((()=>[v("取消")])),_:1}),b(d,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:s.submit},{default:y((()=>[v("连接")])),_:1},8,["onClick"])])]),e.$props.loading?(m(),p("div",Ne,[b(C)])):w("",!0)]),b(k,{message:i.message},null,8,["message"])])),[[S,()=>e.$emit("cancel")]])}],["__scopeId","data-v-7aff0277"]]);let Oe=0;const Pe={props:["title","curViewInx","carType","sdb","tinyBatteryFlag","loading"],emits:["cancel","importFileSubmit","treeDataChange"],components:{Button:l,Cascader:q,Message:i,Spin:K},data:()=>({dbcVal:[n.DEFAULT[0].value,n.DEFAULT[0].children[0].value],channelVal:{label:"(不加载)",value:0},channelValTwo:{label:"(不加载)",value:0},channelValThree:{label:"(不加载)",value:0},linChannelVal:{label:"(不加载)",value:0},linChannelValTwo:{label:"(不加载)",value:0},blfDirectory:"",dbcDirectory:"",dbcDirectoryTwo:"",dbcDirectoryThree:"",linDbcDirectory:"",linDbcDirectoryTwo:"",channelNo:{label:1,value:1},channelNoTwo:{label:2,value:2},channelNoThree:{label:3,value:3},linChannelNo:{label:4,value:4},linChannelNoTwo:{label:5,value:5},message:{visible:!1,level:"",content:""},filesList:["","","","","","","","","","","","","","","",""]}),watch:{dbcVal:{handler(e){this.channelVal={label:"(不加载)",value:0},this.channelValTwo={label:"(不加载)",value:0},this.channelValThree={label:"(不加载)",value:0},this.linChannelVal={label:"(不加载)",value:0},this.linChannelValTwo={label:"(不加载)",value:0}},immediate:!0}},mounted(){},computed:{dbcVerOpts:()=>[...n.DEFAULT,{label:"自定义模板",value:"自定义模板"}],channelOptions(){let e=[];if(""!==this.dbcVal[0]&&""!==this.dbcVal[1]){e=n.DEFAULT.find((e=>e.value===this.dbcVal[0]))?.children.find((e=>e.value===this.dbcVal[1]))?.comments||[];let t=e.map(((e,t)=>e?`${t}-${e}`:e)).filter((e=>""!==e)).map(((e,t)=>({label:e,value:Number(e.split("-")[0])})));return t.unshift({label:"(不加载)",value:0}),t}},linChannelOptions(){let e=[];if(""!==this.dbcVal[0]&&""!==this.dbcVal[1]){e=S.find((e=>e.value===this.dbcVal[0]))?.children.find((e=>e.value===this.dbcVal[1]))?.comments||[];let t=e.map((e=>({label:e,value:Number(e.split("-")[0])-1e3})));return t.unshift({label:"(不加载)",value:0}),t}}},methods:{choosePath(){o.choosePath({directory:window.downloadPath,saveFilename:"tspa-Record.blf",dialogType:"SAVE_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then((({data:e})=>{console.log("res>>>",e),e.directory&&(this.blfDirectory=e.directory)}))},chooseDbcPath(){JSBridge.send({method:"getUserDBC"},(e=>{console.log("res",e),this.dbcDirectory=e.data})),res.directory&&(this.blfDirectory=res.filename)},chooseDbcPathTwo(){JSBridge.send({method:"getUserDBC"},(e=>{console.log("res",e),this.dbcDirectory=e.data})),res.directory&&(this.blfDirectory=res.filename)},chooseDbcPathThree(){o.choosePath({dialogType:"OPEN_DIALOG",fileTypes:["DBC文件 (*.dbc;*.DBC)"],allow_multiple:!1}).then((({data:e})=>{e.directory&&(this.linDbcDirectory=e.directory)}))},chooseLinDbcPath(){o.choosePath({dialogType:"OPEN_DIALOG",fileTypes:["LDF文件 (*.ldf;*.LDF)"],allow_multiple:!1}).then((({data:e})=>{e.directory&&(this.linDbcDirectory=e.directory)}))},chooseLinDbcPathTwo(){o.choosePath({dialogType:"OPEN_DIALOG",fileTypes:["LDF文件 (*.ldf;*.LDF)"],allow_multiple:!1}).then((({data:e})=>{e.directory&&(this.linDbcDirectoryTwo=e.directory)}))},submit(){"android"===d?"自定义模板"!==this.dbcVal[0]?this.channelVal.value===this.channelValTwo.value&&0!==this.channelVal.value?this.showMessage({timeout:5e3,level:"error",content:"不可重复选择相同通道"}):this.$emit("submitFiveToShow",this.dbcVal,[this.channelVal.label,this.channelValTwo.label,this.channelValThree.label],[this.linChannelVal.label,this.linChannelValTwo.label],this.blfDirectory):this.channelNo===this.channelNoTwo===this.channelNoThree?this.showMessage({timeout:5e3,level:"error",content:"不可重复选择相同通道"}):this.$emit("submitFiveToShow",this.dbcVal,[this.channelNo.value+"-"+this.dbcDirectory,this.channelNoTwo.value+"-"+this.dbcDirectoryTwo,this.channelNoThree.value+"-"+this.dbcDirectoryThree],[this.linChannelNo.value+"-"+this.linDbcDirectory,this.linChannelNoTwo.value+"-"+this.linDbcDirectoryTwo],this.blfDirectory):"自定义模板"!==this.dbcVal[0]?(console.log("提交中..123"),this.channelVal.value===this.channelValTwo.value&&0!==this.channelVal.value?this.showMessage({timeout:5e3,level:"error",content:"不可重复选择相同通道"}):""!==this.blfDirectory?this.$emit("submitFiveToShow",this.dbcVal,[this.channelVal.label,this.channelValTwo.label,this.channelValThree.label],[this.linChannelVal.label,this.linChannelValTwo.label],this.blfDirectory):this.showMessage({timeout:5e3,level:"error",content:"请选择保存目录路径"})):this.channelNo===this.channelNoTwo===this.channelNoThree?this.showMessage({timeout:5e3,level:"error",content:"不可重复选择相同通道"}):""!==this.blfDirectory?(console.log("自定义传参",this.channelNo),this.$emit("submitFiveToShow",this.dbcVal,[this.channelNo.value+"-"+this.dbcDirectory,this.channelNoTwo.value+"-"+this.dbcDirectoryTwo,this.channelNoThree.value+"-"+this.dbcDirectoryThree],[this.linChannelNo.value+"-"+this.linDbcDirectory,this.linChannelNoTwo.value+"-"+this.linDbcDirectoryTwo],this.blfDirectory)):this.showMessage({timeout:5e3,level:"error",content:"请选择保存目录路径"})},showMessage({level:e,content:t,timeout:a}){clearTimeout(Oe),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Oe=setTimeout((()=>{this.message.visible=!1}),a))}}},Ue=e=>(C("data-v-3b5d5c72"),e=e(),k(),e),He={class:"o-import-dialog"},Be={class:"o-dialog-wrap"},je={class:"o-dialog-header-wrap"},ze={class:"o-dialog-title"},qe={class:"o-dialog-container-wrap"},Ke={class:"o-import-configuration"},We={class:"o-dialog-item-wrap"},Xe=Ue((()=>u("span",{class:"o-dialog-item"},"车型/DBC：",-1))),Ge={class:"o-dialog-item-select"},Ye={class:"o-dialog-item-group-wrap"},Je={class:"o-dialog-item-wrap edit-modal-channel"},Qe=Ue((()=>u("span",{class:"o-dialog-item"},"CAN通道1：",-1))),Ze={class:"o-dialog-item-wrap edit-modal-channel-two"},et=Ue((()=>u("span",{class:"o-dialog-item"},"CAN通道2：",-1))),tt={class:"o-dialog-item-wrap edit-modal-channel-three"},at=Ue((()=>u("span",{class:"o-dialog-item"},"CAN通道3：",-1))),lt={class:"o-dialog-item-group-wrap"},it={class:"o-dialog-item-wrap edit-modal-channel"},st=Ue((()=>u("span",{class:"o-dialog-item"},"LIN通道1：",-1))),nt={class:"o-dialog-item-wrap edit-modal-channel-two"},ot=Ue((()=>u("span",{class:"o-dialog-item"},"LIN通道2：",-1))),dt={class:"o-dialog-item-wrap"},rt=Ue((()=>u("span",{style:{color:"red"}},null,-1))),ct=Ue((()=>u("span",{class:"o-dialog-item"},"CAN通道1：",-1))),ht={class:"o-dialog-tab"},mt={class:"o-dialog-choose-dbc"},pt=["title"],ut={class:"o-dialog-item-wrap"},gt=Ue((()=>u("span",{style:{color:"red"}},null,-1))),bt=Ue((()=>u("span",{class:"o-dialog-item"},"CAN通道2：",-1))),ft={class:"o-dialog-tab"},yt={class:"o-dialog-choose-dbc"},vt=["title"],wt={class:"o-dialog-item-wrap"},Ct=Ue((()=>u("span",{style:{color:"red"}},null,-1))),kt=Ue((()=>u("span",{class:"o-dialog-item"},"CAN通道3：",-1))),St={class:"o-dialog-tab"},Tt={class:"o-dialog-choose-dbc"},Dt=["title"],Vt={class:"o-dialog-item-wrap"},xt=Ue((()=>u("span",{style:{color:"red"}},null,-1))),Lt=Ue((()=>u("span",{class:"o-dialog-item"},"LIN通道1：",-1))),It={class:"o-dialog-tab"},Ft={class:"o-dialog-choose-dbc"},Rt=["title"],$t={class:"o-dialog-item-wrap"},Mt=Ue((()=>u("span",{style:{color:"red"}},null,-1))),Et=Ue((()=>u("span",{class:"o-dialog-item"},"LIN通道2：",-1))),_t={class:"o-dialog-tab"},Nt={class:"o-dialog-choose-dbc"},At=["title"],Ot={key:2,class:"o-dialog-item-wrap"},Pt=Ue((()=>u("span",{style:{color:"red"}},"* ",-1))),Ut=Ue((()=>u("span",{class:"o-dialog-item"},"保存目录：",-1))),Ht=["title"],Bt={class:"o-dialog-footer-wrap"},jt={class:"o-dialog-footer"},zt={key:0,class:"o-dialog-loading"},qt=s(Pe,[["render",function(e,t,a,l,i,s){const n=r("Cascader"),o=r("v-select"),d=r("Button"),C=r("Spin"),k=r("Message"),S=c("esc");return h((m(),p("div",He,[u("div",Be,[u("div",je,[u("div",ze,g(e.$props.title),1),u("i",{class:"o-dialog-title-close",onClick:t[0]||(t[0]=t=>e.$emit("cancel"))})]),u("div",qe,[u("div",Ke,[u("div",We,[Xe,u("div",Ge,[b(n,{options:s.dbcVerOpts,modelValue:i.dbcVal,"onUpdate:modelValue":t[1]||(t[1]=e=>i.dbcVal=e)},null,8,["options","modelValue"])])]),"自定义模板"!=i.dbcVal[0]?(m(),p(f,{key:0},[u("div",Ye,[u("div",Je,[Qe,b(o,{options:s.channelOptions,clearable:!1,label:"label",value:"value",modelValue:i.channelVal,"onUpdate:modelValue":t[2]||(t[2]=e=>i.channelVal=e),class:"chf-input-ecu"},null,8,["options","modelValue"])]),u("div",Ze,[et,b(o,{options:s.channelOptions,clearable:!1,label:"label",value:"value",modelValue:i.channelValTwo,"onUpdate:modelValue":t[3]||(t[3]=e=>i.channelValTwo=e),class:"chf-input-ecu"},null,8,["options","modelValue"])])]),u("div",tt,[at,b(o,{options:s.channelOptions,clearable:!1,label:"label",value:"value",modelValue:i.channelValThree,"onUpdate:modelValue":t[4]||(t[4]=e=>i.channelValThree=e),class:"chf-input-ecu"},null,8,["options","modelValue"])]),u("div",lt,[u("div",it,[st,b(o,{options:s.linChannelOptions,clearable:!1,label:"label",value:"value",modelValue:i.linChannelVal,"onUpdate:modelValue":t[5]||(t[5]=e=>i.linChannelVal=e),class:"chf-input-ecu"},null,8,["options","modelValue"])]),u("div",nt,[ot,b(o,{options:s.linChannelOptions,clearable:!1,label:"label",value:"value",modelValue:i.linChannelValTwo,"onUpdate:modelValue":t[6]||(t[6]=e=>i.linChannelValTwo=e),class:"chf-input-ecu"},null,8,["options","modelValue"])])])],64)):(m(),p(f,{key:1},[u("div",dt,[rt,ct,u("div",ht,[u("div",mt,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.dbcDirectory||"--"},g(i.dbcDirectory||"--"),9,pt),u("a",{class:"chose-file chose-dbc-file",onClick:t[7]||(t[7]=e=>s.chooseDbcPath())},"选择DBC文件")])])]),u("div",ut,[gt,bt,u("div",ft,[u("div",yt,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.dbcDirectoryTwo||"--"},g(i.dbcDirectoryTwo||"--"),9,vt),u("a",{class:"chose-file chose-dbc-file",onClick:t[8]||(t[8]=e=>s.chooseDbcPathTwo())},"选择DBC文件")])])]),u("div",wt,[Ct,kt,u("div",St,[u("div",Tt,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.dbcDirectoryThree||"--"},g(i.dbcDirectoryThree||"--"),9,Dt),u("a",{class:"chose-file chose-dbc-file",onClick:t[9]||(t[9]=e=>s.chooseDbcPathThree())},"选择DBC文件")])])]),u("div",Vt,[xt,Lt,u("div",It,[u("div",Ft,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.linDbcDirectory||"--"},g(i.linDbcDirectory||"--"),9,Rt),u("a",{class:"chose-file chose-dbc-file",onClick:t[10]||(t[10]=e=>s.chooseLinDbcPath())},"选择LDF文件")])])]),u("div",$t,[Mt,Et,u("div",_t,[u("div",Nt,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.linDbcDirectoryTwo||"--"},g(i.linDbcDirectoryTwo||"--"),9,At),u("a",{class:"chose-file chose-dbc-file",onClick:t[11]||(t[11]=e=>s.chooseLinDbcPathTwo())},"选择LDF文件")])])])],64)),"android"!==e.system?(m(),p("div",Ot,[Pt,Ut,b(d,{onClick:s.choosePath,class:"choose-path"},{default:y((()=>[v("选择路径")])),_:1},8,["onClick"]),v("    ")])):w("",!0),"android"!==e.system?(m(),p("div",{key:3,class:"show-directory",title:i.blfDirectory},g(i.blfDirectory),9,Ht)):w("",!0)])]),u("div",Bt,[u("div",jt,[b(d,{style:{width:"52px"},onClick:t[12]||(t[12]=t=>e.$emit("cancel"))},{default:y((()=>[v("取消")])),_:1}),b(d,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:s.submit},{default:y((()=>[v("连接")])),_:1},8,["onClick"])])]),e.$props.loading?(m(),p("div",zt,[b(C)])):w("",!0)]),b(k,{message:i.message},null,8,["message"])])),[[S,()=>e.$emit("cancel")]])}],["__scopeId","data-v-3b5d5c72"]]);let Kt=0;const Wt={props:["title","curViewInx","carType","sdb","tinyBatteryFlag","loading"],emits:["cancel","importFileSubmit","treeDataChange"],components:{Button:l,Cascader:q,Message:i,Spin:K},data:()=>({dbcVal:[n.DEFAULT[0].value,n.DEFAULT[0].children[0].value],channelValList:[{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0}],blfDirectory:"",dbcDirectoryList:["","","","","","","","","","","",""],channelNo:{label:1,value:1},channelNoTwo:{label:2,value:2},channelNoThree:{label:3,value:3},linChannelNo:{label:4,value:4},linChannelNoTwo:{label:5,value:5},message:{visible:!1,level:"",content:""},filesList:["","","","","","","","","","","","","","","",""]}),watch:{dbcVal:{handler(e){console.log("dbcVal1753",e),this.channelValList=[{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0},{label:"(不加载)",value:0}]},immediate:!0}},mounted(){},computed:{dbcVerOpts:()=>[...n.DEFAULT,{label:"自定义模板",value:"自定义模板"}],channelOptions(){let e=[];if(""!==this.dbcVal[0]&&""!==this.dbcVal[1]){e=n.DEFAULT.find((e=>e.value===this.dbcVal[0]))?.children.find((e=>e.value===this.dbcVal[1]))?.comments||[];let t=e.map(((e,t)=>e?`${t}-${e}`:e)).filter((e=>""!==e)).map(((e,t)=>({label:e,value:Number(e.split("-")[0])})));return t.unshift({label:"(不加载)",value:0}),t}},linChannelOptions(){let e=[];if(""!==this.dbcVal[0]&&""!==this.dbcVal[1]){e=S.find((e=>e.value===this.dbcVal[0]))?.children.find((e=>e.value===this.dbcVal[1]))?.comments||[];let t=e.map((e=>({label:e,value:Number(e.split("-")[0])-1e3})));return t.unshift({label:"(不加载)",value:0}),t}}},methods:{choosePath(){o.choosePath({directory:window.downloadPath,saveFilename:"tspa-Record.blf",dialogType:"SAVE_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then((({data:e})=>{console.log("res>>>",e),e.directory&&(this.blfDirectory=e.directory)}))},chooseDbcPath(e){console.log("inx",e),o.choosePath({dialogType:"OPEN_DIALOG",fileTypes:["DBC文件 (*.dbc;*.DBC)"],allow_multiple:!1}).then((({data:t})=>{t.directory&&(this.dbcDirectoryList[e]=t.directory)}))},submit(){console.log("linChannelOptions1111",this.linChannelOptions),"android"===d?"自定义模板"!==this.dbcVal[0]?this.$emit("submitTwelveToShow",this.dbcVal,this.channelValList.map((e=>e.label)),["(不加载)","(不加载)"],this.blfDirectory):this.$emit("submitTwelveToShow",this.dbcVal,this.channelValList.map(((e,t)=>t+1+"-"+this.dbcDirectoryList[t])),[],this.blfDirectory):"自定义模板"!==this.dbcVal[0]?""!==this.blfDirectory?this.$emit("submitTwelveToShow",this.dbcVal,this.channelValList.map((e=>e.label)),["(不加载)","(不加载)"],this.blfDirectory):this.showMessage({timeout:5e3,level:"error",content:"请选择保存目录路径"}):""!==this.blfDirectory?(console.log("自定义传参",this.channelValList,this.channelValList.map(((e,t)=>t+1+"-"+this.dbcDirectoryList[t]))),this.$emit("submitTwelveToShow",this.dbcVal,this.channelValList.map(((e,t)=>t+1+"-"+this.dbcDirectoryList[t])),[],this.blfDirectory)):this.showMessage({timeout:5e3,level:"error",content:"请选择保存目录路径"})},showMessage({level:e,content:t,timeout:a}){clearTimeout(Kt),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Kt=setTimeout((()=>{this.message.visible=!1}),a))}}},Xt=e=>(C("data-v-8256cc54"),e=e(),k(),e),Gt={class:"o-import-dialog"},Yt={class:"o-dialog-wrap"},Jt={class:"o-dialog-header-wrap"},Qt={class:"o-dialog-title"},Zt={class:"o-dialog-container-wrap"},ea={class:"o-import-configuration"},ta={class:"o-dialog-item-wrap"},aa=Xt((()=>u("span",{class:"o-dialog-item"},"车型/DBC：",-1))),la={class:"o-dialog-item-select"},ia={key:0,class:"o-dialog-item-group-wrap"},sa={class:"o-dialog-item"},na=Xt((()=>u("span",{style:{color:"red"}},null,-1))),oa={class:"o-dialog-item"},da={class:"o-dialog-tab"},ra={class:"o-dialog-choose-dbc"},ca=["title"],ha=["onClick"],ma={key:2,class:"o-dialog-item-wrap"},pa=Xt((()=>u("span",{style:{color:"red"}},"* ",-1))),ua=Xt((()=>u("span",{class:"o-dialog-item"},"保存目录：",-1))),ga=["title"],ba={class:"o-dialog-footer-wrap"},fa={class:"o-dialog-footer"},ya={key:0,class:"o-dialog-loading"},va=s(Wt,[["render",function(e,t,a,l,i,s){const n=r("Cascader"),o=r("v-select"),d=r("Button"),C=r("Spin"),k=r("Message"),S=c("esc");return h((m(),p("div",Gt,[u("div",Yt,[u("div",Jt,[u("div",Qt,g(e.$props.title),1),u("i",{class:"o-dialog-title-close",onClick:t[0]||(t[0]=t=>e.$emit("cancel"))})]),u("div",Zt,[u("div",ea,[u("div",ta,[aa,u("div",la,[b(n,{options:s.dbcVerOpts,modelValue:i.dbcVal,"onUpdate:modelValue":t[1]||(t[1]=e=>i.dbcVal=e)},null,8,["options","modelValue"])])]),"自定义模板"!=i.dbcVal[0]?(m(),p("div",ia,[(m(!0),p(f,null,T(i.channelValList,((e,t)=>(m(),p("div",{class:"o-dialog-item-wrap edit-modal-channel",key:t},[u("span",sa,"CAN通道"+g(t+1)+"：",1),b(o,{options:s.channelOptions,clearable:!1,label:"label",value:"value",modelValue:i.channelValList[t],"onUpdate:modelValue":e=>i.channelValList[t]=e,class:"chf-input-ecu"},null,8,["options","modelValue","onUpdate:modelValue"])])))),128))])):(m(!0),p(f,{key:1},T(i.dbcDirectoryList,((e,t)=>(m(),p("div",{class:"o-dialog-item-wrap",key:t},[na,u("span",oa,"CAN通道"+g(t+1)+"：",1),u("div",da,[u("div",ra,[u("div",{class:"o-table-dbc input-overflow-sty",title:i.dbcDirectoryList[t]||"--"},g(i.dbcDirectoryList[t]||"--"),9,ca),u("a",{class:"chose-file chose-dbc-file",onClick:e=>s.chooseDbcPath(t)},"选择DBC文件",8,ha)])])])))),128)),"android"!==e.system?(m(),p("div",ma,[pa,ua,b(d,{onClick:s.choosePath,class:"choose-path"},{default:y((()=>[v("选择路径")])),_:1},8,["onClick"]),v("    ")])):w("",!0),"android"!==e.system?(m(),p("div",{key:3,class:"show-directory",title:i.blfDirectory},g(i.blfDirectory),9,ga)):w("",!0)])]),u("div",ba,[u("div",fa,[b(d,{style:{width:"52px"},onClick:t[2]||(t[2]=t=>e.$emit("cancel"))},{default:y((()=>[v("取消")])),_:1}),b(d,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:s.submit},{default:y((()=>[v("连接")])),_:1},8,["onClick"])])]),e.$props.loading?(m(),p("div",ya,[b(C)])):w("",!0)]),b(k,{message:i.message},null,8,["message"])])),[[S,()=>e.$emit("cancel")]])}],["__scopeId","data-v-8256cc54"]]),wa={props:{modelValue:{type:Boolean,required:!0},id:{type:String,required:!0}},computed:{checkValue:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},methods:{handleChange(e){this.checkValue=e.target.checked}}},Ca={class:"switch-wrap"},ka={class:"switch"},Sa=["checked"],Ta=(e=>(C("data-v-3935df67"),e=e(),k(),e))((()=>u("span",null,null,-1))),Da=s(wa,[["render",function(e,t,a,l,i,s){return m(),p("div",Ca,[u("label",ka,[u("input",{type:"checkbox",checked:s.checkValue,onChange:t[0]||(t[0]=(...e)=>s.handleChange&&s.handleChange(...e))},null,40,Sa),Ta])])}],["__scopeId","data-v-3935df67"]]);let Va=[],xa=0;const La={props:["signals","carType","sdb","dbcVal","fileType","defaultOptions","filledOptions","loading","dbcChn","ldfChn"],emits:["signalsChange","cancel"],components:{Button:l,RecycleScroller:D,Spin:K,Message:i},data(){const e=this.$ls.get("blfread_sdbData")||[];if(console.log("sdbCustom123",this.$props.dbcVal,this.sdb,this.dbcChn,this.ldfChn),"custom"===this.carType){let t=e.find((e=>e.sdb===this.sdb))?.comments;t&&(Va=["",...t])}else if(console.log("6777",this.ldfChn,this.dbcChn),this.ldfChn.every((e=>0==e))&&this.dbcChn.some((e=>e>0))&&(Va=V.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[]),this.ldfChn.some((e=>e>0))&&this.dbcChn.every((e=>e<0))&&(Va=x.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[]),this.ldfChn.some((e=>e>0))&&this.dbcChn.some((e=>e>0))){console.log("5566");let e=V.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[],t=x.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[];Va=e.concat(t)}return console.log("C2C123",Va),Va=Va.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`)),{inputStr:"",treeData:[],checkedList:[],isFilled:!1,message:{visible:!1,level:"",content:""},showSignalsList:[]}},computed:{list(){let e=[];for(let t=0;t<this.treeData.length;t++){let a=this.treeData[t];-1!=a.id&&e.push({_id:a.id,id:a.id,node_type:a.node_type,text:a.text});for(let t=0;t<a.children.length;t++){let l=a.children[t];"-"!=l.id[0]&&e.push({_id:a.id+"-"+l.id,id:l.id,node_type:l.node_type,text:l.text});for(let t=0;t<l.children.length;t++){let i=l.children[t];e.push({...i,_id:a.id+"-"+l.id+"-"+i.id})}}}return console.log(e,11111111),e}},watch:{isFilled(e,t){this.dataInit()}},async created(){this.dataInit()},mounted(){console.log(this.$props.signals),this.$refs.chsInputRef.focus(),this.checkedList=this.$props.signals,this.updateChecked(),setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},beforeUnmount(){},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{onFilledChange(e){this.inputStr="",this.isFilled=!this.isFilled},title4node:e=>Q(e),clickHandler(e){0==this.$refs.root?.contains(e.target)&&this.$emit("cancel")},dataInit(){let e=[];console.log(this.$props.filledOptions.data,33333333333);let t=this.$props.filledOptions.data;for(let a in t){let l={id:+a,text:Va[a],node_type:"channel",children:[]};for(let e in t[a]){let i={id:a+"_"+e,text:"-1"==e?"":e,node_type:"msg",channel:l.id,children:t[a][e].map((t=>({id:t[0],msg:"-1"==e?"-1":+e.match(/\(([^)]+)\)/)?.[1].toUpperCase().replace(/X/g,"x")||e,channel:l.id,text:t[0],node_type:"signal",comment:t[1],remark:t[2],maxRaw:t[5],minRaw:t[6],enums:t[9],unit:t[10],androidId:t[18]})))};l.children.push(i)}e.push(l)}this.treeData=Object.freeze(e),console.log(this.treeData)},selectNode(e){console.log(this.checkedList);let t=this.checkedList.map((e=>({...e})));t.some((t=>t._id===e._id))?(console.log("s1"),this.checkedList=t.filter((t=>t._id!==e._id))):(console.log("s2"),t.length<30?this.checkedList=[...t.filter((t=>t._id!==e._id)),e]:this.showMessage({level:"error",content:`选择不能超过${t.length}项`,timeout:2e3}))},showMessage({level:e,content:t,timeout:a}){clearTimeout(xa),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(xa=setTimeout((()=>{this.message.visible=!1}),a))},submit(){this.$emit("signalsChange",this.checkedList)},updateChecked(){},highlightWord(e){if(!e)return e;const t=this.inputStr;if(!t)return e;const a=t.split(/\s+/g);var l,i,s=a.length;for(l=0;l<s;l++)try{(i=new RegExp(a[l],"gi")).test(e)&&(e=e.replace(i,"<strong>$&</strong>"))}catch(n){i=a[l],e=e.replace(i,"<strong>$&</strong>")}return e},onChange:L((function(){let e,t=!1,a=this.inputStr.toLowerCase();a.startsWith("0x")&&(t=!0);try{e=new RegExp(a,"i")}catch(s){e={test:e=>~e.toLowerCase().indexOf(e.toLowerCase())}}let l=[],i=this.$props.filledOptions.data;for(let n in i){let s={id:+n,text:Va[n],node_type:"channel",children:[]};for(let l in i[n]){let o=t&&l.includes(a),d={id:n+"_"+l,text:"-1"==l?"":l,node_type:"msg",channel:s.id,children:i[n][l].filter((t=>o||e.test(t[0])||e.test(t[1]))).map((e=>({id:e[0],msg:"-1"==l?"-1":+l.match(/\(([^)]+)\)/)?.[1].toUpperCase().replace(/X/g,"x"),channel:s.id,text:e[0],node_type:"signal",comment:e[1],remark:e[2],maxRaw:e[5],minRaw:e[6],enums:e[9],unit:e[10],androidId:e[18]})))};d.children.length>0&&s.children.push(d)}(s.children.length>0||e.test(s.text)||e.test(s.comment))&&l.push(s)}this.treeData=l,console.log(this.treeData),this.updateChecked()}),500,{leading:!1})}},Ia={class:"chs-er",ref:"root"},Fa={class:"chs-list-er"},Ra={key:0,class:"chs-node"},$a=["innerHTML"],Ma=["onMousedown","for"],Ea=["id","checked"],_a=["innerHTML"],Na=["innerHTML"],Aa={key:0,class:"spin-loding-style"},Oa=(e=>(C("data-v-82c5920a"),e=e(),k(),e))((()=>u("div",null,null,-1))),Pa=s(La,[["render",function(e,t,a,l,i,s){const n=r("RecycleScroller"),o=r("Spin"),d=r("Message"),f=c("tooltip"),C=c("esc");return h((m(),p("div",Ia,[h(u("input",{class:"chs-input-er",ref:"chsInputRef",placeholder:"搜索信号名称/信号描述","onUpdate:modelValue":t[0]||(t[0]=e=>i.inputStr=e),onInput:t[1]||(t[1]=(...e)=>s.onChange&&s.onChange(...e)),draggable:!1},null,544),[[I,i.inputStr]]),u("div",Fa,[b(n,{class:"chs-list",items:s.list,"item-size":28,"key-field":"_id"},{default:y((({item:e})=>["channel"==e.node_type?(m(),p("div",Ra,g(e.text),1)):"msg"==e.node_type?(m(),p("div",{key:1,class:"chs-node",style:{"text-indent":"1em"},innerHTML:s.highlightWord(e.text)},null,8,$a)):"signal"==e.node_type?h((m(),p("div",{key:2,onMousedown:F((t=>s.selectNode(e)),["prevent","stop"]),for:e._id,style:{"text-indent":"2em"},class:"chs-node chs-node-item"},[u("input",{id:e._id,type:"checkbox",class:"chs-node-checkbox",checked:i.checkedList.some((t=>t._id===e._id))},null,8,Ea),u("span",{class:"chs-node-signal",innerHTML:s.highlightWord(e.text)},null,8,_a),v(" "),u("span",{class:"chs-node-comment",innerHTML:s.highlightWord(e.comment)},null,8,Na)],40,Ma)),[[f,{content:s.title4node(e),html:!0},void 0,{right:!0}]]):w("",!0)])),_:1},8,["items"]),u("div",{class:R(30==i.checkedList.length?"chs-ft-label-len":"chs-ft-label")},"（"+g(i.checkedList.length)+"/30）",3),u("div",{class:"chs-btn confirm","data-cy":"chooseSignalSubmit",onClick:t[2]||(t[2]=(...e)=>s.submit&&s.submit(...e))},"确定"),u("div",{class:"chs-btn cancel",onClick:t[3]||(t[3]=t=>e.$emit("cancel"))},"取消"),e.$props.loading?(m(),p("div",Aa,[Oa,b(o)])):w("",!0),b(d,{message:i.message},null,8,["message"])])])),[[C,()=>e.$emit("cancel")]])}],["__scopeId","data-v-82c5920a"]]),Ua={props:["chartTableData","showSignalsList"],computed:{mergedArray(){return this.$props.chartTableData.map((e=>{const t=this.$props.showSignalsList.find((t=>t.name===e.name));return t?{...e,...t}:e}))}},watch:{mergedArray:{deep:!0,handler(e,t){this.mergedArray.forEach(((e,t)=>{let a=Math.trunc((e.raw_values[e.raw_values?.length-1]-Math.abs(e.minRaw))/(e.maxRaw-Math.abs(e.minRaw))*100)>100?100:Math.trunc((e.raw_values[e.raw_values?.length-1]-Math.abs(e.minRaw))/(e.maxRaw-Math.abs(e.minRaw))*100);this.mergedArray[t].proportion=a,console.log(this.mergedArray[t].proportion,e.raw_values[e.raw_values?.length-1]-Math.abs(e.minRaw),Math.abs(e.minRaw),(e.raw_values[e.raw_values?.length-1]-Math.abs(e.minRaw))/(e.maxRaw-Math.abs(e.minRaw))*100,"11111111")}))}}},data:()=>({})},Ha=e=>(C("data-v-170cda80"),e=e(),k(),e),Ba={style:{"overflow-y":"auto",height:"calc(100vh - 215px)",border:"1px solid #f0f0f0",width:"calc(100% - 20px)",position:"relative"}},ja={class:"o-table"},za=Ha((()=>u("thead",{class:"o-table-thead",style:{"background-color":"#FAFAFA"}},[u("tr",null,[u("th",{class:"o-table-cell"},[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[u("div",null,"Name"),u("div",{class:"time-line"})])]),u("th",{class:"o-table-cell"},[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[v(" Value "),u("div",{class:"time-line"})])]),u("th",{class:"o-table-cell"},[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[v(" Unit "),u("div",{class:"time-line"})])]),u("th",{class:"o-table-cell"},[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[v(" Raw Value "),u("div",{class:"time-line"})])]),u("th",{class:"o-table-cell"},[u("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[v(" Bar "),u("div",{class:"time-line"})])]),u("th",{class:"o-table-cell"},"Commont")])],-1))),qa={class:"o-table-tbody"},Ka={key:0,class:"o-pul-button-wrap-icon"},Wa=[Ha((()=>u("img",{class:"text-muted-ing-data",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACICAMAAABX7hBEAAAAM1BMVEUAAAD////Nzc0MDAyXl5cAAAAAAAC9vb3t7e0BAQF1dXUAAAApKSkAAABBQUFXV1cAAACKKc10AAAAEXRSTlMATExMTAk1TExBTCFLF0tMKkK5GFYAAAL4SURBVHja7JntauswDIZty7Is+fP+r/Y0dUOz0BZzMKkGe35sMFh5Kr2Sndb88cd/gR2NahBAuWJolZNmxd6iz1z0KiJEGwVCMVoBsvauqLWIQaxVrZhqtHeoscqBRiY7iJRVDjSL3dkGWt+09GqtasUCWSg+FSUrm5ZQJUNuPu6STtdAF/DOkVSAKm5XbIpOaG7uDvmWAZqPyhQLkCM3oFFI726SkZRcIoKQ5NrEE9HTUShuA63ghC5ADUC27kJum+febPFRwSUCueXsx32BvNThKeLvhczef3ugE0AlqmIHMUbnpQ3P2mD7Bd9URIZKzkmN9shNc5TzwfcuER2g3aiwC548yUvLQ9FcDqIxKQyA7FuirwAczLVgCpyOu+aNHEkGDpfvQ+zMHfF8aT33V2re5C7PHyY+bzfM7ly5BkPuepC5mDPsj3J1tPU7lJc7I4gKuRuJy8s/55WZW+9nkBXI3Sic3pknDZ9+4M1PNV3To8YLEEopGjr5jgDAzOoee3ewj8egpNQQGcIjiWwUgtz3EUaNJcQQnl5B4bIJwSCjGfRutFEYN0G9FeRkNkG1GUTAg1didbu6h/vPIVYUHsgjdBg4lRQU+u3NxcSs8oN81Be6Xyeobq/sfGkzY5ilvDjbSljF+74kaDJDYxxOxxBy80uon5IdMrkZHi+CgMcnYLuEnD7Gvk0ZUu6nECKLXQJ9Xg2Fxc3gYRwiz3+ENQWMNU18PzSBAP6cr1UFBDSf6UBzhj9akfIVBRyEOhfDGtAsT6Df3/aiQdlJdVEBnyO8alAG7C8p4E6ajSHg4gRCMlP0PNfk9tjXqwu4OoYpX5bAHZyP4dICmhMr9nUxfXkBlw4K/2vfXlIABKEAikbaR7P9b7d5kxREDM5dwVGcPNS71wbm1PhmI1ZVQjn6FK7GoXx0rRNOipULj2eX4r60AteqQqcjCAgICAgICAgICAgICAgICAgICAgICAgICAgI+BdgHn3buX1/XJmr9AZus7VIkiRJD2y6ViB4C1+1AAAAAElFTkSuQmCC",alt:""},null,-1))),Ha((()=>u("td",{class:"text-center text-muted-data"},"请先选择信号并确认",-1)))],Xa={class:"o-table-cell"},Ga={class:"o-table-cell"},Ya={class:"o-table-cell"},Ja={class:"o-table-cell"},Qa={class:"o-table-cell",style:{width:"230px"}},Za={class:"o-table-cell"},el={style:{width:"360px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},tl=s(Ua,[["render",function(e,t,a,l,i,s){const n=c("tooltip");return m(),p("div",Ba,[u("table",ja,[za,u("tbody",qa,[0==s.mergedArray?.length?(m(),p("div",Ka,Wa)):w("",!0),(m(!0),p(f,null,T(s.mergedArray,((e,t)=>(m(),p("tr",{key:t},[u("td",Xa,g(e.name),1),u("td",Ga,g(0===Object.keys(e.enums)?.length?e.values[e.values?.length-1]:e.enums[e.values[e.values?.length-1]]),1),u("td",Ya,g(e.unit),1),u("td",Ja,g(e.raw_values[e.raw_values?.length-1]),1),u("td",Qa,[u("div",{style:$({width:e.proportion+"%"}),class:"proportion"},null,4)]),h((m(),p("td",Za,[u("div",el,g(e.comment),1)])),[[n,e.comment]])])))),128))])])])}],["__scopeId","data-v-170cda80"]]);let al=0;const ll={props:["store","closeFlag","getDbcData","dbcVal","sdb","dbcChn","ldfChn","chartTableData"],emits:["connect","showMessage","getCarCode"],components:{Button:l,TableChart:tl,Header:a,ManageViewsGroup:Y,Draggable:J,ChooseSignal:Pa,AddOrSelector:W,TimePlotMulti:X,ProgressBar:G,Message:i,ButtonGroup:se,Switch:Da},data(){let e=this.$ls.get("blfread_treeData")?.map((e=>({...e,carType:e.carType||"MS11",sdb:e.sdb||"E4U1",children:e.children.map((t=>({...t,warning:!1,pid:e.id,color:t.color||"blue"})))})));return e&&0!==e?.length||(e=[]),e=e.filter((e=>!("MS11"===e.carType&&"E4U1"===e.sdb&&"默认视图"===e.text&&0===e.children.length))),e.some((e=>"MS11"===e.carType&&"E4U1"===e.sdb)),this.$ls.set("blfread_treeData",e),{system:d,modeOptions:[{label:"分散",value:"single"},{label:"对齐",value:"same"},{label:"聚合",value:"shifted"}],chartMode:"single",timeFilterOptions:[{label:"绝对时间",value:"absolute"},{label:"相对时间",value:"relative"}],timeFilterMode:{label:"绝对时间",value:"absolute"},startTime:0,showDotsFrame:!1,fileType:"blf",blfcpp:"cpp",isBigFile:!1,chooseSignalAble:!1,message:{visible:!1,level:"",content:""},modal:{title:"导入文件",visible:!1},manageModal:{title:"管理视图",manageVisible:!1},treeData:e.map((e=>(e.children.forEach((e=>{e.warning=!1})),e))),curView:{label:e[0]?.text,value:0,tag:e[0]?.sdb},C2C:[],colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],sdb:"E4U3_1115",directory:"",carType:"MS11",directorySize:{label:"",value:0,durationMaybe:0,durationMaybeLabel:"0秒"},backBlock:!1,chartDataLoaded:!0,waitChart:{},fileChoosed:!1,traceList:new Map,timeData:Object.freeze([]),tableList:[],channelVersion:[{label:"全部",value:""}],channelVal:"全部",ECUVersion:[{label:"全部",value:""}],ECUVal:"全部",canIdsVersion:[{label:"全部",value:""}],canIdsVal:"全部",filterTableList:[],columnDefs:[{headerName:"Time",field:"timeTabData"},{headerName:"Chn",field:"chnTabData",width:80},{headerName:"ID",field:"idTabData",width:80},{headerName:"Name",field:"nameTabData",width:300},{headerName:"Event Type",field:"eventTabData"},{headerName:"Dir",field:"dirTabData",width:80},{headerName:"DLC",field:"dlcTabData",width:80},{headerName:"文本ECU",field:"dataTabData"}],debug:window._debug,signalLoading:!1,defaultOptions:{},filledOptions:{},showSignalsList:[],objSing:{},mlistChart:[{key:"timeChart",name:" 切换为折线图",icon:"box"},{key:"tableChart",name:"切换为表格",icon:"setting"}],curChart:"timeChart",tablechartShow:!0,timechartShow:!1,timeLimit:10,minTime:0,turnTimeLimit:!1}},computed:{sdbVal(){return[this.carType,this.$props.sdb]},quitConfirm(){return!!this.directory.trim()},treeDataDbc(){return this.treeData.map(((e,t)=>({...e,label:e.text,value:t,tag:e.sdb}))).filter((e=>e.carType===this.carType&&e.sdb===this.sdb))},carTypeLabel(){return this.carType&&"custom"!==this.carType?this.carType+" / ":""},view(){return this.treeData[this.curView?.value]},directoryLabel(){let e=this.directory.split("/").pop();return e.length>25?e.slice(0,10)+"..."+e.slice(-15):e},fileType_CarType(){return[this.fileType,this.carType]}},mounted(){this.debug=!!window._debug,this.fillEmptyTreeData(),this.curView=this.treeDataDbc[0],M.report("trackPage",{page:"查看报文",tip:"1174.10.0.1.27765"}),window._timeData=this.timeData},beforeUnmount(){this.timeData=[]},unmounted(){E.blf.freeSpace(),E.ascReader.freeSpace(),E.logReader.freeSpace(),window._timeData.forEach((e=>{e.t.length=0}))},watch:{fileType_CarType(){"mdf"===this.fileType?this.blfcpp="cpp":this.debug||("custom"===this.carType?this.blfcpp="python":this.blfcpp="cpp")},blfcpp:{handler(e){window._blfcpp=e},immediate:!0},sdbVal:{handler(e){this.sdb=this.$props.sdb;let t=[];this.curView=this.treeDataDbc[0];const a=this.$ls.get("blfread_sdbData")||[];if("custom"===this.carType){let e=a.find((e=>e.sdb===this.sdb))?.comments;e&&(t=["",...e])}else t=SDB.DEFAULT.find((e=>e.value===this.carType))?.children.find((e=>e.value===this.sdb))?.comments||[];this.C2C=t.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`))},immediate:!0},chartDataLoaded(e,t){e?(this.backBlock=!1,document.querySelector(".o-body").style.cursor=""):(this.backBlock=!0,document.querySelector(".o-body").style.cursor="wait")},treeData:{handler(e,t){JSON.stringify(this.$ls.get("blfread_treeData"))!==JSON.stringify(e)&&this.$ls.set("blfread_treeData",e)},deep:!0},chooseSignalAble:{handler(){this.filledOptions=this.$props.getDbcData}},directory:{async handler(e){const t=await o.getFileSize(e),a=Math.round(.166*(1678e-19*t*t+1.768e-7*t+.5581));this.directorySize={label:ee(t),value:t,durationMaybe:1e3*a,durationMaybeLabel:le(a)}}},curView:{handler(e){this.updateSignal(this.view.children)},deep:!0},dbcVal:{handler(e){this.carType="自定义模板"===e?"custom":e.split("/")[0]},deep:!0}},beforeUpdate(){},methods:{choose(e){this.curChart=e,"timeChart"==e?(this.timechartShow=!1,this.tablechartShow=!0):"tableChart"==e&&(this.timechartShow=!0,this.tablechartShow=!1)},upTimeData(e){if(!(e?.length>0))return;let t=Date.now()/1e3-(this.turnTimeLimit?this.timeLimit:1200);console.log("minTime",t),console.log("this.timeData1111",this.timeData);let a=this.timeData.slice();console.log("pieceData1850",e,a),e.forEach((e=>{let l=a.find((t=>t.channel===e.busId&&t.name===e.name));for(;l?.t?.[0]<t;)l.t.shift(),l.v.shift();l&&(l.t.push(...e.times.map((e=>+e.toFixed(3)))),l.v.push(...e.values))})),this.timeData=Object.freeze(a),console.log("this.timeData",this.timeData,this.view),this.loadChart(this.view)},onUpdateDefaultOptions(e){this.defaultOptions=Object.freeze(e)},title4node:e=>Q(e),showMessage({level:e,content:t,timeout:a}){clearTimeout(al),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(al=setTimeout((()=>{this.message.visible=!1}),a))},hideMessage(){this.message.visible=!1},onTreeDataChange(){this.treeData=this.$ls.get("blfread_treeData")},fillEmptyTreeData(){SDB.DEFAULT.forEach((e=>{e.children.forEach((t=>{this.treeData.some((a=>a.carType===e.value&&a.sdb===t.value))||this.treeData.push({id:+Math.random().toString().replace(".",""),text:"默认视图",type:"view",editable:!1,carType:e.value,sdb:t.value,deleteConfirm:!1,children:[]})}))}))},deleteView(e){let t=this.treeData.filter((t=>t.id!==e.id));this.curView.value=t.findIndex((e=>e.id===this.view.id)),this.treeData=t},updateView(e){this.treeData=this.treeData.map((t=>t.id===e.id?e:t))},onImportView(e){this.addView(e)},resetTimeData(){this.directory="",this.backBlock=!1,this.chartDataLoaded=!0,this.waitChart={},this.fileChoosed=!1,this.traceList=new Map},choosePath(){"blf"===this.fileType?(this.chartDataLoaded=!1,this.clearTimeData(),E.blf.getBLFdata({blfFile:this.directory,mode:this.isBigFile?"bigFile":void 0}).then((async e=>{this.startTime=e.data.startTime,this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let t=this.treeData.slice();t.splice(this.curView.value,1),t.unshift(this.treeData[this.curView.value]),t=t.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),E.blf.haveDataSignal({}).then((e=>{this.filledOptions=Object.freeze(e.data),this.signalLoading=!1}));for(let a=0;a<t.length;a++)await this.play(t[a]),0===a&&(this.chartDataLoaded=!0)})).catch((()=>{})).finally((()=>{this.chartDataLoaded=!0,this.signalLoading=!1}))):"mdf"===this.fileType?(async()=>{this.signalLoading=!1,this.chartDataLoaded=!1,this.clearTimeData(),this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let e=this.treeData.slice();e.splice(this.curView.value,1),e.unshift(this.treeData[this.curView.value]),e=e.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),await this.play(this.treeData[this.curView.value]);for(let t=0;t<e.length;t++)await this.play(e[t]),0===t&&(this.chartDataLoaded=!0)})():"asc"===this.fileType?(this.chartDataLoaded=!1,this.clearTimeData(),E.ascReader.getAscdata({ascFile:this.directory}).then((async e=>{this.startTime=e.data?.data?.startTime||0,this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let t=this.treeData.slice();t.splice(this.curView.value,1),t.unshift(this.treeData[this.curView.value]),t=t.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),E.ascReader.haveDataSignal({ascFile:this.directory}).then((e=>{this.filledOptions=Object.freeze(e.data),this.signalLoading=!1}));for(let a=0;a<t.length;a++)await this.play(t[a]),0===a&&(this.chartDataLoaded=!0)})).catch((()=>{})).finally((()=>{this.chartDataLoaded=!0,this.signalLoading=!1}))):"log"===this.fileType&&(this.chartDataLoaded=!1,this.clearTimeData(),E.logReader.getLogData({logFile:this.directory}).then((async e=>{this.startTime=e.data?.data?.startTime||0,this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let t=this.treeData.slice();t.splice(this.curView.value,1),t.unshift(this.treeData[this.curView.value]),t=t.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),E.logReader.haveDataSignal({ascFile:this.directory}).then((e=>{this.filledOptions=Object.freeze(e.data),this.signalLoading=!1}));for(let a=0;a<t.length;a++)await this.play(t[a]),0===a&&(this.chartDataLoaded=!0)})).catch((()=>{})).finally((()=>{this.chartDataLoaded=!0,this.signalLoading=!1})))},clearTimeData(){this.timeData=Object.freeze([]),this.treeData.forEach((e=>{e.children.forEach((e=>{e.warning=void 0}))}))},hideSignal(e,t){e.hidden=!e.hidden,this.play(t,!0)},deleteSignal(e){this.treeData=this.treeData.map((t=>{if(t.id==e.pid){let a={...t,children:t.children.filter((t=>!(t.id==e.id&&t.msg==e.msg&&t.channel==e.channel)))};return this.$nextTick((()=>this.play(a,!0))),a}return{...t}}))},async play(e,t){console.log("this.$props.getDbcData1041",this.$props.getDbcData),this.loadChart(e)},loadChart(e){console.log("node1727",e,this.timeData);const t={blue:"#2266ff",cerulean:"#00c7f2",cyan:"#00e0b8",green:"#3fd926",lime:"#add900",purple:"#8125ff",pink:"#ff4475",red:"#ff3838",orange:"#ffad4d",yellow:"#f1d900"},a=e.children.filter((e=>!e.hidden)).map(((e,a)=>{const l=this.timeData.find((t=>e.channel===t.channel&&e.text===t.name));return l?{...l,color:t[e.color]}:{name:e.text,enums:e.enums,channel:e.channel,msg:e.msg,color:t[this.colorList[a%9]],t:[],v:[]}}));this.timeData=Object.freeze(a)},tranLinCanId(e){const t=e.match(/\(([^)]+)\)/);if(t){const e=t[1],a=parseInt(e,16);return console.log(a),a}},async updateSignal(e,t){console.log("signals8899",e,this.curView?.value,this.treeData),0==e.length&&(this.timeData=Object.freeze([])),this.showSignalsList=[],e.forEach((e=>{let t={};t.busId=e.channel,t.canId=e.msg,t.name=e.text,t.color=e.color,t.maxRaw=+e.maxRaw,t.minRaw=+e.minRaw,t.comment=e.comment,t.unit=e.unit,t.enums=e.enums,t.id=e.androidId,this.showSignalsList.push(t)}));let a=this.showSignalsList.filter(((e,t)=>this.showSignalsList.findIndex((t=>t.name===e.name))===t)),l=await E.blfLogging.selectShowSignals(a);200!==l.code&&this.showMessage({timeout:2e3,level:"error",content:l.data.msg});const i=this.view;this.treeData=this.treeData.map((a=>{if(a.id==i.id){console.log("signals99",e);let l=e.map(((e,l)=>{let i=a.children.find((t=>e.id==t.id&&e.msg==t.msg&&e.channel==t.channel));return i?{...i,pid:a.id,color:"1"==t||0==e?.colorEditable?e.color:this.colorList[l%9]}:{_id:e._id,pid:a.id,id:e.id,text:e.text,comment:e.comment,remark:e?.remark,msg:e.msg,channel:e.channel,type:"signal",color:"1"==t||0==e?.colorEditable?e.color:this.colorList[l%9],colorEditable:!1,maxRaw:+e.maxRaw,minRaw:+e.minRaw,comment:e.comment,unit:e.unit,enums:e.enums}}));return{...a,children:l}}return a})),this.upTimeData(),this.chooseSignalAble=!1},goBackHome(){this.$router.push({path:"/"})},importFile(){this.modal.visible=!0},addView(e){let t=e.label||"新建视图"+(this.treeData.length+1);if(this.treeData=[...this.treeData,{id:e.id||Date.now(),text:t,type:"view",editable:!1,deleteConfirm:!1,children:e?.children||[],carType:e?.carType||this.carType,sdb:e?.sdb||this.sdb}],"AddOrSelector"===e?.from){let e=this.treeData.length-1;this.curView={label:this.treeData[e].text,value:e}}},onSwitchView({fromNode:e,toNode:t}){this.view.id===e.id?this.curView.value=this.treeData.findIndex((e=>e.id===t.id)):this.view.id===t.id&&(this.curView.value=this.treeData.findIndex((t=>t.id===e.id))),this.treeData=this.treeData.map((a=>a.id===e.id?t:a.id===t.id?e:a))},manageShow(){this.manageModal.manageVisible=!0},onCancelImportFile(){this.modal.visible=!1},async onCancelSelect(e){this.manageModal.manageVisible=!1;const t=this.treeData.findIndex((t=>t.id===e)),a=this.treeData[t];if(console.log("view334",a),this.curView={label:this.treeData[t].text,value:t,tag:a.sdb},this.carType!==a.carType||this.sdb!==a.sdb){let e=[],t=[];if("custom"===a.carType){const l=(this.$ls.get("blfread_sdbData")||[]).find((e=>e.sdb===a.sdb));e=l.files,t=l.comments}this.onCheckView({curId:a.id,carType:a.carType,sdb:a.sdb,directory:this.directory,files:e,comments:t})}else this.$nextTick((()=>{const e=a,t=e.id;void 0===this.waitChart[t]&&this.directory&&this.play(e)})),"mdf"==this.fileType&&this.play(this.treeData[this.curView.value])},onCheckView(e){this.signalLoading=!0,this.resetTimeData(),this.$nextTick((()=>{this.modal.visible=!1;let t=this.treeData.filter((t=>t.id===e.curId)).map((t=>({label:t.text,value:this.treeData.findIndex((t=>t.id===e.curId))})));this.curView=t[0],this.carType=e.carType,console.log("data1725",e),this.sdb=e?.sdb,this.directory=Z(e.directory),this.files=e.files.length?e.files:void 0,this.comments=e.comments.length?e.comments:void 0,this.fileType=e.fileType,void 0!==e.isBigFile&&(this.isBigFile=e.isBigFile),"mdf"===e.fileType?E.mdf.getSignals({mdfPath:e.directory}).then((e=>{this.defaultOptions=Object.freeze(e.data.data)})).then((()=>{this.choosePath()})):this.$nextTick((async()=>{console.log("this.carType7788",this.carType),"custom"===this.carType?"blf"===this.fileType?await E.blf.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):"log"===this.fileType?await E.logReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):await E.ascReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):"blf"===this.fileType?await E.blf.reAdjust(e.sendReAdjust):"log"===this.fileType?("noAdapted"==e.adaptedType&&await E.logReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})),await E.logReader.reAdjust(e.sendReAdjust)):("noAdapted"==e.adaptedType&&await E.ascReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})),await E.ascReader.reAdjust(e.sendReAdjust)),console.log("this.defaultOptions",this.defaultOptions),this.choosePath()}))})),M.report("track","click",{element_name:"查看报文",asset_name:this.directory+";",tip:"1174.10.0.1.27766"})},onExportDotsData(e){const t=e.map((e=>e.join("\t"))).join("\n");te(t,"tspa-打点-"+_()+".txt")},changeState(){this.turnTimeLimit=!this.turnTimeLimit,console.log("this.turnTimeLimit ? this.timeLimit : 1200",this.turnTimeLimit?this.timeLimit:1200)}}},il=e=>(C("data-v-f99e1350"),e=e(),k(),e),sl={class:"o-pul-er"},nl={key:0,class:"o-column"},ol={class:"o-column-left"},dl=il((()=>u("div",{class:"o-resize-bar"},null,-1))),rl=il((()=>u("div",{class:"o-resize-line"},null,-1))),cl={class:"o-resize-save"},hl={class:"o-pul-board"},ml={class:"o-pul-select-wrap"},pl={class:"o-pul-button-wrap"},ul=[il((()=>u("i",{class:"t-icon chooseSignal"},null,-1))),il((()=>u("span",null,"选择信号",-1)))],gl=il((()=>u("span",{style:{color:"#D9D9D9","font-size":"18px",transform:"scaleX(0.5)"}},"|",-1))),bl=[il((()=>u("i",{class:"t-icon manageView"},null,-1))),il((()=>u("span",null,"管理视图",-1)))],fl=["data-empty"],yl=["data-hidden"],vl=["data-open","onClick"],wl=["data-color","onClick"],Cl=["onMouseleave"],kl=["title","data-color","onClick"],Sl={class:"t-node-text"},Tl={key:0,class:"t-node-warning"},Dl={key:1,class:"t-node-error"},Vl=["onClick"],xl=["onClick"],Ll=il((()=>u("div",{class:"drag-icon"},null,-1))),Il={class:"o-column-right"},Fl={class:"rec-body",style:{position:"relative"}},Rl={class:"timechart-er"},$l={class:"tch-tool-er"},Ml={class:"tch-tool-hotkey-er"},El={class:"timechart-hotkey"},_l={class:"hotkey-more"},Nl=il((()=>u("div",{class:"hotkey-icon-book"},null,-1))),Al={class:"hotkey-more-body"},Ol=O('<li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>缩放横轴 <span class="hotkey-btn" data-v-f99e1350>ctrl+滚轮</span></div></li><li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>平移横轴 <span class="hotkey-btn" data-v-f99e1350>shift+滚轮</span></div></li><li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>缩放纵轴 <span class="hotkey-btn" data-v-f99e1350>alt+ctrl+滚轮</span></div></li><li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>平移纵轴 <span class="hotkey-btn" data-v-f99e1350>alt+shift+滚轮</span></div></li><li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>框选放大 <span class="hotkey-btn" data-v-f99e1350>左键拖拽</span></div></li><li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>复位轴 <span class="hotkey-btn" data-v-f99e1350>左键双击</span></div></li><li data-v-f99e1350><div class="timechart-hotkey-it" data-v-f99e1350>选择帧 <span class="hotkey-btn" data-v-f99e1350>左键单击</span></div></li>',7),Pl={class:"timechart-hotkey-it"},Ul={class:"hotkey-btn"},Hl=il((()=>u("li",null,[u("div",{class:"timechart-hotkey-it"},[v("框选时段 "),u("span",{class:"hotkey-btn"},"shift+左键")])],-1))),Bl={class:"tch-tool-blank-er"},jl=il((()=>u("div",{class:"tch-tool-span"},null,-1))),zl=il((()=>u("div",{class:"tch-tool-span"},null,-1))),ql=["id"],Kl={class:"filter-time"},Wl={class:"filter-time-wrap"},Xl=il((()=>u("span",null,"筛选时间： 近 ",-1))),Gl=["disabled"],Yl={class:"rec-body-table"},Jl=[il((()=>u("div",{class:"table-data"},null,-1)))],Ql={key:1,class:"board-spin-er"},Zl={class:"board-spin-progress"},ei={class:"board-spin-text"},ti=s(ll,[["render",function(e,t,a,l,i,s){const n=r("AddOrSelector"),o=r("ChooseSignal"),d=r("Draggable"),C=r("Button"),k=r("v-select"),S=r("ButtonGroup"),D=r("TimePlotMulti"),V=r("Switch"),x=r("ProgressBar"),L=r("ManageViewsGroup"),R=r("Message"),M=c("tooltip");return m(),p(f,null,[u("div",sl,[s.view?(m(),p("div",nl,[u("div",ol,[dl,rl,u("div",cl,[u("div",hl,[u("div",ml,[b(n,{options:s.treeDataDbc,placeholder:"输入视图名称",modelValue:i.curView,"onUpdate:modelValue":t[0]||(t[0]=e=>i.curView=e),onAdd:s.addView},null,8,["options","modelValue","onAdd"])]),u("div",pl,[u("div",{class:"head-btn",onClick:t[1]||(t[1]=F((()=>i.chooseSignalAble=!i.chooseSignalAble),["prevent","stop"]))},ul),gl,u("div",{class:"head-btn",id:"delete_module",onClick:t[2]||(t[2]=e=>s.manageShow())},bl),i.chooseSignalAble?(m(),N(o,{key:0,filledOptions:i.filledOptions,signals:s.view.children,onSignalsChange:s.updateSignal,loading:i.signalLoading,carType:i.carType,fileType:i.fileType,sdb:i.sdb,dbcVal:a.dbcVal,dbcChn:a.dbcChn,ldfChn:a.ldfChn,onCancel:t[3]||(t[3]=()=>i.chooseSignalAble=!1)},null,8,["filledOptions","signals","onSignalsChange","loading","carType","fileType","sdb","dbcVal","dbcChn","ldfChn"])):w("",!0)]),u("div",{class:"o-pul-tree-er","data-empty":0===s.view.children.length},[s.view?(m(),N(d,{key:0,onDrag:t[4]||(t[4]=F((()=>{}),["stop"])),onDragstart:t[5]||(t[5]=F((()=>{}),["stop"])),maxLevel:1,class:"t-list",modelValue:s.view.children,"onUpdate:modelValue":t[6]||(t[6]=e=>s.view.children=e),onAfterDrop:t[7]||(t[7]=e=>s.updateSignal(s.view.children,"1"))},{default:y((({node:e,stat:t})=>[u("div",{class:"t-node","data-type":"signal","data-hidden":e.hidden},[u("i",{class:"t-node-exp","data-open":t.open,onClick:e=>t.open=!t.open},null,8,vl),v(),h((m(),p("i",{class:"t-node-icon","data-color":e.color,onClick:F((t=>e.colorEditable=!0),["stop","prevent"])},[h(u("div",{class:"color-picker",onMouseleave:t=>e.colorEditable=!1},[(m(!0),p(f,null,T(i.colorList,(t=>(m(),p("div",{class:"color-item",title:t,"data-color":t,key:t,onClick:a=>{e.color=t,s.updateSignal(s.view.children,"1")}},null,8,kl)))),128))],40,Cl),[[A,e.colorEditable]])],8,wl)),[[M,"更改颜色"]]),h((m(),p("span",Sl,[u("span",null,g("mdf"!==i.fileType?e.channel>1e3?"":i.C2C[e.channel]+"-":"")+g(e.text),1),!0===e.warning?h((m(),p("div",Tl,null,512)),[[M,"信号无数据"]]):w("",!0),e.hidden||null!==e.warning?w("",!0):h((m(),p("div",Dl,null,512)),[[M,"文件内无此信号"]])])),[[M,{content:s.title4node(e),html:!0},void 0,{right:!0}]]),h(u("div",{class:"t-node-delete",onClick:t=>s.deleteSignal(e)},null,8,Vl),[[M,"删除"]]),h(u("div",{class:"t-node-watch",onClick:t=>{s.hideSignal(e,s.view)}},null,8,xl),[[M,"显示|隐藏"]])],8,yl)])),_:1},8,["modelValue"])):w("",!0)],8,fl)])]),Ll]),u("div",Il,[h(u("div",Fl,[u("div",Rl,[u("div",$l,[u("div",Ml,[u("div",El,[u("div",_l,[Nl,v("快捷键 "),u("div",Al,[u("ul",null,[Ol,u("li",null,[u("div",Pl,[v("打点 "),u("span",Ul,g("mac"===i.system?"option":"alt")+"+左键",1)])]),Hl])])])])]),u("div",Bl,[h((m(),N(C,{class:"tch-tool-btn",onClick:t[8]||(t[8]=e=>i.showDotsFrame=!i.showDotsFrame)},{default:y((()=>[v("打点")])),_:1})),[[M,"alt+左键"]]),jl,h(b(k,{options:i.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:i.timeFilterMode,"onUpdate:modelValue":t[9]||(t[9]=e=>i.timeFilterMode=e),class:"tch-tool-select"},null,8,["options","modelValue"]),[[M,"时间显示"]]),zl,b(S,{options:i.modeOptions,modelValue:i.chartMode,"onUpdate:modelValue":t[10]||(t[10]=e=>i.chartMode=e)},null,8,["options","modelValue"])])]),(m(),p("div",{id:"timechart_"+s.view.id,style:$(`width: 100%; height: calc(100% - 93px);min-height: ${"single"===i.chartMode?40*(i.timeData?.length||0)+1:1}px;`),key:s.view.id},[i.timeData.length>0&&i.timeData.some((e=>e.t))?(m(),N(D,{key:0,"data-cy":"timePlotMulti",fileType:i.fileType,timeData:i.timeData,showEnum:!0,mode:i.chartMode,startTime:i.startTime,timeFilter:i.timeFilterMode.value,showExport:!1,showDotsFrame:i.showDotsFrame,"onUpdate:showDotsFrame":t[11]||(t[11]=e=>i.showDotsFrame=e),monitor:!0},null,8,["fileType","timeData","mode","startTime","timeFilter","showDotsFrame"])):w("",!0)],12,ql)),u("div",Kl,[b(V,{modelValue:i.turnTimeLimit,"onUpdate:modelValue":t[12]||(t[12]=e=>s.changeState()),id:i.turnTimeLimit},null,8,["modelValue","id"]),u("div",Wl,[Xl,h(u("input",{class:"input",type:"number",placeholder:"输入数字",disabled:!i.turnTimeLimit,min:"0",max:"1200","onUpdate:modelValue":t[13]||(t[13]=e=>i.timeLimit=e),onInput:t[14]||(t[14]=(...t)=>e.onChange&&e.onChange(...t))},null,40,Gl),[[I,i.timeLimit,void 0,{lazy:!0}]]),v(" 秒 ")])])])],512),[[A,!i.timechartShow]]),h(u("div",Yl,Jl,512),[[A,!i.tablechartShow]])])])):w("",!0),i.chartDataLoaded?w("",!0):(m(),p("div",Ql,[u("div",Zl,[i.directorySize.durationMaybe?(m(),N(x,{key:0,second:i.directorySize.durationMaybe},null,8,["second"])):w("",!0)]),u("div",ei,"正在解析文件 "+g(s.directoryLabel)+"（"+g(i.directorySize.label)+"），约"+g(i.directorySize.durationMaybeLabel)+"…",1)]))]),i.manageModal.manageVisible?(m(),N(L,{key:0,fileType:i.fileType,propTreeData:i.treeData,curViewInx:i.curView.value,title:i.manageModal.title,onCancel:s.onCancelSelect,onDelete:s.deleteView,onUpdate:s.updateView,onImport:s.onImportView,onAdd:s.addView,onSwitch:s.onSwitchView},null,8,["fileType","propTreeData","curViewInx","title","onCancel","onDelete","onUpdate","onImport","onAdd","onSwitch"])):w("",!0),b(R,{message:i.message},null,8,["message"])],64)}],["__scopeId","data-v-f99e1350"]]);let ai;const li=["data-disable"],ii=["data-active"],si={class:"block-title"},ni={class:"line-title"},oi=["data-active"],di=s({name:"ScrollBar",props:["modelValue","start","end","disable","timeFilter","startTime"],emits:["update:modelValue","change"],data:()=>({lineTop:0,scrollTop:0,lineTitle:"",scrollTitle:"",lineVisible:!1,dragging:!1,dragHover:!1}),methods:{enterHandler(){this.dragging||(this.lineVisible=!0)},leaveHandler(){this.lineVisible=!1},moveHandler(e){this.lineVisible&&(e.offsetY<0||e.offsetY>=this.$refs.root.clientHeight-28||(this.lineTop=e.offsetY,this.lineTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*e.offsetY/(this.$refs.root.clientHeight-28))))},clickHandler(e){this.scrollTop=e.offsetY;const t=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",t),this.$emit("change",t)},tooltipFormatter:e=>parseInt(e)/1e3,timeStrFilter(e){return"absolute"===this.$props.timeFilter?new Date(1e3*e+(this.$props.startTime||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"}):e},blockDownHandler(){this.dragging=!0,ai=void 0},blockUphandler(){if(this.dragging){this.dragging=!1;const e=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",e),this.$emit("change",e)}},blockLeaveHandler(){this.enterHandler(),this.dragHover=!1},blockEnterHandler(){this.leaveHandler(),this.dragHover=!0},blockMoveHandler(e){if(this.dragging){let t=0;null!=ai&&(t=e.pageY-ai),ai=e.pageY,console.log("move",e.pageY);let a=this.scrollTop+t;const l=this.$refs.root.clientHeight;if(a<0){if(0===this.scrollTop)return;a=0}else if(a>l-28){if(this.scrollTop===l-28)return;a=l-28}this.scrollTop=a,this.scrollTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28))}}},watch:{modelValue(e){if(this.dragging)return;let t=(e-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(t*(this.$refs.root.clientHeight-28)),this.scrollTitle=this.tooltipFormatter(e),this.dragging=!1,this.dragHover=!1},end(e){if(this.dragging)return;let t=(this.$props.modelValue-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(t*(this.$refs.root.clientHeight-28))}},mounted(){window.addEventListener("mouseup",this.blockUphandler),window.addEventListener("mousemove",this.blockMoveHandler)},unmounted(){window.removeEventListener("mouseup",this.blockUphandler),window.removeEventListener("mousemove",this.blockMoveHandler)}},[["render",function(e,t,a,l,i,s){return m(),p("div",{class:"bar-er","data-disable":e.$props.disable,ref:"root",onClick:t[5]||(t[5]=F(((...e)=>s.clickHandler&&s.clickHandler(...e)),["prevent","stop"])),onMousemove:t[6]||(t[6]=(...e)=>s.moveHandler&&s.moveHandler(...e)),onMouseenter:t[7]||(t[7]=(...e)=>s.enterHandler&&s.enterHandler(...e)),onMouseleave:t[8]||(t[8]=(...e)=>s.leaveHandler&&s.leaveHandler(...e))},[u("div",{class:"bar-block","data-active":i.dragging,onClick:t[0]||(t[0]=F((()=>{}),["prevent","stop"])),onMousedown:t[1]||(t[1]=(...e)=>s.blockDownHandler&&s.blockDownHandler(...e)),onMouseup:t[2]||(t[2]=(...e)=>s.blockUphandler&&s.blockUphandler(...e)),onMouseleave:t[3]||(t[3]=(...e)=>s.blockLeaveHandler&&s.blockLeaveHandler(...e)),onMouseenter:t[4]||(t[4]=(...e)=>s.blockEnterHandler&&s.blockEnterHandler(...e)),style:$({transform:"translateY("+i.scrollTop+"px)"})},[u("div",si,g(s.timeStrFilter(i.scrollTitle)),1)],44,ii),h(u("div",{class:"bar-line",style:$({transform:"translateY("+i.lineTop+"px)"})},[u("div",ni,g(s.timeStrFilter(i.lineTitle)),1)],4),[[A,i.lineVisible]]),u("div",{class:"scroll-title","data-active":i.dragging},g(s.timeStrFilter(i.scrollTitle)),9,oi)],40,li)}],["__scopeId","data-v-af35b704"]]),ri={props:["col","asyncData"],emits:["change"],data:()=>({options:[],loading:!1,current:[]}),methods:{async onMouseEnter(){this.loading=!0,this.options=[];try{this.options=await this.$props.asyncData(this.$props.col)}catch(e){}this.loading=!1},onModelValueChange(e){this.current=e,this.$emit("change",e)}},watch:{col:{handler(e){this.current=e.value},deep:!0}}},ci=["data-active"],hi=(e=>(C("data-v-7504714d"),e=e(),k(),e))((()=>u("div",null,null,-1)));let mi=0,pi=0;const ui={props:["rowData","columnsDef","columnsFilter","from","filters"],emits:["toggleExpand","scrollRow","scrollAction","filterItem","colFilterChange","updatePadding","timeModeChange"],components:{RecycleScroller:D,FilterItem:s(ri,[["render",function(e,t,a,l,i,s){const n=r("v-select");return m(),p("div",{class:"select-icon","data-active":i.current?.length>0,onMouseenter:t[0]||(t[0]=(...e)=>s.onMouseEnter&&s.onMouseEnter(...e))},[u("div",{class:"flt-er",style:$({width:e.$props.col.width+40+"px"})},[b(n,{loading:i.loading,options:i.options,dropdownShouldOpen:()=>!0,searchable:!0,modelValue:i.current,"onUpdate:modelValue":s.onModelValueChange,multiple:""},{"no-options":y((()=>[hi])),_:1},8,["loading","options","modelValue","onUpdate:modelValue"])],4)],40,ci)}],["__scopeId","data-v-7504714d"]])},created(){this.$_scrollTimer=0},data:()=>({isChildTit:!1,searchVal:"",isOpenSearch:!1,selectFilterList:[],showSelect:!1,curId:-1,filterChnItem:"",filterValItem:"",formData:{},filterList:{channel:"",canId:"",name:"",canType:"",dir:"",dlc:""},left:0,timeFilterOptions:[{label:"绝对时间",value:"absolute"},{label:"相对时间",value:"relative"},{label:"时间差",value:"diff"}],timeFilterMode:{label:"绝对时间",value:"absolute"},selectionActive:!1}),computed:{fullWidth(){return"calc("+this.$props.columnsDef.map((e=>"number"==typeof e.width?e.width+"px":e.width)).join(" + ")+")"}},watch:{rowData:{},timeFilterMode(e){this.onTimeModelChange(e.value)}},methods:{onScrollX(e){this.left=-e.target.scrollLeft+"px"},onTableClick(e){if(e.target?.className?.includes?.("table-td")){this.selectionActive=!0;let t=window.getSelection();t.removeAllRanges();let a=document.createRange();a.selectNodeContents(e.target),t.addRange(a),t=a=null}},filterHex:e=>void 0===e?"":(e>=0?ne(e):e).toString().replace(/^(00)+/g,"")||"00",update(e,t,a,l){mi=a,pi=this.$props.rowData.length-l,this.$emit("updatePadding",{visibleStartIndex:a,visibleEndIndex:l})},searchInfo(){this.isOpenSearch=!1},onOpenSearch(){this.isOpenSearch=!0},scrollToBottom(){this.$refs.scroller?.scrollToItem(this.$props.rowData.length-1)},scrollToItem(e){this.$refs.scroller?.scrollToItem(e)},nativeScroll(){const e=this.$refs.scroller.$el;e.addEventListener("scroll",(e=>{if(clearTimeout(this.$_scrollTimer),this.selectionActive){this.selectionActive=!1;let e=window.getSelection();e.removeAllRanges(),e=null}})),e.addEventListener("wheel",(e=>{this.$emit("scrollAction",{topPadding:mi,bottomPadding:pi}),e.deltaY>0||e.deltaX>0?pi<=40&&this.$emit("scrollRow","down"):(e.deltaY<0||e.deltaX<0)&&mi<=40&&this.$emit("scrollRow","up")}))},filterItem(e,t){this.filterChnItem=e,this.curId=t,this.$emit("filterItem"),this.selectFilterList=[],E.blfLogging.getFiltItems({selectItem:e,channel:"",canId:"",name:"",canType:"",dir:"",dlc:""}).then((e=>{let t=e.data.data;t.length>0&&t.forEach((e=>{e&&this.selectFilterList.push({value:e,label:e,selected:!1})}))}))},onChooseFilterItem(e,t){e.selected=!0,this.$emit("reDrawTable",e,t,this.selectFilterList)},onTimeModelChange(e){this.$emit("timeModeChange",e)}},mounted(){this.nativeScroll()}},gi=e=>(C("data-v-42657959"),e=e(),k(),e),bi={style:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"inherit","flex-direction":"inherit","align-items":"inherit"}},fi={key:1,class:"o-pul-time-option-warp"},yi=gi((()=>u("div",{class:"table-header",style:{height:"32px","line-height":"32px"}},null,-1))),vi=["data-even"],wi=["onMousedown"],Ci=["onMousedown"],ki=[gi((()=>u("span",{class:"container-tit",style:{width:"205px"}},"信号名",-1))),gi((()=>u("span",{class:"container-tit",style:{width:"200px"}},"信号物理值",-1))),gi((()=>u("span",{class:"container-tit",style:{width:"80px"}},"HEX",-1))),gi((()=>u("span",{class:"container-tit",style:{width:"calc(100vw - 487px)"}},"信号描述",-1)))],Si={class:"table-parent-tr o-table-expand-child"},Ti={class:"table-td",style:{width:"205px"}},Di={class:"table-td",style:{width:"200px"}},Vi={class:"table-td",style:{width:"80px"}},xi={class:"table-td",style:{width:"calc(100vw - 487px)"}},Li=s(ui,[["render",function(e,t,a,l,i,s){const n=r("FilterItem"),o=r("v-select"),d=r("RecycleScroller");return m(),p("div",{class:"table",onClick:t[2]||(t[2]=(...e)=>s.onTableClick&&s.onTableClick(...e)),style:{"font-size":"10px"}},[u("div",{class:"table-header",style:$({height:"32px",lineHeight:"32px",transform:"translateX("+i.left+")",width:s.fullWidth,position:"absolute",zIndex:1})},[u("div",bi,[(m(!0),p(f,null,T(e.$props.columnsDef,((a,l)=>(m(),p("div",{class:"header-tit",key:l,style:$({width:a.width>0?a.width+"px":a.width})},[u("span",null,g(a.titName),1),a.filterShow?(m(),N(n,{key:0,onChange:t=>e.$emit("colFilterChange",{keyName:a.keyName,value:t}),col:a,asyncData:e.$props.columnsFilter},null,8,["onChange","col","asyncData"])):w("",!0),"timestamp"==a.keyName||"diff"==a.keyName||"deltaTime"==a.keyName?(m(),p("div",fi,[b(o,{options:i.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:i.timeFilterMode,"onUpdate:modelValue":t[0]||(t[0]=e=>i.timeFilterMode=e),class:"canoe-frame-vselect"},null,8,["options","modelValue"])])):w("",!0)],4)))),128))])],4),yi,b(d,{items:e.$props.rowData,"item-size":24,"key-field":"id",emitUpdate:!0,onUpdate:s.update,ref:"scroller",class:"frame-class"},{default:y((({item:t,index:a})=>[t.isParent?(m(),p("div",{key:0,class:R("0"!=t.canId?"table-parent-tr":"table-parent-tr-error"),"data-even":a%2==0,style:$({transform:"translateX("+i.left+")",width:s.fullWidth})},[(m(!0),p(f,null,T(e.$props.columnsDef,(l=>(m(),p("div",{class:"table-td",style:$({width:"number"==typeof l.width?l.width+"px":l.width}),key:l.keyName},[l.custom?(m(),p(f,{key:0},[t.isExpand&&t.isParent&&t.name?(m(),p("i",{key:0,class:"collapse-icon",onMousedown:F((t=>e.$emit("toggleExpand",a)),["stop","prevent"])},null,40,wi)):w("",!0),!1===t.isExpand&&t.isParent&&t.name?(m(),p("i",{key:1,class:"expand-icon",onMousedown:F((t=>e.$emit("toggleExpand",a)),["stop","prevent"])},null,40,Ci)):w("",!0)],64)):(m(),p(f,{key:1},[v(g(l.displayMap?l.displayMap(t[l.keyName]):t[l.keyName]),1)],64))],4)))),128))],14,vi)):(m(),p(f,{key:1},[t.isChildTit?(m(),p("div",{key:0,class:"table-header o-table-expand-child",style:$({transform:"translateX("+i.left+")",width:s.fullWidth})},ki,4)):(m(),p("div",{key:1,class:"table-parent",style:$({transform:"translateX("+i.left+")",width:s.fullWidth})},[u("div",Si,[u("span",Ti,g(t.name),1),u("span",Di,g(t.value),1),u("span",Vi,g(s.filterHex(t.hex)),1),u("span",xi,g(t.comment),1)])],4))],64))])),_:1},8,["items","onUpdate"]),u("div",{class:"table-scroll-x",onScroll:t[1]||(t[1]=(...e)=>s.onScrollX&&s.onScrollX(...e))},[u("div",{class:"table-scroll-x-bar",style:$({width:s.fullWidth})},null,4)],32)])}],["__scopeId","data-v-42657959"]]),Ii=s({beforeMount(){console.log("this.params",this.params)},methods:{onExpand(){console.log("this.params.data",this.params.data),!1===this.params.data.isExpand?(this.params.node.setDataValue("isExpand",!0),this.params.api.applyTransactionAsync({add:[JSON.parse(this.params.data.parsedData)],addIndex:this.params.rowIndex+1})):(this.params.node.setDataValue("isExpand",!1),this.params.api.applyTransactionAsync({remove:this.params.api.getRowNode(this.params.rowIndex+1)})),this.params.api.redrawRows()}}},[["render",function(e,t,a,l,i,s){return m(),p("div",null,[e.params.data.isExpand?(m(),p("i",{key:0,class:"expand-icon",onClick:t[0]||(t[0]=(...e)=>s.onExpand&&s.onExpand(...e))})):(m(),p("i",{key:1,class:"collapse-icon",onClick:t[1]||(t[1]=(...e)=>s.onExpand&&s.onExpand(...e))})),u("span",null,g(e.params.value),1)])}]]),Fi={methods:{onClick(){}}},Ri=[O('<table><thead class="o-table-thead"><tr><th class="o-table-cell">信号</th><th class="o-table-cell o-cell-ar">信号物理值</th><th class="o-table-cell o-cell-ar">信号描述</th></tr></thead><tbody class="o-table-tbody"></tbody></table>',1)];let $i,Mi=0,Ei=0,_i=0,Ni=0;const Ai={props:["store","closeFlag","recentTest","connectStatus","colFilterShow","channelOne","channelTwo","channelThree","linChannelVal","linChannelValTwo","filePath","dbcVal","startTime","sn","dbcChn","ldfChn","channelValList","linChannelValList"],emits:["updateBock","updateTimeData","recordTimeChange","startTimeChange","chartTableFun"],components:{Button:l,Message:i,ScrollBar:di,ExpandInfo:Ii,FullWidthCellRenderer:s(Fi,[["render",function(e,t,a,l,i,s){return m(),p("div",{onClick:t[0]||(t[0]=(...e)=>s.onClick&&s.onClick(...e))},Ri)}]]),TableRecycleScroller:Li,CopyPath:ae,ButtonGroup:se},data(){return{isFullScreen:!1,expandKeys:new Set,visibleStartIndex:0,visibleEndIndex:0,bottomPadding:0,recordLoading:!1,mode:"all",sliderValue:-1,comments:["","","","","","","","","","","","","","","",""],message:{visible:!1,level:"",content:""},seconds:0,timeFilterModeVal:"absolute",rowData:[],isRecording:!1,startSqlId:0,endSqlId:0,isLock:!1,isScrollEnd:!0,isAddData:!0,secondConfirm:!1,topLock:!1,bottomLock:!1,openFlag:!1,mlist:[{key:"lookRecord",name:"帧查看",icon:"box"},{key:"supeRecord",name:"图像查看",icon:"setting"}],cur:"lookRecord",recordShow:!0,colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],columnsDef:[{titName:"",width:30,keyName:"id",type:"number",value:[],filterShow:!1,custom:!0},{titName:"",width:110,keyName:"diff"===this.timeFilterModeVal?"single"===this.mode?"deltaTime":"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let t=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return t.toFixed(6);case"absolute":return new Date(1e3*t).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"});case"relative":return(e-this.startTime).toFixed(6);default:return e}}},{titName:"Chn",width:40,keyName:"channel",type:"number",value:[],filterShow:!0},{titName:"ID",width:40,keyName:"canId",type:"number",value:[],filterShow:!0,displayMap:e=>"0x"+e.toString(16)},{titName:"NAME",width:110,keyName:"name",type:"string",value:[],filterShow:!0},{titName:"Event",width:50,keyName:"canType",type:"string",value:[],filterShow:!0},{titName:"Dir",width:40,keyName:"dir",type:"string",value:[],filterShow:!0},{titName:"Dlc",width:40,keyName:"dlc",type:"number",value:[],filterShow:!0},{titName:"DATA",width:1380,keyName:"data",type:"string",value:[],filterShow:!1,displayMap:e=>e.map((e=>e.toString(16).padStart(2,"0"))).join(" ")}]}},watch:{mode(e,t){this.topPadding=0,this.$refs.table.scrollToItem(0),this.expandKeys.clear(),this.rowData=[],this.isRecording&&this.resumeScroll()},filePath(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},dbcVal(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},recordLoading(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},isRecording(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},colComputed(){this.columnsDef[1]={titName:"",width:110,keyName:"diff"===this.timeFilterModeVal?"single"===this.mode?"deltaTime":"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let t=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return t.toFixed(6);case"absolute":return new Date(1e3*t).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23",timeZone:"Asia/Shanghai"})+"."+t.toFixed(6).split(".")[1];case"relative":return(e-this.startTime).toFixed(6);default:return e}}}}},computed:{colComputed(){return this.timeFilterModeVal+this.startTime+this.mode},recordTime(){return console.log("recordTime223",ie(parseInt((1e3*this.seconds).toString().split(".")[0]))),ie(parseInt((1e3*this.seconds).toString().split(".")[0]))},showData(){let e={mode:"all"};return this.columnsDef.forEach((t=>{t.filterShow&&(e[t.keyName]=(t.value||[]).map((e=>e.value)))})),e},diffRowData(){return this.rowData.map(((e,t,a)=>({...e,diff:0===t?0:a[t].timestamp-a[t-1].timestamp})))}},methods:{choose(e){this.cur=e,this.recordShow="supeRecord"!=e},async colFilter(e){const t="name"===e.keyName?null:"";let a,l={selectItem:e.keyName,...this.showData,[e.keyName]:t};try{a=await await E.blfLogging.getFiltItems(l)}catch(i){}return(a?.data?.data||[]).map((t=>({value:t,label:"canId"===e.keyName?"0x"+t.toString(16):""===t?" 空":t}))).sort(((t,a)=>("number"===e.type?+t.value>+a.value:t.value>a.value)?1:-1))},startRecord(e){clearInterval(Ni),this.checkHardware(e),this.isLock=!1,this.columnsDef=this.columnsDef.map((e=>({...e,value:[]})))},async endRecord(){this.recordLoading=!0,clearTimeout(_i),clearInterval(Ni),E.blfLogging.stopLogging(),await P(2e3),this.isRecording=!1,this.recordLoading=!1},async checkHardware(e){this.recordLoading=!1,this.secondConfirm=!1,console.log("调检查并连接硬件设备接口"),clearInterval(Ni),this.isRecording=!0,this.startLogging(e),this.resumeScroll()},async startLogging(e){console.log("55666",e),this.seconds=0,this.rowData=[],this.$emit("startTimeChange",Date.now()/1e3),Ni=setInterval((()=>{this.seconds=Date.now()/1e3-this.startTime}),1e3),this.$emit("recordTimeChange",this.recordTime);let t=["","","","","","","","","","","","","","","",""];this.channelValList.forEach(((e,a)=>{t[a]=e.split("-").pop()})),console.log("this.dbcChn07101822",this.dbcChn,t);let a=this.filePath.replace(".blf","-"+_()+".blf"),l=await E.blfLogging.startLogging({path:a,type:"blf",typelin:"asc",channel:3,sdb:"自定义模板"===this.dbcVal?"":this.dbcVal.split("/")[1],carType:"自定义模板"===this.dbcVal?"custom":this.dbcVal.split("/")[0],dbcChn:this.dbcChn,ldfChn:this.ldfChn,files:"自定义模板"===this.dbcVal?t:["","","","","","","","","","","","","","","",""],comments:this.comments,mode:e});console.log("startLoggin",l)},showMessage({level:e,content:t,timeout:a}){clearTimeout(Mi),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Mi=setTimeout((()=>{this.message.visible=!1}),a))},showLoggingMessage(){clearTimeout(_i),$i=async()=>{let e;this.showData.mode=this.mode;try{e=await E.blfLogging.showLoggingMessage({...this.showData}),console.log("showLogginMsg",e)}catch(a){console.log("error",a)}if(this.$emit("chartTableFun",e.data.signal_data),console.log(e.data.signal_data,e.data,0x1ed6eb565788e400),!e)return;let t=e?.data?.frame_data||[];if(!this.isLock&&t?.length>0)if("all"===this.mode){let e=t[0].sqlId,a=t[t.length-1].sqlId;t.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=""+e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),this.startSqlId=e,this.endSqlId=a,Ei=t[t.length-1].timestamp,this.rowData=t,this.$refs.table.scrollToBottom(),this.isAddData&&(this.sliderValue=e/a*(Ei-this.startTime)*1e3)}else"single"===this.mode&&(t.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=""+e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),t=t.sort(((e,t)=>e.channel===t.channel?e.canId-t.canId:e.channel-t.channel)),await this.drawExpandRows(t));this.$emit("updateTimeData",e.data.signal_data),this.isRecording?_i=setTimeout((()=>{requestAnimationFrame($i)}),200):clearTimeout(_i),this.$emit("recordTimeChange",this.recordTime)},$i()},async drawExpandRows(e){const t="-",a={};this.rowData.slice().sort(((e,a)=>{const l=e.id,i=a.id;return!~l.indexOf(t)&&~i.indexOf(t)?-1:~l.indexOf(t)&&!~i.indexOf(t)?1:~l.indexOf(t)||~i.indexOf(t)?l>i?1:l<i?-1:0:e.channel<a.channel?-1:e.channel>a.channel?1:e.canId-a.canId})),e.forEach((e=>{const l=e.channel+"-"+e.canId;if(~e.id.indexOf(t))a[l].children.push(e);else{const t=a[l]?.children||[];a[l]=e,a[l].children=this.expandKeys.has(l)?t:[]}}));let l=this.rowData.slice();for(let s=this.visibleEndIndex;s>=this.visibleStartIndex;s--){if(!l?.[s])continue;let e=null,t=0;if(l[s].isParent)e=l[s],t=s;else if(s===this.visibleStartIndex)for(let a=s;a>=0;a--)if(l[a].isParent){e=l[a],t=a;break}if(e){const i=e.channel+"-"+e.canId;if(this.expandKeys.has(i)){const e=await this.onToggleExpand(t,l,!0);e?.length&&(a[i].children=e)}}}const i=[];for(let s in a){const e=a[s],t=e.children;delete e.children,t.length&&(e.isExpand=!0),i.push(e),t.forEach((e=>{i.push(e)}))}this.rowData=i},getSelectData(e){let t="",a="",l="";switch(e){case"up":l=this.startSqlId;break;case"down":a=this.endSqlId;break;case"pick":clearTimeout(_i),t=this.sliderValue/1e3+this.startTime}E.blfLogging.selectData({moreThanTimeStamp:t,lessThanTimeStamp:"",moreThanSqlID:a,lessThanSqlID:l,...this.showData,sqlId:"",numbers:100}).then((t=>{if(t?.data?.data?.length>0){let a=t.data.data;switch(a.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),e){case"up":this.rowData=a.concat(...this.rowData),this.$refs.table.scrollToItem(t.data.data.length-1),this.sliderValue=1e3*(t.data.data[0].timestamp-this.startTime),t.data.startSqlId&&(this.startSqlId=t.data.startSqlId);break;case"down":this.rowData=this.rowData.concat(...a),t.data.endSqlId&&(this.endSqlId=t.data.endSqlId);break;case"pick":this.startSqlId=t.data.startSqlId,this.endSqlId=t.data.endSqlId,this.rowData=a,this.sliderValue=1e3*(t.data.data[0].timestamp-this.startTime)}}})).finally((()=>{this.topLock=!1,this.bottomLock=!1}))},onUpdatePadding(e){this.visibleStartIndex=e.visibleStartIndex,this.visibleEndIndex=e.visibleEndIndex},onTimeModeChange(e){this.timeFilterModeVal=e},onScrollAction(e){this.isLock||("all"===this.mode?this.isLock=!0:this.isLock=!1,this.isScrollEnd=!1)},onBodyScrollEnd(e){"single"!==this.mode&&("up"===e&&!1===this.topLock&&(this.topLock=!0,this.getSelectData(e)),"down"===e&&!1===this.bottomLock&&(this.bottomLock=!0,this.getSelectData(e)))},onClicked(){this.isLock=!1,this.isScrollEnd=!1},resumeScroll(){this.isScrollEnd=!0,this.isAddData=!0,this.isLock=!1,this.showLoggingMessage()},async onToggleExpand(e,t,a){const l=t.map((e=>({...e}))),i=l[e],s=i.channel+"-"+i.canId;if(a||!i.isExpand){this.expandKeys.add(s);const t=await E.blfLogging.parsedSignal({channel:i.channel,canId:""+i.canId,canData:(i.data||[]).map((e=>e.toString(16)))});let n=t?.data.sort(((e,t)=>e.name<t.name?-1:1))||[],o=i.sqlId;if(n.forEach(((e,t)=>{e.channel=i.channel,e.canId=""+i.canId,e.isParent=!1,e.isExpand=!0,e.isChildTit=!1,e.id=o+"-"+e.name})),n.unshift({channel:i.channel,canId:""+i.canId,isParent:!1,isExpand:!0,isChildTit:!0,id:o+"-"}),l.splice(e+1,0,...n),i.isExpand=n.length,a)return n;this.rowData=l}else this.expandKeys.delete(s),l.splice(e+1,l[e].isExpand),l[e].isExpand=!1,this.rowData=l},onSliderChange(e){this.isScrollEnd=!1,this.isAddData=!1,"all"===this.mode?this.isLock=!0:this.isLock=!1,this.getSelectData("pick")},onFilterItem(){this.openFlag=!this.openFlag},onColFilterChange(e){let t=this.columnsDef.find((t=>e.keyName===t.keyName));t&&(t.value=e.value),this.resumeScroll()}},mounted(){},unmounted(){$i=null,clearTimeout(_i),clearInterval(Ni)}},Oi=e=>(C("data-v-cd6b598b"),e=e(),k(),e),Pi={class:"o-pul-er"},Ui={key:0},Hi=Oi((()=>u("div",{class:"o-pul-title"},"报文录制配置",-1))),Bi={class:"o-pul-p-wrap",style:{display:"flex","flex-wrap":"wrap"}},ji={class:"o-pul-p"},zi={class:"record-header-message"},qi=Oi((()=>u("b",null,"车型/DBC：",-1))),Ki={class:"record-header-message",style:{width:"20vw"}},Wi=Oi((()=>u("div",{class:"o-pul-hr"},null,-1))),Xi={class:"o-table-wrap"},Gi=s(Ai,[["render",function(e,t,a,l,i,s){const n=r("ScrollBar"),o=r("TableRecycleScroller"),d=r("Message"),y=c("tooltip");return m(),p(f,null,[u("div",Pi,[i.recordShow?(m(),p("div",Ui,[Hi,u("div",Bi,[u("div",ji,[u("span",zi,[qi,v(g(a.dbcVal),1)]),(m(!0),p(f,null,T(a.channelValList,((e,t)=>(m(),p("div",{class:"o-pul-p",key:t},[h((m(),p("span",Ki,[u("b",null,"CAN通道"+g(t+1)+"：",1),v(g(e),1)])),[[y,e]])])))),128))])]),Wi,u("div",Xi,[b(n,{modelValue:i.sliderValue,"onUpdate:modelValue":t[0]||(t[0]=e=>i.sliderValue=e),disable:"all"!==i.mode,startTime:1e3*a.startTime,start:0,end:1e3*i.seconds,onChange:s.onSliderChange,timeFilter:"relative"!=i.timeFilterModeVal?"absolute":"relative"},null,8,["modelValue","disable","startTime","end","onChange","timeFilter"]),b(o,{rowData:s.diffRowData,filters:s.showData,columnsDef:i.columnsDef,onToggleExpand:t[1]||(t[1]=e=>s.onToggleExpand(e,i.rowData)),onScrollRow:s.onBodyScrollEnd,onScrollAction:s.onScrollAction,onFilterItem:s.onFilterItem,onClick:s.onClicked,columnsFilter:s.colFilter,openFlag:i.openFlag,onColFilterChange:s.onColFilterChange,ref:"table",onUpdatePadding:s.onUpdatePadding,onTimeModeChange:s.onTimeModeChange,style:{height:"100%"}},null,8,["rowData","filters","columnsDef","onScrollRow","onScrollAction","onFilterItem","onClick","columnsFilter","openFlag","onColFilterChange","onUpdatePadding","onTimeModeChange"]),h(u("div",{class:"scrollToBottomBtn",onClick:t[2]||(t[2]=F((e=>s.resumeScroll()),["stop"]))},null,512),[[A,i.isLock&&"all"===i.mode],[y,"恢复向下滚动",void 0,{left:!0}]])])])):w("",!0)]),b(d,{message:i.message},null,8,["message"])],64)}],["__scopeId","data-v-cd6b598b"]]);let Yi;const Ji=["data-disable"],Qi=["data-active"],Zi={class:"block-title"},es={class:"line-title"},ts=["data-active"],as=s({name:"ScrollBar",props:["modelValue","start","end","disable","timeFilter","startTime"],emits:["update:modelValue","change"],data:()=>({lineTop:0,scrollTop:0,lineTitle:"",scrollTitle:"",lineVisible:!1,dragging:!1,dragHover:!1}),methods:{enterHandler(){this.dragging||(this.lineVisible=!0)},leaveHandler(){this.lineVisible=!1},moveHandler(e){this.lineVisible&&(e.offsetY<0||e.offsetY>=this.$refs.root.clientHeight-28||(this.lineTop=e.offsetY,this.lineTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*e.offsetY/(this.$refs.root.clientHeight-28))))},clickHandler(e){this.scrollTop=e.offsetY;const t=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",t),this.$emit("change",t)},tooltipFormatter:e=>parseInt(e)/1e3,timeStrFilter(e){return"absolute"===this.$props.timeFilter?new Date(1e3*e+(this.$props.startTime||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"}):e},blockDownHandler(){this.dragging=!0,Yi=void 0},blockUphandler(){if(this.dragging){this.dragging=!1;const e=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",e),this.$emit("change",e)}},blockLeaveHandler(){this.enterHandler(),this.dragHover=!1},blockEnterHandler(){this.leaveHandler(),this.dragHover=!0},blockMoveHandler(e){if(this.dragging){let t=0;null!=Yi&&(t=e.pageY-Yi),Yi=e.pageY,console.log("move",e.pageY);let a=this.scrollTop+t;const l=this.$refs.root.clientHeight;if(a<0){if(0===this.scrollTop)return;a=0}else if(a>l-28){if(this.scrollTop===l-28)return;a=l-28}this.scrollTop=a,this.scrollTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28))}}},watch:{modelValue(e){if(this.dragging)return;let t=(e-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(t*(this.$refs.root.clientHeight-28)),this.scrollTitle=this.tooltipFormatter(e),this.dragging=!1,this.dragHover=!1},end(e){if(this.dragging)return;let t=(this.$props.modelValue-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(t*(this.$refs.root.clientHeight-28))}},mounted(){window.addEventListener("mouseup",this.blockUphandler),window.addEventListener("mousemove",this.blockMoveHandler)},unmounted(){window.removeEventListener("mouseup",this.blockUphandler),window.removeEventListener("mousemove",this.blockMoveHandler)}},[["render",function(e,t,a,l,i,s){return m(),p("div",{class:"bar-er","data-disable":e.$props.disable,ref:"root",onClick:t[5]||(t[5]=F(((...e)=>s.clickHandler&&s.clickHandler(...e)),["prevent","stop"])),onMousemove:t[6]||(t[6]=(...e)=>s.moveHandler&&s.moveHandler(...e)),onMouseenter:t[7]||(t[7]=(...e)=>s.enterHandler&&s.enterHandler(...e)),onMouseleave:t[8]||(t[8]=(...e)=>s.leaveHandler&&s.leaveHandler(...e))},[u("div",{class:"bar-block","data-active":i.dragging,onClick:t[0]||(t[0]=F((()=>{}),["prevent","stop"])),onMousedown:t[1]||(t[1]=(...e)=>s.blockDownHandler&&s.blockDownHandler(...e)),onMouseup:t[2]||(t[2]=(...e)=>s.blockUphandler&&s.blockUphandler(...e)),onMouseleave:t[3]||(t[3]=(...e)=>s.blockLeaveHandler&&s.blockLeaveHandler(...e)),onMouseenter:t[4]||(t[4]=(...e)=>s.blockEnterHandler&&s.blockEnterHandler(...e)),style:$({transform:"translateY("+i.scrollTop+"px)"})},[u("div",Zi,g(s.timeStrFilter(i.scrollTitle)),1)],44,Qi),h(u("div",{class:"bar-line",style:$({transform:"translateY("+i.lineTop+"px)"})},[u("div",es,g(s.timeStrFilter(i.lineTitle)),1)],4),[[A,i.lineVisible]]),u("div",{class:"scroll-title","data-active":i.dragging},g(s.timeStrFilter(i.scrollTitle)),9,ts)],40,Ji)}],["__scopeId","data-v-1c63ae6b"]]),ls={props:["col","asyncData"],emits:["change"],data:()=>({options:[],loading:!1,current:[]}),methods:{async onMouseEnter(){this.loading=!0,this.options=[];try{this.options=await this.$props.asyncData(this.$props.col)}catch(e){}this.loading=!1},onModelValueChange(e){this.current=e,this.$emit("change",e)}},watch:{col:{handler(e){this.current=e.value},deep:!0}}},is=["data-active"],ss=(e=>(C("data-v-0c66c0da"),e=e(),k(),e))((()=>u("div",null,null,-1)));let ns=0,os=0;const ds={props:["rowData","columnsDef","columnsFilter","from","filters"],emits:["toggleExpand","scrollRow","scrollAction","filterItem","colFilterChange","updatePadding","timeModeChange"],components:{RecycleScroller:D,FilterItem:s(ls,[["render",function(e,t,a,l,i,s){const n=r("v-select");return m(),p("div",{class:"select-icon","data-active":i.current?.length>0,onMouseenter:t[0]||(t[0]=(...e)=>s.onMouseEnter&&s.onMouseEnter(...e))},[u("div",{class:"flt-er",style:$({width:e.$props.col.width+40+"px"})},[b(n,{loading:i.loading,options:i.options,dropdownShouldOpen:()=>!0,searchable:!0,modelValue:i.current,"onUpdate:modelValue":s.onModelValueChange,multiple:""},{"no-options":y((()=>[ss])),_:1},8,["loading","options","modelValue","onUpdate:modelValue"])],4)],40,is)}],["__scopeId","data-v-0c66c0da"]])},created(){this.$_scrollTimer=0},data:()=>({isChildTit:!1,searchVal:"",isOpenSearch:!1,selectFilterList:[],showSelect:!1,curId:-1,filterChnItem:"",filterValItem:"",formData:{},filterList:{channel:"",canId:"",name:"",canType:"",dir:"",dlc:""},left:0,timeFilterOptions:[{label:"Time 绝对时间",value:"absolute"},{label:"Time 相对时间",value:"relative"},{label:"ΔTime 时间差",value:"diff"}],timeFilterMode:{label:"Time 绝对时间",value:"absolute"},selectionActive:!1}),computed:{fullWidth(){return"calc("+this.$props.columnsDef.map((e=>"number"==typeof e.width?e.width+"px":e.width)).join(" + ")+")"}},watch:{rowData:{handler(){if(this.selectionActive){this.selectionActive=!1;let e=window.getSelection();e.removeAllRanges(),e=null}setTimeout((()=>{console.log("updateVisibleItems"),this.$refs.scroller.updateVisibleItems(!0)}),0)},deep:!0},timeFilterMode(e){this.onTimeModelChange(e.value)}},methods:{onScrollX(e){this.left=-e.target.scrollLeft+"px"},onTableClick(e){if(e.target?.className?.includes?.("table-td")){this.selectionActive=!0;let t=window.getSelection();t.removeAllRanges();let a=document.createRange();a.selectNodeContents(e.target),t.addRange(a),t=a=null}},filterHex:e=>void 0===e?"":(e>=0?ne(e):e).toString().replace(/^(00)+/g,"")||"00",update(e,t,a,l){ns=a,os=this.$props.rowData.length-l,this.$emit("updatePadding",{visibleStartIndex:a,visibleEndIndex:l})},searchInfo(){this.isOpenSearch=!1},onOpenSearch(){this.isOpenSearch=!0},scrollToBottom(){this.$refs.scroller?.scrollToItem(this.$props.rowData.length-1)},scrollToItem(e){this.$refs.scroller?.scrollToItem(e)},nativeScroll(){const e=this.$refs.scroller.$el;e.addEventListener("scroll",(e=>{if(clearTimeout(this.$_scrollTimer),this.selectionActive){this.selectionActive=!1;let e=window.getSelection();e.removeAllRanges(),e=null}this.$_scrollTimer=setTimeout((()=>{console.log("updateVisibleItems"),this.$refs.scroller.updateVisibleItems(!0)}),100)})),e.addEventListener("wheel",(e=>{this.$emit("scrollAction",{topPadding:ns,bottomPadding:os}),e.deltaY>0||e.deltaX>0?os<=40&&this.$emit("scrollRow","down"):(e.deltaY<0||e.deltaX<0)&&ns<=40&&this.$emit("scrollRow","up")}))},filterItem(e,t){this.filterChnItem=e,this.curId=t,this.$emit("filterItem"),this.selectFilterList=[],E.blfLogging.getFiltItems({selectItem:e,channel:"",canId:"",name:"",canType:"",dir:"",dlc:""}).then((e=>{let t=e.data.data;t.length>0&&t.forEach((e=>{e&&this.selectFilterList.push({value:e,label:e,selected:!1})}))}))},onChooseFilterItem(e,t){e.selected=!0,this.$emit("reDrawTable",e,t,this.selectFilterList)},onTimeModelChange(e){this.$emit("timeModeChange",e)}},mounted(){this.nativeScroll()}},rs=e=>(C("data-v-906464b1"),e=e(),k(),e),cs={style:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"inherit","flex-direction":"inherit","align-items":"inherit"}},hs={key:1,class:"o-pul-time-option-warp"},ms=rs((()=>u("div",{class:"table-header",style:{height:"32px","line-height":"32px"}},null,-1))),ps=["data-even"],us=["onMousedown"],gs=["onMousedown"],bs=[rs((()=>u("span",{class:"container-tit",style:{width:"205px"}},"信号名",-1))),rs((()=>u("span",{class:"container-tit",style:{width:"200px"}},"信号物理值",-1))),rs((()=>u("span",{class:"container-tit",style:{width:"80px"}},"HEX",-1))),rs((()=>u("span",{class:"container-tit",style:{width:"calc(100vw - 487px)"}},"信号描述",-1)))],fs={class:"table-parent-tr o-table-expand-child"},ys={class:"table-td",style:{width:"205px"}},vs={class:"table-td",style:{width:"200px"}},ws={class:"table-td",style:{width:"80px"}},Cs={class:"table-td",style:{width:"calc(100vw - 487px)"}},ks=s(ds,[["render",function(e,t,a,l,i,s){const n=r("FilterItem"),o=r("v-select"),d=r("RecycleScroller");return m(),p("div",{class:"table",onClick:t[2]||(t[2]=(...e)=>s.onTableClick&&s.onTableClick(...e))},[u("div",{class:"table-header",style:$({height:"32px",lineHeight:"32px",transform:"translateX("+i.left+")",width:s.fullWidth,position:"absolute",zIndex:1})},[u("div",cs,[(m(!0),p(f,null,T(e.$props.columnsDef,((a,l)=>(m(),p("div",{class:"header-tit",key:l,style:$({width:a.width>0?a.width+"px":a.width})},[u("span",null,g(a.titName),1),a.filterShow?(m(),N(n,{key:0,onChange:t=>e.$emit("colFilterChange",{keyName:a.keyName,value:t}),col:a,asyncData:e.$props.columnsFilter},null,8,["onChange","col","asyncData"])):w("",!0),"timestamp"==a.keyName||"diff"==a.keyName||"deltaTime"==a.keyName?(m(),p("div",hs,[b(o,{options:i.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:i.timeFilterMode,"onUpdate:modelValue":t[0]||(t[0]=e=>i.timeFilterMode=e),class:"canoe-frame-vselect"},null,8,["options","modelValue"])])):w("",!0)],4)))),128))])],4),ms,b(d,{items:e.$props.rowData,"item-size":24,"key-field":"id",emitUpdate:!0,onUpdate:s.update,ref:"scroller",class:"frame-class"},{default:y((({item:t,index:a})=>[t.isParent?(m(),p("div",{key:0,class:"table-parent-tr","data-even":a%2==0,style:$({transform:"translateX("+i.left+")",width:s.fullWidth})},[(m(!0),p(f,null,T(e.$props.columnsDef,(l=>(m(),p("div",{class:"table-td",style:$({width:"number"==typeof l.width?l.width+"px":l.width}),key:l.keyName},[l.custom?(m(),p(f,{key:0},[t.isExpand&&t.isParent&&t.name?(m(),p("i",{key:0,class:"collapse-icon",onMousedown:F((t=>e.$emit("toggleExpand",a)),["stop","prevent"])},null,40,us)):w("",!0),!1===t.isExpand&&t.isParent&&t.name?(m(),p("i",{key:1,class:"expand-icon",onMousedown:F((t=>e.$emit("toggleExpand",a)),["stop","prevent"])},null,40,gs)):w("",!0)],64)):(m(),p(f,{key:1},[v(g(l.displayMap?l.displayMap(t[l.keyName]):t[l.keyName]),1)],64))],4)))),128))],12,ps)):(m(),p(f,{key:1},[t.isChildTit?(m(),p("div",{key:0,class:"table-header o-table-expand-child",style:$({transform:"translateX("+i.left+")",width:s.fullWidth})},bs,4)):(m(),p("div",{key:1,class:"table-parent",style:$({transform:"translateX("+i.left+")",width:s.fullWidth})},[u("div",fs,[u("span",ys,g(t.name),1),u("span",vs,g(t.value),1),u("span",ws,g(s.filterHex(t.hex)),1),u("span",Cs,g(t.comment),1)])],4))],64))])),_:1},8,["items","onUpdate"]),u("div",{class:"table-scroll-x",onScroll:t[1]||(t[1]=(...e)=>s.onScrollX&&s.onScrollX(...e))},[u("div",{class:"table-scroll-x-bar",style:$({width:s.fullWidth})},null,4)],32)])}],["__scopeId","data-v-906464b1"]]),Ss=s({beforeMount(){console.log("this.params",this.params)},methods:{onExpand(){console.log("this.params.data",this.params.data),!1===this.params.data.isExpand?(this.params.node.setDataValue("isExpand",!0),this.params.api.applyTransactionAsync({add:[JSON.parse(this.params.data.parsedData)],addIndex:this.params.rowIndex+1})):(this.params.node.setDataValue("isExpand",!1),this.params.api.applyTransactionAsync({remove:this.params.api.getRowNode(this.params.rowIndex+1)})),this.params.api.redrawRows()}}},[["render",function(e,t,a,l,i,s){return m(),p("div",null,[e.params.data.isExpand?(m(),p("i",{key:0,class:"expand-icon",onClick:t[0]||(t[0]=(...e)=>s.onExpand&&s.onExpand(...e))})):(m(),p("i",{key:1,class:"collapse-icon",onClick:t[1]||(t[1]=(...e)=>s.onExpand&&s.onExpand(...e))})),u("span",null,g(e.params.value),1)])}]]),Ts={methods:{onClick(){}}},Ds=[O('<table><thead class="o-table-thead"><tr><th class="o-table-cell">信号</th><th class="o-table-cell o-cell-ar">信号物理值</th><th class="o-table-cell o-cell-ar">信号描述</th></tr></thead><tbody class="o-table-tbody"></tbody></table>',1)];let Vs,xs=0,Ls=0,Is=0,Fs=0;const Rs={props:["store","closeFlag","recentTest","connectStatus","colFilterShow","channelOne","channelTwo","channelThree","linChannelVal","linChannelValTwo","filePath","dbcVal","startTime"],emits:["updateBock","updateTimeData","recordTimeChange","startTimeChange"],components:{Button:l,Message:i,ScrollBar:as,ExpandInfo:Ss,FullWidthCellRenderer:s(Ts,[["render",function(e,t,a,l,i,s){return m(),p("div",{onClick:t[0]||(t[0]=(...e)=>s.onClick&&s.onClick(...e))},Ds)}]]),TableRecycleScroller:ks,CopyPath:ae,ButtonGroup:se},data(){return{expandKeys:new Set,visibleStartIndex:0,visibleEndIndex:0,bottomPadding:0,recordLoading:!1,mode:"all",sliderValue:-1,comments:["","","","","","","","","","","","","","","",""],message:{visible:!1,level:"",content:""},seconds:0,timeFilterModeVal:"absolute",rowData:[],isRecording:!1,startSqlId:0,endSqlId:0,isLock:!1,isScrollEnd:!0,isAddData:!0,secondConfirm:!1,topLock:!1,bottomLock:!1,openFlag:!1,mlist:[{key:"lookRecord",name:"帧查看",icon:"box"},{key:"supeRecord",name:"图像查看",icon:"setting"}],cur:"lookRecord",recordShow:!0,colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],columnsDef:[{titName:"",width:30,keyName:"id",type:"number",value:[],filterShow:!1,custom:!0},{titName:"",width:164,keyName:"diff"===this.timeFilterModeVal?"single"===this.mode?"deltaTime":"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let t=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return t.toFixed(6);case"absolute":return new Date(1e3*t).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"});case"relative":return(e-this.startTime).toFixed(6);default:return e}}},{titName:"Chn",width:60,keyName:"channel",type:"number",value:[],filterShow:!0},{titName:"ID",width:60,keyName:"linId",type:"number",value:[],filterShow:!0,displayMap:e=>"0x"+e.toString(16)},{titName:"NAME",width:200,keyName:"name",type:"string",value:[],filterShow:!0},{titName:"checksum",width:80,keyName:"checksum",type:"string",value:[],filterShow:!1,displayMap:e=>"0x"+e.toString(16)},{titName:"Dir",width:60,keyName:"dir",type:"string",value:[],filterShow:!0},{titName:"Dlc",width:60,keyName:"dlc",type:"number",value:[],filterShow:!0},{titName:"DATA",width:1380,keyName:"data",type:"string",value:[],filterShow:!1,displayMap:e=>e.map((e=>e.toString(16).padStart(2,"0"))).join(" ")}]}},watch:{mode(e,t){this.topPadding=0,this.$refs.table.scrollToItem(0),this.expandKeys.clear(),this.rowData=[],this.isRecording&&this.resumeScroll()},filePath(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},dbcVal(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},recordLoading(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},isRecording(){this.$emit("updateBock",{filePath:this.filePath,dbcVal:this.dbcVal,recordLoading:this.recordLoading,isRecording:this.isRecording})},colComputed(){this.columnsDef[1]={titName:"",width:164,keyName:"diff"===this.timeFilterModeVal?"single"===this.mode?"deltaTime":"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let t=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return t.toFixed(6);case"absolute":return new Date(1e3*t).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23",timeZone:"Asia/Shanghai"})+"."+t.toFixed(6).split(".")[1];case"relative":return(e-this.startTime).toFixed(6);default:return e}}}}},computed:{colComputed(){return this.timeFilterModeVal+this.startTime+this.mode},recordTime(){return new Date(0,0,0,0,0,this.seconds).toLocaleTimeString()},showData(){let e={mode:"all"};return this.columnsDef.forEach((t=>{t.filterShow&&(e[t.keyName]=(t.value||[]).map((e=>e.value)))})),e},diffRowData(){return this.rowData.map(((e,t,a)=>({...e,diff:0===t?0:a[t].timestamp-a[t-1].timestamp})))}},methods:{choose(e){this.cur=e,this.recordShow="supeRecord"!=e},async colFilter(e){console.log("col111",e);const t="name"===e.keyName?null:"";let a,l={selectItem:e.keyName,...this.showData,[e.keyName]:t};console.log("params222",l);try{a=await await E.blfLogging.getFiltItemsLin(l)}catch(i){}return(a?.data?.data||[]).map((t=>({value:t,label:"linId"===e.keyName?"0x"+t.toString(16):""===t?" 空":t}))).sort(((t,a)=>("number"===e.type?+t.value>+a.value:t.value>a.value)?1:-1))},startRecord(){clearInterval(Fs),this.checkHardware(),this.isLock=!1,this.columnsDef=this.columnsDef.map((e=>({...e,value:[]})))},async checkHardware(){this.recordLoading=!1,this.secondConfirm=!1,clearInterval(Fs),this.isRecording=!0,this.resumeScroll()},async startLogging(){this.seconds=0,this.rowData=[],this.$emit("startTimeChange",Date.now()/1e3),Fs=setInterval((()=>{this.seconds=Date.now()/1e3-this.startTime}),1e3),this.$emit("recordTimeChange",this.recordTime),parseInt(this.channelOne),parseInt(this.channelTwo),parseInt(this.channelThree),parseInt(this.linChannelVal),parseInt(this.linChannelValTwo),this.channelOne.split("-").pop(),this.channelTwo.split("-").pop(),this.channelThree.split("-").pop();let e=this.filePath.replace(".blf","-"+_()+".blf");console.log(e)},showMessage({level:e,content:t,timeout:a}){clearTimeout(xs),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(xs=setTimeout((()=>{this.message.visible=!1}),a))},showLoggingMessage(){console.log("23333"),clearTimeout(Is),Vs=async()=>{let e;this.showData.mode=this.mode;try{e=await E.blfLogging.showLoggingMessageLin({...this.showData})}catch(a){}if(!e)return;let t=e?.data?.frame_data||[];if(console.log("eventData",t),!this.isLock&&t?.length>0)if("all"===this.mode){let e=t[0].sqlId,a=t[t.length-1].sqlId;t.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=""+e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),this.startSqlId=e,this.endSqlId=a,Ls=t[t.length-1].timestamp,this.rowData=t,this.$refs.table.scrollToBottom(),this.isAddData&&(this.sliderValue=e/a*(Ls-this.startTime)*1e3)}else"single"===this.mode&&(t.forEach((e=>{console.log("ele111",e),e.isExpand=!1,e.isParent=!0,e.id=""+e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),t=t.sort(((e,t)=>e.channel===t.channel?e.linId-t.linId:e.channel-t.channel)),console.log("finevent",t),await this.drawExpandRows(t),this.rowData=t);this.$emit("updateTimeData",e.data.signal_data),this.isRecording?Is=setTimeout((()=>{requestAnimationFrame(Vs)}),400):clearTimeout(Is),this.$emit("recordTimeChange",this.recordTime)},Vs()},async drawExpandRows(e){const t="-",a={};console.log("1233event"),this.rowData.slice().sort(((e,a)=>{const l=e.id,i=a.id;return!~l.indexOf(t)&&~i.indexOf(t)?-1:~l.indexOf(t)&&!~i.indexOf(t)?1:~l.indexOf(t)||~i.indexOf(t)?l>i?1:l<i?-1:0:e.channel<a.channel?-1:e.channel>a.channel?1:e.canId-a.canId})),e.forEach((e=>{const l=e.channel+"-"+e.canId;if(~e.id.indexOf(t))a[l].children.push(e);else{const t=a[l]?.children||[];a[l]=e,a[l].children=this.expandKeys.has(l)?t:[]}}));let l=this.rowData.slice();for(let s=this.visibleEndIndex;s>=this.visibleStartIndex;s--){if(!l?.[s])continue;let e=null,t=0;if(l[s].isParent)e=l[s],t=s;else if(s===this.visibleStartIndex)for(let a=s;a>=0;a--)if(l[a].isParent){e=l[a],t=a;break}if(e){const i=e.channel+"-"+e.canId;if(this.expandKeys.has(i)){const e=await this.onToggleExpand(t,l,!0);e?.length&&(a[i].children=e)}}}const i=[];for(let s in a){const e=a[s],t=e.children;delete e.children,t.length&&(e.isExpand=!0),i.push(e),t.forEach((e=>{i.push(e)}))}this.rowData=i},getSelectData(e){let t="",a="",l="";switch(console.log("向下"),e){case"up":l=this.startSqlId;break;case"down":a=this.endSqlId;break;case"pick":clearTimeout(Is),t=this.sliderValue/1e3+this.startTime}E.blfLogging.selectDataLin({moreThanTimeStamp:t,lessThanTimeStamp:"",moreThanSqlID:a,lessThanSqlID:l,...this.showData,sqlId:"",numbers:100}).then((t=>{if(t?.data?.data?.length>0){let a=t.data.data;switch(a.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),e){case"up":this.rowData=a.concat(...this.rowData),this.$refs.table.scrollToItem(t.data.data.length-1),this.sliderValue=1e3*(t.data.data[0].timestamp-this.startTime),t.data.startSqlId&&(this.startSqlId=t.data.startSqlId);break;case"down":this.rowData=this.rowData.concat(...a),t.data.endSqlId&&(this.endSqlId=t.data.endSqlId);break;case"pick":this.startSqlId=t.data.startSqlId,this.endSqlId=t.data.endSqlId,this.rowData=a,this.sliderValue=1e3*(t.data.data[0].timestamp-this.startTime)}}})).finally((()=>{this.topLock=!1,this.bottomLock=!1}))},onUpdatePadding(e){this.visibleStartIndex=e.visibleStartIndex,this.visibleEndIndex=e.visibleEndIndex},onTimeModeChange(e){this.timeFilterModeVal=e},onScrollAction(e){this.isLock||("all"===this.mode?this.isLock=!0:this.isLock=!1,this.isScrollEnd=!1)},onBodyScrollEnd(e){"single"!==this.mode&&("up"===e&&!1===this.topLock&&(this.topLock=!0,this.getSelectData(e)),"down"===e&&!1===this.bottomLock&&(this.bottomLock=!0,this.getSelectData(e)))},onClicked(){this.isLock=!1,this.isScrollEnd=!1},resumeScroll(){this.isScrollEnd=!0,this.isAddData=!0,this.isLock=!1,this.showLoggingMessage()},async onToggleExpand(e,t,a){const l=t.map((e=>({...e}))),i=l[e],s=i.channel+"-"+i.canId;let n=parseInt(this.linChannelVal)||0,o=parseInt(this.linChannelValTwo)||0;if(a||!i.isExpand){this.expandKeys.add(s);const t=await E.blfLogging.parsedSignalLin({channel:i.channel,linId:""+i.linId,ldfChn:[n,o],linData:(i.data||[]).map((e=>e.toString(16)))});let d=t?.data.sort(((e,t)=>e.name<t.name?-1:1))||[],r=i.sqlId;if(d.forEach(((e,t)=>{e.channel=i.channel,e.canId=""+i.canId,e.isParent=!1,e.isExpand=!0,e.isChildTit=!1,e.id=r+"-"+e.name})),d.unshift({channel:i.channel,canId:""+i.canId,isParent:!1,isExpand:!0,isChildTit:!0,id:r+"-"}),l.splice(e+1,0,...d),i.isExpand=d.length,a)return d;this.rowData=l}else this.expandKeys.delete(s),l.splice(e+1,l[e].isExpand),l[e].isExpand=!1,this.rowData=l},onSliderChange(e){this.isScrollEnd=!1,this.isAddData=!1,this.isLock=!0,this.getSelectData("pick")},onFilterItem(){this.openFlag=!this.openFlag},onColFilterChange(e){let t=this.columnsDef.find((t=>e.keyName===t.keyName));t&&(t.value=e.value),this.resumeScroll()}},mounted(){},unmounted(){Vs=null,clearTimeout(Is),clearInterval(Fs)}},$s=e=>(C("data-v-7da5c499"),e=e(),k(),e),Ms={class:"o-pul-er"},Es={key:0},_s=$s((()=>u("div",{class:"o-pul-title"},"报文录制配置",-1))),Ns={class:"o-pul-p-wrap"},As={class:"o-pul-p"},Os={class:"record-header-message"},Ps=$s((()=>u("b",null,"车型/DBC：",-1))),Us=["v-tooltip"],Hs=[$s((()=>u("b",null,"保存目录：",-1)))],Bs={class:"o-pul-path"},js={class:"o-pul-p-wrap"},zs={class:"o-pul-p"},qs={class:"record-header-message"},Ks=$s((()=>u("b",null,"Lin通道1：",-1))),Ws={class:"record-header-message"},Xs=$s((()=>u("b",null,"Lin通道2：",-1))),Gs={class:"o-pul-btn-wrap"},Ys=$s((()=>u("div",{class:"tool-btn-wrap"},[u("i",{class:"warn-icon"}),u("div",{class:"tool-picker-contianer-wrap"},"录制将覆盖文件,确认要开始录制吗?")],-1))),Js=$s((()=>u("div",{class:"tool-picker-arrow"},null,-1))),Qs={class:"tool-picker-footer-wrap"},Zs={class:"o-dialog-footer"},en=$s((()=>u("div",{class:"o-pul-hr"},null,-1))),tn={class:"o-table-wrap"},an=s(Rs,[["render",function(e,t,a,l,i,s){const n=r("CopyPath"),o=r("Button"),d=r("ButtonGroup"),C=r("ScrollBar"),k=r("TableRecycleScroller"),S=r("Message"),T=c("tooltip"),D=c("esc");return m(),p(f,null,[u("div",Ms,[i.recordShow?(m(),p("div",Es,[_s,u("div",Ns,[u("div",As,[u("span",Os,[Ps,v(g(a.dbcVal),1)]),u("span",{class:"record-header-message",style:{width:"71px"},"v-tooltip":a.filePath},Hs,8,Us),u("span",Bs,[b(n,{path:a.filePath,length:60,full:!0},null,8,["path"])])])]),u("div",js,[u("div",zs,[h((m(),p("span",qs,[Ks,v(g(a.linChannelVal),1)])),[[T,a.linChannelVal]]),h((m(),p("span",Ws,[Xs,v(g(a.linChannelValTwo),1)])),[[T,a.linChannelValTwo]])])]),u("div",Gs,[i.secondConfirm?h((m(),p("div",{key:0,class:"tool-picker-wrap",onClick:t[1]||(t[1]=F((()=>{}),["stop"]))},[Ys,Js,u("div",Qs,[u("div",Zs,[b(o,{class:"small-btn",style:{width:"30px"},onClick:t[0]||(t[0]=F((e=>i.secondConfirm=!1),["stop"]))},{default:y((()=>[v("取消")])),_:1}),b(o,{class:"small-btn",type:"primary",style:{width:"30px",margin:"0 0 0 10px"},onClick:F(s.checkHardware,["stop"])},{default:y((()=>[v("确定")])),_:1},8,["onClick"])])])])),[[D,()=>e.$emit("cancel")]]):w("",!0),v("   "),b(d,{options:[{label:"普通",value:"all"},{label:"单帧",value:"single"}],class:"theme-btn-group",modelValue:i.mode,"onUpdate:modelValue":t[2]||(t[2]=e=>i.mode=e)},null,8,["modelValue"])]),en,u("div",tn,[b(C,{modelValue:i.sliderValue,"onUpdate:modelValue":t[3]||(t[3]=e=>i.sliderValue=e),disable:"all"!==i.mode,startTime:1e3*a.startTime,start:0,end:1e3*i.seconds,onChange:s.onSliderChange,timeFilter:"relative"!=i.timeFilterModeVal?"absolute":"relative"},null,8,["modelValue","disable","startTime","end","onChange","timeFilter"]),b(k,{rowData:s.diffRowData,filters:s.showData,columnsDef:i.columnsDef,onToggleExpand:t[4]||(t[4]=e=>s.onToggleExpand(e,i.rowData)),onScrollRow:s.onBodyScrollEnd,onScrollAction:s.onScrollAction,onFilterItem:s.onFilterItem,onClick:s.onClicked,columnsFilter:s.colFilter,openFlag:i.openFlag,onColFilterChange:s.onColFilterChange,ref:"table",onUpdatePadding:s.onUpdatePadding,onTimeModeChange:s.onTimeModeChange,style:{height:"100%"}},null,8,["rowData","filters","columnsDef","onScrollRow","onScrollAction","onFilterItem","onClick","columnsFilter","openFlag","onColFilterChange","onUpdatePadding","onTimeModeChange"]),h(u("div",{class:"scrollToBottomBtn",onClick:t[5]||(t[5]=F((e=>s.resumeScroll()),["stop"]))},null,512),[[A,i.isLock&&"all"===i.mode],[T,"恢复向下滚动",void 0,{left:!0}]])])])):w("",!0)]),b(S,{message:i.message},null,8,["message"])],64)}],["__scopeId","data-v-7da5c499"]]);let ln=[],sn=0;const nn={class:"chs-er",ref:"root"},on={class:"chs-list-er","data-loading":!1},dn=["onClick"],rn=["id","onUpdate:modelValue","data-indeterminate"],cn=["innerHTML"],hn=["for"],mn=["id","onUpdate:modelValue","data-indeterminate"],pn=["innerHTML"],un={class:"footer"},gn=s({props:["filledOptions","checkedOptions"],emits:["connect","showMessage","getCarCode","cancel","signalsChange"],components:{Button:l,RecycleScroller:D,Spin:K,Message:i},data(){const e=this.$ls.get("blfread_sdbData")||[];if("custom"===this.carType){let t=e.find((e=>e.sdb===this.sdb))?.comments;t&&(ln=["",...t])}else ln=n.DEFAULT.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[];return ln=ln.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`)),{inputStr:"",checkedList:[],selectNodeList:[],counter:0,sdbCustom:e,lodingSpin:!1,isFlag:1,message:{visible:!1,level:"",content:""},listOpen:[],expandKeys:new Set([])}},computed:{list(){this.checkedList=this.$props.checkedOptions;let e=[],t=this,a=this.$props.filledOptions.data;for(let s in a){let l;l={_id:+s,id:+s,text:ln[s],node_type:"channel",children:[],set checked(e){l.children.forEach((t=>{t.checked=e}))},get checked(){return!l.children.some((e=>0==e.checked))},get indeterminate(){return l.children.some((e=>e.checked))&&l.children.some((e=>!e.checked))}};for(let e in a[s]){let i;i={_id:s+"_"+e,id:s+"_"+e,text:"-1"==e?"":e,node_type:"msg",channel:l.id,set checked(e){e?t.checkedList.push(i):t.checkedList=t.checkedList.filter((e=>!(e._id===i._id)))},get checked(){return t.checkedList.some((e=>e._id===i._id))},children:a[s][e].map((t=>{let a;return a={_id:s+"_"+e+"_"+t[0],id:t[0],msg:"-1"==e?"-1":+e.match(/0x\w+/)?.[0]||e,channel:l.id,text:t[0],node_type:"signal",comment:t[1],remark:t[2],canId:t[3],rawValue:t[4],maxRaw:t[5],minRaw:t[6],maxPhys:t[7],minPhys:t[8],selectPhys:t[9],unit:t[10],startBit:t[11],length:t[12],physStep:t[13],dlc:t[14],canType:t[15],periodic:t[16],eteDisable:t[17]},a}))},l.children.push(i)}e.push(l)}let l=[];for(let s=0;s<e.length;s++){let t=e[s];if(-1!=t.id&&l.push(t),this.inputStr||this.expandKeys.has(t.id))for(let e=0;e<t.children.length;e++){let a=t.children[e];"-"!=a.id[0]&&l.push(a)}}if(this.inputStr.length>0){const e=this.inputStr.toLowerCase();let t;try{t=new RegExp(e,"i")}catch(i){t={test:e=>~e.toLowerCase().indexOf(e.toLowerCase())}}l=l.filter((e=>t.test(e.text)||e.comment&&t.test(e.comment)||e.remark&&t.test(e.remark)))}return l}},watch:{checkedListIndex:{handler(e){this.checkedList=[]},deep:!0}},mounted(){this.$refs.chsInputRef.focus(),setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},beforeUnmount(){},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{clickHandler(e){0==this.$refs.root?.contains(e.target)&&this.$emit("cancel")},showFirstChild(e){this.expandKeys.has(e.id)?this.expandKeys.delete(e.id):this.expandKeys.add(e.id)},clearTable(){this.checkedList=[]},title4node:e=>Q(e),showMessage({level:e,content:t,timeout:a}){clearTimeout(sn),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(sn=setTimeout((()=>{this.message.visible=!1}),a))},submit(){this.checkedList.length>80?this.showMessage({level:"error",content:"信号选择不能超过80项",timeout:3e3}):this.$emit("signalsChange",this.checkedList)},highlightWord(e){if(!e)return e;const t=this.inputStr;if(!t)return e;const a=t.split(/\s+/g);var l,i,s=a.length;for(l=0;l<s;l++)try{(i=new RegExp(a[l],"gi")).test(e)&&(e=e.replace(i,"<strong>$&</strong>"))}catch(n){i=a[l],e=e.replace(i,"<strong>$&</strong>")}return e}}},[["render",function(e,t,a,l,i,s){const n=r("RecycleScroller"),o=r("Message"),d=c("tooltip"),g=c("esc");return h((m(),p("div",nn,[h(u("input",{class:"chs-input-er",placeholder:"搜索信号名称/信号描述",ref:"chsInputRef","onUpdate:modelValue":t[0]||(t[0]=e=>i.inputStr=e),onInput:t[1]||(t[1]=(...t)=>e.onChange&&e.onChange(...t)),draggable:!1},null,544),[[I,i.inputStr]]),u("div",on,[b(n,{class:"chs-list",items:s.list,"item-size":28,"key-field":"_id"},{default:y((({item:e})=>[u("label",null,["channel"==e.node_type&&e.id<=36?(m(),p("div",{key:0,style:{"margin-left":"1px"},class:R(!i.inputStr&&i.expandKeys.has(e.id)?"switch-open":"switch-close"),onClick:F((t=>s.showFirstChild(e)),["stop","prevent"])},null,10,dn)):w("",!0),"channel"==e.node_type&&e.id<=36?h((m(),p("input",{key:1,style:{"margin-left":"3px"},id:e._id,type:"checkbox","onUpdate:modelValue":t=>e.checked=t,"data-indeterminate":e.indeterminate,"click.stop":""},null,8,rn)),[[U,e.checked]]):w("",!0),"channel"==e.node_type&&e.id<=36?(m(),p("span",{key:2,class:"chs-node",innerHTML:s.highlightWord(e._id)},null,8,cn)):"msg"==e.node_type?h((m(),p("div",{key:3,for:e.children,style:{"text-indent":"2em","margin-left":"-15px"},class:"chs-node chs-node-item"},[h(u("input",{id:e._id,type:"checkbox","onUpdate:modelValue":t=>e.checked=t,"data-indeterminate":e.indeterminate,"click.stop":""},null,8,mn),[[U,e.checked]]),u("span",{class:"",innerHTML:s.highlightWord(e.text)},null,8,pn)],8,hn)),[[d,{content:s.title4node(e),html:!0},void 0,{right:!0}]]):w("",!0)])])),_:1},8,["items"])]),u("div",un,[u("div",{class:"chs-btn confirm",onClick:t[2]||(t[2]=(...e)=>s.submit&&s.submit(...e))},"确认"),u("div",{class:"chs-btn cancel",onClick:t[3]||(t[3]=(...e)=>s.clearTable&&s.clearTable(...e))},"重置")]),b(o,{message:i.message},null,8,["message"])])),[[g,()=>e.$emit("cancel")]])}],["__scopeId","data-v-c2cba19d"]]),bn=["data-forbidden","data-disabled"],fn=s({props:["disabled"],data:()=>({editable:!1}),methods:{clickBody(e){if(this.$props.disabled)return;this.editable=!0,e.target.children?.[0]?.focus(),console.log("e.target111",e.target);let t=e=>{e.target&&(e.target==this.$refs.root||this.$refs.root?.contains(e.target))?this.editable=!0:e.target&&(this.editable=!1,document.body.removeEventListener("mousedown",t))};document.body.addEventListener("mousedown",t)}},mounted(){}},[["render",function(e,t,a,l,i,s){return m(),p("div",{ref:"root",class:"ewer","data-forbidden":e.$props.disabled,"data-disabled":!i.editable,onClick:t[0]||(t[0]=(...e)=>s.clickBody&&s.clickBody(...e))},[H(e.$slots,"default")],8,bn)}]]),yn=["data-hi"],vn=s({props:["modelValue","min","max","watch"],emits:["update:modelValue","change","error"],data:()=>({str:"",type:16,highlight:!1}),watch:{modelValue:{handler(e,t){null!=t&&parseFloat(e)!==parseFloat(t)&&this.$props.watch&&(this.highlight=!0,setTimeout((()=>{this.highlight=!1}),500));let a="0x0";try{a="0x"+(parseInt(e)||0).toString(16)}catch(l){}this.str=a,this.type=16},immediate:!0}},methods:{onChange(e){let t=e.target.value;if(!this.valid(t.toString()))return this.str="0x"+(parseInt(this.$props.modelValue)||0).toString(16),void this.$emit("error",t);let a=10===this.type?parseInt(t):parseInt("0x"+t.replace("0x",""),16);a<this.min?a=+this.min:a>this.max&&(a=+this.max),this.str="0x"+a.toString(16),this.$emit("update:modelValue",a),this.$emit("change",a)},valid(e){return 16==this.type?/^(0x)?[0-9a-fA-F]+$/.test(e):/\d+/.test(e)}}},[["render",function(e,t,a,l,i,s){return h((m(),p("input",{class:"input","data-hi":i.highlight,type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>i.str=e),onChange:t[1]||(t[1]=F(((...e)=>s.onChange&&s.onChange(...e)),["prevent"])),onKeydown:t[2]||(t[2]=B(F(((...e)=>s.onChange&&s.onChange(...e)),["stop","prevent"]),["enter"]))},null,40,yn)),[[I,i.str,void 0,{lazy:!0}]])}],["__scopeId","data-v-c55d1b50"]]),wn=["data-hi","min","max","step"],Cn={key:0,class:"ic-down"},kn=["data-hi","value"],Sn=["value"],Tn=s({props:["min","max","step","modelValue","enum","watch","class"],emits:["update:modelValue","change"],data:()=>({str:"",highlight:!1}),computed:{enumOpts(){return Object.entries(this.$props.enum)}},watch:{modelValue:{handler(e,t){null!=t&&parseFloat(e)!==parseFloat(t)&&this.$props.watch&&(this.highlight=!0,setTimeout((()=>{this.highlight=!1}),500)),this.str=e?.[0]>="A"?this.enumOpts.find((t=>+t[1]==+e))?.[0]||"":parseFloat(e)},immediate:!0}},methods:{onChange(e){let t=parseFloat(e.target.value),a=parseFloat(this.min),l=parseFloat(this.max);console.log(t,this.min,this.max),t<a?t=a:t>l&&(t=l),this.str=t.toString(),this.$emit("update:modelValue",t),this.$emit("change",t)}}},[["render",function(e,t,a,l,i,s){return m(),p(f,null,[h(u("input",{class:R(["input",e.$props.class]),type:"number","data-hi":i.highlight,min:a.min,max:a.max,step:a.step,"onUpdate:modelValue":t[0]||(t[0]=e=>i.str=e),onChange:t[1]||(t[1]=(...e)=>s.onChange&&s.onChange(...e)),style:$({width:s.enumOpts.length?"40%":""})},null,46,wn),[[I,i.str,void 0,{lazy:!0}]]),s.enumOpts.length?(m(),p("i",Cn)):w("",!0),s.enumOpts.length?(m(),p("select",{key:1,"data-hi":i.highlight,class:"select",value:i.str,onChange:t[2]||(t[2]=(...e)=>s.onChange&&s.onChange(...e))},[(m(!0),p(f,null,T(s.enumOpts,(e=>(m(),p("option",{value:e[0]},g(e[1]),9,Sn)))),256))],40,kn)):w("",!0)],64)}],["__scopeId","data-v-b4b10b3c"]]);let Dn=0;const Vn={props:["store","setStore"],components:{Button:l,Message:i,ChooseSignal:gn,EditWrapper:fn,InputHex:vn,InputOrSelect:Tn},data:()=>({hexMultiValue:0,isHexMulti:!1,hexs:[],frames:[],listTable:{cols:[{label:"",width:"2.8em",icon:"add"},{label:"Frame Name",width:"auto"},{label:"E2E",width:"6em",type:"checkbox",checked:!1},{label:"Period (ms)",width:"9em",tooltip:{content:"1-1000ms:周期发送<br/>0:单点发送",html:!0}},{label:"ID",width:"4.5em",tooltip:"DBC导入禁止修改ID"},{label:"Channel",width:"6em"},{label:"Type",width:"6em"},{label:"DLC",width:"4em"},{label:"",width:"5em"}]},sigTable:{cols:[{label:"Signal Name",width:"auto"},{label:"Raw",width:"90px"},{label:"Phys",width:"200px"},{label:"Unit",width:"4em"}]},cur:-1,chooseSignalShow:!1,filledOptions:[],isSyncFrames:!1,addRecordShow:!1,message:{visible:!1,level:"",content:""},curChannel:0}),computed:{checkedOptions(){return this.frames.filter((e=>"dbc"==e.from))},checkIndeterminate(){return this.frames.some((e=>e.e2e))&&this.frames.some((e=>!e.e2e))},allChecked(){return this.frames.some((e=>e.e2e))&&this.frames.some((e=>e.children[0].eteDisable))}},watch:{"$props.store.sendRecord.isRecording":{handler(e){e&&this.updateMultiFrame(this.frames.map(((e,t)=>({...e,row:t+1}))),"add")}},"$props.store.sendRecord.dbc.dbcChn":{handler(e,t){}},"$props.store.sendRecord":{handler(e,t){}},frames:{async handler(e,t){if(this.isSyncFrames)return;this.isSyncFrames=!0,this.isHexMulti=!1;for(let i=0;i<e.length;i++){let t=e[i],a=t.channel;console.log("sendframe.dbcChannel07041553",a);let l=t.canId;console.log("sendframe.dirty07041441",t.dirty),"raw"===t.dirty?(await E.blfLogging.getRawValueToPhysValue({dbcChannel:a,canId:l,signalsData:t.children}).then((e=>{this.frames[i]={...t,rawData:e.data.data.rawData,children:t.children.map((t=>({...t,physValue:e.data.data.signalsData.find((e=>e.name===t.id))?.physValue??t.physValue}))),dirty:!1,raw:i+1},this.updateMultiFrame([{row:i+1,...this.frames[i]}],"modify")})).catch(console.log),await P(100)):"data"===t.dirty?(console.log("sendframes[i]07051410",t),"dbc"===t.from?await E.blfLogging.getDataToValues({dbcChannel:a,canId:l,rawData:t.rawData}).then((e=>{this.frames[i]={...t,children:t.children.map((t=>({...t,physValue:e.data.data.signalsPhysData.find((e=>e.name===t.id))?.physValue??t.physValue,rawValue:e.data.data.signalsRawData.find((e=>e.name===t.id))?.rawValue??t.rawValue}))),dirty:!1,raw:i+1},this.updateMultiFrame([{row:i+1,...this.frames[i]}],"modify")})).catch(console.log):(this.frames[i]={...t,dirty:!1,raw:i+1},this.updateMultiFrame([{row:i+1,...this.frames[i]}],"modify"))):"phys"===t.dirty?await E.blfLogging.getPhysValueToRawValue({dbcChannel:a,canId:l,signalsData:t.children}).then((e=>{this.frames[i]={...t,rawData:e.data.data.rawData,children:t.children.map((t=>({...t,rawValue:e.data.data.signalsData.find((e=>e.name===t.id))?.rawValue??t.rawValue}))),dirty:!1,raw:i+1},this.updateMultiFrame([{row:i+1,...this.frames[i]}],"modify")})).catch(console.log):"dlc"===t.dirty?(this.frames[i]={...t,rawData:Array.from({length:t.dlc},((e,a)=>t.rawData[a]||0)),dirty:!1,raw:i+1},this.updateMultiFrame([{row:i+1,...t}],"modify")):"periodic"===t.dirty?(this.frames[i]={...t,isSending:0!=t.periodic&&t.isSending,dirty:!1,raw:i+1},this.updateMultiFrame([{row:i+1,...t}],"modify")):t.dirty&&(this.frames[i].dirty=!1,this.updateMultiFrame([{row:i+1,...t}],"modify"))}this.isSyncFrames=!1;let a=e.filter((e=>!0===e.children[0]?.eteDisable)),l=[];a.forEach((e=>{l.push({raw:e.raw,canId:e.canId,dbcChannel:e.channel,useE2E:e.e2e?1:0})})),E.blfLogging.setE2EConfig({e2eSlotList:l})},deep:!0},cur(e){console.log("sendCur07041058",e,this.frames[e]),this.isHexMulti=!1,this.hexs=[]}},methods:{showMessage({level:e,content:t,timeout:a}){clearTimeout(Dn),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Dn=setTimeout((()=>{this.message.visible=!1}),a))},onHexErr(){this.showMessage({timeout:2e3,level:"error",content:"请输入正确格式的16进制"})},updateFrame(e){let t=this.frames.slice(),a=[],l=[];for(let i=t.length-1;i>=0;i--){let a=t[i];if("dbc"===a.from){let s=e.findIndex((e=>e.id===a.id));if(~s)e.splice(s,1);else{i===this.cur&&(this.cur=-1);let e=t.splice(i,1);l.unshift({...e,row:i+1})}}}this.updateMultiFrame(l,"delete"),a=e.map(((e,t)=>{let a=e.children[0]||{};return{...e,name:e.text,from:"dbc",e2e:!1,periodic:a.periodic||0,canType:a.canType||"CAN",dlc:a.dlc||64,canId:a.msg||0,dirty:"raw",isSending:!1,children:e.children.map((e=>({...e,name:e.id})))}})),t.push(...a),this.frames=t,this.chooseSignalShow=!1,this.addRecordShow=!1},delFrame(e){e===this.cur&&(this.cur=-1);let t=this.frames.splice(e,1);this.frames.forEach(((e,t)=>{this.frames[t].raw=t+1})),this.updateMultiFrame([{...t,row:e+1}],"delete")},addFrame(e){this.addRecordShow=!1;let t=[{name:"",e2e:!1,periodic:1e3,canId:"CAN"===e?111:222,channel:this.$props.store.sendRecord.dbc.dbcChn["CAN"===e?0:1],canType:e,dlc:8,isSending:!1,from:e,rawData:[0,0,0,0,0,0,0,0],children:[{eteDisable:!1}]}],a=this.frames.length-1;this.frames.push(...t),console.log("addthis.frames",this.frames),this.updateMultiFrame(t.map(((e,t)=>({...e,row:a+t}))),"add")},updateMultiFrame(e,t){if(!this.$props.store.sendRecord.isRecording)return;let a=e.map((e=>({...e,channel:1+this.$props.store.sendRecord.dbc.dbcChn.indexOf(e.channel)})));a.length>0&&E.blfLogging.getPeriodicSend({data:a,behavor:t})},togglePlay(e,t){e.periodic>0?(e.isSending=!e.isSending,this.updateMultiFrame([{row:t+1,...e}],"modify")):E.blfLogging.getManualSend({row:t+1,...e,channel:1+this.$props.store.sendRecord.dbc.dbcChn.indexOf(e.channel)}).catch(console.log)},onHexMultiChange(){this.frames[this.cur].rawData=this.frames[this.cur].rawData.map(((e,t)=>this.hexs.includes(t)?this.hexMultiValue:e)),this.frames[this.cur].dirty="data"},clickHandler(e){0==this.$refs.root?.contains(e.target)&&(this.addRecordShow=!1)},onChecked(e){this.allChecked=!e,this.allChecked?this.frames.forEach((e=>{e.children[0]?.eteDisable&&(e.e2e=!0)})):this.frames.forEach((e=>{e.e2e=!1}))}},mounted(){setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)}},xn=e=>(C("data-v-437f19d4"),e=e(),k(),e),Ln={class:"body"},In={class:"list-er"},Fn={class:"list-table"},Rn={key:1,class:"ic-help"},$n=["data-indeterminate"],Mn=["onClick","data-active"],En=["title"],_n=["data-from","data-cantype","data-valid"],Nn=["disabled","onUpdate:modelValue"],An=["onUpdate:modelValue","onChange"],On=["disabled","onUpdate:modelValue","onChange"],Pn=["value"],Un=["disabled","onUpdate:modelValue","onChange"],Hn=[xn((()=>u("option",{value:"CAN"},"CAN",-1))),xn((()=>u("option",{value:"CANFD"},"CANFD",-1)))],Bn=["disabled","onUpdate:modelValue","onChange"],jn=["value"],zn=["data-disable","data-recording","data-active","onClick"],qn=["onClick"],Kn={key:0,class:"table-empty"},Wn={class:"empty-meark"},Xn={class:"sig-er"},Gn={class:"hex-er"},Yn=xn((()=>u("th",{style:{width:"4em"}}," ",-1))),Jn={style:{width:"11.8%"}},Qn={key:0},Zn=["value"],eo={class:"hex-footer"},to={class:"hex-multi-input"},ao={class:"btn-import-er"},lo={class:"add-record",ref:"root"},io=["data-disabled"],so=["data-disabled"],no=["data-disabled"],oo=s(Vn,[["render",function(e,t,a,l,i,s){const n=r("EditWrapper"),o=r("InputHex"),d=r("InputOrSelect"),C=r("Button"),k=r("ChooseSignal"),S=r("Message"),D=c("tooltip");return m(),p(f,null,[u("div",Ln,[u("div",In,[u("table",Fn,[u("tr",null,[(m(!0),p(f,null,T(i.listTable.cols,(e=>(m(),p("th",{style:$({width:e.width})},[v(g(e.label)+" ",1),e.icon?(m(),p("i",{key:0,onClick:t[0]||(t[0]=e=>i.addRecordShow=!i.addRecordShow),class:"ic-add"})):w("",!0),e.tooltip?h((m(),p("i",Rn,null,512)),[[D,e.tooltip]]):w("",!0),e.type?h((m(),p("input",{key:2,type:"checkbox",onChange:t[1]||(t[1]=e=>s.onChecked(s.allChecked)),"data-indeterminate":s.checkIndeterminate,"onUpdate:modelValue":t[2]||(t[2]=e=>s.allChecked=e)},null,40,$n)),[[U,s.allChecked]]):w("",!0)],4)))),256))]),(m(!0),p(f,null,T(i.frames,((t,a)=>(m(),p("tr",{onClick:e=>i.cur=a,"data-active":i.cur===a},[u("td",null,g(a+1),1),u("td",{title:t.name},[u("i",{class:"ic-can","data-from":t.from,"data-cantype":t.canType,"data-valid":Object.values(e.$props.store.sendRecord.dbc.dbcChn).includes(t.channel)},null,8,_n),v(" "+g(t.name),1)],8,En),u("td",null,[b(n,{style:{"justify-content":"center"}},{default:y((()=>[h(u("input",{type:"checkbox",disabled:!t.children[0]?.eteDisable,"onUpdate:modelValue":e=>t.e2e=e},null,8,Nn),[[U,t.e2e,void 0,{lazy:!0}]])])),_:2},1024)]),u("td",null,[b(n,null,{default:y((()=>[h(u("input",{class:"td-input",type:"number",min:"0",max:"1000","onUpdate:modelValue":e=>t.periodic=e,onChange:e=>t.dirty="periodic"},null,40,An),[[I,t.periodic,void 0,{lazy:!0}]])])),_:2},1024)]),u("td",null,[b(n,{disabled:"dbc"===t.from},{default:y((()=>[b(o,{onError:s.onHexErr,min:0,max:2047,disabled:"dbc"===t.from,class:"td-input",modelValue:t.canId,"onUpdate:modelValue":e=>t.canId=e,onChange:e=>t.dirty="canId"},null,8,["onError","disabled","modelValue","onUpdate:modelValue","onChange"])])),_:2},1032,["disabled"])]),u("td",null,[b(n,{disabled:"dbc"===t.from},{default:y((()=>[h(u("select",{disabled:"dbc"===t.from,class:"td-input","onUpdate:modelValue":e=>t.channel=e,onChange:e=>t.dirty="channel"},[(m(!0),p(f,null,T(e.$props.store.sendRecord.dbc.dbcChn,((e,t)=>(m(),p("option",{value:e},"CAN"+g(t+1),9,Pn)))),256))],40,On),[[j,t.channel,void 0,{lazy:!0}]])])),_:2},1032,["disabled"])]),u("td",null,[b(n,{disabled:"dbc"===t.from},{default:y((()=>[h(u("select",{disabled:"dbc"===t.from,class:"td-input","onUpdate:modelValue":e=>t.canType=e,onChange:e=>t.dirty="canType"},Hn,40,Un),[[j,t.canType]])])),_:2},1032,["disabled"])]),u("td",null,[b(n,{disabled:"CAN"===t.canType||"dbc"===t.from},{default:y((()=>[h(u("select",{disabled:"CAN"===t.canType||"dbc"===t.from,class:"td-input","onUpdate:modelValue":e=>t.dlc=e,onChange:e=>t.dirty="dlc"},[(m(),p(f,null,T([8,12,16,20,24,32,48,64],(e=>u("option",{value:e},g(e),9,jn))),64))],40,Bn),[[j,t.dlc]])])),_:2},1032,["disabled"])]),u("td",null,[u("i",{class:"ic-play","data-disable":Object.values(e.$props.store.sendRecord.dbc.dbcChn).includes(t.channel),"data-recording":e.$props.store.sendRecord.isRecording,"data-active":t.isSending,onClick:e=>s.togglePlay(t,a)},null,8,zn),v("  "),u("i",{class:"ic-del",onClick:F((e=>s.delFrame(a)),["stop"])},null,8,qn)])],8,Mn)))),256))]),0==i.frames.length?(m(),p("div",Kn,[u("div",Wn,[v("暂无内容，请先"),u("span",{class:"empty-btn",onClick:t[3]||(t[3]=e=>i.addRecordShow=!i.addRecordShow)},"导入帧")])])):w("",!0)]),u("div",Xn,[(m(),p("table",{class:"sig-table",key:"sig"+i.cur},[u("tr",null,[(m(!0),p(f,null,T(i.sigTable.cols,(e=>(m(),p("th",{style:$({width:e.width})},g(e.label),5)))),256))]),""!==i.frames[i.cur]?.name?(m(!0),p(f,{key:0},T(i.frames[i.cur]?.children,(e=>(m(),p("tr",null,[h((m(),p("td",null,[v(g(e.text)+" ",1)])),[[D,{content:`${e.text}<hr/>phys:${e.minPhys} ~ ${e.maxPhys}<br/>raw:${e.minRaw?"0x"+e.minRaw.toString(16):""} ~ ${e.maxRaw?"0x"+e.maxRaw.toString(16):""}<br/>Start Bit:${e.startBit}<br>Length:${e.length}<br>Phys Step:${e.physStep}`,html:!0},void 0,{"top-start":!0}]]),u("td",null,[b(n,null,{default:y((()=>[b(o,{watch:!0,onError:s.onHexErr,min:e.minRaw,max:e.maxRaw,class:"td-input",modelValue:e.rawValue,"onUpdate:modelValue":t=>e.rawValue=t,modelModifiers:{lazy:!0},onChange:t[4]||(t[4]=e=>i.frames[i.cur].dirty="raw")},null,8,["onError","min","max","modelValue","onUpdate:modelValue"])])),_:2},1024)]),u("td",null,[b(n,null,{default:y((()=>[b(d,{watch:!0,min:e.minPhys,max:e.maxPhys,class:"td-input",step:e.physStep,modelValue:e.physValue,"onUpdate:modelValue":t=>e.physValue=t,enum:e.selectPhys?e.selectPhys:"",onChange:t[5]||(t[5]=e=>i.frames[i.cur].dirty="phys")},null,8,["min","max","step","modelValue","onUpdate:modelValue","enum"])])),_:2},1024)]),u("td",null,g(e.unit),1)])))),256)):w("",!0)]))]),u("div",Gn,[(m(),p("table",{class:"hex-table",key:"hex"+i.cur},[u("tr",null,[Yn,(m(),p(f,null,T([0,1,2,3,4,5,6,7],(e=>u("th",Jn,g(e),1))),64))]),i.frames[i.cur]?.rawData?(m(),p(f,{key:0},T([0,8,16,24,32,40,48,56,64],((e,a)=>(m(),p(f,null,[i.frames[i.cur].rawData.length>e?(m(),p("tr",Qn,[u("td",null,[u("b",null,g(e),1)]),(m(),p(f,null,T(8,(a=>u("td",null,[i.isHexMulti&&e+a-1<i.frames[i.cur].rawData.length?h((m(),p("input",{key:0,type:"checkbox",class:"radio","onUpdate:modelValue":t[6]||(t[6]=e=>i.hexs=e),value:e+a-1},null,8,Zn)),[[U,i.hexs]]):w("",!0),e+a-1<i.frames[i.cur].rawData.length?(m(),N(n,{key:1},{default:y((()=>[b(o,{watch:!0,onError:s.onHexErr,min:0,max:255,class:"td-input",style:{width:"calc(100%)","text-indent":"20px"},modelValue:i.frames[i.cur].rawData[e+a-1],"onUpdate:modelValue":t=>i.frames[i.cur].rawData[e+a-1]=t,modelModifiers:{lazy:!0},onChange:t[7]||(t[7]=e=>i.frames[i.cur].dirty="data")},null,8,["onError","modelValue","onUpdate:modelValue"])])),_:2},1024)):w("",!0)]))),64))])):w("",!0)],64)))),64)):w("",!0)])),u("div",eo,[i.isHexMulti?(m(),p(f,{key:1},[v(" 批量修改:("+g(i.hexs.length)+"个)  ",1),b(C,{style:{float:"right",height:"23px","margin-left":"8px"},onClick:t[9]||(t[9]=e=>{i.hexs=[],i.isHexMulti=!1})},{default:y((()=>[v("退出")])),_:1}),b(C,{style:{float:"right",height:"23px"},type:"primary",onClick:s.onHexMultiChange},{default:y((()=>[v("修改")])),_:1},8,["onClick"]),u("div",to,[b(o,{onError:s.onHexErr,min:0,max:255,modelValue:i.hexMultiValue,"onUpdate:modelValue":t[10]||(t[10]=e=>i.hexMultiValue=e)},null,8,["onError","modelValue"])])],64)):(m(),p("div",{key:0,class:"hex-footer-full-btn",onClick:t[8]||(t[8]=e=>i.isHexMulti=!i.isHexMulti)},"进入批量修改"))])]),h(u("div",ao,[i.chooseSignalShow?(m(),N(k,{key:0,filledOptions:e.$props.store.sendRecord.frames,checkedOptions:s.checkedOptions,onSignalsChange:s.updateFrame,onCancel:t[11]||(t[11]=()=>{i.chooseSignalShow=!1})},null,8,["filledOptions","checkedOptions","onSignalsChange"])):w("",!0)],512),[[A,i.chooseSignalShow]]),h(u("div",lo,[u("div",{onClick:t[12]||(t[12]=e=>i.chooseSignalShow=!i.chooseSignalShow),"data-disabled":0===e.$props.store.sendRecord.frames.length},"从DBC中导入帧",8,io),u("div",{onClick:t[13]||(t[13]=e=>s.addFrame("CAN")),"data-disabled":0==e.$props.store.sendRecord.dbc.dbcChn.length},"自定义CAN帧",8,so),u("div",{onClick:t[14]||(t[14]=e=>s.addFrame("CANFD")),"data-disabled":0==e.$props.store.sendRecord.dbc.dbcChn.length},"自定义CAN FD帧",8,no)],512),[[A,i.addRecordShow]])]),b(S,{message:i.message},null,8,["message"])],64)}],["__scopeId","data-v-437f19d4"]]);let ro=[],co=0;const ho={class:"chs-er",ref:"root"},mo={class:"chs-list-er","data-loading":!1},po=["onClick"],uo=["id","onUpdate:modelValue","data-indeterminate"],go=["innerHTML"],bo=["for"],fo=["id","onUpdate:modelValue","data-indeterminate"],yo=["innerHTML"],vo={class:"footer"};let wo=0;const Co={props:["activeTab","linSendInfo","nodeOpt","ldfChn","store","setStore","curFileIdx","deployDisable"],components:{ButtonGroup:se,Button:l,InputHex:vn,EditWrapper:fn,ChooseSignal:s({props:["filledOptions","checkedOptions"],emits:["connect","showMessage","getCarCode","cancel","signalsChange"],components:{Button:l,RecycleScroller:D,Spin:K,Message:i},data(){const e=this.$ls.get("blfread_sdbData")||[];if("custom"===this.carType){let t=e.find((e=>e.sdb===this.sdb))?.comments;t&&(ro=["",...t])}else ro=x.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[];return ro=ro.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`)),{inputStr:"",checkedList:[],selectNodeList:[],counter:0,sdbCustom:e,lodingSpin:!1,isFlag:1,message:{visible:!1,level:"",content:""},listOpen:[],expandKeys:new Set([])}},computed:{list(){this.checkedList=this.$props.checkedOptions;let e=[],t=this,a=this.$props.filledOptions.data;for(let s in a){let l;l={_id:+s,id:+s,text:ro[s],node_type:"channel",children:[],set checked(e){l.children.forEach((t=>{t.checked=e}))},get checked(){return!l.children.some((e=>0==e.checked))},get indeterminate(){return l.children.some((e=>e.checked))&&l.children.some((e=>!e.checked))}};for(let e in a[s]){let i;i={_id:s+"_"+e,id:s+"_"+e,text:"-1"==e?"":e,node_type:"msg",channel:l.id,set checked(e){e?t.checkedList.push(i):t.checkedList=t.checkedList.filter((e=>!(e._id===i._id)))},get checked(){return t.checkedList.some((e=>e._id===i._id))},children:a[s][e].map((t=>{let a;return a={_id:s+"_"+e+"_"+t[0],id:t[0],msg:"-1"==e?"-1":+e.match(/0x\w+/)?.[0]||e,channel:l.id,text:t[0],node_type:"signal",comment:t[1],remark:t[2],canId:t[3],rawValue:t[4],maxRaw:t[5],minRaw:t[6],maxPhys:t[7],minPhys:t[8],selectPhys:t[9],unit:t[10],startBit:t[11],length:t[12],physStep:t[13],dlc:t[14],canType:t[15],periodic:t[16],eteDisable:t[17]},a}))},l.children.push(i)}e.push(l)}let l=[];for(let s=0;s<e.length;s++){let t=e[s];if(-1!=t.id&&l.push(t),this.inputStr||this.expandKeys.has(t.id))for(let e=0;e<t.children.length;e++){let a=t.children[e];"-"!=a.id[0]&&l.push(a)}}if(this.inputStr.length>0){const e=this.inputStr.toLowerCase();let t;try{t=new RegExp(e,"i")}catch(i){t={test:e=>~e.toLowerCase().indexOf(e.toLowerCase())}}l=l.filter((e=>t.test(e.text)||e.comment&&t.test(e.comment)||e.remark&&t.test(e.remark)))}return l}},watch:{checkedListIndex:{handler(e){this.checkedList=[]},deep:!0}},mounted(){this.$refs.chsInputRef.focus(),setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},beforeUnmount(){},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{clickHandler(e){0==this.$refs.root?.contains(e.target)&&this.$emit("cancel")},showFirstChild(e){this.expandKeys.has(e.id)?this.expandKeys.delete(e.id):this.expandKeys.add(e.id)},clearTable(){this.checkedList=[]},title4node:e=>Q(e),showMessage({level:e,content:t,timeout:a}){clearTimeout(co),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(co=setTimeout((()=>{this.message.visible=!1}),a))},submit(){this.checkedList.length>80?this.showMessage({level:"error",content:"信号选择不能超过80项",timeout:3e3}):this.$emit("signalsChange",this.checkedList)},highlightWord(e){if(!e)return e;const t=this.inputStr;if(!t)return e;const a=t.split(/\s+/g);var l,i,s=a.length;for(l=0;l<s;l++)try{(i=new RegExp(a[l],"gi")).test(e)&&(e=e.replace(i,"<strong>$&</strong>"))}catch(n){i=a[l],e=e.replace(i,"<strong>$&</strong>")}return e}}},[["render",function(e,t,a,l,i,s){const n=r("RecycleScroller"),o=r("Message"),d=c("tooltip"),g=c("esc");return h((m(),p("div",ho,[h(u("input",{class:"chs-input-er",placeholder:"搜索信号名称/信号描述",ref:"chsInputRef","onUpdate:modelValue":t[0]||(t[0]=e=>i.inputStr=e),onInput:t[1]||(t[1]=(...t)=>e.onChange&&e.onChange(...t)),draggable:!1},null,544),[[I,i.inputStr]]),u("div",mo,[b(n,{class:"chs-list",items:s.list,"item-size":28,"key-field":"_id"},{default:y((({item:e})=>[u("label",null,["channel"==e.node_type&&e.id>=1e3?(m(),p("div",{key:0,style:{"margin-left":"1px"},class:R(!i.inputStr&&i.expandKeys.has(e.id)?"switch-open":"switch-close"),onClick:F((t=>s.showFirstChild(e)),["stop","prevent"])},null,10,po)):w("",!0),"channel"==e.node_type&&e.id>=1e3?h((m(),p("input",{key:1,style:{"margin-left":"3px"},id:e._id,type:"checkbox","onUpdate:modelValue":t=>e.checked=t,"data-indeterminate":e.indeterminate,"click.stop":""},null,8,uo)),[[U,e.checked]]):w("",!0),"channel"==e.node_type&&e.id>=1e3?(m(),p("span",{key:2,class:"chs-node",innerHTML:s.highlightWord(e._id)},null,8,go)):"msg"==e.node_type?h((m(),p("div",{key:3,for:e.children,style:{"text-indent":"2em","margin-left":"-15px"},class:"chs-node chs-node-item"},[h(u("input",{id:e._id,type:"checkbox","onUpdate:modelValue":t=>e.checked=t,"data-indeterminate":e.indeterminate,"click.stop":""},null,8,fo),[[U,e.checked]]),u("span",{class:"",innerHTML:s.highlightWord(e.text)},null,8,yo)],8,bo)),[[d,{content:s.title4node(e),html:!0},void 0,{right:!0}]]):w("",!0)])])),_:1},8,["items"])]),u("div",vo,[u("div",{class:"chs-btn confirm",onClick:t[2]||(t[2]=(...e)=>s.submit&&s.submit(...e))},"确认"),u("div",{class:"chs-btn cancel",onClick:t[3]||(t[3]=(...e)=>s.clearTable&&s.clearTable(...e))},"重置")]),b(o,{message:i.message},null,8,["message"])])),[[g,()=>e.$emit("cancel")]])}],["__scopeId","data-v-b5f3b0db"]]),InputOrSelect:Tn},data:()=>({nodeVal:{},mode:"schedule",cur:-1,linListTable:{cols:[{label:"",width:"2.8em",icon:"add"},{label:"Frame Name",width:"auto"},{label:"Delay (ms)",width:"9em",tooltip:{content:"1-1000ms:周期发送<br/>0:单点发送",html:!0}},{label:"ID",width:"4.5em",tooltip:"DBC导入禁止修改ID"},{label:"Channel",width:"6em"},{label:"DIR",width:"6em"},{label:"DLC",width:"3em"},{label:"",width:"5em"}]},linSigTable:{cols:[{label:"Signal Name",width:"auto"},{label:"Raw",width:"90px"},{label:"Phys",width:"200px"},{label:"Unit",width:"4em"}]},linIsHexMulti:!1,hexs:[],activeTab:0,activeChn:0,activeScheduleIndex:-1,activeTableList:new Map,chooseLinSignalShow:!1,linAddRecordShow:!1,frames:[],cur:-1,isDeploying:!1,isDeployChecked:!0,showScheduleList:!0,scheduleStyleOpt:[{label:"调度表",value:"schedule",disable:"false"},{label:"单帧",value:"single",disable:"false"}],isFilled:!0}),watch:{curFileIdx(e){this.activeTab=e},deployDisable(e){console.log("部署disable",e)},linSendInfo(e){this.activeLinData=e?.data[this.activeChn],console.log("this.activeLinData07251122",this.activeLinData)},ldfChn:{handler(e){console.log("newVal07051108",e),this.nodeVal={},this.frames=[],this.scheduleList=[]},deep:!0,immediate:!0},"$props.store.sendRecord.isRecording":{handler(e){e&&this.updateMultiFrame(this.frames.map(((e,t)=>({...e,row:t+1}))),"add")}},"$props.store.sendRecord":{handler(e,t){}},frames:{async handler(e,t){if(console.log("nextFrames1800111",e),!this.isSyncFrames){this.isSyncFrames=!0,this.isHexMulti=!1,e.length>0&&(this.isDeployChecked=!1);for(let t=0;t<e.length;t++){let a=e[t],l=a.channel;console.log("frame07051053",l);let i=a.id;console.log("frame.dirty07041441",a.dirty,a),"raw"===a.dirty?await E.blfLogging.getRawValueToPhysValueLIN({ldfChannel:this.ldfChn[this.activeTab],linId:i,signalsData:a.children.map((e=>({name:e.text,rawValue:e.rawValue})))}).then((e=>{this.frames[t]={...a,rawData:e.data.data.rawData,children:a.children.map((t=>({...t,physValue:e.data.data.signalsData.find((e=>e.name===t.id))?.physValue??t.physValue}))),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.frames[t]}],"modify"),this.isDeploying&&this.getDSServer()})).catch(console.log):"data"===a.dirty?(console.log("this.frames[i]07051410",a),"dbc"===a.from||"sch"===a.from?await E.blfLogging.getDataToValuesLIN({ldfChannel:this.ldfChn[this.activeTab],linId:i,rawData:a.rawData}).then((e=>{console.log("res07110934",e),this.frames[t]={...a,children:a.children.map((t=>({...t,physValue:e.data.data.signalsPhysData.find((e=>e.name===t.id))?.physValue??t.physValue,rawValue:e.data.data.signalsRawData.find((e=>e.name===t.id))?.rawValue??t.rawValue}))),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.frames[t]}],"modify")})).catch(console.log):(this.frames[t]={...a,dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.frames[t]}],"modify")),this.isDeploying&&this.getDSServer()):"phys"===a.dirty?(console.log("frame.children0710",a.children),await E.blfLogging.getPhysValueToRawValueLIN({ldfChannel:this.ldfChn[this.activeTab],linId:i,signalsData:a.children.map((e=>({name:e.text,physValue:parseInt(e.physValue)})))}).then((e=>{this.frames[t]={...a,rawData:e.data.data.rawData,children:a.children.map((t=>({...t,rawValue:e.data.data.signalsData.find((e=>e.name===t.id))?.rawValue??t.rawValue}))),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.frames[t]}],"modify"),this.isDeploying&&this.getDSServer()})).catch(console.log)):"dlc"===a.dirty?(this.frames[t]={...a,rawData:Array.from({length:a.dlc},((e,t)=>a.rawData[t]||0)),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...a}],"modify"),this.isDeploying&&this.getDSServer()):"delay"===a.dirty?(this.frames[t]={...a,isSending:0!=a.delay&&a.isSending,dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...a}],"modify"),this.isDeploying&&this.getDSServer()):a.dirty&&(this.frames[t].dirty=!1,this.updateMultiFrame([{row:t+1,...a}],"modify"),this.isDeploying&&this.getDSServer())}this.isSyncFrames=!1}},deep:!0},cur(e){console.log("cur07041051",e,this.frames[e]),this.isHexMulti=!1,this.hexs=[]}},computed:{scheduleList(){if(console.log("this.activeLinData",this.ldfChn[this.activeTab],this.activeTab,this.linSendInfo,this.ldfChn),console.log("this.nodeVal.value",this.nodeVal),Object.keys(this.nodeVal).length>0&&""!==this.nodeVal.value){let e={};if("master"===this.nodeVal.parentNode)return this.showScheduleList=!0,e=0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode][this.nodeVal.value]:{},Object.keys(e||{});{this.showScheduleList=!1,console.log("this.linSendInfo.data[this.ldfChn[this.activeTab]]",this.linSendInfo.data[this.ldfChn[this.activeTab]],this.linSendInfo),e=0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode]:{};let t=Object.keys(e||{});return console.log("99999",t),t.forEach(((e,t)=>{e===this.nodeVal.value&&this.checkedSchedule(t,e)})),t}}},checkedOptions(){return this.frames.filter((e=>"dbc"==e.from))}},mounted(){setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{checkedSchedule(e,t){console.log("index,item",e,t);let a=[];a="master"===this.nodeVal.parentNode?0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode][this.nodeVal.value][t]:[]:0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode][t]:[],this.activeScheduleIndex=e;let l=a.map((e=>({_id:this.nodeVal.parentNode+"_"+e[0]+"_"+this.mode,id:e[1],linId:e[1],text:e[0],name:e[0],dir:e[2],dlc:e[3],delay:e[4],channel:this.ldfChn[0],dirty:"raw",from:"sch",children:e[5].map((e=>{let t;return t={_id:e[0],id:e[0],text:e[0],node_type:"signal",comment:e[1],remark:e[2],linId:e[3],rawValue:e[4],maxRaw:e[5],minRaw:e[6],maxPhys:e[7].toString(),minPhys:e[8].toString(),selectPhys:e[9],unit:e[10],startBit:e[11],length:e[12],physStep:e[13].toString(),dlc:e[14],canType:e[15],periodic:e[16]},t}))})));this.frames=[],this.frames.push(...l),this.activeTableList.set(this.nodeVal.parentNode+"-"+this.nodeVal.value+"-"+this.mode,{phone:"213-555-1234",address:"123 N 1st Ave"})},clickHandler(e){0==this.$refs.root?.contains(e.target)&&(this.linAddRecordShow=!1)},showMessage({level:e,content:t,timeout:a}){clearTimeout(wo),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(wo=setTimeout((()=>{this.message.visible=!1}),a))},onHexErr(){this.showMessage({timeout:2e3,level:"error",content:"请输入正确格式的16进制"})},addFrame(e){console.log("this.ldfChn[0]",this.ldfChn[0]),this.linAddRecordShow=!1;let t=[{name:"",delay:20,id:1===e,channel:this.ldfChn[0],canType:e,dir:"tx",dlc:8,isSending:!1,from:e,rawData:[0,0,0,0,0,0,0,0]}],a=this.frames.length-1;this.frames.push(...t),this.updateMultiFrame(t.map(((e,t)=>({...e,row:a+t}))),"add")},updateMultiFrame(e,t){console.log("list07051359",e),this.$props.store.sendRecord.isRecording&&e.map((e=>({...e,channel:1+this.$props.store.sendRecord.dbc.ldfChn.indexOf(e.channel)})))},updateFrame(e){let t=this.frames.slice(),a=[],l=[];for(let i=t.length-1;i>=0;i--){let a=t[i];if("dbc"===a.from){let s=e.findIndex((e=>e.id===a.id));if(~s)e.splice(s,1);else{i===this.cur&&(this.cur=-1);let e=t.splice(i,1);l.unshift({...e,row:i+1})}}}this.updateMultiFrame(l,"delete"),a=e.map(((e,t)=>{let a=e.children[0]||{};return console.log("it111",a),{...e,name:e.text,from:"dbc",periodic:a.periodic||0,canType:a.canType||"LIN",dlc:a.dlc||64,id:a.msg||0,linId:a.canId||0,dirty:"raw",dir:"tx",delay:10,isSending:!1,children:e.children.map((e=>({...e,name:e.id})))}})),t.push(...a),this.frames=t,console.log("this.frames07040952",this.frames),this.chooseLinSignalShow=!1,this.addRecordShow=!1},async startDeploy(){console.log("部署",this.nodeVal,this.nodeVal.parentNode),this.isDeploying=!0;for(var e=0;e<this.scheduleStyleOpt.length;e++)"single"===this.scheduleStyleOpt[e].value&&(this.scheduleStyleOpt[e].disable="true");this.getDSServer(),console.log("ldfChn11",this.ldfChn,this.frames)},async getDSServer(){await E.blfLogging.getDeployShedule({channelId:1,mode:this.nodeVal.parentNode?this.nodeVal.parentNode:this.isFilled?"master":"slave",LINFrames:this.frames.map((e=>({LINId:e.linId?"0x"+(parseInt(e.linId)||0).toString(16):"0x0",dataLength:e.rawData?e.rawData.length:0,dir:"tx"===e.dir?0:1,delay:e.delay,data:e.rawData})))}).then((e=>{})).catch(console.log)},async endDeploy(){this.isDeploying=!1;for(var e=0;e<this.scheduleStyleOpt.length;e++)"single"===this.scheduleStyleOpt[e].value&&(this.scheduleStyleOpt[e].disable="false");await E.blfLogging.getUnDeployShedule({channelId:1,mode:this.nodeVal.parentNode?this.nodeVal.parentNode:this.isFilled?"master":"slave"}).then((e=>{})).catch(console.log)},async togglePlay(e,t){console.log("raw07162036",e,t),await E.blfLogging.getManualSendLIN({channelId:1,mode:this.nodeVal.parentNode?this.nodeVal.parentNode:this.isFilled?"master":"slave",LINFrames:[{LINId:e.linId?"0x"+(parseInt(e.linId)||0).toString(16):"0x0",dataLength:e.rawData.length,dir:"tx"===e.dir?0:1,delay:e.delay,data:e.rawData}]}).then((e=>{}))},delFrame(e){console.log("idx2003",e,this.frames),e===this.cur&&(this.cur=-1);let t=this.frames.splice(e,1);this.frames.forEach(((e,t)=>{this.frames[t].raw=t+1})),this.updateMultiFrame([{...t,row:e+1}],"delete")}}},ko=e=>(C("data-v-290efa56"),e=e(),k(),e),So={class:"lin-body"},To={class:"select-er"},Do={class:"select-left"},Vo=ko((()=>u("span",{class:"record-header-message"},[u("b",null,"节点：")],-1))),xo={key:0,class:"chs-ft-label pointer"},Lo=["checked"],Io=ko((()=>u("i",{class:"icon-ques"},null,-1))),Fo={class:"select-right"},Ro=ko((()=>u("i",{class:"play-icon"},null,-1))),$o=ko((()=>u("i",{class:"stop-icon"},null,-1))),Mo={class:"lin-list-wrap"},Eo={class:"lin-list-tree-er"},_o=ko((()=>u("div",{class:"lin-list-tree-tit"},[u("i",{class:"lin-list-icon"}),u("b",null,"LIN调度表")],-1))),No={class:"lin-list-tree-body"},Ao=["data-disabled","data-active","onClick"],Oo=ko((()=>u("i",{class:"lin-list-icon-sm"},null,-1))),Po=["title"],Uo={class:"lin-list-er"},Ho={class:"lin-list-table"},Bo={key:1,class:"ic-help"},jo={key:2,type:"checkbox"},zo={class:"add-record",ref:"root"},qo=["data-disabled"],Ko=["data-disabled"],Wo=["onClick","data-active"],Xo=["data-from","data-cantype","data-valid"],Go=["onUpdate:modelValue","onChange"],Yo=["onUpdate:modelValue","onChange"],Jo=["value"],Qo=["onUpdate:modelValue","onChange"],Zo=[ko((()=>u("option",{value:"tx"},"tx",-1))),ko((()=>u("option",{value:"rx"},"rx",-1)))],ed=["disabled","onUpdate:modelValue","onChange"],td=["data-disable","data-recording","data-active","onClick"],ad=["data-disable","onClick"],ld={key:0,class:"table-empty"},id={class:"empty-meark"},sd={class:"btn-import-er"},nd={class:"lin-sig-er"},od={class:"lin-hex-er"},dd=ko((()=>u("th",{style:{width:"4em"}}," ",-1))),rd={style:{width:"11.8%"}},cd={key:0},hd=["value"],md={class:"hex-footer"},pd={class:"hex-multi-input"},ud=s(Co,[["render",function(e,t,a,l,i,s){const n=r("v-select"),o=r("ButtonGroup"),d=r("Button"),C=r("EditWrapper"),k=r("InputHex"),S=r("ChooseSignal"),D=r("InputOrSelect"),V=c("tooltip");return m(),p("div",So,[u("div",To,[u("div",Do,[Vo,b(n,{options:a.nodeOpt,clearable:!1,searchable:!1,disabled:i.isDeploying,label:"label",value:"value",modelValue:i.nodeVal,"onUpdate:modelValue":t[0]||(t[0]=e=>i.nodeVal=e),class:"tch-tool-select"},null,8,["options","disabled","modelValue"]),"0"==a.ldfChn[this.activeTab]?h((m(),p("label",xo,[u("input",{class:"chs-node-checkboxAll",type:"checkbox",checked:i.isFilled,onClick:t[1]||(t[1]=t=>e.checkMasterMode())},null,8,Lo),v("主节点模式"),Io])),[[V,"主节点模式"]]):w("",!0)]),u("div",Fo,[b(o,{options:i.scheduleStyleOpt,class:"theme-btn-group",modelValue:i.mode,"onUpdate:modelValue":t[2]||(t[2]=e=>i.mode=e)},null,8,["options","modelValue"]),v("  "),i.isDeploying?(m(),N(d,{key:1,type:"primary",class:"header-import-btn",onClick:s.endDeploy},{default:y((()=>[$o,v("停止 ")])),_:1},8,["onClick"])):(m(),N(d,{key:0,type:"primary",class:"header-import-btn",onClick:s.startDeploy,disabled:i.isDeployChecked||"single"==i.mode||a.deployDisable,progress:"100%"},{default:y((()=>[Ro,v("部署 ")])),_:1},8,["onClick","disabled"]))])]),u("div",Mo,[h(u("div",Eo,[_o,u("div",No,[(m(!0),p(f,null,T(s.scheduleList,((e,t)=>(m(),p("div",{class:"lin-list-tree-item",key:t,"data-disabled":i.isDeploying,"data-active":i.activeScheduleIndex===t,onClick:a=>s.checkedSchedule(t,e)},[Oo,u("span",{title:e},g(e),9,Po)],8,Ao)))),128))])],512),[[A,i.showScheduleList]]),u("div",Uo,[u("table",Ho,[u("tr",null,[(m(!0),p(f,null,T(i.linListTable.cols,(e=>(m(),p("th",{style:$({width:e.width})},[v(g(e.label)+" ",1),e.icon?(m(),p("i",{key:0,onClick:t[3]||(t[3]=e=>i.linAddRecordShow=!i.linAddRecordShow),class:"lin-ic-add"})):w("",!0),e.tooltip?h((m(),p("i",Bo,null,512)),[[V,e.tooltip]]):w("",!0),e.type?(m(),p("input",jo)):w("",!0)],4)))),256)),h(u("div",zo,[u("div",{onClick:t[4]||(t[4]=e=>i.chooseLinSignalShow=!i.chooseLinSignalShow),"data-disabled":0===e.$props.store?.sendRecord?.frames?.length||i.isDeploying},"从DBC中导入帧",8,qo),u("div",{onClick:t[5]||(t[5]=e=>s.addFrame("LIN")),"data-disabled":0==e.$props.store?.sendRecord?.frames?.length||i.isDeploying},"自定义帧",8,Ko)],512),[[A,i.linAddRecordShow]])]),(m(!0),p(f,null,T(i.frames,((t,a)=>(m(),p("tr",{onClick:e=>i.cur=a,"data-active":i.cur===a},[u("td",null,g(a+1),1),u("td",null,[u("i",{class:"ic-can","data-from":t.from,"data-cantype":t.canType,"data-valid":Object.values(e.$props.store.sendRecord.dbc.ldfChn).includes(t.channel)},null,8,Xo),v(" "+g(t.name),1)]),u("td",null,[b(C,null,{default:y((()=>[h(u("input",{class:"td-input",type:"number",min:"0",max:"1000","onUpdate:modelValue":e=>t.delay=e,onChange:e=>t.dirty="delay"},null,40,Go),[[I,t.delay,void 0,{lazy:!0}]])])),_:2},1024)]),u("td",null,[b(C,{disabled:"LIN"!==t.from},{default:y((()=>[b(k,{onError:s.onHexErr,min:0,max:2047,disabled:"LIN"!==t.from,class:"td-input",modelValue:t.linId,"onUpdate:modelValue":e=>t.linId=e,onChange:e=>t.dirty="linId"},null,8,["onError","disabled","modelValue","onUpdate:modelValue","onChange"])])),_:2},1032,["disabled"])]),u("td",null,[b(C,{disabled:!0},{default:y((()=>[h(u("select",{class:"td-input",disabled:!0,"onUpdate:modelValue":e=>t.channel=e,onChange:e=>t.dirty="channel"},[(m(!0),p(f,null,T(e.$props.store.sendRecord.dbc.ldfChn,((e,t)=>(m(),p("option",{value:e},"LIN"+g(t+1),9,Jo)))),256))],40,Yo),[[j,t.channel,void 0,{lazy:!0}]])])),_:2},1024)]),u("td",null,[b(C,null,{default:y((()=>[h(u("select",{class:"td-input","onUpdate:modelValue":e=>t.dir=e,onChange:e=>t.dirty="dir"},Zo,40,Qo),[[j,t.dir]])])),_:2},1024)]),u("td",null,[b(C,{disabled:"LIN"!==t.from},{default:y((()=>[h(u("input",{disabled:"LIN"!==t.from,class:"td-input",type:"number",min:"0",max:"8","onUpdate:modelValue":e=>t.dlc=e,onChange:e=>t.dirty="dlc"},null,40,ed),[[I,t.dlc,void 0,{lazy:!0}]])])),_:2},1032,["disabled"])]),u("td",null,["schedule"!==i.mode?(m(),p("i",{key:0,class:"ic-play","data-disable":Object.values(e.$props.store.sendRecord.dbc.ldfChn).includes(t.channel),"data-recording":e.$props.store.sendRecord.isRecording,"data-active":t.isSending,onClick:e=>s.togglePlay(t,a)},null,8,td)):w("",!0),v("  "),u("i",{class:"ic-del","data-disable":i.isDeploying,onClick:F((e=>s.delFrame(a)),["stop"])},null,8,ad)])],8,Wo)))),256))]),0==i.frames.length?(m(),p("div",ld,[u("div",id,[v("暂无内容，请先"),u("span",{class:"empty-btn",onClick:t[6]||(t[6]=e=>i.linAddRecordShow=!i.linAddRecordShow)},"导入帧")])])):w("",!0)]),h(u("div",sd,[i.chooseLinSignalShow?(m(),N(S,{key:0,filledOptions:e.$props.store.sendRecord.frames,checkedOptions:s.checkedOptions,onSignalsChange:s.updateFrame,onCancel:t[7]||(t[7]=()=>{i.chooseLinSignalShow=!1})},null,8,["filledOptions","checkedOptions","onSignalsChange"])):w("",!0)],512),[[A,i.chooseLinSignalShow]])]),u("div",nd,[(m(),p("table",{class:"sig-table",key:"sig"+i.cur},[u("tr",null,[(m(!0),p(f,null,T(i.linSigTable.cols,(e=>(m(),p("th",{style:$({width:e.width})},g(e.label),5)))),256))]),""!==i.frames[i.cur]?.name?(m(!0),p(f,{key:0},T(i.frames[i.cur]?.children,(e=>(m(),p("tr",null,[h((m(),p("td",null,[v(g(e.text)+" ",1)])),[[V,{content:`${e.text}<hr/>phys:${e.minPhys} ~ ${e.maxPhys}<br/>raw:${e.minRaw?"0x"+e.minRaw.toString(16):""} ~ ${e.maxRaw?"0x"+e.maxRaw.toString(16):""}<br/>Start Bit:${e.startBit}<br>Length:${e.length}<br>Phys Step:${e.physStep}`,html:!0},void 0,{"top-start":!0}]]),u("td",null,[b(C,null,{default:y((()=>[b(k,{watch:!0,onError:s.onHexErr,min:e.minRaw,max:e.maxRaw,class:"td-input",modelValue:e.rawValue,"onUpdate:modelValue":t=>e.rawValue=t,modelModifiers:{lazy:!0},onChange:t[8]||(t[8]=e=>i.frames[i.cur].dirty="raw")},null,8,["onError","min","max","modelValue","onUpdate:modelValue"])])),_:2},1024)]),u("td",null,[b(C,null,{default:y((()=>[b(D,{watch:!0,min:e.minPhys,max:e.maxPhys,class:"td-input",step:e.physStep,modelValue:e.physValue,"onUpdate:modelValue":t=>e.physValue=t,enum:e.selectPhys?e.selectPhys:"",onChange:t[9]||(t[9]=e=>i.frames[i.cur].dirty="phys")},null,8,["min","max","step","modelValue","onUpdate:modelValue","enum"])])),_:2},1024)]),u("td",null,g(e.unit),1)])))),256)):w("",!0)]))]),u("div",od,[(m(),p("table",{class:"lin-hex-table",key:"hex"+i.cur},[u("tr",null,[dd,(m(),p(f,null,T([0,1,2,3,4,5,6,7],(e=>u("th",rd,g(e),1))),64))]),i.frames[i.cur]?.rawData?(m(),p(f,{key:0},T([0,8,16,24,32,40,48,56,64],((a,l)=>(m(),p(f,null,[i.frames[i.cur].rawData.length>a?(m(),p("tr",cd,[u("td",null,[u("b",null,g(a),1)]),(m(),p(f,null,T(8,(l=>u("td",null,[e.isHexMulti&&a+l-1<i.frames[i.cur].rawData.length?h((m(),p("input",{key:0,type:"checkbox",class:"radio","onUpdate:modelValue":t[10]||(t[10]=e=>i.hexs=e),value:a+l-1},null,8,hd)),[[U,i.hexs]]):w("",!0),a+l-1<i.frames[i.cur].rawData.length?(m(),N(C,{key:1},{default:y((()=>[b(k,{watch:!0,onError:s.onHexErr,min:0,max:255,class:"td-input",style:{width:"calc(100%)","text-indent":"20px"},modelValue:i.frames[i.cur].rawData[a+l-1],"onUpdate:modelValue":e=>i.frames[i.cur].rawData[a+l-1]=e,modelModifiers:{lazy:!0},onChange:t[11]||(t[11]=e=>i.frames[i.cur].dirty="data")},null,8,["onError","modelValue","onUpdate:modelValue"])])),_:2},1024)):w("",!0)]))),64))])):w("",!0)],64)))),64)):w("",!0)])),u("div",md,[i.linIsHexMulti?(m(),p(f,{key:1},[v(" 批量修改:("+g(i.hexs.length)+"个)  ",1),b(d,{style:{float:"right",height:"23px","margin-left":"8px"},onClick:t[13]||(t[13]=e=>{i.hexs=[],i.linIsHexMulti=!1})},{default:y((()=>[v("退出")])),_:1}),b(d,{style:{float:"right",height:"23px"},type:"primary"},{default:y((()=>[v("修改")])),_:1}),u("div",pd,[b(k,{onError:s.onHexErr,min:0,max:255,modelValue:e.hexMultiValue,"onUpdate:modelValue":t[14]||(t[14]=t=>e.hexMultiValue=t)},null,8,["onError","modelValue"])])],64)):(m(),p("div",{key:0,class:"hex-footer-full-btn",onClick:t[12]||(t[12]=e=>i.linIsHexMulti=!i.linIsHexMulti)},"进入批量修改"))])])])}],["__scopeId","data-v-290efa56"]]);let gd=[],bd=0;const fd={class:"chs-er",ref:"root"},yd={class:"chs-list-er","data-loading":!1},vd=["onClick"],wd=["id","onUpdate:modelValue","data-indeterminate"],Cd=["innerHTML"],kd=["for"],Sd=["id","onUpdate:modelValue","data-indeterminate"],Td=["innerHTML"],Dd={class:"footer"};let Vd=0;const xd={props:["activeTab","linSendInfo","nodeOpt","ldfChn","store","setStore","curFileIdx","deployDisable"],components:{ButtonGroup:se,Button:l,InputHex:vn,EditWrapper:fn,ChooseSignal:s({props:["filledOptions","checkedOptions"],emits:["connect","showMessage","getCarCode","cancel","signalsChange"],components:{Button:l,RecycleScroller:D,Spin:K,Message:i},data(){const e=this.$ls.get("blfread_sdbData")||[];if("custom"===this.carType){let t=e.find((e=>e.sdb===this.sdb))?.comments;t&&(gd=["",...t])}else gd=x.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[];return gd=gd.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`)),{inputStr:"",checkedList:[],selectNodeList:[],counter:0,sdbCustom:e,lodingSpin:!1,isFlag:1,message:{visible:!1,level:"",content:""},listOpen:[],expandKeys:new Set([])}},computed:{list(){this.checkedList=this.$props.checkedOptions;let e=[],t=this,a=this.$props.filledOptions.data;for(let s in a){let l;l={_id:+s,id:+s,text:gd[s],node_type:"channel",children:[],set checked(e){l.children.forEach((t=>{t.checked=e}))},get checked(){return!l.children.some((e=>0==e.checked))},get indeterminate(){return l.children.some((e=>e.checked))&&l.children.some((e=>!e.checked))}};for(let e in a[s]){let i;i={_id:s+"_"+e,id:s+"_"+e,text:"-1"==e?"":e,node_type:"msg",channel:l.id,set checked(e){e?t.checkedList.push(i):t.checkedList=t.checkedList.filter((e=>!(e._id===i._id)))},get checked(){return t.checkedList.some((e=>e._id===i._id))},children:a[s][e].map((t=>{let a;return a={_id:s+"_"+e+"_"+t[0],id:t[0],msg:"-1"==e?"-1":+e.match(/0x\w+/)?.[0]||e,channel:l.id,text:t[0],node_type:"signal",comment:t[1],remark:t[2],canId:t[3],rawValue:t[4],maxRaw:t[5],minRaw:t[6],maxPhys:t[7],minPhys:t[8],selectPhys:t[9],unit:t[10],startBit:t[11],length:t[12],physStep:t[13],dlc:t[14],canType:t[15],periodic:t[16],eteDisable:t[17]},a}))},l.children.push(i)}e.push(l)}let l=[];for(let s=0;s<e.length;s++){let t=e[s];if(-1!=t.id&&l.push(t),this.inputStr||this.expandKeys.has(t.id))for(let e=0;e<t.children.length;e++){let a=t.children[e];"-"!=a.id[0]&&l.push(a)}}if(this.inputStr.length>0){const e=this.inputStr.toLowerCase();let t;try{t=new RegExp(e,"i")}catch(i){t={test:e=>~e.toLowerCase().indexOf(e.toLowerCase())}}l=l.filter((e=>t.test(e.text)||e.comment&&t.test(e.comment)||e.remark&&t.test(e.remark)))}return l}},watch:{checkedListIndex:{handler(e){this.checkedList=[]},deep:!0}},mounted(){this.$refs.chsInputRef.focus(),setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},beforeUnmount(){},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{clickHandler(e){0==this.$refs.root?.contains(e.target)&&this.$emit("cancel")},showFirstChild(e){this.expandKeys.has(e.id)?this.expandKeys.delete(e.id):this.expandKeys.add(e.id)},clearTable(){this.checkedList=[]},title4node:e=>Q(e),showMessage({level:e,content:t,timeout:a}){clearTimeout(bd),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(bd=setTimeout((()=>{this.message.visible=!1}),a))},submit(){this.checkedList.length>80?this.showMessage({level:"error",content:"信号选择不能超过80项",timeout:3e3}):this.$emit("signalsChange",this.checkedList)},highlightWord(e){if(!e)return e;const t=this.inputStr;if(!t)return e;const a=t.split(/\s+/g);var l,i,s=a.length;for(l=0;l<s;l++)try{(i=new RegExp(a[l],"gi")).test(e)&&(e=e.replace(i,"<strong>$&</strong>"))}catch(n){i=a[l],e=e.replace(i,"<strong>$&</strong>")}return e}}},[["render",function(e,t,a,l,i,s){const n=r("RecycleScroller"),o=r("Message"),d=c("tooltip"),g=c("esc");return h((m(),p("div",fd,[h(u("input",{class:"chs-input-er",placeholder:"搜索信号名称/信号描述",ref:"chsInputRef","onUpdate:modelValue":t[0]||(t[0]=e=>i.inputStr=e),onInput:t[1]||(t[1]=(...t)=>e.onChange&&e.onChange(...t)),draggable:!1},null,544),[[I,i.inputStr]]),u("div",yd,[b(n,{class:"chs-list",items:s.list,"item-size":28,"key-field":"_id"},{default:y((({item:e})=>[u("label",null,["channel"==e.node_type&&e.id>=1e3?(m(),p("div",{key:0,style:{"margin-left":"1px"},class:R(!i.inputStr&&i.expandKeys.has(e.id)?"switch-open":"switch-close"),onClick:F((t=>s.showFirstChild(e)),["stop","prevent"])},null,10,vd)):w("",!0),"channel"==e.node_type&&e.id>=1e3?h((m(),p("input",{key:1,style:{"margin-left":"3px"},id:e._id,type:"checkbox","onUpdate:modelValue":t=>e.checked=t,"data-indeterminate":e.indeterminate,"click.stop":""},null,8,wd)),[[U,e.checked]]):w("",!0),"channel"==e.node_type&&e.id>=1e3?(m(),p("span",{key:2,class:"chs-node",innerHTML:s.highlightWord(e._id)},null,8,Cd)):"msg"==e.node_type?h((m(),p("div",{key:3,for:e.children,style:{"text-indent":"2em","margin-left":"-15px"},class:"chs-node chs-node-item"},[h(u("input",{id:e._id,type:"checkbox","onUpdate:modelValue":t=>e.checked=t,"data-indeterminate":e.indeterminate,"click.stop":""},null,8,Sd),[[U,e.checked]]),u("span",{class:"",innerHTML:s.highlightWord(e.text)},null,8,Td)],8,kd)),[[d,{content:s.title4node(e),html:!0},void 0,{right:!0}]]):w("",!0)])])),_:1},8,["items"])]),u("div",Dd,[u("div",{class:"chs-btn confirm",onClick:t[2]||(t[2]=(...e)=>s.submit&&s.submit(...e))},"确认"),u("div",{class:"chs-btn cancel",onClick:t[3]||(t[3]=(...e)=>s.clearTable&&s.clearTable(...e))},"重置")]),b(o,{message:i.message},null,8,["message"])])),[[g,()=>e.$emit("cancel")]])}],["__scopeId","data-v-c5da6a65"]]),InputOrSelect:Tn},data:()=>({nodeVal:{},mode:"schedule",cur:-1,linListTable:{cols:[{label:"",width:"2.8em",icon:"add"},{label:"Frame Name",width:"auto"},{label:"Delay (ms)",width:"9em",tooltip:{content:"1-1000ms:周期发送<br/>0:单点发送",html:!0}},{label:"ID",width:"4.5em",tooltip:"DBC导入禁止修改ID"},{label:"Channel",width:"6em"},{label:"DIR",width:"6em"},{label:"DLC",width:"3em"},{label:"",width:"5em"}]},linSigTable:{cols:[{label:"Signal Name",width:"auto"},{label:"Raw",width:"90px"},{label:"Phys",width:"200px"},{label:"Unit",width:"4em"}]},linIsHexMulti:!1,hexs:[],activeTab:0,activeChn:0,activeScheduleIndex:-1,activeTableList:new Map,chooseLinSignalShow:!1,linAddRecordShow:!1,otherFrames:[],cur:-1,isDeploying:!1,isDeployChecked:!0,showScheduleList:!0,scheduleStyleOpt:[{label:"调度表",value:"schedule",disable:"false"},{label:"单帧",value:"single",disable:"false"}],isFilled:!0}),watch:{curFileIdx(e){this.activeTab=e,console.log("this.activeChn",this.activeChn,this.ldfChn)},deployDisable(e){console.log("部署disable",e)},linSendInfo(e){console.log("val111111",e),this.activeLinData=e?.data[this.activeChn]},ldfChn:{handler(e){console.log("newVal07051108",e),this.nodeVal={},this.otherFrames=[],this.scheduleList=[]},deep:!0,immediate:!0},"$props.store.sendRecord.isRecording":{handler(e){e&&this.updateMultiFrame(this.otherFrames.map(((e,t)=>({...e,row:t+1}))),"add")}},"$props.store.sendRecord":{handler(e,t){}},otherFrames:{async handler(e,t){if(console.log("nextFrames1800",e),!this.isSyncFrames){this.isSyncFrames=!0,this.isHexMulti=!1;for(let t=0;t<e.length;t++){this.isDeployChecked=!1;let a=e[t],l=a.channel;console.log("frame07051053",l);let i=a.id;console.log("frame.dirty07041441",a.dirty,a),"raw"===a.dirty?await E.blfLogging.getRawValueToPhysValueLIN({ldfChannel:this.ldfChn[this.activeTab],linId:i,signalsData:a.children.map((e=>({name:e.text,rawValue:e.rawValue})))}).then((e=>{this.otherFrames[t]={...a,rawData:e.data.data.rawData,children:a.children.map((t=>({...t,physValue:e.data.data.signalsData.find((e=>e.name===t.id))?.physValue??t.physValue}))),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.otherFrames[t]}],"modify"),this.isDeploying&&this.getDSServer()})).catch(console.log):"data"===a.dirty?(console.log("this.otherFrames[i]07051410",a),"dbc"===a.from||"sch"===a.from?await E.blfLogging.getDataToValuesLIN({ldfChannel:this.ldfChn[this.activeTab],linId:i,rawData:a.rawData}).then((e=>{console.log("res07110934",e),this.otherFrames[t]={...a,children:a.children.map((t=>({...t,physValue:e.data.data.signalsPhysData.find((e=>e.name===t.id))?.physValue??t.physValue,rawValue:e.data.data.signalsRawData.find((e=>e.name===t.id))?.rawValue??t.rawValue}))),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.otherFrames[t]}],"modify")})).catch(console.log):(this.otherFrames[t]={...a,dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.otherFrames[t]}],"modify")),this.isDeploying&&this.getDSServer()):"phys"===a.dirty?(console.log("frame.children0710",a.children),await E.blfLogging.getPhysValueToRawValueLIN({ldfChannel:this.ldfChn[this.activeTab],linId:i,signalsData:a.children.map((e=>({name:e.text,physValue:parseInt(e.physValue)})))}).then((e=>{this.otherFrames[t]={...a,rawData:e.data.data.rawData,children:a.children.map((t=>({...t,rawValue:e.data.data.signalsData.find((e=>e.name===t.id))?.rawValue??t.rawValue}))),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...this.otherFrames[t]}],"modify"),this.isDeploying&&this.getDSServer()})).catch(console.log)):"dlc"===a.dirty?(this.otherFrames[t]={...a,rawData:Array.from({length:a.dlc},((e,t)=>a.rawData[t]||0)),dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...a}],"modify"),this.isDeploying&&this.getDSServer()):"delay"===a.dirty?(this.otherFrames[t]={...a,isSending:0!=a.delay&&a.isSending,dirty:!1,raw:t+1},this.updateMultiFrame([{row:t+1,...a}],"modify"),this.isDeploying&&this.getDSServer()):a.dirty&&(this.otherFrames[t].dirty=!1,this.updateMultiFrame([{row:t+1,...a}],"modify"),this.isDeploying&&this.getDSServer())}this.isSyncFrames=!1}},deep:!0},cur(e){console.log("cur07041051",e,this.otherFrames[e]),this.isHexMulti=!1,this.hexs=[]}},computed:{scheduleList(){if(console.log("this.nodeVal",Object.keys(this.nodeVal),this.nodeVal,this.linSendInfo,this.ldfChn[this.activeTab]),Object.keys(this.nodeVal).length>0&&""!==this.nodeVal.value){let e={};if("master"===this.nodeVal.parentNode)return this.showScheduleList=!0,e=0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode][this.nodeVal.value]:{},Object.keys(e||{});{this.showScheduleList=!1,e=0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode]:{};let t=Object.keys(e||{});return console.log("99999",t),t.forEach(((e,t)=>{e===this.nodeVal.value&&this.checkedSchedule(t,e)})),t}}},checkedOptions(){return this.otherFrames.filter((e=>"dbc"==e.from))}},mounted(){setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{checkedSchedule(e,t){let a=[];console.log("this.nodeVal.parentNode1749",this.nodeVal.parentNode),a="master"===this.nodeVal.parentNode?0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode][this.nodeVal.value][t]:[]:0!==this.ldfChn[this.activeTab]?this.linSendInfo.data[this.ldfChn[this.activeTab]][this.nodeVal.parentNode][t]:[],this.activeScheduleIndex=e;let l=a.map((e=>({_id:this.nodeVal.parentNode+"_"+e[0]+"_"+this.mode,id:e[1],linId:e[1],text:e[0],name:e[0],dir:e[2],dlc:e[3],delay:e[4],channel:this.ldfChn[1],dirty:"raw",from:"sch",children:e[5].map((e=>{let t;return t={_id:e[0],id:e[0],text:e[0],node_type:"signal",comment:e[1],remark:e[2],linId:e[3],rawValue:e[4],maxRaw:e[5],minRaw:e[6],maxPhys:e[7].toString(),minPhys:e[8].toString(),selectPhys:e[9],unit:e[10],startBit:e[11],length:e[12],physStep:e[13].toString(),dlc:e[14],canType:e[15],periodic:e[16]},t}))})));this.otherFrames=[],this.otherFrames.push(...l),this.activeTableList.set(this.nodeVal.parentNode+"-"+this.nodeVal.value+"-"+this.mode,{phone:"213-555-1234",address:"123 N 1st Ave"})},clickHandler(e){0==this.$refs.root?.contains(e.target)&&(this.linAddRecordShow=!1)},showMessage({level:e,content:t,timeout:a}){clearTimeout(Vd),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Vd=setTimeout((()=>{this.message.visible=!1}),a))},onHexErr(){this.showMessage({timeout:2e3,level:"error",content:"请输入正确格式的16进制"})},addFrame(e){this.linAddRecordShow=!1;let t=[{name:"",delay:20,id:1===e,channel:this.ldfChn[1],canType:e,dir:"tx",dlc:8,isSending:!1,from:e,rawData:[0,0,0,0,0,0,0,0]}],a=this.otherFrames.length-1;this.otherFrames.push(...t),this.updateMultiFrame(t.map(((e,t)=>({...e,row:a+t}))),"add")},updateMultiFrame(e,t){console.log("list07051359",e),this.$props.store.sendRecord.isRecording&&e.map((e=>({...e,channel:this.$props.store.sendRecord.dbc.ldfChn.indexOf(e.channel)+1})))},updateFrame(e){let t=this.otherFrames.slice(),a=[],l=[];for(let i=t.length-1;i>=0;i--){let a=t[i];if("dbc"===a.from){let s=e.findIndex((e=>e.id===a.id));if(~s)e.splice(s,1);else{i===this.cur&&(this.cur=-1);let e=t.splice(i,1);l.unshift({...e,row:i+1})}}}this.updateMultiFrame(l,"delete"),a=e.map(((e,t)=>{let a=e.children[0]||{};return console.log("it2222",a),{...e,name:e.text,from:"dbc",periodic:a.periodic||0,canType:a.canType||"LIN",dlc:a.dlc||64,id:a.msg||0,linId:a.canId||0,dirty:"raw",dir:"tx",delay:10,isSending:!1,children:e.children.map((e=>({...e,name:e.id})))}})),t.push(...a),this.otherFrames=t,console.log("this.frames07040952",this.otherFrames),this.chooseLinSignalShow=!1,this.addRecordShow=!1},async startDeploy(){console.log("部署",this.nodeVal,this.nodeVal.parentNode),this.isDeploying=!0;for(var e=0;e<this.scheduleStyleOpt.length;e++)"single"===this.scheduleStyleOpt[e].value&&(this.scheduleStyleOpt[e].disable="true");this.getDSServer(),console.log("ldfChn11",this.ldfChn,this.otherFrames)},async getDSServer(){await E.blfLogging.getDeployShedule({channelId:2,mode:this.nodeVal.parentNode?this.nodeVal.parentNode:this.isFilled?"master":"slave",LINFrames:this.otherFrames.map((e=>({LINId:e.linId?"0x"+(parseInt(e.linId)||0).toString(16):"0x0",dataLength:e.rawData?e.rawData.length:0,dir:"tx"===e.dir?0:1,delay:e.delay,data:e.rawData})))}).then((e=>{})).catch(console.log)},async endDeploy(){this.isDeploying=!1;for(var e=0;e<this.scheduleStyleOpt.length;e++)"single"===this.scheduleStyleOpt[e].value&&(this.scheduleStyleOpt[e].disable="false");await E.blfLogging.getUnDeployShedule({channelId:2,mode:this.nodeVal.parentNode?this.nodeVal.parentNode:this.isFilled?"master":"slave"}).then((e=>{})).catch(console.log)},async togglePlay(e,t){console.log("raw07162036",e,t),await E.blfLogging.getManualSendLIN({channelId:2,mode:this.nodeVal.parentNode?this.nodeVal.parentNode:this.isFilled?"master":"slave",LINFrames:[{LINId:e.linId?"0x"+(parseInt(e.linId)||0).toString(16):"0x0",dataLength:e.rawData.length,dir:"tx"===e.dir?0:1,delay:e.delay,data:e.rawData}]}).then((e=>{}))},delFrame(e){console.log("idx200322222",e,this.otherFrames),e===this.cur&&(this.cur=-1);let t=this.otherFrames.splice(e,1);this.otherFrames.forEach(((e,t)=>{this.otherFrames[t].raw=t+1})),this.updateMultiFrame([{...t,row:e+1}],"delete")}}},Ld=e=>(C("data-v-ec94f9f4"),e=e(),k(),e),Id={class:"lin-body"},Fd={class:"select-er"},Rd={class:"select-left"},$d=Ld((()=>u("span",{class:"record-header-message"},[u("b",null,"节点：")],-1))),Md={key:0,class:"chs-ft-label pointer"},Ed=["checked"],_d=Ld((()=>u("i",{class:"icon-ques"},null,-1))),Nd={class:"select-right"},Ad=Ld((()=>u("i",{class:"play-icon"},null,-1))),Od=Ld((()=>u("i",{class:"stop-icon"},null,-1))),Pd={class:"lin-list-wrap"},Ud={class:"lin-list-tree-er"},Hd=Ld((()=>u("div",{class:"lin-list-tree-tit"},[u("i",{class:"lin-list-icon"}),u("b",null,"LIN调度表")],-1))),Bd={class:"lin-list-tree-body"},jd=["data-disabled","data-active","onClick"],zd=Ld((()=>u("i",{class:"lin-list-icon-sm"},null,-1))),qd=["title"],Kd={class:"lin-list-er"},Wd={class:"lin-list-table"},Xd={key:1,class:"ic-help"},Gd={key:2,type:"checkbox"},Yd={class:"add-record",ref:"root"},Jd=["data-disabled"],Qd=["data-disabled"],Zd=["onClick","data-active"],er=["data-from","data-cantype","data-valid"],tr=["onUpdate:modelValue","onChange"],ar=["onUpdate:modelValue","onChange"],lr=["value"],ir=["onUpdate:modelValue","onChange"],sr=[Ld((()=>u("option",{value:"tx"},"tx",-1))),Ld((()=>u("option",{value:"rx"},"rx",-1)))],nr=["disabled","onUpdate:modelValue","onChange"],or=["data-disable","data-recording","data-active","onClick"],dr=["data-disable","onClick"],rr={key:0,class:"table-empty"},cr={class:"empty-meark"},hr={class:"btn-import-er"},mr={class:"lin-sig-er"},pr={class:"lin-hex-er"},ur=Ld((()=>u("th",{style:{width:"4em"}}," ",-1))),gr={style:{width:"11.8%"}},br={key:0},fr=["value"],yr={class:"hex-footer"},vr={class:"hex-multi-input"},wr=["data-theme","data-position"],Cr={class:"tab"},kr=["value"],Sr=["data-dirty","onClick"];let Tr=0;const Dr={props:["store","setStore","closeFlag"],emits:["connect","showMessage","getCarCode"],components:{Button:l,Header:a,FrameRecord:Gi,LinRecord:an,ChartRecord:ti,EditModal:Ae,FiveChannelEditModal:qt,TwelveChannelEditModal:va,SendRecord:oo,Message:i,LinSendRecord:ud,LinOtherSendRecord:s(xd,[["render",function(e,t,a,l,i,s){const n=r("v-select"),o=r("ButtonGroup"),d=r("Button"),C=r("EditWrapper"),k=r("InputHex"),S=r("ChooseSignal"),D=r("InputOrSelect"),V=c("tooltip");return m(),p("div",Id,[u("div",Fd,[u("div",Rd,[$d,b(n,{options:a.nodeOpt,clearable:!1,searchable:!1,disabled:i.isDeploying,label:"label",value:"value",modelValue:i.nodeVal,"onUpdate:modelValue":t[0]||(t[0]=e=>i.nodeVal=e),class:"tch-tool-select"},null,8,["options","disabled","modelValue"]),"0"==a.ldfChn[this.activeTab]?h((m(),p("label",Md,[u("input",{class:"chs-node-checkboxAll",type:"checkbox",checked:i.isFilled,onClick:t[1]||(t[1]=t=>e.checkMasterMode())},null,8,Ed),v("主节点模式"),_d])),[[V,"主节点模式"]]):w("",!0)]),u("div",Nd,[b(o,{options:i.scheduleStyleOpt,class:"theme-btn-group",modelValue:i.mode,"onUpdate:modelValue":t[2]||(t[2]=e=>i.mode=e)},null,8,["options","modelValue"]),v("  "),i.isDeploying?(m(),N(d,{key:1,type:"primary",class:"header-import-btn",onClick:s.endDeploy},{default:y((()=>[Od,v("停止 ")])),_:1},8,["onClick"])):(m(),N(d,{key:0,type:"primary",class:"header-import-btn",onClick:s.startDeploy,disabled:i.isDeployChecked||"single"==i.mode||a.deployDisable,progress:"100%"},{default:y((()=>[Ad,v("部署 ")])),_:1},8,["onClick","disabled"]))])]),u("div",Pd,[h(u("div",Ud,[Hd,u("div",Bd,[(m(!0),p(f,null,T(s.scheduleList,((e,t)=>(m(),p("div",{class:"lin-list-tree-item",key:t,"data-disabled":i.isDeploying,"data-active":i.activeScheduleIndex===t,onClick:a=>s.checkedSchedule(t,e)},[zd,u("span",{title:e},g(e),9,qd)],8,jd)))),128))])],512),[[A,i.showScheduleList]]),u("div",Kd,[u("table",Wd,[u("tr",null,[(m(!0),p(f,null,T(i.linListTable.cols,(e=>(m(),p("th",{style:$({width:e.width})},[v(g(e.label)+" ",1),e.icon?(m(),p("i",{key:0,onClick:t[3]||(t[3]=e=>i.linAddRecordShow=!i.linAddRecordShow),class:"lin-ic-add"})):w("",!0),e.tooltip?h((m(),p("i",Xd,null,512)),[[V,e.tooltip]]):w("",!0),e.type?(m(),p("input",Gd)):w("",!0)],4)))),256)),h(u("div",Yd,[u("div",{onClick:t[4]||(t[4]=e=>i.chooseLinSignalShow=!i.chooseLinSignalShow),"data-disabled":0===e.$props.store?.sendRecord?.otherFrames?.length||i.isDeploying},"从DBC中导入帧",8,Jd),u("div",{onClick:t[5]||(t[5]=e=>s.addFrame("LIN")),"data-disabled":0==e.$props.store?.sendRecord?.otherFrames?.length||i.isDeploying},"自定义帧",8,Qd)],512),[[A,i.linAddRecordShow]])]),(m(!0),p(f,null,T(i.otherFrames,((t,a)=>(m(),p("tr",{onClick:e=>i.cur=a,"data-active":i.cur===a},[u("td",null,g(a+1),1),u("td",null,[u("i",{class:"ic-can","data-from":t.from,"data-cantype":t.canType,"data-valid":Object.values(e.$props.store.sendRecord.dbc.ldfChn).includes(t.channel)},null,8,er),v(" "+g(t.name),1)]),u("td",null,[b(C,null,{default:y((()=>[h(u("input",{class:"td-input",type:"number",min:"0",max:"1000","onUpdate:modelValue":e=>t.delay=e,onChange:e=>t.dirty="delay"},null,40,tr),[[I,t.delay,void 0,{lazy:!0}]])])),_:2},1024)]),u("td",null,[b(C,{disabled:"LIN"!==t.from},{default:y((()=>[b(k,{onError:s.onHexErr,min:0,max:2047,disabled:"LIN"!==t.from,class:"td-input",modelValue:t.linId,"onUpdate:modelValue":e=>t.linId=e,onChange:e=>t.dirty="linId"},null,8,["onError","disabled","modelValue","onUpdate:modelValue","onChange"])])),_:2},1032,["disabled"])]),u("td",null,[b(C,{disabled:!0},{default:y((()=>[h(u("select",{disabled:!0,class:"td-input","onUpdate:modelValue":e=>t.channel=e,onChange:e=>t.dirty="channel"},[(m(!0),p(f,null,T(e.$props.store.sendRecord.dbc.ldfChn,((e,t)=>(m(),p("option",{value:e},"LIN2",8,lr)))),256))],40,ar),[[j,t.channel,void 0,{lazy:!0}]])])),_:2},1024)]),u("td",null,[b(C,null,{default:y((()=>[h(u("select",{class:"td-input","onUpdate:modelValue":e=>t.dir=e,onChange:e=>t.dirty="dir"},sr,40,ir),[[j,t.dir]])])),_:2},1024)]),u("td",null,[b(C,{disabled:"LIN"!==t.from},{default:y((()=>[h(u("input",{disabled:"LIN"!==t.from,class:"td-input",type:"number",min:"0",max:"8","onUpdate:modelValue":e=>t.dlc=e,onChange:e=>t.dirty="dlc"},null,40,nr),[[I,t.dlc,void 0,{lazy:!0}]])])),_:2},1032,["disabled"])]),u("td",null,["schedule"!==i.mode?(m(),p("i",{key:0,class:"ic-play","data-disable":Object.values(e.$props.store.sendRecord.dbc.ldfChn).includes(t.channel),"data-recording":e.$props.store.sendRecord.isRecording,"data-active":t.isSending,onClick:e=>s.togglePlay(t,a)},null,8,or)):w("",!0),v("  "),u("i",{class:"ic-del","data-disable":i.isDeploying,onClick:F((e=>s.delFrame(a)),["stop"])},null,8,dr)])],8,Zd)))),256))]),0==i.otherFrames.length?(m(),p("div",rr,[u("div",cr,[v("暂无内容，请先"),u("span",{class:"empty-btn",onClick:t[6]||(t[6]=e=>i.linAddRecordShow=!i.linAddRecordShow)},"导入帧")])])):w("",!0)]),h(u("div",hr,[i.chooseLinSignalShow?(m(),N(S,{key:0,filledOptions:e.$props.store.sendRecord.otherFrames,checkedOptions:s.checkedOptions,onSignalsChange:s.updateFrame,onCancel:t[7]||(t[7]=()=>{i.chooseLinSignalShow=!1})},null,8,["filledOptions","checkedOptions","onSignalsChange"])):w("",!0)],512),[[A,i.chooseLinSignalShow]])]),u("div",mr,[(m(),p("table",{class:"sig-table",key:"sig"+i.cur},[u("tr",null,[(m(!0),p(f,null,T(i.linSigTable.cols,(e=>(m(),p("th",{style:$({width:e.width})},g(e.label),5)))),256))]),""!==i.otherFrames[i.cur]?.name?(m(!0),p(f,{key:0},T(i.otherFrames[i.cur]?.children,(e=>(m(),p("tr",null,[h((m(),p("td",null,[v(g(e.text)+" ",1)])),[[V,{content:`${e.text}<hr/>phys:${e.minPhys} ~ ${e.maxPhys}<br/>raw:${e.minRaw?"0x"+e.minRaw.toString(16):""} ~ ${e.maxRaw?"0x"+e.maxRaw.toString(16):""}<br/>Start Bit:${e.startBit}<br>Length:${e.length}<br>Phys Step:${e.physStep}`,html:!0},void 0,{"top-start":!0}]]),u("td",null,[b(C,null,{default:y((()=>[b(k,{watch:!0,onError:s.onHexErr,min:e.minRaw,max:e.maxRaw,class:"td-input",modelValue:e.rawValue,"onUpdate:modelValue":t=>e.rawValue=t,modelModifiers:{lazy:!0},onChange:t[8]||(t[8]=e=>i.otherFrames[i.cur].dirty="raw")},null,8,["onError","min","max","modelValue","onUpdate:modelValue"])])),_:2},1024)]),u("td",null,[b(C,null,{default:y((()=>[b(D,{watch:!0,min:e.minPhys,max:e.maxPhys,class:"td-input",step:e.physStep,modelValue:e.physValue,"onUpdate:modelValue":t=>e.physValue=t,enum:e.selectPhys?e.selectPhys:"",onChange:t[9]||(t[9]=e=>i.otherFrames[i.cur].dirty="phys")},null,8,["min","max","step","modelValue","onUpdate:modelValue","enum"])])),_:2},1024)]),u("td",null,g(e.unit),1)])))),256)):w("",!0)]))]),u("div",pr,[(m(),p("table",{class:"lin-hex-table",key:"hex"+i.cur},[u("tr",null,[ur,(m(),p(f,null,T([0,1,2,3,4,5,6,7],(e=>u("th",gr,g(e),1))),64))]),i.otherFrames[i.cur]?.rawData?(m(),p(f,{key:0},T([0,8,16,24,32,40,48,56,64],((a,l)=>(m(),p(f,null,[i.otherFrames[i.cur].rawData.length>a?(m(),p("tr",br,[u("td",null,[u("b",null,g(a),1)]),(m(),p(f,null,T(8,(l=>u("td",null,[e.isHexMulti&&a+l-1<i.otherFrames[i.cur].rawData.length?h((m(),p("input",{key:0,type:"checkbox",class:"radio","onUpdate:modelValue":t[10]||(t[10]=e=>i.hexs=e),value:a+l-1},null,8,fr)),[[U,i.hexs]]):w("",!0),a+l-1<i.otherFrames[i.cur].rawData.length?(m(),N(C,{key:1},{default:y((()=>[b(k,{watch:!0,onError:s.onHexErr,min:0,max:255,class:"td-input",style:{width:"calc(100%)","text-indent":"20px"},modelValue:i.otherFrames[i.cur].rawData[a+l-1],"onUpdate:modelValue":e=>i.otherFrames[i.cur].rawData[a+l-1]=e,modelModifiers:{lazy:!0},onChange:t[11]||(t[11]=e=>i.otherFrames[i.cur].dirty="data")},null,8,["onError","modelValue","onUpdate:modelValue"])])),_:2},1024)):w("",!0)]))),64))])):w("",!0)],64)))),64)):w("",!0)])),u("div",yr,[i.linIsHexMulti?(m(),p(f,{key:1},[v(" 批量修改:("+g(i.hexs.length)+"个)  ",1),b(d,{style:{float:"right",height:"23px","margin-left":"8px"},onClick:t[13]||(t[13]=e=>{i.hexs=[],i.linIsHexMulti=!1})},{default:y((()=>[v("退出")])),_:1}),b(d,{style:{float:"right",height:"23px"},type:"primary"},{default:y((()=>[v("修改")])),_:1}),u("div",vr,[b(k,{onError:s.onHexErr,min:0,max:255,modelValue:e.hexMultiValue,"onUpdate:modelValue":t[14]||(t[14]=t=>e.hexMultiValue=t)},null,8,["onError","modelValue"])])],64)):(m(),p("div",{key:0,class:"hex-footer-full-btn",onClick:t[12]||(t[12]=e=>i.linIsHexMulti=!i.linIsHexMulti)},"进入批量修改"))])])])}],["__scopeId","data-v-ec94f9f4"]]),Tabs:s({props:["theme","modelValue","options","position","closeable"],emits:["update:modelValue","close"],data(){return{value:this.$props.modelValue}},watch:{value(e){e!==this.modelValue&&this.$emit("update:modelValue",e)},modelValue(e){this.value=e}},methods:{onWheel(e){let t=0;t=e.deltaY>0||e.deltaX>0?100:-100;const a=this.$refs.rootRef;let l=a.scrollLeft+t;l<0?l=0:l+a.clientWidth>=a.scrollWidth&&(l=a.scrollWidth-a.clientWidth),console.log("nextD",a,l),a.scrollLeft=l}}},[["render",function(e,t,a,l,i,s){return m(),p("div",{class:"tab-er","data-theme":a.theme||"default","data-position":a.position,ref:"rootRef",onWheel:t[1]||(t[1]=(...e)=>s.onWheel&&s.onWheel(...e))},[(m(!0),p(f,null,T(a.options,(l=>(m(),p("label",Cr,[u("span",null,g(l.label),1),h(u("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),value:l.value},null,8,kr),[[z,i.value]]),a.closeable?(m(),p("i",{key:0,class:"ic-close","data-dirty":l.dirty,onClick:t=>e.$emit("close",l.value)},null,8,Sr)):w("",!0)])))),256)),H(e.$slots,"default",{},void 0,!0)],40,wr)}],["__scopeId","data-v-a2a581b5"]])},data:()=>({system:d,isHardwareChecked:!1,expandKeys:new Set,visibleStartIndex:0,visibleEndIndex:0,bottomPadding:0,recordLoading:!1,startTime:0,editModal:{title:"配置",editVisible:!1},mode:"all",dbcVal:"",sliderValue:-1,channelOne:"",channelTwo:"",channelThree:"",channelFour:"",channelFive:"",channelSix:"",channelSeven:"",channelEight:"",channelNine:"",channelTen:"",channelEleven:"",channelTwelve:"",linChannelVal:"",linChannelValTwo:"",filePath:"",comments:["","","","","","","","","","","","","","","",""],message:{visible:!1,level:"",content:""},seconds:0,rowData:[],isRecording:!1,startSqlId:0,endSqlId:0,isLock:!1,isScrollEnd:!0,isAddData:!0,secondConfirm:!1,topLock:!1,bottomLock:!1,openFlag:!1,mlist:[{key:"lookRecord",name:"CAN帧查看",icon:"box"},{key:"supeRecord",name:"图像查看",icon:"setting"},{key:"sendRecord",name:"CAN发送报文",icon:"send"},{key:"linSendRecord",name:"LIN发送报文",icon:"send"},{key:"linRecord",name:"LIN帧查看",icon:"box"}],cur:"lookRecord",recordShow:!1,linRecordShow:!0,colFilterShow:!1,recordChart:"RecordChart",recordTime:"00:00:00",frames:[],timeData:Object.freeze([]),showSignalsList:[],updateSignalData:{},dbcLoading:!1,sendRecordShow:!1,linSendRecordShow:!1,lookRecord:!0,isEditModalLoading:!1,sn:"--",sw:"--",frameType:"canFrame",sdb:"E4U3_1115",dbcChn:[],ldfChn:[],linSendInfo:[],channelValList:[],linChannelValList:[],chartTableData:[],btnActionStyle:"",curFileIdx:0,mainTabs:[],activeTab:0,activeLinData:{},nodeOpt:[],deployDisable:!0,changeDbcLoading:!1}),watch:{mode(e,t){this.topPadding=0,this.$refs.table.scrollToItem(0),this.expandKeys.clear(),this.rowData=[],this.isRecording&&this.resumeScroll()},frames(e){this.$props.setStore("sendRecord",{frames:e})},isRecording(e){this.$props.setStore("sendRecord",{isRecording:e})},curFileIdx(e){this.activeTab=this.ldfChn[e],console.log("newVal",e,this.ldfChn,this.activeTab),0===this.activeTab?(this.nodeOpt=[],console.log("111111")):this.changeTabOption(this.activeTab)}},computed:{quitConfirm(){return!!(this.dbcVal||this.channelOne||this.channelTwo||this.channelThree||this.filePath)}},methods:{chartTableFun(e){},updateTimeData(e){this.$refs.chartRecordRef?.upTimeData(e)},recordTimeChange(e){this.recordTime=e},async colFilterChange(){this.editModal.editVisible=!0,this.changeDbcLoading=!0,await E.blfLogging.checkHardware().then((async e=>{console.log("res111",e),"android"===d?200===e?.data?.code?(this.showMessage({timeout:5e3,level:"success",content:e.data?.msg||"硬件连接成功"}),this.sn=e.data.data.sn,this.sw=e.data.data.version,this.isHardwareChecked=!0,this.isEditModalLoading=!1,this.changeDbcLoading=!1):(this.isHardwareChecked=!1,this.showMessage({timeout:5e3,level:"error",content:e.data?.msg||"硬件连接失败"})):1===e?.data?.code?(this.showMessage({timeout:5e3,level:"success",content:e.data?.msg||"硬件连接成功"}),this.sn=e.data.data.sn,this.sw=e.data.data.sw,this.isHardwareChecked=!0,this.isEditModalLoading=!1,this.changeDbcLoading=!1):(this.isHardwareChecked=!1,this.showMessage({timeout:5e3,level:"error",content:e.data?.msg||"硬件连接失败"}))})).catch((e=>{this.isHardwareChecked=!1,this.showMessage({timeout:5e3,level:"error",content:"硬件连接失败"})})).finally((()=>{this.isEditModalLoading=!1,this.changeDbcLoading=!1}))},async startRecord(){this.updateSignalData=this.$refs.chartRecordRef?.view,this.$refs.chartRecordRef?.updateSignal(this.updateSignalData?.children,"1"),this.$refs.chartRecordRef?.clearTimeData(),this.btnActionStyle="normal",this.$refs.frameRecordRef.startRecord(this.btnActionStyle),this.$refs.linRecordRef.startRecord(),this.isRecording=!0,this.deployDisable=!1,M.report("track","click",{element_name:"开始录制",tip:"1174.18.0.1.33199"})},async startListen(){this.btnActionStyle="listen",this.$refs.frameRecordRef.startRecord(this.btnActionStyle),this.isRecording=!0,this.deployDisable=!1},endRecord(){JSBridge.send({method:"stopDevice"},(e=>{console.log("res",e)})),this.$refs.frameRecordRef.endRecord(),this.isRecording=!1,this.deployDisable=!0,M.report("track","click",{element_name:"停止录制",tip:"1174.18.0.1.33203"})},endListen(){this.$refs.frameRecordRef.endRecord(),this.isRecording=!1,this.deployDisable=!0,M.report("track","click",{element_name:"停止录制",tip:"1174.18.0.1.33203"})},choose(e){this.cur=e,"supeRecord"==e?(this.recordShow=!0,this.sendRecordShow=!0,this.linSendRecordShow=!0,this.lookRecord=!1,this.linRecordShow=!0):"lookRecord"==e?(this.recordShow=!1,this.sendRecordShow=!0,this.linSendRecordShow=!0,this.lookRecord=!0,this.frameType="canFrame",this.linRecordShow=!0):"sendRecord"==e?(this.recordShow=!0,this.lookRecord=!0,this.sendRecordShow=!1,this.linSendRecordShow=!0,this.linRecordShow=!0):"linRecord"==e?(this.linRecordShow=!1,this.recordShow=!0,this.sendRecordShow=!0,this.lookRecord=!0,this.linSendRecordShow=!0,this.frameType="linFrame"):"linSendRecord"==e&&(this.recordShow=!0,this.lookRecord=!0,this.sendRecordShow=!0,this.linSendRecordShow=!1,this.linRecordShow=!0)},updateBocks(e){this.dbcVal=e.dbcVal,this.recordLoading=e.recordLoading,this.isRecording=e.isRecording,this.filePath=e.filePath},openEditDialog(){this.editModal.editVisible=!0,this.openFlag=!1},onCancelSelect(){this.editModal.editVisible=!1},showMessage({level:e,content:t,timeout:a}){clearTimeout(Tr),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Tr=setTimeout((()=>{this.message.visible=!1}),a))},async onSubmitToShow(e,t,a,l){console.log("dbcVal",e,t,a,l),this.dbcVal="自定义模板"===e[0]?this.dbcVal="自定义模板":this.dbcVal=e[0]+"/"+e[1],this.sdb="自定义模板"===this.dbcVal?"默认视图":this.dbcVal.split("/")[1],this.filePath=l,this.filePath="C:/Users/Downloads/";let i=["","","","","","","","","","","","","","","",""],s=["","","","","","","","","","","","","","","",""];this.dbcChn=t.map(((e,t)=>"(不加载)"!==e?(i[t]=e.split("-").pop(),parseInt(e.split("-")[0])):0-(t+1))),console.log("this.dbcChn111",this.dbcChn),this.ldfChn=a.map(((e,t)=>(console.log("item111",e),s[t]=e.split("-").pop(),"(不加载)"!==e?parseInt(e):0))),this.channelValList=t,this.linChannelValList=a,this.mainTabs=[],this.linChannelValList.forEach(((e,t)=>{"(不加载)"!==e?this.mainTabs.push({label:e,value:t,dirty:"tab"}):this.mainTabs.push({label:"LIN"+(t+1),value:t,dirty:"tab"})})),console.log("mainTabs",this.mainTabs,this.linChannelValList,this.linChannelValList.some((e=>"(不加载)"!==e))),this.channelOne=t[0],this.channelTwo=t[1],this.channelThree=t[2],this.linChannelVal=a[0],this.linChannelValTwo=a[1];let n={sdb:this.sdb,carType:"自定义模板"===this.dbcVal?"custom":this.dbcVal.split("/")[0],dbcChn:this.dbcChn,ldfChn:this.ldfChn,files:"自定义模板"===this.dbcVal?i:["","","","","","","","","","","","","","","",""],ldfFiles:"自定义模板"===this.dbcVal?s:["","","","","","","","","","","","","","","",""],comments:this.comments,ldfComments:this.comments};this.$props.setStore("sendRecord",{dbc:n}),this.dbcLoading=!0,this.changeDbcLoading=!0;let o=await E.blfLogging.getDBC(n).finally((()=>{this.dbcLoading=!1,this.changeDbcLoading=!1}));this.frames=o,this.editModal.editVisible=!1},changeTabOption(e){let t=this.linSendInfo?.data[e];if(console.log("allNodeObj",t),0!==Object.keys(t||{}).length){let e=Object.keys(t.master).map((e=>({value:e,label:e+"[主节点]",parentNode:"master"}))),a=Object.keys(t.slaves).map((e=>({value:e,label:e+"[从节点]",parentNode:"slaves"})));this.nodeOpt=[...e,...a]}}},mounted(){M.report("trackPage",{page:"报文录制",tip:"1174.18.0.1.33191"}),E.blfLogging.removeSql()},unmounted(){E.blfLogging.removeSql(),clearInterval(0),clearInterval(0)}},Vr=e=>(C("data-v-547d41a4"),e=e(),k(),e),xr=["data-loading"],Lr={style:{position:"absolute",left:"1em",display:"flex","column-gap":"6px","align-items":"center"}},Ir=Vr((()=>u("i",{class:"lead-icon"},null,-1))),Fr={class:"o-pul-record-btn"},Rr=Vr((()=>u("i",{class:"play-icon"},null,-1))),$r=Vr((()=>u("i",{class:"stop-icon"},null,-1))),Mr={class:"o-pul-record-btn"},Er=Vr((()=>u("i",{class:"play-icon"},null,-1))),_r={key:0,class:"o-pul-record-time"},Nr={key:1,class:"o-pul-record-time"},Ar={style:{display:"flex"}},Or={class:"record-header-message",style:{display:"flex","align-items":"center"}},Pr={class:"record-header-message-imp"},Ur=Vr((()=>u("span",{style:{color:"#D9D9D9","font-size":"16px",margin:"0 10px"}},"|",-1))),Hr={class:"record-header-message",style:{"margin-right":"8px"}},Br={class:"record-header-message-imp"},jr={class:"o-pul-er"},zr={class:"o-menu"},qr={style:{position:"relative"}},Kr=["data-active"],Wr=Vr((()=>u("i",{class:"supe-look-record"},null,-1))),Xr=["data-active"],Gr=Vr((()=>u("i",{class:"supe-record"},null,-1))),Yr=["data-active"],Jr=Vr((()=>u("i",{class:"send-record"},null,-1))),Qr=["data-active"],Zr=Vr((()=>u("i",{class:"send-record"},null,-1))),ec=["data-active"],tc=Vr((()=>u("i",{class:"supe-lin-record"},null,-1))),ac=["data-hidden"],lc=["data-hidden"],ic=["data-hidden"],sc=["data-hidden"],nc=["data-hidden"],oc={key:0,class:"bdy-tabs"},dc=Vr((()=>u("div",{style:{width:"54px",display:"inline-block"}},null,-1)));e("default",s(Dr,[["render",function(e,t,a,l,i,s){const n=r("Button"),o=r("Header"),d=r("FrameRecord"),c=r("LinRecord"),C=r("ChartRecord"),k=r("SendRecord"),S=r("Tabs"),T=r("LinSendRecord"),D=r("LinOtherSendRecord"),V=r("EditModal"),x=r("FiveChannelEditModal"),L=r("TwelveChannelEditModal"),I=r("Message");return m(),p(f,null,[u("div",{class:"record-page-er","data-loading":i.changeDbcLoading},[b(o,{title:"报文录制",quitConfirm:s.quitConfirm,showRight:!1,recentTest:e.$props.store.connectCar.latest,connectStatus:e.$props.store.connectCar.status},{default:y((()=>[u("div",Lr,[b(n,{type:"primary",class:"header-import-btn",disabled:i.isRecording,onClick:s.colFilterChange},{default:y((()=>[Ir,v("连接设备")])),_:1},8,["disabled","onClick"]),u("div",Fr,[i.isRecording?(m(),N(n,{key:1,type:"primary",onClick:s.endRecord,loading:i.recordLoading,progress:"100%"},{default:y((()=>[$r,v("停止")])),_:1},8,["onClick","loading"])):(m(),N(n,{key:0,type:"primary",loading:i.recordLoading,disabled:i.dbcLoading||!i.dbcVal||!i.filePath||!i.isHardwareChecked,progress:"100%",onClick:s.startRecord},{default:y((()=>[Rr,v("监控并录制 ")])),_:1},8,["loading","disabled","onClick"]))]),u("div",Mr,[i.isRecording?w("",!0):(m(),N(n,{key:0,type:"primary",loading:i.recordLoading,disabled:i.dbcLoading||!i.dbcVal||!i.filePath||!i.isHardwareChecked,progress:"100%",onClick:s.startListen},{default:y((()=>[Er,v("仅监控 ")])),_:1},8,["loading","disabled","onClick"]))]),"listen"==i.btnActionStyle?(m(),p("div",_r,"监控时间: "+g(i.recordTime),1)):(m(),p("div",Nr,"录制时间: "+g(i.recordTime),1))]),u("template",Ar,[u("span",Or,[v(" 设备名称： "),u("span",Pr,g(i.sn),1)]),Ur,u("span",Hr,[v(" 版本号："),u("span",Br,g(i.sw),1)])])])),_:1},8,["quitConfirm","recentTest","connectStatus"]),u("div",jr,[u("div",zr,[u("div",qr,[u("div",{class:"o-menu-it","data-active":i.cur==i.mlist[0].key||i.mlist[0].active,onClick:t[0]||(t[0]=e=>s.choose(i.mlist[0].key))},[Wr,v(" "+g(i.mlist[0].name),1)],8,Kr),"mac"!=i.system?(m(),p("div",{key:0,class:"o-menu-it","data-active":i.cur==i.mlist[1].key||i.mlist[1].active,onClick:t[1]||(t[1]=e=>s.choose(i.mlist[1].key))},[Gr,v(" "+g(i.mlist[1].name),1)],8,Xr)):w("",!0),u("div",{class:"o-menu-it","data-active":i.cur==i.mlist[2].key||i.mlist[2].active,onClick:t[2]||(t[2]=e=>s.choose(i.mlist[2].key))},[Jr,v(" "+g(i.mlist[2].name),1)],8,Yr),i.sn.includes("CR3")?(m(),p("div",{key:1,class:"o-menu-it","data-active":i.cur==i.mlist[3].key||i.mlist[3].active,onClick:t[3]||(t[3]=e=>s.choose(i.mlist[3].key))},[Zr,v(" "+g(i.mlist[3].name),1)],8,Qr)):w("",!0),i.sn.includes("CR3")?(m(),p("div",{key:2,class:"o-menu-it","data-active":i.cur==i.mlist[4].key||i.mlist[4].active,onClick:t[4]||(t[4]=e=>s.choose(i.mlist[4].key))},[tc,v(" "+g(i.mlist[4].name),1)],8,ec)):w("",!0)])]),u("div",{class:"rec-body","data-hidden":i.recordShow},[b(d,{onUpdateBock:s.updateBocks,onUpdateTimeData:s.updateTimeData,ref:"frameRecordRef",onChartTableFun:s.chartTableFun,frameType:i.frameType,sn:i.sn,dbcChn:i.dbcChn,ldfChn:i.ldfChn,channelValList:i.channelValList,linChannelValList:i.linChannelValList,channelOne:i.channelOne,channelTwo:i.channelTwo,channelThree:i.channelThree,linChannelVal:i.linChannelVal,linChannelValTwo:i.linChannelValTwo,filePath:i.filePath,onRecordTimeChange:s.recordTimeChange,dbcVal:i.dbcVal,colFilterShow:i.colFilterShow,onStartTimeChange:t[5]||(t[5]=e=>{i.startTime=e}),startTime:i.startTime},null,8,["onUpdateBock","onUpdateTimeData","onChartTableFun","frameType","sn","dbcChn","ldfChn","channelValList","linChannelValList","channelOne","channelTwo","channelThree","linChannelVal","linChannelValTwo","filePath","onRecordTimeChange","dbcVal","colFilterShow","startTime"])],8,ac),i.sn.includes("CR3")?(m(),p("div",{key:0,class:"rec-body","data-hidden":i.linRecordShow},[b(c,{onUpdateBock:s.updateBocks,onUpdateTimeData:s.updateTimeData,ref:"linRecordRef",channelOne:i.channelOne,channelTwo:i.channelTwo,channelThree:i.channelThree,linChannelVal:i.linChannelVal,linChannelValTwo:i.linChannelValTwo,filePath:i.filePath,dbcVal:i.dbcVal,colFilterShow:i.colFilterShow,onStartTimeChange:t[6]||(t[6]=e=>{i.startTime=e}),startTime:i.startTime},null,8,["onUpdateBock","onUpdateTimeData","channelOne","channelTwo","channelThree","linChannelVal","linChannelValTwo","filePath","dbcVal","colFilterShow","startTime"])],8,lc)):w("",!0),"mac"!==i.system?(m(),p("div",{key:1,class:"rec-body","data-hidden":i.lookRecord},[b(C,{ref:"chartRecordRef",sdb:i.sdb,dbcChn:i.dbcChn,ldfChn:i.ldfChn,dbcVal:i.dbcVal,getDbcData:i.frames},null,8,["sdb","dbcChn","ldfChn","dbcVal","getDbcData"])],8,ic)):w("",!0),u("div",{class:"rec-body","data-hidden":i.sendRecordShow},[b(k,{store:e.$props.store,setStore:e.$props.setStore},null,8,["store","setStore"])],8,sc),i.sn.includes("CR3")?(m(),p("div",{key:2,class:"rec-body","data-hidden":i.linSendRecordShow},[i.mainTabs.length>0?(m(),p("div",oc,[b(S,{position:"top",closeable:!1,options:i.mainTabs,modelValue:i.curFileIdx,"onUpdate:modelValue":t[7]||(t[7]=e=>i.curFileIdx=e)},{default:y((()=>[dc])),_:1},8,["options","modelValue"])])):w("",!0),h(b(T,{activeTab:i.activeTab,linSendInfo:i.linSendInfo,nodeOpt:i.nodeOpt,curFileIdx:i.curFileIdx,ldfChn:i.ldfChn,deployDisable:i.deployDisable,store:e.$props.store,setStore:e.$props.setStore},null,8,["activeTab","linSendInfo","nodeOpt","curFileIdx","ldfChn","deployDisable","store","setStore"]),[[A,0===i.curFileIdx]]),h(b(D,{activeTab:i.activeTab,linSendInfo:i.linSendInfo,nodeOpt:i.nodeOpt,curFileIdx:i.curFileIdx,ldfChn:i.ldfChn,deployDisable:i.deployDisable,store:e.$props.store,setStore:e.$props.setStore},null,8,["activeTab","linSendInfo","nodeOpt","curFileIdx","ldfChn","deployDisable","store","setStore"]),[[A,1===i.curFileIdx]])],8,nc)):w("",!0),h(b(V,{loading:i.isEditModalLoading,title:i.editModal.title,onCancel:s.onCancelSelect,onSubmitToShow:s.onSubmitToShow},null,8,["loading","title","onCancel","onSubmitToShow"]),[[A,i.editModal.editVisible&&i.sn.includes("CR2")&&!i.changeDbcLoading]]),h(b(x,{loading:i.isEditModalLoading,title:i.editModal.title,onCancel:s.onCancelSelect,onSubmitFiveToShow:s.onSubmitToShow},null,8,["loading","title","onCancel","onSubmitFiveToShow"]),[[A,i.editModal.editVisible&&i.sn.includes("CR3")&&!i.changeDbcLoading]]),h(b(L,{loading:i.isEditModalLoading,title:i.editModal.title,onCancel:s.onCancelSelect,onSubmitTwelveToShow:s.onSubmitToShow},null,8,["loading","title","onCancel","onSubmitTwelveToShow"]),[[A,i.editModal.editVisible&&i.sn.includes("DR4")&&!i.changeDbcLoading]])])],8,xr),b(I,{message:i.message},null,8,["message"])],64)}],["__scopeId","data-v-547d41a4"]]))}}}));
