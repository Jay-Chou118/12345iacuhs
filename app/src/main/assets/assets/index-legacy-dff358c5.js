System.register(["./Button-legacy-cab470d9.js","./ev-timeplot-legacy-0d4b84bd.js","./Message-legacy-d7b40696.js","./Header-legacy-33add6f4.js","./ImportFileDialog-legacy-9c05b867.js","./index-legacy-f7d28b44.js","./index.es-legacy-6a1a5759.js","./index-legacy-e92e21e0.js","./signal-legacy-1ac1ca13.js","./Spin-legacy-329834b0.js","./index-legacy-f2f11c47.js","./CopyPath-legacy-ab167fcf.js","./time-legacy-9e872c4a.js","./num-legacy-b60967d7.js","./DownloadMessage-legacy-c990a4a7.js","./ButtonGroup-legacy-401d2c97.js","./Cascader-legacy-dbee3d90.js"],(function(e,t){"use strict";var a,i,s,l,n,d,r,o,c,h,p,m,u,g,b,f,y,v,C,w,D,T,k,x,S,_,V,M,F,L,A,B,O,I,j,P,E,N,U,$,z,R,H,W,G,q,J,X,K,Q;return{setters:[e=>{a=e.B},e=>{i=e.A,s=e.W,l=e.P},e=>{n=e.M},e=>{d=e.H},e=>{r=e.I},e=>{o=e.M},e=>{c=e.c},e=>{h=e.q,p=e.S,m=e.u,u=e._,g=e.r,b=e.l,f=e.w,y=e.o,v=e.c,C=e.d,w=e.g,D=e.h,T=e.i,k=e.t,x=e.x,S=e.a,_=e.f,V=e.y,M=e.p,F=e.b,L=e.s,A=e.e,B=e.k,O=e.j,I=e.z,j=e.A,P=e.B,E=e.F,N=e.C,U=e.n,$=e.v,z=e.m},e=>{R=e.t},e=>{H=e.S},e=>{W=e.n},e=>{G=e.b,q=e.s},e=>{J=e.s},e=>{X=e.b},e=>{K=e.D},e=>{Q=e.B},null],execute:function(){let t=[],Y=0;const Z={props:["signals","carType","sdb","fileType","defaultOptions","filledOptions","loading"],emits:["signalsChange","cancel"],components:{Button:a,RecycleScroller:h,Spin:H,Message:n},data(){const e=this.$ls.get("blfread_sdbData")||[];if("custom"===this.carType){let a=e.find((e=>e.sdb===this.sdb))?.comments;a&&(t=["",...a])}else t=p.DEFAULT.find((e=>e.value===this.$props.carType))?.children.find((e=>e.value===this.$props.sdb))?.comments||[];return t=t.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`)),{inputStr:"",treeData:[],checkedList:[],isFilled:!1,message:{visible:!1,level:"",content:""}}},computed:{list(){let e=[];for(let t=0;t<this.treeData.length;t++){let a=this.treeData[t];-1!=a.id&&e.push({_id:a.id,id:a.id,node_type:a.node_type,text:a.text});for(let t=0;t<a.children.length;t++){let i=a.children[t];"-"!=i.id[0]&&e.push({_id:a.id+"-"+i.id,id:i.id,node_type:i.node_type,text:i.text});for(let t=0;t<i.children.length;t++){let s=i.children[t];e.push({...s,_id:a.id+"-"+i.id+"-"+s.id})}}}return e}},watch:{isFilled(e,t){this.dataInit()}},async created(){this.dataInit()},mounted(){this.$refs.chsInputRef.focus(),this.checkedList=this.$props.signals,this.updateChecked(),setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},beforeUnmount(){},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{onFilledChange(e){this.inputStr=e,this.onChange(),console.log("91992",e),this.isFilled=!this.isFilled},title4node:e=>R(e),clickHandler(e){0==this.$refs.root?.contains(e.target)&&this.$emit("cancel")},dataInit(){let e=[],a=this.isFilled?this.$props.filledOptions:this.$props.defaultOptions;for(let i in a){let s={id:+i,text:t[i],node_type:"channel",children:[]};for(let e in a[i]){let t={id:i+"_"+e,text:"-1"==e?"":e,node_type:"msg",channel:s.id,children:a[i][e].map((t=>({id:t[0],msg:"-1"==e?"-1":+e.match(/0x\w+/)?.[0]||e,channel:s.id,text:t[0],node_type:"signal",comment:t[1],remark:t[2]})))};s.children.push(t)}e.push(s)}this.treeData=Object.freeze(e)},selectNode(e){console.log("selectNode",e,this.checkedList);let t=this.checkedList.map((e=>({...e})));t.some((t=>t._id===e._id))?(console.log("s1"),this.checkedList=t.filter((t=>t._id!==e._id))):(console.log("s2"),t.length<30?this.checkedList=[...t.filter((t=>t._id!==e._id)),e]:this.showMessage({level:"error",content:`选择不能超过${t.length}项`,timeout:2e3}))},showMessage({level:e,content:t,timeout:a}){clearTimeout(Y),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(Y=setTimeout((()=>{this.message.visible=!1}),a))},submit(){this.$emit("signalsChange",this.checkedList)},updateChecked(){},highlightWord(e){if(!e)return e;const t=this.inputStr;if(!t)return e;const a=t.split(/\s+/g);var i,s,l=a.length;for(i=0;i<l;i++)try{(s=new RegExp(a[i],"gi")).test(e)&&(e=e.replace(s,"<strong>$&</strong>"))}catch(n){s=a[i],e=e.replace(s,"<strong>$&</strong>")}return e},onChange:m((function(){let e,a=!1,i=this.inputStr.toLowerCase();i.startsWith("0x")&&(a=!0);try{e=new RegExp(i,"i")}catch(n){e={test:e=>~e.toLowerCase().indexOf(e.toLowerCase())}}let s=[],l=this.isFilled?this.$props.filledOptions:this.$props.defaultOptions;for(let d in l){let n={id:+d,text:t[d],node_type:"channel",children:[]};for(let t in l[d]){let s=a&&t.includes(i),r={id:d+"_"+t,text:"-1"==t?"":t,node_type:"msg",channel:n.id,children:l[d][t].filter((t=>s||e.test(t[0])||e.test(t[1]))).map((e=>({id:e[0],msg:"-1"==t?"-1":+t.match(/0x\w+/)[0],channel:n.id,text:e[0],node_type:"signal",comment:e[1],remark:e[2]})))};r.children.length>0&&n.children.push(r)}(n.children.length>0||e.test(n.text)||e.test(n.comment))&&s.push(n)}this.treeData=s,console.log(this.treeData),this.updateChecked()}),500,{leading:!1})}},ee=e=>(M("data-v-29f4f9d0"),e=e(),F(),e),te={class:"chs-er",ref:"root"},ae={class:"chs-list-er"},ie={key:0,class:"chs-node"},se=["innerHTML"],le=["onMousedown","for"],ne=["id","checked"],de=["innerHTML"],re=["innerHTML"],oe={key:0,class:"chs-ft-label pointer"},ce=["checked"],he=ee((()=>C("i",{class:"icon-ques"},null,-1))),pe={key:1,class:"spin-loding-style"},me=ee((()=>C("div",null,null,-1)));let ue=0;const ge={props:["store","closeFlag"],emits:["connect","showMessage","getCarCode"],components:{Button:a,Header:d,ImportFileDialog:r,ManageViewsGroup:o,Draggable:c,ChooseSignal:u(Z,[["render",function(e,t,a,i,s,l){const n=g("RecycleScroller"),d=g("Spin"),r=g("Message"),o=b("tooltip"),c=b("esc");return f((y(),v("div",te,[f(C("input",{class:"chs-input-er",ref:"chsInputRef",placeholder:"搜索信号名称/信号描述","onUpdate:modelValue":t[0]||(t[0]=e=>s.inputStr=e),onInput:t[1]||(t[1]=(...e)=>l.onChange&&l.onChange(...e)),draggable:!1},null,544),[[w,s.inputStr]]),C("div",ae,[D(n,{class:"chs-list",items:l.list,"item-size":28,"key-field":"_id"},{default:T((({item:e})=>["channel"==e.node_type?(y(),v("div",ie,k(e.text),1)):"msg"==e.node_type?(y(),v("div",{key:1,class:"chs-node",style:{"text-indent":"1em"},innerHTML:l.highlightWord(e.text)},null,8,se)):"signal"==e.node_type?f((y(),v("div",{key:2,onMousedown:x((t=>l.selectNode(e)),["prevent","stop"]),for:e._id,style:{"text-indent":"2em"},class:"chs-node chs-node-item"},[C("input",{id:e._id,type:"checkbox",class:"chs-node-checkbox",checked:s.checkedList.some((t=>t._id===e._id))},null,8,ne),C("span",{class:"chs-node-signal",innerHTML:l.highlightWord(e.text)},null,8,de),S(" "),C("span",{class:"chs-node-comment",innerHTML:l.highlightWord(e.comment)},null,8,re)],40,le)),[[o,{content:l.title4node(e),html:!0},void 0,{right:!0}]]):_("",!0)])),_:1},8,["items"]),C("div",{class:V(30==s.checkedList.length?"chs-ft-label-len":"chs-ft-label")},"（"+k(s.checkedList.length)+"/30）",3),"mdf"!=a.fileType?f((y(),v("label",oe,[C("input",{class:"chs-node-checkboxAll",type:"checkbox",checked:s.isFilled,onClick:t[2]||(t[2]=e=>l.onFilledChange(s.inputStr))},null,8,ce),S("有数据"),he])),[[o,"仅显示有数据的信号"]]):_("",!0),C("div",{class:"chs-btn confirm","data-cy":"chooseSignalSubmit",onClick:t[3]||(t[3]=(...e)=>l.submit&&l.submit(...e))},"确定"),C("div",{class:"chs-btn cancel",onClick:t[4]||(t[4]=t=>e.$emit("cancel"))},"取消"),e.$props.loading?(y(),v("div",pe,[me,D(d)])):_("",!0),D(r,{message:s.message},null,8,["message"])])])),[[c,()=>e.$emit("cancel")]])}],["__scopeId","data-v-29f4f9d0"]]),AddOrSelector:i,TimePlotMulti:s,ProgressBar:l,Message:n,DownloadMessage:K,ButtonGroup:Q,Button:a},data(){let e=this.$ls.get("blfread_treeData")?.map((e=>({...e,carType:e.carType||"MS11",sdb:e.sdb||"E4U1",children:e.children.map((t=>({...t,warning:!1,pid:e.id,color:t.color||"blue"})))})));if(e&&0!==e?.length||(e=[]),e=e.filter((e=>!("MS11"===e.carType&&"E4U1"===e.sdb&&"默认视图"===e.text&&0===e.children.length))),!e.some((e=>"MS11"===e.carType&&"E4U1"===e.sdb))){let t=Date.now();e.push({id:t,text:"默认视图",type:"view",editable:!1,carType:"MS11",sdb:"E4U1",deleteConfirm:!1,children:[{id:"PwrModSts",msg:198,channel:3,text:"PwrModSts",node_type:"signal",comment:"PowerMode Status",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::PwrModSts::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-PwrModSts",pid:t,color:"purple"},{id:"VCUActGearLvr",msg:198,channel:3,text:"VCUActGearLvr",node_type:"signal",comment:"Actual gear level 车辆实际档位\\\\nP R N D挡位",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUActGearLvr::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUActGearLvr",pid:t,color:"blue",warning:!1},{id:"VCUAccrPedlRat",msg:198,channel:3,text:"VCUAccrPedlRat",node_type:"signal",comment:"加速油门踏板开度",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUAccrPedlRat::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUAccrPedlRat",pid:t,color:"cerulean",warning:!1},{id:"HvBattSoCAct",msg:449,channel:5,text:"HvBattSoCAct",node_type:"signal",comment:"HV battery SoC actual",remark:"BMS::VCCD/VECU::BMS_PTCANFD_0x1C1::HvBattSoCAct::CANFD signal",checked:!0,_id:"5-5_BMS_PTCANFD_0x1C1(0x1c1)-HvBattSoCAct",pid:t,color:"cyan",warning:!1},{id:"VehSpd",msg:179,channel:3,text:"VehSpd",node_type:"signal",comment:"Vehicle speed",remark:"BCS::ADD/VCCD/BCP/EPS/SCUC/SWM::BCS_ChassisCANFD_0xB3::VehSpd::CANFD signal",checked:!0,_id:"3-3_BCS_ChassisCANFD_0xB3(0xb3)-VehSpd",pid:t,color:"green",warning:!1},{id:"SwtHiBeam",msg:419,channel:3,text:"SwtHiBeam",node_type:"signal",comment:"组合开关远光灯请求命令",remark:"SWM::BCP/BCS/VCCD::SWM_ChassisCANFD_0x1A3::SwtHiBeam::CANFD signal",checked:!0,_id:"3-3_SWM_ChassisCANFD_0x1A3(0x1a3)-SwtHiBeam",pid:t,color:"lime",warning:!1}]})}return this.$ls.set("blfread_treeData",e),{system:L,modeOptions:[{label:"分散",value:"single"},{label:"对齐",value:"same"},{label:"聚合",value:"shifted"}],chartMode:"single",timeFilterOptions:[{label:"绝对时间",value:"absolute"},{label:"相对时间",value:"relative"}],timeFilterMode:{label:"绝对时间",value:"absolute"},startTime:0,showDotsFrame:!1,fileType:"blf",blfcpp:"cpp",isBigFile:!1,chooseSignalAble:!1,downloadMessage:{show:!1,path:""},message:{visible:!1,level:"",content:""},modal:{title:"导入文件",visible:!1},manageModal:{title:"管理视图",manageVisible:!1},treeData:e.map((e=>(e.children.forEach((e=>{e.warning=!1})),e))),curView:{label:e[0]?.text,value:0,tag:e[0]?.sdb},C2C:[],colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],sdb:"E4U3_1115",directory:"",carType:"MS11",directorySize:{label:"",value:0,durationMaybe:0,durationMaybeLabel:"0秒"},backBlock:!1,chartDataLoaded:!0,waitChart:{},fileChoosed:!1,traceList:new Map,timeData:{},tableList:[],channelVersion:[{label:"全部",value:""}],channelVal:"全部",ECUVersion:[{label:"全部",value:""}],ECUVal:"全部",canIdsVersion:[{label:"全部",value:""}],canIdsVal:"全部",filterTableList:[],columnDefs:[{headerName:"Time",field:"timeTabData"},{headerName:"Chn",field:"chnTabData",width:80},{headerName:"ID",field:"idTabData",width:80},{headerName:"Name",field:"nameTabData",width:300},{headerName:"Event Type",field:"eventTabData"},{headerName:"Dir",field:"dirTabData",width:80},{headerName:"DLC",field:"dlcTabData",width:80},{headerName:"文本ECU",field:"dataTabData"}],debug:window._debug,signalLoading:!1,defaultOptions:{},filledOptions:{},exportTypeOptions:[{label:"mdf(*.mdf)",value:"mdf"},{label:"csv(*.csv)",value:"csv"},{label:"blf(*.blf)",value:"blf"},{label:"mat(*.mat)",value:"mat"}],exportTypeValue:"blf"}},computed:{sdbVal(){return[this.carType,this.sdb]},quitConfirm(){return!!this.directory.trim()},treeDataDbc(){return this.treeData.map(((e,t)=>({...e,label:e.text,value:t,tag:e.sdb}))).filter((e=>e.carType===this.carType&&e.sdb===this.sdb))},carTypeLabel(){return this.carType&&"custom"!==this.carType?this.carType+" / ":""},view(){return this.treeData[this.curView.value]},directoryLabel(){let e=this.directory.split("/").pop();return e.length>25?e.slice(0,10)+"..."+e.slice(-15):e},fileType_CarType(){return[this.fileType,this.carType]}},mounted(){this.debug=!!window._debug,this.fillEmptyTreeData(),this.curView=this.treeDataDbc[0],O.report("trackPage",{page:"查看报文",tip:"1174.10.0.1.27765"})},beforeUnmount(){this.timeData={}},unmounted(){A.blf.freeSpace(),A.ascReader.freeSpace(),A.logReader.freeSpace()},watch:{fileType_CarType(){"mdf"===this.fileType?this.blfcpp="cpp":this.debug||("custom"===this.carType?this.blfcpp="python":this.blfcpp="cpp")},blfcpp:{handler(e){window._blfcpp=e},immediate:!0},sdbVal:{handler(e){let t=[];const a=this.$ls.get("blfread_sdbData")||[];if("custom"===this.carType){let e=a.find((e=>e.sdb===this.sdb))?.comments;e&&(t=["",...e])}else t=p.DEFAULT.find((e=>e.value===this.carType))?.children.find((e=>e.value===this.sdb))?.comments||[];this.C2C=t.map(((e,t)=>`${"⓪①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳㉑㉒㉓㉔㉕㉖㉗㉘㉙㉚㉛㉜㉝㉞㉟㊱㊲"[t]}${e}`))},immediate:!0},chartDataLoaded(e,t){e?(this.backBlock=!1,document.querySelector(".o-body").style.cursor=""):(this.backBlock=!0,document.querySelector(".o-body").style.cursor="wait")},treeData:{handler(e,t){JSON.stringify(this.$ls.get("blfread_treeData"))!==JSON.stringify(e)&&this.$ls.set("blfread_treeData",e)},deep:!0},directory:{async handler(e){const t=await B.getFileSize(e);let a=Math.round(.166*(1678e-19*t*t+1.768e-7*t+.5581));e.endsWith("mdf")&&(a=25),this.directorySize={label:G(t),value:t,durationMaybe:1e3*a,durationMaybeLabel:J(a)}}}},methods:{onUpdateDefaultOptions(e){this.defaultOptions=Object.freeze(e)},title4node:e=>R(e),showMessage({level:e,content:t,timeout:a}){clearTimeout(ue),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(ue=setTimeout((()=>{this.message.visible=!1}),a))},hideMessage(){this.message.visible=!1},onTreeDataChange(){this.treeData=this.$ls.get("blfread_treeData")},fillEmptyTreeData(){p.DEFAULT.forEach((e=>{e.children.forEach((t=>{this.treeData.some((a=>a.carType===e.value&&a.sdb===t.value))||this.treeData.push({id:+Math.random().toString().replace(".",""),text:"默认视图",type:"view",editable:!1,carType:e.value,sdb:t.value,deleteConfirm:!1,children:[]})}))}))},deleteView(e){let t=this.treeData.filter((t=>t.id!==e.id));this.curView.value=t.findIndex((e=>e.id===this.view.id)),this.treeData=t},updateView(e){this.treeData=this.treeData.map((t=>t.id===e.id?e:t))},onImportView(e){this.addView(e)},resetTimeData(){this.directory="",this.backBlock=!1,this.chartDataLoaded=!0,this.waitChart={},this.fileChoosed=!1,this.traceList=new Map,this.timeData={}},choosePath(){"blf"===this.fileType?(this.chartDataLoaded=!1,this.clearTimeData(),A.blf.getBLFdata({blfFile:this.directory,mode:this.isBigFile?"bigFile":void 0}).then((async e=>{this.startTime=e.data.startTime,this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let t=this.treeData.slice();t.splice(this.curView.value,1),t.unshift(this.treeData[this.curView.value]),t=t.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),A.blf.haveDataSignal({}).then((e=>{this.filledOptions=Object.freeze(e.data),this.signalLoading=!1}));for(let a=0;a<t.length;a++)await this.play(t[a]),0===a&&(this.chartDataLoaded=!0)})).catch((()=>{})).finally((()=>{this.chartDataLoaded=!0,this.signalLoading=!1}))):"mdf"===this.fileType?(async()=>{this.chartDataLoaded=!1,this.clearTimeData(),this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let e=this.treeData.slice();e.splice(this.curView.value,1),e.unshift(this.treeData[this.curView.value]),e=e.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),await this.play(this.treeData[this.curView.value]),this.signalLoading=!1;for(let t=0;t<e.length;t++)await this.play(e[t]),0===t&&(this.chartDataLoaded=!0)})():"asc"===this.fileType?(this.chartDataLoaded=!1,this.clearTimeData(),A.ascReader.getAscdata({ascFile:this.directory}).then((async e=>{this.startTime=e.data?.data?.startTime||0,this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let t=this.treeData.slice();t.splice(this.curView.value,1),t.unshift(this.treeData[this.curView.value]),t=t.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),A.ascReader.haveDataSignal({ascFile:this.directory}).then((e=>{this.filledOptions=Object.freeze(e.data),this.signalLoading=!1}));for(let a=0;a<t.length;a++)await this.play(t[a]),0===a&&(this.chartDataLoaded=!0)})).catch((()=>{})).finally((()=>{this.chartDataLoaded=!0,this.signalLoading=!1}))):"log"===this.fileType&&(this.chartDataLoaded=!1,this.clearTimeData(),A.logReader.getLogData({logFile:this.directory}).then((async e=>{this.startTime=e.data?.data?.startTime||0,this.fileChoosed=!0,this.treeData.forEach((e=>{this.waitChart[e.id]=!0}));let t=this.treeData.slice();t.splice(this.curView.value,1),t.unshift(this.treeData[this.curView.value]),t=t.filter((e=>e.carType===this.carType&&e.sdb===this.sdb)),A.logReader.haveDataSignal({ascFile:this.directory}).then((e=>{this.filledOptions=Object.freeze(e.data),this.signalLoading=!1}));for(let a=0;a<t.length;a++)await this.play(t[a]),0===a&&(this.chartDataLoaded=!0)})).catch((()=>{})).finally((()=>{this.chartDataLoaded=!0,this.signalLoading=!1})))},clearTimeData(){for(let e in this.timeData)this.timeData[e]=[];this.treeData.forEach((e=>{e.children.forEach((e=>{e.warning=void 0}))}))},hideSignal(e,t){this.waitChart[e.pid]||(e.hidden=!e.hidden,this.play(t,!0))},deleteSignal(e){this.waitChart[e.pid]||(this.treeData=this.treeData.map((t=>{if(t.id==e.pid){let a={...t,children:t.children.filter((t=>!(t.id==e.id&&t.msg==e.msg&&t.channel==e.channel)))};return this.$nextTick((()=>this.play(a,!0))),a}return{...t}})))},async play(e,t){if("python"===this.blfcpp){if(!this.fileChoosed)return;if(t)return void this.loadChart(e,t);let a;if(this.waitChart[e.id]=!0,"blf"===this.fileType)try{a=await A.blf.getAnalysisByParams({params:e.children.map((e=>[e.channel,e.msg,e.text]))})}catch(s){return void(this.waitChart[e.id]=!1)}if("asc"===this.fileType)try{a=await A.ascReader.getAnalysisByParams({params:e.children.map((e=>[e.channel,e.msg,e.text]))})}catch(s){return void(this.waitChart[e.id]=!1)}if("log"===this.fileType)try{a=await A.logReader.getAnalysisByParams(e.children.map((e=>({busId:+e.channel,canId:+e.msg,name:e.text}))))}catch(s){return void(this.waitChart[e.id]=!1)}const i={};for(let e in a.data){const t=a.data[e];let s=!t[6],l=Object.freeze(t[3].map((e=>{if(s)return parseFloat(e[1]);{let t=parseFloat(e[1]),a=new Number(t);return a.valueOf=()=>t,a.toString=()=>"0x"+X(e[1]),a}})));this.traceList.set(t[0]+"_"+t[2],{name:this.C2C[+t[0]]+"-"+t[2],t:Object.freeze(t[3].map((e=>Math.round(1e3*e[0][0])/1e3))),v:l,enums:t[4],cycle:t[5],safe:s}),i[t[0]+"_"+t[2]]=t[3].length}return e.children=e.children.map((e=>{let t=!1;switch(i[e.channel+"_"+e.text]){case 0:t=!0;break;case void 0:t=null}return{...e,warning:t}})),this.loadChart(e),void(this.waitChart[e.id]=!1)}if(!this.fileChoosed)return;if(t)return void this.loadChart(e,t);let a;this.waitChart[e.id]=!0;try{if("mdf"===this.fileType)a=await A.mdf.getAnalysisByParams({signals:e.children.map((e=>({busId:+e.channel,canId:+e.msg,name:e.text})))}),a&&(this.chartDataLoaded=!0);else if("blf"===this.fileType)a=await A.blf.getAnalysisByParams(e.children.map((e=>({busId:+e.channel,canId:+e.msg,name:e.text}))));else if("log"===this.fileType)try{a=await A.logReader.getAnalysisByParams(e.children.map((e=>({busId:+e.channel,canId:+e.msg,name:e.text}))))}catch(s){return void(this.waitChart[e.id]=!1)}else try{a=await A.ascReader.getAnalysisByParams({params:e.children.map((e=>[e.channel,e.msg,e.text]))})}catch(s){return void(this.waitChart[e.id]=!1)}}catch(s){return void(this.waitChart[e.id]=!1)}const i={};if("mdf"===this.fileType)for(let l in a.data.data){const e=a.data.data[l];let t=!e.overLenData,s=Object.freeze(e.values.map((e=>{if(t)return parseFloat(e);{let t=parseFloat(e),a=new Number(t);return a.valueOf=()=>t,a.toString=()=>"0x"+X(e),a}})));this.traceList.set(e.busId+"_"+e.name,{name:null!=this.C2C[+e.busId]?this.C2C[+e.busId]+"-"+e.name:e.name,t:Object.freeze(e.times),v:s,enums:e.enums,cycle:e.cycle}),i[e.busId+"_"+e.name]=e.times.length}else if("blf"===this.fileType)for(let l in a.data){const e=a.data[l];let t=!e.overLenData,s=Object.freeze(e.values.map((e=>{if(t)return parseFloat(e);{let t=parseFloat(e),a=new Number(t);return a.valueOf=()=>t,a.toString=()=>"0x"+X(e),a}})));this.traceList.set(e.busId+"_"+e.name,{name:this.C2C[+e.busId]+"-"+e.name,t:Object.freeze(e.times),v:s,enums:e.enums,cycle:e.cycle}),i[e.busId+"_"+e.name]=e.times.length}else for(let l in a.data){const e=a.data[l];let t=!e[6],s=Object.freeze(e[3].map((e=>{if(t)return parseFloat(e[1]);{let t=parseFloat(e[1]),a=new Number(t);return a.valueOf=()=>t,a.toString=()=>"0x"+X(e[1]),a}})));this.traceList.set(e[0]+"_"+e[2],{name:this.C2C[+e[0]]+"-"+e[2],t:Object.freeze(e[3].map((e=>Math.round(1e3*e[0][0])/1e3))),v:s,enums:e[4],cycle:e[5],safe:t}),i[e[0]+"_"+e[2]]=e[3].length}e.children=e.children.map((e=>{switch(i[e.channel+"_"+e.text]){case 0:e.warning=!0;break;case void 0:e.warning=null;break;default:e.warning=!1}return{...e}})),this.loadChart(e),this.waitChart[e.id]=!1},loadChart(e){const t={blue:"#2266ff",cerulean:"#00c7f2",cyan:"#00e0b8",green:"#3fd926",lime:"#add900",purple:"#8125ff",pink:"#ff4475",red:"#ff3838",orange:"#ffad4d",yellow:"#f1d900"},a=e.children.filter((e=>!e.hidden&&this.traceList.get(e.channel+"_"+e.text)?.t.length>0)).map((e=>{const a=this.traceList.get(e.channel+"_"+e.text);return Object.assign(a,{color:t[e.color]})}));this.timeData[e.id]=a},updateSignal(e){const t=this.view;this.treeData=this.treeData.map((a=>{if(a.id==t.id){let t=e.map(((e,t)=>{let i=a.children.find((t=>e.id==t.id&&e.msg==t.msg&&e.channel==t.channel));return i?{...i,pid:a.id,color:this.colorList[t%9]}:{_id:e._id,pid:a.id,id:e.id,text:e.text,comment:e.comment,remark:e.remark,msg:e.msg,channel:e.channel,type:"signal",color:this.colorList[t%9],colorEditable:!1}}));const i={...a,children:t};return this.play(i),i}return a})),this.chooseSignalAble=!1},goBackHome(){this.$router.push({path:"/"})},importFile(){this.modal.visible=!0},addView(e){let t=e.label||"新建视图"+(this.treeData.length+1);if(this.treeData=[...this.treeData,{id:e.id||Date.now(),text:t,type:"view",editable:!1,deleteConfirm:!1,children:e?.children||[],carType:e?.carType||this.carType,sdb:e?.sdb||this.sdb}],"AddOrSelector"===e?.from){let e=this.treeData.length-1;this.curView={label:this.treeData[e].text,value:e}}},onSwitchView({fromNode:e,toNode:t}){this.view.id===e.id?this.curView.value=this.treeData.findIndex((e=>e.id===t.id)):this.view.id===t.id&&(this.curView.value=this.treeData.findIndex((t=>t.id===e.id))),this.treeData=this.treeData.map((a=>a.id===e.id?t:a.id===t.id?e:a))},manageShow(){this.manageModal.manageVisible=!0},onCancelImportFile(){this.modal.visible=!1},async onCancelSelect(e){this.manageModal.manageVisible=!1;const t=this.treeData.findIndex((t=>t.id===e)),a=this.treeData[t];if(this.curView={label:this.treeData[t].text,value:t,tag:a.sdb},this.carType!==a.carType||this.sdb!==a.sdb){let e=[],t=[];if("custom"===a.carType){const i=(this.$ls.get("blfread_sdbData")||[]).find((e=>e.sdb===a.sdb));e=i.files,t=i.comments}this.onCheckView({curId:a.id,carType:a.carType,sdb:a.sdb,directory:this.directory,files:e,comments:t})}else this.$nextTick((()=>{const e=a,t=e.id;void 0===this.waitChart[t]&&this.directory&&this.play(e)})),"mdf"==this.fileType&&this.play(this.treeData[this.curView.value])},onCheckView(e){this.signalLoading=!0,this.resetTimeData(),this.$nextTick((()=>{this.modal.visible=!1;let t=this.treeData.filter((t=>t.id===e.curId)).map((t=>({label:t.text,value:this.treeData.findIndex((t=>t.id===e.curId))})));this.curView=t[0],this.carType=e.carType,this.sdb=e.sdb,this.directory=W(e.directory),this.files=e.files.length?e.files:void 0,this.comments=e.comments.length?e.comments:void 0,this.fileType=e.fileType,void 0!==e.isBigFile&&(this.isBigFile=e.isBigFile),"mdf"===e.fileType?(this.chartDataLoaded=!1,A.mdf.getSignals({mdfPath:e.directory}).then((e=>{this.defaultOptions=[],this.defaultOptions=Object.freeze(e.data.data)})).then((()=>{this.choosePath()}))):this.$nextTick((async()=>{"custom"===this.carType?"blf"===this.fileType?await A.blf.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):"log"===this.fileType?await A.logReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):await A.ascReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):"blf"===this.fileType?await A.blf.reAdjust(e.sendReAdjust):"log"===this.fileType?("noAdapted"==e.adaptedType&&await A.logReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})),await A.logReader.reAdjust(e.sendReAdjust)):("noAdapted"==e.adaptedType&&await A.ascReader.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})),await A.ascReader.reAdjust(e.sendReAdjust)),this.choosePath()}))})),O.report("track","click",{element_name:"查看报文",asset_name:this.directory+";",tip:"1174.10.0.1.27766"})},onExportArea(e){const t=this.view.children.filter((e=>!1===e.warning)),a=this.timeData[this.view.id];let i="csv",s="CSV文件 (*.csv;*.CSV)";switch(e.type){case"blf":i="blf",s="BLF文件 (*.blf;*.BLF)";break;case"mdf":i="mf4",s="MDF文件 (*.mf4;*.MF4)";break;case"mat":i="mat",s="MAT文件 (*.mat;*.MAT)"}B.choosePath({directory:this.directory.replace(/\/[^\/]+$/,""),saveFilename:this.directory.match(/\/([^\/]+)$/)[1].replace(/.blf|.dat|.mdf|.mf4|.asc|.log/i,`_cut-${e.start}-${e.end}.${i}`),dialogType:"SAVE_DIALOG",fileTypes:[s],allow_multiple:!1}).then((i=>{if(i.data.directory){const s=W(i.data.directory),l=W(this.directory),n=a.map(((a,i)=>{const s=a.t.findIndex((t=>t>=e.start)),l=a.t.length-a.t.slice().reverse().findIndex((t=>t<=e.end));return{busId:t[i].channel,busName:(this.C2C[+t[i].channel]||"").slice(1),canId:t[i].msg,cycle:a.cycle,enums:a.enums,name:t[i].text,times:a.t.slice(s,l),values:a.v.slice(s,l)}}));this.showMessage({level:"loading",content:"导出中..."});let d="";d="mac"==L?s.includes(e.type)?s:s+e.type:s,"log"===this.fileType?A.logReader.exportFile({filePath:l,outputFilePath:d,type:e.type,resampleRate:e.resampleRate,startTime:e.startTime,endTime:e.endTime,data:n}).then((e=>{this.showMessage({level:"success",content:"导出成功",timeout:2e3}),this.downloadMessage.path=d,this.downloadMessage.show=!0})).catch((e=>{this.showMessage({level:"error",content:"导出失败",timeout:2e3})})):A.blf.exportFile({filePath:l,outputFilePath:d,type:e.type,resampleRate:e.resampleRate,startTime:e.startTime,endTime:e.endTime,data:n}).then((e=>{this.showMessage({level:"success",content:"导出成功",timeout:2e3}),this.downloadMessage.path=d,this.downloadMessage.show=!0})).catch((e=>{this.showMessage({level:"error",content:"导出失败",timeout:2e3})}))}}))},onExportDotsData(e){const t=e.map((e=>e.join("\t"))).join("\n");q(t,"tspa-打点-"+I()+".txt")}}},be=e=>(M("data-v-4bcbc335"),e=e(),F(),e),fe={class:"blf-check"},ye=be((()=>C("i",{class:"lead-icon"},null,-1))),ve={key:0},Ce={key:1},we={class:"record-header-message"},De={class:"record-header-message-imp"},Te={class:"record-header-message-imp"},ke={class:"o-pul-er"},xe={key:0,class:"o-column"},Se={class:"o-column-left"},_e=be((()=>C("div",{class:"o-resize-bar"},null,-1))),Ve=be((()=>C("div",{class:"o-resize-line"},null,-1))),Me={class:"o-resize-save"},Fe={class:"o-pul-board"},Le={class:"o-pul-select-wrap"},Ae={class:"o-pul-button-wrap"},Be=[be((()=>C("i",{class:"t-icon chooseSignal"},null,-1))),be((()=>C("span",null,"选择信号",-1)))],Oe=be((()=>C("span",{style:{color:"#D9D9D9","font-size":"18px",transform:"scaleX(0.5)"}},"|",-1))),Ie=[be((()=>C("i",{class:"t-icon manageView"},null,-1))),be((()=>C("span",null,"管理视图",-1)))],je=["data-empty"],Pe=["data-hidden"],Ee=["data-open","onClick"],Ne=["data-color","onClick"],Ue=["onMouseleave"],$e=["title","data-color","onClick"],ze={class:"t-node-text"},Re={key:0,class:"t-node-warning"},He={key:1,class:"t-node-error"},We=["onClick"],Ge=["onClick"],qe=be((()=>C("div",{class:"drag-icon"},null,-1))),Je={class:"o-column-right"},Xe=["data-loading"],Ke={class:"tch-tool-er"},Qe={class:"tch-tool-hotkey-er"},Ye={class:"timechart-hotkey"},Ze={class:"hotkey-more"},et=be((()=>C("div",{class:"hotkey-icon-book"},null,-1))),tt={class:"hotkey-more-body"},at=N('<li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>缩放横轴 <span class="hotkey-btn" data-v-4bcbc335>ctrl+滚轮</span></div></li><li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>平移横轴 <span class="hotkey-btn" data-v-4bcbc335>shift+滚轮</span></div></li><li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>缩放纵轴 <span class="hotkey-btn" data-v-4bcbc335>alt+ctrl+滚轮</span></div></li><li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>平移纵轴 <span class="hotkey-btn" data-v-4bcbc335>alt+shift+滚轮</span></div></li><li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>框选放大 <span class="hotkey-btn" data-v-4bcbc335>左键拖拽</span></div></li><li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>复位轴 <span class="hotkey-btn" data-v-4bcbc335>左键双击</span></div></li><li data-v-4bcbc335><div class="timechart-hotkey-it" data-v-4bcbc335>选择帧 <span class="hotkey-btn" data-v-4bcbc335>左键单击</span></div></li>',7),it={class:"timechart-hotkey-it"},st={class:"hotkey-btn"},lt=be((()=>C("li",null,[C("div",{class:"timechart-hotkey-it"},[S("框选时段 "),C("span",{class:"hotkey-btn"},"shift+左键")])],-1))),nt={class:"tch-tool-blank-er"},dt=be((()=>C("div",{class:"tch-tool-span"},null,-1))),rt=be((()=>C("div",{class:"tch-tool-span"},null,-1))),ot=["id"],ct={key:1,class:"board-spin-er"},ht={class:"board-spin-progress"},pt={class:"board-spin-text"};e("default",u(ge,[["render",function(e,t,a,i,s,l){const n=g("Button"),d=g("Header"),r=g("AddOrSelector"),o=g("ChooseSignal"),c=g("Draggable"),h=g("v-select"),p=g("ButtonGroup"),m=g("TimePlotMulti"),u=g("ProgressBar"),w=g("ImportFileDialog"),V=g("ManageViewsGroup"),M=g("Message"),F=g("DownloadMessage"),L=b("tooltip");return y(),v(E,null,[C("div",fe,[D(d,{title:"查看报文-信号分析",quitConfirm:l.quitConfirm,backBlock:s.backBlock},{default:T((()=>[D(n,{type:"primary",class:"header-import-btn",onClick:l.importFile},{default:T((()=>[ye,S("导入文件")])),_:1},8,["onClick"]),s.debug?(y(),v("label",ve,[f(C("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=e=>s.blfcpp=e),value:"python"},null,512),[[U,s.blfcpp]]),S("python")])):_("",!0),s.debug?(y(),v("label",Ce,[f(C("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=e=>s.blfcpp=e),value:"cpp"},null,512),[[U,s.blfcpp]]),S("cpp")])):_("",!0),C("span",we,[S(" 文件："),C("span",De,k(l.directoryLabel||"--"),1),f(C("span",{style:{color:"#333","text-shadow":"0 0.3px currentColor"}},"（"+k(s.directorySize.label)+"）",513),[[$,s.directorySize.value]]),S("  DBC配置："),C("span",Te,k(l.carTypeLabel)+k(s.sdb||"--"),1)])])),_:1},8,["quitConfirm","backBlock"]),C("div",ke,[l.view?(y(),v("div",xe,[C("div",Se,[_e,Ve,C("div",Me,[C("div",Fe,[C("div",Le,[D(r,{options:l.treeDataDbc,placeholder:"输入视图名称",modelValue:s.curView,"onUpdate:modelValue":t[2]||(t[2]=e=>s.curView=e),onAdd:l.addView},null,8,["options","modelValue","onAdd"])]),C("div",Ae,[C("div",{class:"head-btn",onClick:t[3]||(t[3]=x((()=>s.chooseSignalAble=!s.chooseSignalAble),["prevent","stop"]))},Be),Oe,C("div",{class:"head-btn",id:"delete_module",onClick:t[4]||(t[4]=e=>l.manageShow())},Ie),s.chooseSignalAble?(y(),j(o,{key:0,defaultOptions:s.defaultOptions,filledOptions:s.filledOptions,signals:l.view.children,onSignalsChange:l.updateSignal,loading:s.signalLoading,carType:s.carType,fileType:s.fileType,sdb:s.sdb,onCancel:t[5]||(t[5]=()=>s.chooseSignalAble=!1)},null,8,["defaultOptions","filledOptions","signals","onSignalsChange","loading","carType","fileType","sdb"])):_("",!0)]),C("div",{class:"o-pul-tree-er","data-empty":0===l.view.children.length},[l.view?(y(),j(c,{key:0,onDrag:t[6]||(t[6]=x((()=>{}),["stop"])),onDragstart:t[7]||(t[7]=x((()=>{}),["stop"])),maxLevel:1,class:"t-list",modelValue:l.view.children,"onUpdate:modelValue":t[8]||(t[8]=e=>l.view.children=e),onAfterDrop:t[9]||(t[9]=e=>l.play(l.view,!0))},{default:T((({node:e,stat:t})=>[C("div",{class:"t-node","data-type":"signal","data-hidden":e.hidden},[C("i",{class:"t-node-exp","data-open":t.open,onClick:e=>t.open=!t.open},null,8,Ee),S(),f((y(),v("i",{class:"t-node-icon","data-color":e.color,onClick:x((t=>e.colorEditable=!0),["stop","prevent"])},[f(C("div",{class:"color-picker",onMouseleave:t=>e.colorEditable=!1},[(y(!0),v(E,null,z(s.colorList,(t=>(y(),v("div",{class:"color-item",title:t,"data-color":t,key:t,onClick:a=>{e.color=t,l.play(l.view,!0)}},null,8,$e)))),128))],40,Ue),[[$,e.colorEditable]])],8,Ne)),[[L,"更改颜色"]]),f((y(),v("span",ze,[C("span",null,k("mdf"!==s.fileType?s.C2C[e.channel]+"-":"")+k(e.text),1),!0===e.warning?f((y(),v("div",Re,null,512)),[[L,"信号无数据"]]):_("",!0),e.hidden||null!==e.warning?_("",!0):f((y(),v("div",He,null,512)),[[L,"文件内无此信号"]])])),[[L,{content:l.title4node(e),html:!0},void 0,{right:!0}]]),f(C("div",{class:"t-node-delete",onClick:t=>l.deleteSignal(e)},null,8,We),[[L,"删除"]]),f(C("div",{class:"t-node-watch",onClick:t=>{l.hideSignal(e,l.view)}},null,8,Ge),[[L,"显示|隐藏"]])],8,Pe)])),_:1},8,["modelValue"])):_("",!0)],8,je)])]),qe]),C("div",Je,[C("div",{class:"timechart-er","data-loading":s.waitChart[l.view.id]},[C("div",Ke,[C("div",Qe,[C("div",Ye,[C("div",Ze,[et,S("快捷键 "),C("div",tt,[C("ul",null,[at,C("li",null,[C("div",it,[S("打点 "),C("span",st,k("mac"===s.system?"option":"alt")+"+左键",1)])]),lt])])])])]),C("div",nt,[f((y(),j(n,{class:"tch-tool-btn",onClick:t[10]||(t[10]=e=>s.showDotsFrame=!s.showDotsFrame)},{default:T((()=>[S("打点")])),_:1})),[[L,"alt+左键"]]),dt,f(D(h,{options:s.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:s.timeFilterMode,"onUpdate:modelValue":t[11]||(t[11]=e=>s.timeFilterMode=e),class:"tch-tool-select"},null,8,["options","modelValue"]),[[L,"时间显示"]]),rt,D(p,{options:s.modeOptions,modelValue:s.chartMode,"onUpdate:modelValue":t[12]||(t[12]=e=>s.chartMode=e)},null,8,["options","modelValue"])])]),(y(),v("div",{id:"timechart_"+l.view.id,style:P(`width: 100%; height: calc(100% - 50px);min-height: ${"single"===s.chartMode?50*(s.timeData[l.view.id]?.length||0)+1:1}px;`),key:l.view.id},[s.timeData[l.view.id]?.length>0?(y(),j(m,{key:0,"data-cy":"timePlotMulti",fileType:s.fileType,exportTypeValue:s.exportTypeValue,exportTypeOptions:s.exportTypeOptions,timeData:s.timeData[l.view.id],onExportAreaData:l.onExportArea,mode:s.chartMode,startTime:s.startTime,timeFilter:s.timeFilterMode.value,showDotsFrame:s.showDotsFrame,"onUpdate:showDotsFrame":t[13]||(t[13]=e=>s.showDotsFrame=e)},null,8,["fileType","exportTypeValue","exportTypeOptions","timeData","onExportAreaData","mode","startTime","timeFilter","showDotsFrame"])):_("",!0)],12,ot))],8,Xe)])])):_("",!0),s.chartDataLoaded?_("",!0):(y(),v("div",ct,[C("div",ht,[s.directorySize.durationMaybe?(y(),j(u,{key:0,second:s.directorySize.durationMaybe},null,8,["second"])):_("",!0)]),C("div",pt,"正在解析文件 "+k(l.directoryLabel)+"（"+k(s.directorySize.label)+"），约"+k(s.directorySize.durationMaybeLabel)+"…",1)]))]),s.modal.visible?(y(),j(w,{key:0,curViewInx:s.curView.value,from:"reader",title:s.modal.title,onCancel:l.onCancelImportFile,onImportFileSubmit:l.onCheckView,hisDirectory:s.directory,carType:s.carType,sdb:s.sdb,onTreeDataChange:l.onTreeDataChange,onUpdateDefaultOptions:l.onUpdateDefaultOptions},null,8,["curViewInx","title","onCancel","onImportFileSubmit","hisDirectory","carType","sdb","onTreeDataChange","onUpdateDefaultOptions"])):_("",!0),s.manageModal.manageVisible?(y(),j(V,{key:1,fileType:s.fileType,propTreeData:s.treeData,curViewInx:s.curView.value,title:s.manageModal.title,onCancel:l.onCancelSelect,onDelete:l.deleteView,onUpdate:l.updateView,onImport:l.onImportView,onAdd:l.addView,onSwitch:l.onSwitchView},null,8,["fileType","propTreeData","curViewInx","title","onCancel","onDelete","onUpdate","onImport","onAdd","onSwitch"])):_("",!0)]),D(M,{message:s.message},null,8,["message"]),s.downloadMessage.show?(y(),j(F,{key:0,path:s.downloadMessage.path,onClose:t[14]||(t[14]=e=>s.downloadMessage.show=!1)},null,8,["path"])):_("",!0)],64)}],["__scopeId","data-v-4bcbc335"]]))}}}));
