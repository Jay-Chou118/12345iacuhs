import{B as U}from"./Button-043fad64.js";import{_ as B,r as k,l as $,w as A,o as p,c as m,d as s,g as q,h as b,i as x,a as w,x as g,B as K,p as H,b as R,F as S,m as L,K as z,y as M,S as I,t as D,A as F,f as T}from"./index-59e66c9b.js";import{M as G}from"./Message-4c5abb6c.js";import{s as P}from"./CopyPath-b35d3a81.js";import{C as X}from"./Cascader-57d959d1.js";const Y={components:{Button:U},emits:["cancel"],props:["cardIndex","cardName"],data(){return{titleName:this.$props.cardName}},methods:{reSet(){this.renameStr=""}}},Z=e=>(H("data-v-059d0938"),e=e(),R(),e),O={class:"tool-picker-contianer-wrap"},j=Z(()=>s("div",{class:"tool-picker-arrow"},null,-1)),ee={class:"tool-picker-footer-wrap"},te={class:"o-dialog-footer"};function se(e,t,r,d,i,o){const c=k("Button"),y=$("esc");return A((p(),m("div",{class:"tool-picker-wrap",style:K("--cardIndex:"+e.$props.cardIndex),onClick:t[3]||(t[3]=g(()=>{},["stop"]))},[s("div",O,[A(s("input",{class:"o-table-remark chs-input-er",placeholder:"编辑视图名称","onUpdate:modelValue":t[0]||(t[0]=h=>i.titleName=h),maxlength:"20"},null,512),[[q,i.titleName]])]),j,s("div",ee,[s("div",te,[b(c,{style:{width:"30px"},onClick:t[1]||(t[1]=g(h=>e.$emit("cancel"),["stop"]))},{default:x(()=>[w("取消")]),_:1}),b(c,{type:"primary",style:{width:"30px",margin:"0 20px 0 10px"},onClick:t[2]||(t[2]=g(h=>e.$emit("ok",i.titleName),["stop"]))},{default:x(()=>[w("确定")]),_:1})])])],4)),[[y,()=>e.$emit("cancel")]])}const ie=B(Y,[["render",se],["__scopeId","data-v-059d0938"]]);const oe={emits:["cancel"],components:{Button:U},props:["cardIndex","cardName","cardId"],data(){return{titleName:this.$props.cardName,titleId:this.$props.cardId}},methods:{reSet(){this.renameStr=""}},mounted(){console.log("删除提示",this.$props)}},W=e=>(H("data-v-08841c08"),e=e(),R(),e),ae=W(()=>s("div",{class:"tool-picker-contianer-wrap"},[s("i",{class:"i-warning"}),s("span",null,"确认要删除视图吗")],-1)),re=W(()=>s("div",{class:"tool-picker-arrow"},null,-1)),le={class:"tool-picker-footer-wrap"},de={class:"o-dialog-footer"};function ne(e,t,r,d,i,o){const c=k("Button"),y=$("esc");return A((p(),m("div",{class:"tool-picker-wrap",style:K("--cardIndex:"+e.$props.cardIndex),onClick:t[2]||(t[2]=g(()=>{},["stop"]))},[ae,re,s("div",le,[s("div",de,[b(c,{style:{width:"30px"},onClick:t[0]||(t[0]=g(h=>e.$emit("cancel"),["stop"]))},{default:x(()=>[w("取消")]),_:1}),b(c,{type:"primary",style:{width:"30px",margin:"0 20px 0 10px"},onClick:t[1]||(t[1]=g(h=>e.$emit("ok",i.titleId),["stop"]))},{default:x(()=>[w("确定")]),_:1})])])],4)),[[y,()=>e.$emit("cancel")]])}const ce=B(oe,[["render",ne],["__scopeId","data-v-08841c08"]]);/**
 * @description  draggable polyfill
 * @author       XboxYan
 * @email        yanwenbin1991@live.com
 * @github       https://github.com/XboxYan/draggable-polyfill
 * @license      MIT
 */(function(){if("setDragImage"in window.DataTransfer.prototype&&document.body.animate){var e=null,t=0,r=0,d=0,i=0,o=null,c=null,y,h,V=new Image;V.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAQSURBVHgBAQUA+v8AAAAAAAAFAAFkeJU4AAAAAElFTkSuQmCC";var C=document.createElement("style");C.textContent="[dragging]{position:static!important;box-sizing:border-box!important;margin:0!important;}        .drag-obj{position:fixed;left:0;top:0;z-index:999;pointer-events:none;}",document.querySelector("head").appendChild(C),document.addEventListener("dragstart",function(l){if(l.target.nodeType===Node.ELEMENT_NODE){o=l.target,o.dragData={},y=o.getAttribute("axis"),h=y,l.dataTransfer.setData("text",""),l.dataTransfer.setDragImage(V,0,0);var n=o.getBoundingClientRect(),v=n.left,a=n.top;d=l.clientX,i=l.clientY,t=d-v,r=i-a,o.style.transition="none",e=document.createElement("DIV");var u=o.cloneNode(!0);u.style.width=o.offsetWidth+"px",u.style.height=o.offsetHeight+"px",u.style.transform="translate3d(0,0,0)",u.setAttribute("dragging",""),e.appendChild(u),e.className="drag-obj",e.style="transform:translate3d( "+v+"px ,"+a+"px,0);",document.body.appendChild(e)}}),document.addEventListener("dragend",function(l){if(e){var n=l.target.getBoundingClientRect(),v=n.left,a=n.top,u=e.animate([{transform:e.style.transform},{transform:"translate3d("+v+"px,"+a+"px,0)"}],{duration:150,easing:"ease-in-out"});u.onfinish=function(){document.body.removeChild(e),e=null,o.dragData=null,o.style.visibility="visible"}}}),document.addEventListener("drop",function(l){const n=l.target.closest("[allowdrop]");l.preventDefault(),n&&(l.stopPropagation(),n.removeAttribute("over"))}),document.addEventListener("dragenter",function(l){c&&c.toggleAttribute("over",!1);const n=l.target.closest("[allowdrop]");n&&(n.toggleAttribute("over",!0),c=n)}),document.addEventListener("dragover",function(l){if(l.preventDefault(),l.target.closest("[allowdrop]")?l.dataTransfer.dropEffect="copy":l.dataTransfer.dropEffect="move",e){o.style.visibility="hidden";var v=~~(l.clientX-t),a=~~(l.clientY-r);l.shiftKey||y?h==="X"?a=~~(i-r):h==="Y"?v=~~(d-t):h=~~Math.abs(l.clientX-d)>~~Math.abs(l.clientY-i)&&"X"||~~Math.abs(l.clientX-d)<~~Math.abs(l.clientY-i)&&"Y"||"":h="",d=v+t,i=a+r,e.style.transform="translate3d( "+v+"px ,"+a+"px,0)",o.dragData.left=v,o.dragData.top=a}})}})();const pe={props:["modelValue","wrapClass","keyName"],emits:["update:modelValue","switch"],data(){return{fromNode:null,toNode:null,curElement:null}},methods:{onDragStart(e){this.$props.keyName&&(this.curKey=""+e[this.$props.keyName],this.fromNode=e)},onDrop(e){let t=e.target.dataset.key;this.toNode=this.$props.modelValue.find(r=>r[this.$props.keyName]==t),t&&this.$emit("switch",{fromNode:this.fromNode,toNode:this.toNode}),this.fromNode=null,this.toNode=null}}};function ue(e,t,r,d,i,o){return p(),m("div",{class:M(e.$props.wrapClass),onDrop:t[0]||(t[0]=(...c)=>o.onDrop&&o.onDrop(...c))},[(p(!0),m(S,null,L(e.$props.modelValue,(c,y)=>z(e.$slots,"default",{index:y,node:c,onDragStart:o.onDragStart,fromNode:i.fromNode})),256)),z(e.$slots,"footer")],34)}const me=B(pe,[["render",ue]]);let J,Q=0;const he={props:["manageShow","title","curViewInx","propTreeData","fileType"],emits:["cancel","import","add","delete","update","switch","showMessage"],components:{EditViewName:ie,DeleteName:ce,Button:U,Cascader:X,DraggableCard:me,Message:G},data(){let e=this.$ls.get("blfread_sdbData")||[];return{editIndex:-1,delIndex:-1,copyIndex:-1,curIndex:-1,treeData:this.$props.propTreeData,curId:-1,curCarVersion:"Modena/E3U1",sdbCustom:e,treeExpendData:[...I.DEFAULT.map((t,r)=>({carType:I.DEFAULT[r].value,children:t.children.map((d,i)=>({sdb:d.value}))})),{carType:"custom",children:e.map(t=>({sdb:t.sdb}))}],carType:I.DEFAULT[0].value,sdb:I.DEFAULT[0].children[0].value,dbcValue:[I.DEFAULT[0].value,I.DEFAULT[0].children[0].value],copyAppointVerFlag:!1,colorList:["blue","cerulean","cyan","green","lime","purple","pink","red","orange","yellow"],sdbNew:"",message:{visible:!1,level:"",content:""}}},watch:{propTreeData:{handler(e){console.log("propTreeData",e),this.treeData=JSON.parse(JSON.stringify(e))},deep:!0,immediate:!0},curViewInx:{handler(e,t){this.$nextTick(()=>{if(this.treeData[e]){let r=this.cardView.find(d=>d.id===this.treeData[e].id);r&&(this.curId=r.id)}})},deep:!0}},computed:{cardView(){return this.treeData.filter(t=>t.carType===this.carType&&t.sdb===this.sdb).map(t=>({...t,content:t.children.map(r=>r.text).join(", ")}))},cardViewHash(){return document.body.querySelectorAll(".drag-obj").forEach(e=>{e.parentNode.removeChild(e)}),this.cardView.map(e=>e.id).join()},dbcVerOpts(){return[...I.DEFAULT,{label:"自定义模板",value:"自定义模板",children:this.sdbCustom.length>0?this.sdbCustom.map(t=>({label:t.sdb,value:t.sdb,files:t.files,comments:t.comments})):null}]},dbcVal(){return[this.carType,this.sdb]}},mounted(){this.curIndex=this.$props.curViewInx;let e=this.treeData[this.curIndex];this.sdb=e.sdb,this.sdbNew=this.sdb,this.carType=e.carType,this.curId=e.id,this.showSdbVer(),console.log("cardView",this.cardView)},methods:{clickWrapHandler(e){document.querySelector(".o-dialog-card ."+(e.target.className||"a"))||(this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1)},showSdbVer(){document.querySelectorAll("details").forEach(t=>{t.addEventListener("toggle",r=>{console.log("1707",r)})})},exportHandler(e){var d;let t=this.cardView[e],r=t.text+"\n"+((d=t.children)==null?void 0:d.map(i=>"- "+[i.channel,i.msg,i.text,(i.comment||"").replace(/\n/g," "),i.remark].join("|")).join("\n"));P(r,"tspa-"+(t.text||"视图")+".txt")},importHandler(e){var r;let t=(r=e.target.files)==null?void 0:r[0];if(console.log(t),t){const d=new FileReader;d.readAsText(t,"utf-8"),d.onload=i=>{let o=Date.now(),c={id:o,label:"",children:[],carType:this.carType,sdb:this.sdb};i.target.result.replace(/\r\n/g,"\n").replace(/\n([^-])/g," $1").split("\n").forEach((h,V)=>{if(V===0)c.label=h;else{let[C,l,n,v,a]=h.replace(/^- /,"").split("|");c.children.push({pid:o,channel:+C,msg:+l,id:n,text:n,comment:v,remark:a,color:this.colorList[V%9]})}}),console.log("import",c),this.$emit("import",c)},e.target.value=""}},addView(){this.$emit("add",{carType:this.carType,sdb:this.sdb})},editEditView(e){this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1,this.editIndex=e},clickCancel(){this.editIndex=-1},clickRename(e){let t=this.treeData.find(r=>r.id===this.cardView[this.editIndex].id);t.text=e,this.$emit("update",t),this.editIndex=-1},copyView(e){this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1,this.copyIndex=e},copyCurVer(e,t,r){let d=JSON.parse(JSON.stringify(e));d.text=(d.text+"-复制").slice(-20),d.id=Date.now(),d.children.forEach(i=>i.pid=d.id),d.carType=t,d.sdb=r,this.$emit("add",d),this.copyIndex=-1,this.copyAppointVerFlag=!1},copyAppointVer(){this.copyAppointVerFlag=!0},deleteView(e){this.delIndex=-1,this.copyIndex=-1,this.editIndex=-1,this.delIndex=e},clickCancelDelete(){this.delIndex=-1},clickDelete(){this.$emit("delete",this.cardView[this.delIndex]),this.delIndex=-1},showMessage({level:e,content:t,timeout:r}){clearTimeout(Q),e!=null&&(this.message.level=e),t!=null&&(this.message.content=t),this.message.visible=!0,r>0&&(Q=setTimeout(()=>{this.message.visible=!1},r))},checkView(e){this.sdbNew==e.sdb?(this.$emit("cancel",e.id),console.log("双击")):this.showMessage({level:"error",content:"禁止跨区切换视图",timeout:2e3})},chooseVer(e,t){this.carType=e,this.sdb=t},dragenter(e){J=e.target,console.log("dragenterFn",J)}}},_=e=>(H("data-v-3b624670"),e=e(),R(),e),ge={class:"o-dialog-wrap"},_e={class:"o-dialog-header-wrap"},ve={class:"o-dialog-title"},ye={class:"o-dialog-container-wrap"},fe={class:"o-dialog-tree-wrap"},we=_(()=>s("i",{class:"i-car"},null,-1)),ke=["onClick"],Ae=_(()=>s("i",{class:"i-list"},null,-1)),be={class:"o-dialog-modal-wrap"},xe={class:"cur-version-tit"},Ve=["data-key","data-dragging","data-dragactive","data-active","onDragstart","onDblclick"],Ce={class:"o-dialog-card-header"},Ie={class:"o-card-left"},De={class:"o-dialog-card-tit"},Ne=["onClick"],Te={class:"o-card-right"},Ee=["onClick"],Se=["onClick"],$e={key:0,class:"copy-picker-wrap"},Be=_(()=>s("div",{class:"tool-picker-arrow"},null,-1)),Fe=["onClick"],Le=["onClick"],Me={class:"o-modal-card-container"},Ue={key:0,class:"o-card-footer-wrap"},He=_(()=>s("div",{class:"o-cur-card-footer"},[s("i",{class:"i-cur-checkview"}),s("span",null,"当前视图")],-1)),Re=[He],ze=["onClick"],Je=_(()=>s("i",{class:"i-checkview"},null,-1)),Qe=_(()=>s("span",null,"切换视图",-1)),Ke=[Je,Qe],We={class:"o-add-card"},qe=_(()=>s("i",{class:"i-add-view"},null,-1)),Ge=_(()=>s("span",null,"新建视图",-1)),Pe=[qe,Ge],Xe=_(()=>s("span",{style:{"font-size":"0",height:"21px",width:"1px",display:"inline-block",background:"#bbb"}},null,-1)),Ye={class:"o-add-card-right"},Ze=_(()=>s("i",{class:"i-import-view"},null,-1)),Oe=_(()=>s("span",null,"导入视图",-1)),je={key:0,class:"o-modal-wrap"},et={class:"o-modal-header"},tt={class:"o-modal-header-wrap"},st=_(()=>s("div",{class:"o-dialog-title"},"复制视图到指定版本",-1)),it={class:"o-modal-container"},ot=_(()=>s("span",{style:{color:"red"}},"* ",-1)),at=_(()=>s("span",{class:"record-header-message"},"DBC 版本：",-1)),rt={class:"o-che-input"},lt={class:"o-modal-footer"},dt={class:"o-modal-footer-wrap"};function nt(e,t,r,d,i,o){const c=k("EditViewName"),y=k("DeleteName"),h=k("DraggableCard"),V=k("Cascader"),C=k("Button"),l=k("Message"),n=$("tooltip"),v=$("esc");return p(),m(S,null,[A((p(),m("div",{class:"o-manage-dialog",onClick:t[9]||(t[9]=(...a)=>o.clickWrapHandler&&o.clickWrapHandler(...a))},[s("div",ge,[s("div",_e,[s("div",ve,D(e.$props.title),1),s("i",{class:"o-dialog-title-close",onClick:t[0]||(t[0]=a=>e.$emit("cancel",i.curId))})]),s("div",ye,[s("div",fe,[(p(!0),m(S,null,L(i.treeExpendData,(a,u)=>(p(),m("details",{key:u,open:""},[s("summary",null,[we,w(D(a.carType==="custom"?"自定义模板":a.carType),1)]),(p(!0),m(S,null,L(a.children,(E,N)=>(p(),m("div",{class:"list-wrap",key:N},[s("div",{class:M(a.carType===this.carType&&E.sdb===this.sdb?"list-item-active":"list-item"),onClick:f=>o.chooseVer(a.carType,E.sdb)},[Ae,w(D(E.sdb),1)],10,ke)]))),128))]))),128))]),s("div",be,[s("div",xe,[w(" 当前配置: "),s("span",null,D(i.carType==="custom"?"自定义模板":i.carType)+"/"+D(i.sdb),1)]),(p(),F(h,{modelValue:o.cardView,key:o.cardViewHash,wrapClass:"o-dialog-card-wrap",keyName:"id",onSwitch:t[8]||(t[8]=a=>e.$emit("switch",a))},{default:x(({node:a,index:u,onDragStart:E,fromNode:N})=>[s("div",{class:"o-dialog-card",draggable:"true","data-key":a.id,"data-dragging":!!N,"data-dragactive":(N==null?void 0:N.id)===a.id,"data-active":i.curId===a.id,onDragstart:f=>E(a),onDblclick:f=>this.sdbNew==a.sdb&&i.curId!==a.id&&o.checkView(a)},[s("div",Ce,[s("div",Ie,[s("span",De,D(a.text),1),A((p(),m("i",{class:"i-edit",onDblclick:t[1]||(t[1]=g(()=>{},["stop"])),onClick:g(f=>o.editEditView(u),["stop"])},[i.editIndex===u?(p(),F(c,{key:0,onOk:o.clickRename,onCancel:o.clickCancel,cardName:a.text},null,8,["onOk","onCancel","cardName"])):T("",!0)],40,Ne)),[[n,"修改名称"]])]),s("div",Te,[A(s("i",{class:"i-export",onClick:g(f=>o.exportHandler(u),["stop"])},null,8,Ee),[[n,"导出"]]),A((p(),m("i",{class:"i-copy",onClick:g(f=>o.copyView(u),["stop"])},[i.copyIndex===u?(p(),m("div",$e,[Be,s("div",{class:"copy-picker-item",onClick:g(f=>o.copyCurVer(a,i.carType,i.sdb),["stop"])}," 复制到当前配置 ",8,Fe),s("div",{class:"copy-picker-item",onClick:t[2]||(t[2]=g(f=>o.copyAppointVer(),["stop"]))}," 复制到指定配置 ")])):T("",!0)],8,Se)),[[n,"复制"]]),i.curId!==a.id&&o.cardView.length>0?A((p(),m("i",{key:0,class:"i-delete",onDblclick:t[3]||(t[3]=g(()=>{},["stop"])),onClick:g(f=>o.deleteView(u),["stop"]),onBlur:t[4]||(t[4]=(...f)=>o.clickCancelDelete&&o.clickCancelDelete(...f))},[i.delIndex===u?(p(),F(y,{key:0,onOk:o.clickDelete,onCancel:o.clickCancelDelete,cardId:a.id},null,8,["onOk","onCancel","cardId"])):T("",!0)],40,Le)),[[n,"删除"]]):T("",!0)])]),s("div",Me,D(a.content),1),i.curId===a.id?(p(),m("div",Ue,Re)):e.$props.fileType==="mdf"^(i.carType==="custom"&&i.sdb==="mdf")==0?(p(),m("div",{key:1,class:"o-card-footer-wrap",onDblclick:t[5]||(t[5]=g(()=>{},["stop"])),onClick:f=>o.checkView(a)},[s("div",{class:M(this.sdbNew!=a.sdb?"o-card-footer-disable":"o-card-footer")},Ke,2)],40,ze)):T("",!0)],40,Ve)]),footer:x(()=>[s("div",We,[s("div",{class:"o-add-card-left",onClick:t[6]||(t[6]=(...a)=>o.addView&&o.addView(...a))},Pe),Xe,s("div",Ye,[Ze,Oe,s("input",{type:"file",onInput:t[7]||(t[7]=(...a)=>o.importHandler&&o.importHandler(...a))},null,32)])])]),_:1},8,["modelValue"]))])])])])),[[v,()=>e.$emit("cancel",i.curId)]]),i.copyAppointVerFlag?(p(),m("div",je,[s("div",et,[s("div",tt,[st,s("i",{class:"o-dialog-title-close",onClick:t[10]||(t[10]=a=>i.copyAppointVerFlag=!1)})]),s("div",it,[ot,at,s("div",rt,[b(V,{options:o.dbcVerOpts,modelValue:i.dbcValue,"onUpdate:modelValue":t[11]||(t[11]=a=>i.dbcValue=a)},null,8,["options","modelValue"])])]),s("div",lt,[s("div",dt,[b(C,{style:{width:"30px"},onClick:t[12]||(t[12]=a=>i.copyAppointVerFlag=!1)},{default:x(()=>[w("取消")]),_:1}),b(C,{type:"primary",style:{width:"30px",margin:"0 20px 0 10px"},onClick:t[13]||(t[13]=a=>o.copyCurVer(o.cardView[i.copyIndex],i.dbcValue[0]==="自定义模板"?"custom":i.dbcValue[0],i.dbcValue[1]))},{default:x(()=>[w("确定")]),_:1})])])])])):T("",!0),b(l,{style:{"z-index":"100"},message:i.message},null,8,["message"])],64)}const gt=B(he,[["render",nt],["__scopeId","data-v-3b624670"]]);export{gt as M};
