import{H as B}from"./Header-0fec3d0f.js";import{B as P}from"./Button-b8afde1b.js";import{M as q}from"./Message-c1bea39a.js";import{C as O}from"./Cascader-50e0ddf9.js";import{C as U,b as A}from"./CopyPath-84eb6e73.js";import{_ as N,S as F,k as y,e as C,j as M,r as g,c as r,h,d as l,i as E,a as f,t as d,f as p,F as L,m as V,w as m,g as T,v as I,o as c,n as j,p as Z,b as H}from"./index-77d71887.js";import{t as b}from"./time-4b339df6.js";import{n as x}from"./index-a997f70f.js";let w=0;const W={props:["store","closeFlag"],components:{Button:P,Header:B,Cascader:O,CopyPath:U,Message:q},data(){return{pullType:"",chartDataLoaded:!0,recLoading:!1,recList:{time_length:{label:"时间长度",val:"time_length",paths:"",unit:"min"},file_size:{label:"文件大小",val:"file_size",paths:"/persistence/vde/pool,/tmp/vde/pool",unit:"M"},start_time:{label:"起止时间",val:"start_time",paths:"/log/DiagMaster,/persistence/DiagMaster",unit:""},split_number:{label:"拆分个数",val:"split_number",paths:"/log/DiagMaster,/persistence/DiagMaster",unit:"个"}},selectList:{time_length:{label:"时间长度",val:"time_length",paths:"",unit:"min",min:0,max:60},file_size:{label:"文件大小",val:"file_size",paths:"/persistence/vde/pool,/tmp/vde/pool",unit:"M",min:0,max:1024},split_number:{label:"拆分个数",val:"split_number",paths:"/log/DiagMaster,/persistence/DiagMaster",unit:"个",min:0,max:100}},timeFilterOptions:[{label:"绝对时间",value:"absolute"},{label:"相对时间",value:"relative"}],consoleText:"",blfDirectory:"",outputDirectory:"",onFlag:!0,recLoadingProgress:"",dbcVal:[F.DEFAULT[0].value,F.DEFAULT[0].children[0].value],sdbCustom:this.$ls.get("blfread_sdbData")||[],fileSize:0,fileStartTime:0,fileEndTime:0,splitConditionOption:[{label:5,value:5},{label:10,value:10},{label:15,value:15},{label:20,value:20},{label:30,value:30},{label:60,value:60}],blfCondition:1,timeFilterMode:{label:"绝对时间",value:"absolute"},splitAbsoluteStartTime:"",splitAbsoluteEndTime:"",splitRelativeStartTime:0,splitRelativeEndTime:0,limitRelativeTime:0,blfDirectorySize:{label:"",value:0,durationMaybe:0},otherLimitVal:0,startDateString:"",endDateString:"",minAbsoluteStartTime:"",maxAbsoluteEndTime:"",fileSplitFlag:!0,getBackFileSize:0,message:{visible:!1,level:"",content:""}}},watch:{splitAbsoluteStartTime(t){t||(this.splitAbsoluteStartTime="1970-01-01T08:00:00")},splitAbsoluteEndTime(t){t||(this.splitAbsoluteEndTime="1970-01-01T08:00:00")},pullType(t){if(this.blfCondition=1,t==="start_time"&&this.timeFilterMode.value==="absolute"){const i=b(this.fileStartTime*1e3);this.startDateString=i.replace(/\//g,"-"),console.log("this.startDateString2222",this.startDateString);const s=b(this.fileEndTime*1e3);this.endDateString=s.replace(/\//g,"-"),console.log("this.startDateString3333",this.endDateString),this.fileStartTime?this.splitAbsoluteStartTime=this.startDateString:this.splitAbsoluteStartTime="1970-01-01T08:00:00",this.fileEndTime?this.splitAbsoluteEndTime=this.endDateString:this.splitAbsoluteEndTime="1970-01-01T08:00:00"}t==="time_length"?(this.splitConditionOption=[{label:5,value:5},{label:10,value:10},{label:15,value:15},{label:20,value:20},{label:30,value:30},{label:60,value:60}],this.otherLimitVal=Math.trunc(this.limitRelativeTime/60),this.blfCondition=this.otherLimitVal,console.log("时间长度",this.otherLimitVal)):t==="file_size"?(this.splitConditionOption=[{label:10,value:10},{label:20,value:20},{label:50,value:50},{label:100,value:100},{label:200,value:200}],console.log("this.blfDirectorySize",Math.trunc(this.getBackFileSize)),this.otherLimitVal=Math.trunc(this.getBackFileSize),this.blfCondition=this.otherLimitVal):(this.splitConditionOption=[{label:1,value:1},{label:2,value:2},{label:5,value:5},{label:10,value:10},{label:20,value:20}],this.otherLimitVal=30,this.blfCondition=1,console.log("没选拆分方式"))},chartDataLoaded(t,i){t?(document.querySelector("body").style.cursor="",document.querySelector("#app").style.pointerEvents=""):(document.querySelector("body").style.cursor="wait",document.querySelector("#app").style.pointerEvents="none")},blfDirectory:{async handler(t){const i=await y.getFileSize(t),s=.83*.2,u=Math.round((1678e-19*i*i+1768e-10*i+.5581)*s);if(this.blfDirectorySize={label:A(i),value:i,durationMaybe:u*1e3},t&&this.pullType==="start_time"&&this.timeFilterMode.value==="absolute"){const e=b(this.fileStartTime*1e3);this.startDateString=e.replace(/\//g,"-");const n=b(this.fileEndTime*1e3);this.endDateString=n.replace(/\//g,"-"),this.fileStartTime?this.splitAbsoluteStartTime=this.startDateString:this.splitAbsoluteStartTime="1970-01-01T08:00:00",this.fileEndTime?this.splitAbsoluteEndTime=this.endDateString:this.splitAbsoluteEndTime="1970-01-01T08:00:00"}}},timeFilterMode:{handler(t){t.value==="relative"&&this.fileStartTime&&this.fileEndTime&&console.log("相对时间",this.splitRelativeEndTime)}}},computed:{timeWarnLabel(){if(this.timeFilterMode.value==="absolute"){if(this.splitAbsoluteStartTime>this.splitAbsoluteEndTime)return"开始时间需小于结束时间"}else if(this.splitRelativeStartTime>this.splitRelativeEndTime)return"开始时间需小于结束时间";return"值必须在起止时间范围内"},pullDataValid(){return!!(this.blfDirectory&&this.outputDirectory&&this.pullType)},quitConfirm(){return this.recLoading},dbcVerOpts(){return[...F.DEFAULT,{label:"自定义模板",value:"自定义模板",children:this.sdbCustom.length>0?this.sdbCustom.map(i=>({label:i.sdb,value:i.sdb,files:i.files,comments:i.comments})):null}]},curTpl(){if(this.dbcVal[0]==="自定义模板"){let t=this.sdbCustom.find(i=>i.sdb===this.dbcVal[1]);return{carType:"custom",sdb:this.dbcVal[1],files:t==null?void 0:t.files,comments:t==null?void 0:t.comments}}return{carType:this.dbcVal[0],sdb:this.dbcVal[1]}},endRec(){}},mounted(){M.report("trackPage",{page:"拆解报文",tip:"1174.16.0.1.31378"})},methods:{min(t,i){return t<i?t:i},max(t,i){return t>i?t:i},chooseBlfPath(){this.blfCondition="",this.pullType="",this.outputDirectory="",y.choosePath({directory:this.blfDirectory.split("/").slice(0,-1).join("/")||window.downloadPath,dialogType:"OPEN_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then(t=>{t.data.directory&&(this.blfDirectory=x(t.data.directory),C.blfSplit.getFileInfo({blfFile:this.blfDirectory}).then(i=>{this.getBackFileSize=i.data.data.fileSize;const s=this.getBackFileSize*1024;y.getFileSize(this.blfDirectory),this.fileSize=A(s),this.fileStartTime=i.data.data.startTime,this.fileEndTime=i.data.data.endTime,console.log("this.fileStartTime",this.fileStartTime);const u=b(this.fileStartTime*1e3);console.log("this.fileStartToFixedDate332",u),this.startDateString=u.replace(/\//g,"-");const e=b(this.fileEndTime*1e3);this.endDateString=e.replace(/\//g,"-"),this.minAbsoluteStartTime=this.startDateString,this.maxAbsoluteEndTime=this.endDateString,this.limitRelativeTime=Math.trunc(this.fileEndTime)-Math.trunc(this.fileStartTime),this.splitRelativeEndTime=this.limitRelativeTime,this.limitRelativeTime>=60||this.getBackFileSize>=1?this.fileSplitFlag=!0:this.fileSplitFlag=!1}).catch(i=>{}).finally(()=>{this.onFlag=!0}))})},chooseOutputPath(){const i=x(this.blfDirectory).split("/").filter(s=>!s.includes("."));console.log("输出路径filteredArr",i.join("/")),y.choosePath({directory:i.join("/")||window.downloadPath,dialogType:"FOLDER_DIALOG"}).then(({data:s})=>{s.directory&&(this.outputDirectory=x(s.directory))}),console.log("92929",this.outputDirectory,this.blfDirectory,this.pullType)},async startSplit(){this.onFlag=!1,this.chartDataLoaded=!1,this.consoleText="拆分中...";let t={};this.pullType==="time_length"?t.timeLen=this.blfCondition:this.pullType==="file_size"?t.fileSize=this.blfCondition:this.pullType==="split_number"?t.fileNum=this.blfCondition:(t.timeSpan={},t.timeSpan.data=[],this.timeFilterMode.value==="relative"?(t.timeSpan.data.push(this.splitRelativeStartTime,this.splitRelativeEndTime),t.timeSpan.mode="relative"):(t.timeSpan.data.push(Date.parse(this.splitAbsoluteStartTime)/1e3,Date.parse(this.splitAbsoluteEndTime)/1e3),t.timeSpan.mode="abosulute")),await C.blfSplit.Spliter({inFile:this.blfDirectory,outFile:this.outputDirectory,condition:t}).then(i=>{let s=i.data;this.consoleText="",s.data.length>0&&s.data.forEach(u=>{this.consoleText+=u+"\n"}),s.code=="-1"&&this.showMessage({level:"error",content:s.msg,timeout:2e3}),this.onFlag=!0,this.chartDataLoaded=!0}).catch(),M.report("track","click",{element_name:"拆解报文-click",asset_name:this.blfDirectory+";"+this.outputDirectory+";",tip:"1174.16.0.1.31379"})},timestampToDateString(t){const i=new Date(t),s=i.getFullYear(),u=this.addZero(i.getMonth()+1),e=this.addZero(i.getDate()),n=this.addZero(i.getHours()),S=this.addZero(i.getMinutes()),_=this.addZero(i.getSeconds());return"".concat(s,"-").concat(u,"-").concat(e," ").concat(n,":").concat(S,":").concat(_)},addZero(t){return t<10?"0".concat(t):t},showMessage({level:t,content:i,timeout:s}){clearTimeout(w),t!=null&&(this.message.level=t),i!=null&&(this.message.content=i),this.message.visible=!0,s>0&&(w=setTimeout(()=>{this.message.visible=!1},s))},hideMessage(){this.message.visible=!1}}},o=t=>(Z("data-v-5f3ebccd"),t=t(),H(),t),G=["data-disabled"],Y={class:"o-pul-er"},J=o(()=>l("div",{class:"o-pul-title"},"文件拆解配置",-1)),K={class:"o-pul-p choose-cation"},Q=o(()=>l("span",{style:{color:"red"}},"* ",-1)),X=o(()=>l("span",{class:"record-header-message"},"待拆解文件：",-1)),$={class:"o-pul-path"},ee={key:0,class:"o-pul-p"},te={class:"blf-file-info"},ie={class:"blf-file-size"},le=o(()=>l("span",null,"文件大小：",-1)),se=o(()=>l("span",{style:{color:"#D9D9D9","font-size":"16px",margin:"0 20px"}},"|",-1)),oe={class:"blf-file-duration"},ae=o(()=>l("span",null,"文件起止时间：",-1)),ne={key:1,class:"tip-pul-p"},re=o(()=>l("div",{class:"blf-file-info"},[l("div",{class:"tip-label"},[l("i",{class:"i-warning"}),l("span",{style:{color:"#ff5555"}},"文件过小，不需要拆解 (文件需大于等于1M或大于等于1分钟)")])],-1)),ce=[re],de={key:2,class:"o-pul-p input-cation"},pe=o(()=>l("span",{style:{color:"red"}},"* ",-1)),ue=o(()=>l("span",{class:"record-header-message"},"拆解方式：",-1)),he=["value"],me={key:0,class:"blf-split-condition"},fe=o(()=>l("span",{style:{color:"red"}},"* ",-1)),be={class:"record-header-message"},_e=["max"],ge={style:{"margin-left":"6px"}},Te={class:"other-warn-label"},ve=o(()=>l("i",{class:"i-warning"},null,-1)),ye={key:4,class:"o-pul-p input-cation",style:{"min-width":"636px"}},Se={class:"blf-split-condition"},De=o(()=>l("span",{style:{color:"red"}},"* ",-1)),Fe=o(()=>l("span",{class:"record-header-message"},"起止时间：",-1)),Ee={key:0,class:"o-split-input"},xe=["min","max"],Ae=o(()=>l("span",null,"  至  ",-1)),Ce=["min","max"],Me={class:"warn-label"},Le=o(()=>l("i",{class:"i-warning"},null,-1)),Ve={key:1,class:"o-split-input"},we=["max"],ke=o(()=>l("span",null,"  至  ",-1)),ze=["min","max"],Re={class:"warn-label"},Be=o(()=>l("i",{class:"i-warning"},null,-1)),Pe={key:5,class:"o-pul-p choose-out-cation"},qe=o(()=>l("span",{style:{color:"red"}},"* ",-1)),Oe=o(()=>l("span",{class:"record-header-message"},"输出文件夹路径：",-1)),Ue=["title"],Ne={key:6,class:"o-pul-p start-rec"},Ie=o(()=>l("i",{class:"play-icon"},null,-1)),je=["data-empty"],Ze=o(()=>l("div",{class:"o-console-title"},"文件拆解转换结果",-1)),He=["data-loading"];function We(t,i,s,u,e,n){const S=g("Header"),_=g("Button"),k=g("CopyPath"),z=g("v-select"),R=g("Message");return c(),r("div",{class:"blf-split","data-disabled":!e.chartDataLoaded},[h(S,{title:"拆解报文",quitConfirm:n.quitConfirm,showRight:!0,carNum:t.$props.store.connectCar.carNum,connectStatus:t.$props.store.connectCar.status,recentTest:t.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),l("div",Y,[J,l("div",K,[Q,X,h(_,{onClick:n.chooseBlfPath,class:"choose-path"},{default:E(()=>[f("选择文件")]),_:1},8,["onClick"]),f("  "),l("span",$,[h(k,{path:e.blfDirectory,length:45},null,8,["path"])])]),e.blfDirectory?(c(),r("div",ee,[l("div",te,[l("div",ie,[le,l("span",null,d(e.blfDirectorySize.label),1)]),se,l("div",oe,[ae,l("span",null,d(this.startDateString.replace("T"," "))+" ~ "+d(this.endDateString.replace("T"," ")),1)])])])):p("",!0),e.fileSplitFlag?p("",!0):(c(),r("div",ne,ce)),e.fileSplitFlag?(c(),r("div",de,[pe,ue,(c(!0),r(L,null,V(e.recList,(a,v)=>(c(),r("label",{class:"o-input record-header-message-imp",key:v},[m(l("input",{required:"",name:"pull_type",type:"radio","onUpdate:modelValue":i[0]||(i[0]=D=>e.pullType=D),value:v},null,8,he),[[j,e.pullType]]),f(d(a.label)+" "+d(a.size)+" ",1)]))),128))])):p("",!0),e.pullType!=="start_time"&&e.fileSplitFlag?(c(!0),r(L,{key:3},V(e.selectList,(a,v)=>(c(),r("div",{class:"o-pul-p input-cation",key:v},[e.pullType===a.val&&e.pullType?(c(),r("div",me,[fe,l("span",be,d(a.label)+"：",1),m(l("input",{required:"",list:"ice-cream-flavors",placeholder:"请输入",type:"number","onUpdate:modelValue":i[1]||(i[1]=D=>e.blfCondition=D),id:"ice-cream-choice",min:"1",max:e.otherLimitVal,style:{width:"70px"},name:"ice-cream-choice",class:"o-selected-input"},null,8,_e),[[T,e.blfCondition]]),l("span",ge,d(a.unit),1),l("div",Te,[ve,l("span",null,"值必须在1~"+d(e.otherLimitVal)+"范围内",1)])])):p("",!0)]))),128)):p("",!0),e.pullType==="start_time"&&e.fileSplitFlag?(c(),r("div",ye,[l("div",Se,[De,Fe,h(z,{options:e.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:e.timeFilterMode,"onUpdate:modelValue":i[2]||(i[2]=a=>e.timeFilterMode=a),class:"tch-tool-select"},null,8,["options","modelValue"]),e.timeFilterMode.value==="absolute"&&e.fileSplitFlag?(c(),r("div",Ee,[m(l("input",{required:"",type:"datetime-local",min:e.minAbsoluteStartTime,max:n.min(e.maxAbsoluteEndTime,e.maxAbsoluteEndTime),"onUpdate:modelValue":i[3]||(i[3]=a=>e.splitAbsoluteStartTime=a),class:"chf-input-time",step:"1"},null,8,xe),[[T,e.splitAbsoluteStartTime]]),Ae,m(l("input",{required:"",type:"datetime-local",min:n.max(e.minAbsoluteStartTime,e.splitAbsoluteStartTime),max:e.maxAbsoluteEndTime,"onUpdate:modelValue":i[4]||(i[4]=a=>e.splitAbsoluteEndTime=a),class:"chf-input-time",step:"1"},null,8,Ce),[[T,e.splitAbsoluteEndTime]]),l("div",Me,[Le,l("span",null,d(n.timeWarnLabel),1)])])):p("",!0),e.timeFilterMode.value==="relative"&&e.fileSplitFlag?(c(),r("div",Ve,[m(l("input",{required:"",type:"number",min:0,max:n.min(e.limitRelativeTime,e.splitRelativeEndTime),"onUpdate:modelValue":i[5]||(i[5]=a=>e.splitRelativeStartTime=a),class:"chf-input-time",step:"1",style:{width:"70px"}},null,8,we),[[T,e.splitRelativeStartTime]]),ke,m(l("input",{required:"",type:"number",min:n.max(0,e.splitRelativeStartTime),max:e.limitRelativeTime,"onUpdate:modelValue":i[6]||(i[6]=a=>e.splitRelativeEndTime=a),class:"chf-input-time",style:{width:"70px"},step:"1"},null,8,ze),[[T,e.splitRelativeEndTime]]),l("div",Re,[Be,l("span",null,d(n.timeWarnLabel),1)])])):p("",!0)])])):p("",!0),e.fileSplitFlag?(c(),r("div",Pe,[qe,Oe,h(_,{onClick:n.chooseOutputPath,class:"choose-path"},{default:E(()=>[f("选择路径")]),_:1},8,["onClick"]),f("  "),l("span",{class:"o-pul-path",title:e.outputDirectory},d(e.outputDirectory),9,Ue)])):p("",!0),e.fileSplitFlag?(c(),r("div",Ne,[h(_,{type:"primary",disabled:!n.pullDataValid&&e.fileSplitFlag,progress:e.recLoadingProgress,loading:e.recLoading,onClick:n.startSplit},{default:E(()=>[Ie,f(" 开始拆解")]),_:1},8,["disabled","progress","loading","onClick"])])):p("",!0)]),l("div",{class:"o-console-er","data-empty":e.consoleText==="",id:"el-record-console"},[Ze,m(l("div",{class:"o-console-body","data-loading":!e.chartDataLoaded},d(e.consoleText),9,He),[[I,e.consoleText]])],8,je),h(R,{message:e.message},null,8,["message"])],8,G)}const tt=N(W,[["render",We],["__scopeId","data-v-5f3ebccd"]]);export{tt as default};
