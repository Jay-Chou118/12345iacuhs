import{H as k}from"./Header-a7d23244.js";import{B as x}from"./Button-aac43f3a.js";import{M as S}from"./Message-01d1ea64.js";import{_ as B,k as y,e as h,r as _,c as u,h as i,d as a,i as c,w as N,v as g,t as V,j as C,o as f,a as d,p as E,b as F}from"./index-ecb95f9d.js";let T=0,L=0,v=0,D;const P={props:["store","closeFlag"],components:{Button:x,Header:k,Message:S},data(){return{tolerance:"0.2",chartDataLoaded:!0,directory:window.downloadPath+"/20221208000146_100.blf",pullList:{total:{label:"全量采集数据",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},dialogMaster:{label:"DialogMaster日志",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},modal:{visible:!1,resultVisible:!1},pullLoading:!1,pullLoadingProgress:"",consoleText:"",message:{visible:!1,level:"",content:""},SDBVersion:[{name:"E3"}],SDBVal:"E3",onFlag:!0,EthernetArr:[{NetName:"VCCD_inter_diag",NetNameCn:"检测VCCD内部诊断通路",ip:"172.16.33.2"},{NetName:"VCCD_outer_diag",NetNameCn:"检测VCCD外部诊断通路",ip:"169.254.65.2"},{NetName:"VCCD_reliable_DDS",NetNameCn:"检测VCCD可靠DDS的通路",ip:"172.16.45.2"},{NetName:"VCCD_unreliable_DDS",NetNameCn:"检测VCCD不可靠DDS的通路",ip:"172.16.46.2"},{NetName:"VCCD_public_net",NetNameCn:"检测VCCD公网通路",ip:"172.16.100.2"},{NetName:"VCCD_private_net",NetNameCn:"检测VCCD私网通路",ip:"172.16.102.2"},{NetName:"TBOX_inter_diag",NetNameCn:"检测TBOX内部诊断通路",ip:"172.16.33.66"},{NetName:"TBOX_outer_diag",NetNameCn:"检测TBOX外部诊断通路",ip:"169.254.65.66"},{NetName:"TBOX_reliable_DDS",NetNameCn:"检测TBOX可靠DDS的通路",ip:"172.16.45.66"},{NetName:"TBOX_unreliable_DDS",NetNameCn:"检测TBOX不可靠DDS的通路",ip:"172.16.46.66"},{NetName:"TBOX_public_net",NetNameCn:"检测TBOX公网通路",ip:"172.16.100.66"},{NetName:"TBOX_private_net",NetNameCn:"检测TBOX私网通路",ip:"172.16.102.66"},{NetName:"DCD_inter_diag",NetNameCn:"检测DCD内部诊断通路",ip:"172.16.33.33"},{NetName:"ADD_inter_diag",NetNameCn:"检测ADD内部诊断通路",ip:"172.16.33.98"},{NetName:"public_net",NetNameCn:"检测TSP通路",ip:"https://pre-oms.tsp.mioffice.cn/#/"}]}},watch:{closeFlag(t){this.onFlag==!1&&this.showMessage({timeout:-1})}},computed:{pullDataValid(){return!!(this.directory&&this.tolerance&&this.SDBVal)},quitConfirm(){return!this.chartDataLoaded}},mounted(){C.report("trackPage",{page:"检查以太网状态",tip:"1174.3.0.1.27750"})},unmounted(){},methods:{choosePath(){y.choosePath({directory:this.directory,dialogType:"OPEN_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then(t=>{t.data.directory&&(this.directory=t.data.directory)})},async startEthernet(){C.report("track","click",{element_name:"开始检查",asset_name:"开始检查以太网",tip:"1174.3.0.1.27751"}),this.onFlag=!1,this.chartDataLoaded=!1,D=new AbortController,this.consoleText=" 检查中...\n",await h.base.NetworkDiagStart(D.signal).then(t=>{let o=t.data;if(console.log("Etherres>>>>",o),o.TCP_state=="Failure")this.consoleText+="\nTCP连接失败\n",this.stopEthernet();else{let s=this;async function r(){for(let e of s.EthernetArr){if(s.onFlag==!0)break;let l=await h.base.NetworkDiag({NetName:e.NetName}).then(m=>{m.data[e.NetName]=="Failure"?s.consoleText+="\0🔴\0"+e.NetNameCn+" ("+e.ip+")\0\n":s.consoleText+="\0🟢\0"+e.NetNameCn+" ("+e.ip+")\0\n"}).catch(m=>{s.consoleText+="\0🔴\0"+e.NetNameCn+" ("+e.ip+")\0\n"}).finally(()=>{setTimeout(()=>{window.document.querySelector(".o-console-body")&&(window.document.querySelector(".o-console-body").scrollTop=99999999)})});console.log("res>>>>",l)}s.onFlag==!1&&(s.consoleText+=" 网络状态检查完毕！\n"),s.stopEthernet()}r()}}).finally(()=>{this.chartDataLoaded=!0})},async stopEthernet(){D.abort(),this.onFlag=!0,this.chartDataLoaded=!0,v=setTimeout(()=>{this.consoleText+="\n已中断检查\n"},3e3),await h.base.NetworkDiagEnd().then(t=>{let o=t.data;console.log(o,"resp"),o.TCP_state=="Closed"}).catch(t=>{}),this.EthernetArr=[],clearInterval(L),clearTimeout(v)},async exportResult(){C.report("track","click",{element_name:"导出结果",asset_name:"",tip:"1174.3.0.1.27763"});let o="check-ethernet-quality"+new Date().valueOf(),s=window.downloadPath;await y.choosePath({directory:s,dialogType:"SAVE_DIALOG",saveFilename:o+".txt",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then(r=>{r.data.directory&&(console.log("saveFilename2222",o,s),h.blf.exportExeLog({content:this.consoleText,directory:r.data.directory}).then(e=>{e.data.code=="0"&&this.showMessage({timeout:5e3,level:"success",content:"导出成功"})}).catch(e=>{console.log(e)}))})},showMessage({level:t,content:o,timeout:s}){clearTimeout(T),t!=null&&(this.message.level=t),o!=null&&(this.message.content=o),this.message.visible=!0,s>0&&(T=setTimeout(()=>{this.message.visible=!1},s))},hideMessage(){this.message.visible=!1},cannel(){this.modal.visible=!1},submit(){this.modal.visible=!1,this.onFlag=!this.onFlag,this.stopEthernet()},resultCannel(){this.modal.resultVisible=!1}}},p=t=>(E("data-v-4a196db3"),t=t(),F(),t),O={class:"pull-dt-page"},M={class:"o-pul-er"},X={key:0,class:"o-pul-p"},A=p(()=>a("i",{class:"play-icon"},null,-1)),q={key:1,class:"o-pul-p"},I=p(()=>a("i",{class:"stop-icon"},null,-1)),H=["data-empty"],R={class:"o-console-wrap"},z=p(()=>a("div",{class:"o-console-title"},"检查进度",-1)),G=["data-loading"],Q={class:"o-modal-wrap"},j={class:"o-modal-header"},J={class:"o-modal-header-wrap"},K=p(()=>a("div",{class:"o-modal-title"},"提示",-1)),U=p(()=>a("div",{class:"o-modal-container"},[a("span",{class:"record-header-message"},"任务还在执行中，此时关闭TSP助手会终断此任务，确认要继续关闭吗？")],-1)),W={class:"o-modal-footer"},Y={class:"o-modal-footer-wrap"};function Z(t,o,s,r,e,l){const m=_("Header"),n=_("Button"),b=_("Message");return f(),u("div",O,[i(m,{title:"检查以太网状态",quitConfirm:l.quitConfirm,showRight:!0,carNum:t.$props.store.connectCar.carNum,connectStatus:t.$props.store.connectCar.status,recentTest:t.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),a("div",M,[e.onFlag?(f(),u("div",X,[i(n,{type:"primary",disabled:!l.pullDataValid,progress:e.pullLoadingProgress,loading:e.pullLoading,onClick:l.startEthernet},{default:c(()=>[A,d("开始检查")]),_:1},8,["disabled","progress","loading","onClick"])])):(f(),u("div",q,[i(n,{type:"primary",progress:e.pullLoadingProgress,loading:e.pullLoading,onClick:l.stopEthernet},{default:c(()=>[I,d("停止检查")]),_:1},8,["progress","loading","onClick"])]))]),a("div",{class:"o-console-er","data-empty":e.consoleText===""},[a("div",R,[z,N(i(n,{onClick:l.exportResult,class:"export-result"},{default:c(()=>[d("导出结果")]),_:1},8,["onClick"]),[[g,e.consoleText]])]),N(a("div",{class:"o-console-body","data-loading":!e.chartDataLoaded},V(e.consoleText),9,G),[[g,e.consoleText]])],8,H),N(a("div",Q,[a("div",j,[a("div",J,[K,a("i",{class:"o-modal-title-close",onClick:o[0]||(o[0]=(...w)=>l.cannel&&l.cannel(...w))})]),U,a("div",W,[a("div",Y,[i(n,{style:{width:"52px"},onClick:l.cannel},{default:c(()=>[d("取消")]),_:1},8,["onClick"]),i(n,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:l.submit},{default:c(()=>[d("确定")]),_:1},8,["onClick"])])])])],512),[[g,this.modal.visible]]),i(b,{message:e.message},null,8,["message"])])}const se=B(P,[["render",Z],["__scopeId","data-v-4a196db3"]]);export{se as default};
