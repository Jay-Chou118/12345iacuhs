import{B}from"./Button-be50e2e1.js";import{H as j}from"./Header-6d41ae3f.js";import{n as L}from"./index-4c1ed7f2.js";import{_ as I,o as m,c as p,d as n,t as f,x,B as y,w as F,v as q,r as b,h as w,i as M,p as U,b as R,q as X,e as g,F as S,m as O,A as P,f as C,g as G,a as k,s as z,k as W,j as A}from"./index-6913cd26.js";import{b as K}from"./num-b2a97d52.js";import{I as Z}from"./ImportFileDialog-82919b94.js";import{b as J}from"./CopyPath-91557ccb.js";import{s as Q}from"./time-4b339df6.js";import{W as ee,P as te}from"./ev-timeplot-50495d24.js";import{M as ae}from"./Message-a83ebfa3.js";import"./Cascader-8f26ccec.js";import"./Spin-1110e3c0.js";let T;const se={name:"ScrollBar",props:["modelValue","start","end","disable","timeFilter","startTime"],emits:["update:modelValue","change"],data(){return{lineTop:0,scrollTop:0,lineTitle:"",scrollTitle:"",lineVisible:!1,dragging:!1,dragHover:!1}},methods:{enterHandler(){this.dragging||(this.lineVisible=!0)},leaveHandler(){this.lineVisible=!1},moveHandler(e){this.lineVisible&&(e.offsetY<0||e.offsetY>=this.$refs.root.clientHeight-28||(this.lineTop=e.offsetY,this.lineTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*e.offsetY/(this.$refs.root.clientHeight-28))))},clickHandler(e){this.scrollTop=e.offsetY;const a=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",a),this.$emit("change",a)},tooltipFormatter(e){return parseInt(e)/1e3},timeStrFilter(e){return this.$props.timeFilter==="absolute"?new Date(e*1e3+(this.$props.startTime||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"}):e},blockDownHandler(){this.dragging=!0,T=void 0},blockUphandler(){if(this.dragging){this.dragging=!1;const e=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",e),this.$emit("change",e)}},blockLeaveHandler(){this.enterHandler(),this.dragHover=!1},blockEnterHandler(){this.leaveHandler(),this.dragHover=!0},blockMoveHandler(e){if(this.dragging){let a=0;T!=null&&(a=e.pageY-T),T=e.pageY,console.log("move",e.pageY);let i=this.scrollTop+a;const o=this.$refs.root.clientHeight;if(i<0){if(this.scrollTop===0)return;i=0}else if(i>o-28){if(this.scrollTop===o-28)return;i=o-28}this.scrollTop=i,this.scrollTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28))}}},watch:{modelValue(e){if(this.dragging)return;let a=(e-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(a*(this.$refs.root.clientHeight-28)),this.scrollTitle=this.tooltipFormatter(e),this.dragging=!1,this.dragHover=!1},end(e){if(this.dragging)return;let a=(this.$props.modelValue-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(a*(this.$refs.root.clientHeight-28))}},mounted(){window.addEventListener("mouseup",this.blockUphandler),window.addEventListener("mousemove",this.blockMoveHandler)},unmounted(){window.removeEventListener("mouseup",this.blockUphandler),window.removeEventListener("mousemove",this.blockMoveHandler)}},le=["data-disable"],ie=["data-active"],re={class:"block-title"},oe={class:"line-title"},ne=["data-active"];function ce(e,a,i,o,t,s){return m(),p("div",{class:"bar-er","data-disable":e.$props.disable,ref:"root",onClick:a[5]||(a[5]=x((...l)=>s.clickHandler&&s.clickHandler(...l),["prevent","stop"])),onMousemove:a[6]||(a[6]=(...l)=>s.moveHandler&&s.moveHandler(...l)),onMouseenter:a[7]||(a[7]=(...l)=>s.enterHandler&&s.enterHandler(...l)),onMouseleave:a[8]||(a[8]=(...l)=>s.leaveHandler&&s.leaveHandler(...l))},[n("div",{class:"bar-block","data-active":t.dragging,onClick:a[0]||(a[0]=x(()=>{},["prevent","stop"])),onMousedown:a[1]||(a[1]=(...l)=>s.blockDownHandler&&s.blockDownHandler(...l)),onMouseup:a[2]||(a[2]=(...l)=>s.blockUphandler&&s.blockUphandler(...l)),onMouseleave:a[3]||(a[3]=(...l)=>s.blockLeaveHandler&&s.blockLeaveHandler(...l)),onMouseenter:a[4]||(a[4]=(...l)=>s.blockEnterHandler&&s.blockEnterHandler(...l)),style:y({transform:"translateY("+t.scrollTop+"px)"})},[n("div",re,f(s.timeStrFilter(t.scrollTitle)),1)],44,ie),F(n("div",{class:"bar-line",style:y({transform:"translateY("+t.lineTop+"px)"})},[n("div",oe,f(s.timeStrFilter(t.lineTitle)),1)],4),[[q,t.lineVisible]]),n("div",{class:"scroll-title","data-active":t.dragging},f(s.timeStrFilter(t.scrollTitle)),9,ne)],40,le)}const de=I(se,[["render",ce],["__scopeId","data-v-6f06aac4"]]);const he={props:["col","asyncData"],emits:["change"],data(){return{options:[],loading:!1,current:[]}},methods:{async onMouseEnter(){this.loading=!0,this.options=[];try{this.options=await this.$props.asyncData(this.$props.col)}catch(e){}this.loading=!1},onModelValueChange(e){this.current=e,this.$emit("change",e)}},watch:{col:{handler(e){this.current=e.value},deep:!0}}},me=e=>(U("data-v-a6880894"),e=e(),R(),e),pe=["data-active"],ue=me(()=>n("div",null,null,-1));function fe(e,a,i,o,t,s){var c;const l=b("v-select");return m(),p("div",{class:"select-icon","data-active":((c=t.current)==null?void 0:c.length)>0,onMouseenter:a[0]||(a[0]=(...u)=>s.onMouseEnter&&s.onMouseEnter(...u))},[n("div",{class:"flt-er",style:y({width:e.$props.col.width+40+"px"})},[w(l,{loading:t.loading,options:t.options,dropdownShouldOpen:()=>!0,searchable:!0,modelValue:t.current,"onUpdate:modelValue":s.onModelValueChange,multiple:""},{"no-options":M(()=>[ue]),_:1},8,["loading","options","modelValue","onUpdate:modelValue"])],4)],40,pe)}const ge=I(he,[["render",fe],["__scopeId","data-v-a6880894"]]);let E=0,H=0;const be={props:["rowData","columnsDef","columnsFilter","from","filters"],emits:["toggleExpand","scrollRow","scrollAction","filterItem","colFilterChange","updatePadding","dataFilterChange"],components:{RecycleScroller:X,FilterItem:ge,Button:B},created(){this.$_scrollTimer=0},data(){return{selectionActive:!1,isChildTit:!1,searchVal:"",isOpenSearch:!1,selectFilterList:[],showSelect:!1,curId:-1,filterChnItem:"",filterValItem:"",formData:{},filterList:{channel:"",canId:"",name:"",canType:"",dir:"",dlc:""},left:0,timeFilterOptions:[{label:"Time 绝对时间",value:"absolute"},{label:"Time 相对时间",value:"relative"},{label:"ΔTime 时间差",value:"diff"}],timeFilterMode:{label:"Time 绝对时间",value:"absolute"},filterNumberShow:!1,filterDataNumber:"",showWrongMsg:!1,filterWarnLabel:"请输入0~9或者a~f"}},computed:{fullWidth(){return"calc("+this.$props.columnsDef.map(e=>typeof e.width=="number"?e.width+"px":e.width).join(" + ")+")"}},watch:{rowData:{handler(){if(this.selectionActive){this.selectionActive=!1;let e=window.getSelection();e.removeAllRanges(),e=null}setTimeout(()=>{console.log("updateVisibleItems"),this.$refs.scroller.updateVisibleItems(!0)},0)},deep:!0},timeFilterMode(e){this.onTimeModelChange(e.value)}},mounted(){this.nativeScroll(),setTimeout(()=>{document.body.addEventListener("mousedown",this.clickHandler)},300)},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{onScrollX(e){this.left=-e.target.scrollLeft+"px"},onTableClick(e){if(e.target.className.includes("table-td")){this.selectionActive=!0;let a=window.getSelection();a.removeAllRanges();let i=document.createRange();i.selectNodeContents(e.target),a.addRange(i),a=i=null}},filterHex(e){return e===void 0?"":(e>=0?K(e):e).toString().replace(/^(00)+/g,"")||"00"},update(e,a,i,o){E=i,H=this.$props.rowData.length-o,this.$emit("updatePadding",{visibleStartIndex:i,visibleEndIndex:o})},searchInfo(){this.isOpenSearch=!1},onOpenSearch(){this.isOpenSearch=!0},scrollToBottom(){var e;(e=this.$refs.scroller)==null||e.scrollToItem(this.$props.rowData.length-1)},scrollToItem(e){var a;(a=this.$refs.scroller)==null||a.scrollToItem(e)},nativeScroll(){const e=this.$refs.scroller.$el;e.addEventListener("scroll",a=>{if(clearTimeout(this.$_scrollTimer),this.selectionActive){this.selectionActive=!1;let i=window.getSelection();i.removeAllRanges(),i=null}this.$_scrollTimer=setTimeout(()=>{console.log("updateVisibleItems"),this.$refs.scroller.updateVisibleItems(!0)},100)}),e.addEventListener("wheel",a=>{this.$emit("scrollAction",{topPadding:E,bottomPadding:H}),a.deltaY>0||a.deltaX>0?H<=40&&this.$emit("scrollRow","down"):(a.deltaY<0||a.deltaX<0)&&E<=40&&this.$emit("scrollRow","up")})},filterItem(e,a){this.filterChnItem=e,this.curId=a,this.$emit("filterItem"),this.selectFilterList=[],g.blfLogging.getFiltItems({selectItem:e,channel:"",canId:"",name:"",canType:"",dir:"",dlc:""}).then(i=>{let o=i.data.data;o.length>0&&o.forEach(t=>{t&&this.selectFilterList.push({value:t,label:t,selected:!1})})})},onChooseFilterItem(e,a){e.selected=!0,this.$emit("reDrawTable",e,a,this.selectFilterList)},onTimeModelChange(e){this.$emit("timeModeChange",e)},onMouseEnter(){this.filterNumberShow=!0},filterData(){this.filterDataNumber=this.filterDataNumber.toString(),this.filterDataNumber?/^[0-9a-f\s]+$/i.test(this.filterDataNumber)?(this.showWrongMsg=!1,this.filterNumberShow=!1,this.$emit("dataFilterChange",this.filterDataNumber)):(this.showWrongMsg=!0,this.filterNumberShow=!0):(this.showWrongMsg=!1,this.filterNumberShow=!1,this.$emit("dataFilterChange",this.filterDataNumber)),console.log("this.filterDataNumber",this.filterDataNumber)},clickHandler(e){var a;console.log("020304this.$refs",this.$refs.filterRoot,e.target),((a=this.$refs.filterRoot[0])==null?void 0:a.contains(e.target))==!1&&(console.log("020304"),this.filterNumberShow=!1)}}},_=e=>(U("data-v-9181fa72"),e=e(),R(),e),ye={style:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"inherit","flex-direction":"inherit","align-items":"inherit"}},Ce={key:1,class:"o-pul-time-option-warp"},we=["data-active"],_e=_(()=>n("i",{class:"div-select-icon"},null,-1)),Se={class:"o-pul-data-filter-input-item"},ve={key:0,class:"warn-label"},De=_(()=>n("i",{class:"i-warning"},null,-1)),Te=_(()=>n("div",{class:"table-header",style:{height:"32px","line-height":"32px"}},null,-1)),ke=["data-even"],xe=["onMousedown"],Fe=["onMousedown"],Me=_(()=>n("span",{class:"container-tit",style:{width:"205px"}},"信号名",-1)),Ie=_(()=>n("span",{class:"container-tit",style:{width:"200px"}},"信号物理值",-1)),Ve=_(()=>n("span",{class:"container-tit",style:{width:"80px"}},"HEX",-1)),Ne=_(()=>n("span",{class:"container-tit",style:{width:"calc(100vw - 487px)"}},"信号描述",-1)),Le=[Me,Ie,Ve,Ne],Ae={class:"table-parent-tr o-table-expand-child"},Ee={class:"table-td",style:{width:"205px"}},He={class:"table-td",style:{width:"200px"}},Be={class:"table-td",style:{width:"80px"}},Pe={class:"table-td",style:{width:"calc(100vw - 487px)"}};function qe(e,a,i,o,t,s){const l=b("FilterItem"),c=b("v-select"),u=b("RecycleScroller");return m(),p("div",{class:"table",onClick:a[5]||(a[5]=(...r)=>s.onTableClick&&s.onTableClick(...r))},[n("div",{class:"table-header",style:y({height:"32px",lineHeight:"32px",transform:"translateX("+t.left+")",width:s.fullWidth,position:"absolute",zIndex:1})},[n("div",ye,[(m(!0),p(S,null,O(e.$props.columnsDef,(r,d)=>(m(),p("div",{class:"header-tit",key:d,style:y({width:r.width>0?r.width+"px":r.width})},[n("span",null,f(r.titName),1),r.filterShow?(m(),P(l,{key:0,onChange:h=>e.$emit("colFilterChange",{keyName:r.keyName,value:h}),col:r,asyncData:e.$props.columnsFilter},null,8,["onChange","col","asyncData"])):C("",!0),r.keyName=="timestamp"||r.keyName=="diff"?(m(),p("div",Ce,[w(c,{options:t.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:t.timeFilterMode,"onUpdate:modelValue":a[0]||(a[0]=h=>t.timeFilterMode=h),class:"canoe-frame-vselect"},null,8,["options","modelValue"])])):C("",!0),r.keyName=="data"?(m(),p("div",{key:2,class:"o-pul-data-filter","data-active":t.filterDataNumber&&!t.filterNumberShow,onMouseenter:a[3]||(a[3]=(...h)=>s.onMouseEnter&&s.onMouseEnter(...h))},[_e,F(n("div",{class:"o-pul-data-filter-input-er",ref_for:!0,ref:"filterRoot"},[n("div",Se,[F(n("input",{"onUpdate:modelValue":a[1]||(a[1]=h=>t.filterDataNumber=h),placeholder:"请输入数据",class:"o-pul-data-filter-input"},null,512),[[G,t.filterDataNumber]]),n("div",{onClick:a[2]||(a[2]=(...h)=>s.filterData&&s.filterData(...h)),class:"chs-btn confirm"},"确定")]),t.showWrongMsg?(m(),p("div",ve,[De,n("span",null,f(t.filterWarnLabel),1)])):C("",!0)],512),[[q,t.filterNumberShow]])],40,we)):C("",!0)],4))),128))])],4),Te,w(u,{items:e.$props.rowData,"item-size":24,"key-field":"id",emitUpdate:!0,onUpdate:s.update,ref:"scroller",class:"frame-class"},{default:M(({item:r,index:d})=>[r.isParent?(m(),p("div",{key:0,class:"table-parent-tr","data-even":d%2===0,style:y({transform:"translateX("+t.left+")",width:s.fullWidth})},[(m(!0),p(S,null,O(e.$props.columnsDef,h=>(m(),p("div",{class:"table-td",style:y({width:typeof h.width=="number"?h.width+"px":h.width}),key:h.keyName},[h.custom?(m(),p(S,{key:0},[r.isExpand&&r.isParent&&r.name?(m(),p("i",{key:0,class:"collapse-icon",onMousedown:x(V=>e.$emit("toggleExpand",d),["stop","prevent"])},null,40,xe)):C("",!0),r.isExpand===!1&&r.isParent&&r.name?(m(),p("i",{key:1,class:"expand-icon",onMousedown:x(V=>e.$emit("toggleExpand",d),["stop","prevent"])},null,40,Fe)):C("",!0)],64)):(m(),p(S,{key:1},[k(f(h.displayMap?h.displayMap(r[h.keyName]):r[h.keyName]),1)],64))],4))),128))],12,ke)):(m(),p(S,{key:1},[r.isChildTit?(m(),p("div",{key:0,class:"table-header o-table-expand-child",style:y({transform:"translateX("+t.left+")",width:s.fullWidth})},Le,4)):(m(),p("div",{key:1,class:"table-parent",style:y({transform:"translateX("+t.left+")",width:s.fullWidth})},[n("div",Ae,[n("span",Ee,f(r.name),1),n("span",He,f(r.value),1),n("span",Be,f(s.filterHex(r.hex)),1),n("span",Pe,f(r.comment),1)])],4))],64))]),_:1},8,["items","onUpdate"]),n("div",{class:"table-scroll-x",onScroll:a[4]||(a[4]=(...r)=>s.onScrollX&&s.onScrollX(...r))},[n("div",{class:"table-scroll-x-bar",style:y({width:s.fullWidth})},null,4)],32)])}const Ue=I(be,[["render",qe],["__scopeId","data-v-9181fa72"]]);let v=0,$=0,D;const Re={props:["store","closeFlag"],emits:["connect","showMessage","getCarCode"],components:{Button:B,Header:j,ImportFileDialog:Z,Button:B,ScrollBar:de,TableRecycleScroller:Ue,EvTimeplot:ee,ProgressBar:te,Message:ae},data(){var a,i,o;let e=(a=this.$ls.get("blfread_treeData"))==null?void 0:a.map(t=>({...t,checkedListIndex:[],carType:t.carType||"MS11",sdb:t.sdb||"E4",children:t.children.map(s=>({...s,warning:!1,pid:t.id,color:s.color||"blue"})),signals:{}}));if((!e||(e==null?void 0:e.length)===0)&&(e=[]),e=e.filter(t=>!(t.carType==="MS11"&&t.sdb==="E4U1"&&t.text==="默认视图"&&t.children.length===0)),!e.some(t=>t.carType==="MS11"&&t.sdb==="E4U1")){let t=Date.now();e.push({id:t,text:"默认视图",type:"view",editable:!1,carType:"MS11",sdb:"E4U1",deleteConfirm:!1,children:[{id:"PwrModSts",msg:198,channel:3,text:"PwrModSts",node_type:"signal",comment:"PowerMode Status",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::PwrModSts::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-PwrModSts",pid:t,color:"purple"},{id:"VCUActGearLvr",msg:198,channel:3,text:"VCUActGearLvr",node_type:"signal",comment:"Actual gear level 车辆实际档位\\\\nP R N D挡位",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUActGearLvr::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUActGearLvr",pid:t,color:"blue",warning:!1},{id:"VCUAccrPedlRat",msg:198,channel:3,text:"VCUAccrPedlRat",node_type:"signal",comment:"加速油门踏板开度",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUAccrPedlRat::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUAccrPedlRat",pid:t,color:"cerulean",warning:!1},{id:"HvBattSoCAct",msg:449,channel:5,text:"HvBattSoCAct",node_type:"signal",comment:"HV battery SoC actual",remark:"BMS::VCCD/VECU::BMS_PTCANFD_0x1C1::HvBattSoCAct::CANFD signal",checked:!0,_id:"5-5_BMS_PTCANFD_0x1C1(0x1c1)-HvBattSoCAct",pid:t,color:"cyan",warning:!1},{id:"VehSpd",msg:179,channel:3,text:"VehSpd",node_type:"signal",comment:"Vehicle speed",remark:"BCS::ADD/VCCD/BCP/EPS/SCUC/SWM::BCS_ChassisCANFD_0xB3::VehSpd::CANFD signal",checked:!0,_id:"3-3_BCS_ChassisCANFD_0xB3(0xb3)-VehSpd",pid:t,color:"green",warning:!1},{id:"SwtHiBeam",msg:419,channel:3,text:"SwtHiBeam",node_type:"signal",comment:"组合开关远光灯请求命令",remark:"SWM::BCP/BCS/VCCD::SWM_ChassisCANFD_0x1A3::SwtHiBeam::CANFD signal",checked:!0,_id:"3-3_SWM_ChassisCANFD_0x1A3(0x1a3)-SwtHiBeam",pid:t,color:"lime",warning:!1}]})}return this.$ls.set("blfread_treeData",e),{system:z,timeFilterModeVal:"absolute",tableLoading:!1,isParsing:!1,onceLooped:!1,backBlock:!1,exportTypeOptions:[{label:"asc(*.asc)",value:"asc"},{label:"csv(*.csv)",value:"csv"},{label:"blf(*.blf)",value:"blf"}],exportCycleOptions:[{label:"默认",value:""}],exportTypeValue:"blf",exportCycleValue:"",modal:{title:"导入文件",visible:!1},message:{visible:!1,level:"",content:""},columnsDef:[{titName:"",width:30,keyName:"id",type:"number",value:[],filterShow:!1,custom:!0},{titName:"",width:164,keyName:this.timeFilterModeVal==="diff"?"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:t=>{let s=parseFloat(t);switch(this.timeFilterModeVal){case"diff":return s.toFixed(6);case"absolute":return new Date(t*1e3+(this.startSecond*1e3||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"});case"relative":return t.toFixed(6);default:return t}}},{titName:"Chn",width:60,keyName:"channel",type:"number",value:[],filterShow:!0},{titName:"ID",width:60,keyName:"canId",type:"number",value:[],filterShow:!0,displayMap:t=>"0x"+t.toString(16)},{titName:"NAME",width:200,keyName:"name",type:"string",value:[],filterShow:!0},{titName:"Event",width:80,keyName:"canType",type:"string",value:[],filterShow:!0},{titName:"Dir",width:60,keyName:"dir",type:"string",value:[],filterShow:!0},{titName:"Dlc",width:60,keyName:"dlc",type:"number",value:[],filterShow:!0},{titName:"DATA",width:1380,keyName:"data",type:"string",value:[],filterShow:!1,displayMap:t=>t.map(s=>s.toString(16).padStart(2,"0")).join(" ")}],rowData:[],barChartData:[],directorySize:{label:"",value:0,durationMaybe:0,durationMaybeLabel:"0秒"},carType:"MS11",sdb:"E4U3_1115",directory:"",expandKeys:new Set,sliderMsVal:0,lastMsecond:1,startSecond:0,startSqlId:0,endSqlId:0,filterCanData:"",treeData:e.map(t=>(t.children.forEach(s=>{s.warning=!1}),t)),curView:{label:(i=e[0])==null?void 0:i.text,value:0,tag:(o=e[0])==null?void 0:o.sdb}}},mounted(){g.blfTraceFromLogging.removeSql(),A.report("trackPage",{page:"帧分析",tip:"1174.17.0.1.33179"})},beforeUnmount(){g.blfTraceFromLogging.removeSql(),clearTimeout(v),D==null||D.abort()},watch:{directory:{async handler(e){const a=await W.getFileSize(e),i=+(a/1024/1024).toFixed(1);console.log("bt",a,i),this.directorySize={label:J(a),value:a,durationMaybe:i*1e3,durationMaybeLabel:Q(i)}}},colComputed(){this.columnsDef[1]={titName:"",width:164,keyName:this.timeFilterModeVal==="diff"?"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let a=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return a.toFixed(6);case"absolute":return new Date(e*1e3+(this.startSecond*1e3||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23",timeZone:"Asia/Shanghai"})+"."+a.toFixed(6).split(".")[1];case"relative":return e.toFixed(6);default:return e}}}}},computed:{quitConfirm(){return!!this.directory.trim()},showData(){let e={mode:"all"};return this.columnsDef.forEach(a=>{a.filterShow&&(e[a.keyName]=(a.value||[]).map(i=>i.value))}),e},directoryLabel(){let e=this.directory.split("/").pop();return e.length>25?e.slice(0,10)+"..."+e.slice(-15):e},carTypeLabel(){return this.carType&&this.carType!=="custom"?this.carType+" / ":""},colComputed(){return this.timeFilterModeVal+this.startSecond+this.mode},diffRowData(){return this.rowData.map((e,a,i)=>({...e,diff:a===0?0:i[a].timestamp-i[a-1].timestamp}))},view(){return this.treeData[this.curView.value]}},methods:{async colFilter(e){var l;const a=e.keyName==="name"?null:"";let i={selectItem:e.keyName,...this.showData,[e.keyName]:a},o;try{o=await g.blfTraceFromLogging.getFiltItems(i)}catch(c){}console.log(o);let s=(((l=o==null?void 0:o.data)==null?void 0:l.data)||[]).map(c=>({value:c,label:e.keyName==="canId"?"0x"+c.toString(16):c===""?" 空":c})).sort((c,u)=>(e.type==="number"?+c.value>+u.value:c.value>u.value)?1:-1);return console.log(s,111111111),s},importFile(){this.modal.visible=!0},onCancelImportFile(){this.modal.visible=!1},resetTimeData(){clearTimeout(v),this.directory="",this.backBlock=!1,this.tableLoading=!1,this.isParsing=!1,this.onceLooped=!1,this.expandKeys.clear(),this.barChartData=[],this.sliderMsVal=0,this.lastMsecond=1,this.startSecond=0,this.startSqlId=0,this.endSqlId=0,this.rowData=[],this.columnsDef.forEach(e=>{e.value=e.keyName==="name"?null:""})},startParse(){this.isParsing=!0,D=new AbortController,g.blfTraceFromLogging.initBlf({filePath:this.directory},{signal:D.signal}).finally(()=>{this.isParsing=!1,clearTimeout(v),this.getTableChartData(!0)})},loopGetData(){clearTimeout(v),v=setTimeout(async()=>{try{await this.getTableChartData(!0)}catch(e){}this.isParsing&&this.loopGetData()},2e3)},async getTableChartData(e){var s;let a,i;(!this.onceLooped||!e)&&(this.tableLoading=!0);try{i=e?this.onceLooped?"":0:(this.sliderMsVal||0)/1e3||"",a=await g.blfTraceFromLogging.showLoggingMessage({moreThanTimeStamp:i,lessThanTimeStamp:"",moreThanSqlID:"",lessThanSqlID:"",...this.showData,sqlId:"",numbers:100,canData:this.filterCanData})}catch(l){this.tableLoading=!1;return}let o=a.data;(!this.onceLooped||!e)&&(o.forEach(l=>{l.isExpand=!1,l.isParent=!0,l.id=""+l.sqlId,l.canId=l.arbitrationId,delete l.arbitrationId}),o.length!==0&&(this.startSqlId=o[0].sqlId,this.endSqlId=o[o.length-1].sqlId,this.sliderMsVal=o[0].timestamp*1e3),this.rowData=Object.freeze(o),(s=this.$refs.table)==null||s.scrollToItem(0)),this.tableLoading=!1,o.length!==0&&!this.onceLooped&&(this.onceLooped=!0);let t;try{t=await g.blfTraceFromLogging.getGroupCount({...this.showData})}catch(l){return}this.barChartData=[],t.data.startTime!=null&&(this.startSecond=t.data.startTime),t.data.data.length<2&&(t.data.data.unshift([0,0]),t.data.data.push([parseInt(this.lastMsecond/1e3+1),0])),t.data.data.length>0&&(this.lastMsecond=t.data.data.map(l=>l[0]).sort((l,c)=>c-l)[0]*1e3),this.$nextTick(()=>{this.barChartData=Object.freeze([{name:"帧数/秒",t:t.data.data.map(l=>l[0]+this.startSecond),v:t.data.data.map(l=>{let c=new Number(l[1]);return c.toString=()=>l[1],c.valueOf=()=>Math.sqrt(Math.sqrt(l[1])),c}),color:"#EC7F00",enums:[],cycle:Number.MAX_SAFE_INTEGER}])})},getSelectData(e){if(this.tableLoading)return;let a="",i="",o="",t="";switch(e){case"up":t=this.startSqlId;break;case"down":o=this.endSqlId;break;case"pick":this.expandKeys.clear(),this.rowData=[],a=this.sliderMsVal/1e3;break}this.tableLoading=!0,g.blfTraceFromLogging.selectData({moreThanTimeStamp:a,lessThanTimeStamp:i,moreThanSqlID:o,lessThanSqlID:t,...this.showData,sqlId:"",numbers:100,canData:this.filterCanData}).then(s=>{var l,c,u;if(((c=(l=s==null?void 0:s.data)==null?void 0:l.data)==null?void 0:c.length)>=0){let r=s.data.data;switch(typeof((u=r[0])==null?void 0:u.timestamp)=="number"&&(this.sliderMsVal=r[0].timestamp*1e3),r.forEach(d=>{d.isExpand=!1,d.isParent=!0,d.id=d.sqlId,d.canId=d.arbitrationId,delete d.arbitrationId}),e){case"up":r=r.filter(d=>!this.rowData.some(h=>h.sqlId===d.sqlId)),this.rowData=Object.freeze([...r,...this.rowData.map(d=>({...d}))]),typeof s.data.startSqlId=="number"&&(this.startSqlId=s.data.startSqlId),this.$nextTick(()=>{this.$refs.table.scrollToItem(s.data.data.length-1)});break;case"down":r=r.filter(d=>!this.rowData.some(h=>h.sqlId===d.sqlId)),this.rowData=Object.freeze([...this.rowData.map(d=>({...d})),...r]),typeof s.data.endSqlId=="number"&&(this.endSqlId=s.data.endSqlId);break;case"pick":typeof s.data.startSqlId=="number"&&(this.startSqlId=s.data.startSqlId),typeof s.data.endSqlId=="number"&&(this.endSqlId=s.data.endSqlId),this.rowData=Object.freeze(r),this.$nextTick(()=>{this.$refs.table.scrollToItem(0)});break}}}).finally(()=>{this.tableLoading=!1})},onClicked(){},onScrollAction(e){},onBodyScrollEnd(e){this.getSelectData(e)},onCheckView(e){console.log("data121212",e),this.resetTimeData(),this.$nextTick(()=>{this.modal.visible=!1,this.carType=e.carType,this.sdb=e.sdb,this.directory=L(e.directory),this.files=e.files.length?e.files:void 0,this.comments=e.comments.length?e.comments:void 0,this.fileType=e.fileType,this.$nextTick(async()=>{this.carType==="custom"?await g.blfTraceFromLogging.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then(a=>{this.defaultOptions=Object.freeze(a.data)}):await g.blfTraceFromLogging.reAdjust(e.sendReAdjust),this.startParse(),this.loopGetData()})}),A.report("track","click",{element_name:"帧分析",asset_name:this.directory+";",tip:"1174.17.0.1.33180"})},async onToggleExpand(e,a,i){if(this.tableLoading)return;this.tableLoading=!0;const o=a.map(l=>({...l})),t=o[e],s=t.channel+"-"+t.canId;if(i||!t.isExpand){this.expandKeys.add(s);let l;this.tableLoading=!0;try{l=await g.blfTraceFromLogging.parsedSignal({channel:t.channel,canId:""+t.canId,canData:(t.data||[]).map(r=>r.toString(16))})}catch(r){}this.tableLoading=!1;let c=((l==null?void 0:l.data)||[]).sort((r,d)=>r.name<d.name?-1:1)||[],u=t.sqlId;if(c.forEach((r,d)=>{r.channel=t.channel,r.canId=""+t.canId,r.isParent=!1,r.isExpand=!0,r.isChildTit=!1,r.id=u+"-"+r.name}),c.unshift({channel:t.channel,canId:""+t.canId,isParent:!1,isExpand:!0,isChildTit:!0,id:u+"-"}),o.splice(e+1,0,...c),t.isExpand=c.length,i)return this.tableLoading=!1,c;this.rowData=Object.freeze(o)}else this.expandKeys.delete(s),o.splice(e+1,o[e].isExpand),o[e].isExpand=!1,this.rowData=Object.freeze(o);this.tableLoading=!1},onSliderChange(e){this.sliderMsVal=e,this.getSelectData("pick")},async onColFilterChange(e){console.log("filterch",e);let a=this.columnsDef.find(i=>e.keyName===i.keyName);a&&(a.value=e.value),this.rowData=[],this.getTableChartData()},showMessage({level:e,content:a,timeout:i}){clearTimeout($),e!=null&&(this.message.level=e),a!=null&&(this.message.content=a),this.message.visible=!0,i>0&&($=setTimeout(()=>{this.message.visible=!1},i))},onClickDot(e){e.start>0&&(this.sliderMsVal=(e.start-this.startSecond)*1e3,this.getSelectData("pick"))},timestampToTime(e){var a=new Date(e),i=a.getHours(),o=a.getMinutes(),t=o<10?"0"+o:o,s=a.getSeconds(),l=s<10?"0"+s:s;return i+":"+t+":"+l},onExportArea(e,a){e.startTime=(e.startTime-this.startSecond).toFixed(6),e.endTime=(e.endTime-this.startSecond).toFixed(6);let i="blf",o="BLF文件 (*.blf;*.BLF)";switch(e.type){case"blf":i="blf",o="BLF文件 (*.blf;*.BLF)";break;case"csv":i="csv",o="CSV文件 (*.csv;*.CSV)";break;case"asc":i="asc",o="ASC文件 (*.asc;*.ASC)";break}W.choosePath({directory:this.directory.replace(/\/[^\/]+$/,""),saveFilename:this.directory.match(/\/([^\/]+)$/)[1].replace(/.blf|.dat|.mdf|.mf4|.asc|.log/i,"_cut-".concat(e.start,"-").concat(e.end,".").concat(i)),dialogType:"SAVE_DIALOG",fileTypes:[o],allow_multiple:!1}).then(t=>{if(t.data.directory){const s=L(t.data.directory);L(this.directory),this.showMessage({level:"loading",content:"导出中..."});let l="";z=="mac"?s.includes(e.type)?l=s:l=s+e.type:l=s;let c={conditions:{startTimeStamp:e.startTime,endTimeStamp:e.endTime,channel:this.showData.channel,canId:this.showData.canId,name:this.showData.name,canType:this.showData.canType,dir:this.showData.dir,dlc:this.showData.dlc,timeType:this.timeFilterModeVal},outFile:l};g.blfTraceFromLogging.getExportFile({data:c}).then(u=>{console.log(u),u.data.msg=="success"?(this.showMessage({level:"success",content:"导出成功",timeout:2e3}),this.downloadMessage.path=l,this.downloadMessage.show=!0):this.showMessage({level:"error",content:"导出失败",timeout:2e3})}).catch(u=>{console.log(u)})}}),A.report("track","click",{element_name:"帧分析",asset_name:this.directory+";",tip:"1174.17.0.1.33643"})},onTimeModeChange(e){this.timeFilterModeVal=e},onDataFilterChange(e){this.filterCanData=e,this.rowData=[],this.getTableChartData(),console.log("this.filterCanData",this.filterCanData)}}},Oe=e=>(U("data-v-71448008"),e=e(),R(),e),ze={class:"frame-analysis"},We=Oe(()=>n("i",{class:"lead-icon"},null,-1)),$e={class:"record-header-message"},Ye={class:"record-header-message-imp"},je={class:"record-header-message-imp"},Xe={class:"o-pul-er"},Ge={class:"o-chart-wrap"},Ke=["data-empty"],Ze={key:1,class:"o-console-progress"},Je={class:"o-table-wrap"},Qe={key:0,class:"spin-er"};function et(e,a,i,o,t,s){const l=b("Button"),c=b("Header"),u=b("EvTimeplot"),r=b("ProgressBar"),d=b("ScrollBar"),h=b("TableRecycleScroller"),V=b("ImportFileDialog"),Y=b("Message");return m(),p("div",ze,[w(c,{title:"查看报文-帧分析",quitConfirm:s.quitConfirm,backBlock:t.backBlock},{default:M(()=>[w(l,{type:"primary",class:"header-import-btn",disabled:t.isParsing,onClick:s.importFile},{default:M(()=>[We,k("导入文件")]),_:1},8,["disabled","onClick"]),n("span",$e,[k("  文件："),n("span",Ye,f(s.directoryLabel||"--"),1),F(n("span",{style:{color:"#333","text-shadow":"0 0.3px currentColor"}},"（"+f(t.directorySize.label)+"）",513),[[q,t.directorySize.value]]),k("  DBC配置："),n("span",je,f(s.carTypeLabel)+f(t.sdb||"--"),1)])]),_:1},8,["quitConfirm","backBlock"]),n("div",Xe,[n("div",Ge,[n("div",{class:"o-console-er","data-empty":t.barChartData.length===0&&t.directorySize.durationMaybe===0},[t.barChartData.length?(m(),P(u,{key:0,timeData:t.barChartData,startTime:t.startSecond,exportCycleValue:t.exportCycleValue,exportTypeValue:t.exportTypeValue,exportCycleOptions:t.exportCycleOptions,exportTypeOptions:t.exportTypeOptions,onExportAreaData:s.onExportArea,onClickDot:s.onClickDot,timeFilter:t.timeFilterModeVal,path:"bars",fill:!0,mode:"shifted"},null,8,["timeData","startTime","exportCycleValue","exportTypeValue","exportCycleOptions","exportTypeOptions","onExportAreaData","onClickDot","timeFilter"])):C("",!0),t.directorySize.durationMaybe&&t.isParsing?(m(),p("div",Ze,[w(r,{style:{top:"0"},second:t.directorySize.durationMaybe},null,8,["second"])])):C("",!0)],8,Ke)]),n("div",Je,[w(d,{modelValue:t.sliderMsVal,"onUpdate:modelValue":a[0]||(a[0]=N=>t.sliderMsVal=N),start:0,end:t.lastMsecond,startTime:t.startSecond*1e3,timeFilter:t.timeFilterModeVal!="relative"?"absolute":"relative",onChange:s.onSliderChange},null,8,["modelValue","end","startTime","timeFilter","onChange"]),w(h,{rowData:s.diffRowData,filters:s.showData,columnsDef:t.columnsDef,onToggleExpand:a[1]||(a[1]=N=>s.onToggleExpand(N,t.rowData)),onScrollRow:s.onBodyScrollEnd,onScrollAction:s.onScrollAction,onClick:s.onClicked,columnsFilter:s.colFilter,from:"frameAnalysis",onColFilterChange:s.onColFilterChange,onTimeModeChange:s.onTimeModeChange,onDataFilterChange:s.onDataFilterChange,ref:"table",style:{height:"100%"}},null,8,["rowData","filters","columnsDef","onScrollRow","onScrollAction","onClick","columnsFilter","onColFilterChange","onTimeModeChange","onDataFilterChange"]),t.tableLoading?(m(),p("div",Qe)):C("",!0)])]),t.modal.visible?(m(),P(V,{key:0,from:"frameAnalysis",title:t.modal.title,onCancel:s.onCancelImportFile,curViewInx:t.curView.value,onImportFileSubmit:s.onCheckView,hisDirectory:t.directory,carType:t.carType,sdb:t.sdb},null,8,["title","onCancel","curViewInx","onImportFileSubmit","hisDirectory","carType","sdb"])):C("",!0),w(Y,{message:t.message},null,8,["message"])])}const pt=I(Re,[["render",et],["__scopeId","data-v-71448008"]]);export{pt as default};
