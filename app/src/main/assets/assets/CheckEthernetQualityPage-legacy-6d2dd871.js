System.register(["./Header-legacy-497a3a4c.js","./Button-legacy-e4bab9f4.js","./Message-legacy-513a281d.js","./index-legacy-800c9beb.js"],(function(e,t){"use strict";var a,o,s,l,i,n,r,c,d,p,m,h,u,g,N,C,D,_,y;return{setters:[e=>{a=e.H},e=>{o=e.B},e=>{s=e.M},e=>{l=e._,i=e.k,n=e.e,r=e.r,c=e.c,d=e.h,p=e.d,m=e.i,h=e.w,u=e.v,g=e.t,N=e.j,C=e.o,D=e.a,_=e.p,y=e.b}],execute:function(){let t,T=0,v=0;const b={props:["store","closeFlag"],components:{Button:o,Header:a,Message:s},data:()=>({tolerance:"0.2",chartDataLoaded:!0,directory:window.downloadPath+"/20221208000146_100.blf",pullList:{total:{label:"全量采集数据",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},dialogMaster:{label:"DialogMaster日志",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},modal:{visible:!1,resultVisible:!1},pullLoading:!1,pullLoadingProgress:"",consoleText:"",message:{visible:!1,level:"",content:""},SDBVersion:[{name:"E3"}],SDBVal:"E3",onFlag:!0,EthernetArr:[{NetName:"VCCD_inter_diag",NetNameCn:"检测VCCD内部诊断通路",ip:"172.16.33.2"},{NetName:"VCCD_outer_diag",NetNameCn:"检测VCCD外部诊断通路",ip:"169.254.65.2"},{NetName:"VCCD_reliable_DDS",NetNameCn:"检测VCCD可靠DDS的通路",ip:"172.16.45.2"},{NetName:"VCCD_unreliable_DDS",NetNameCn:"检测VCCD不可靠DDS的通路",ip:"172.16.46.2"},{NetName:"VCCD_public_net",NetNameCn:"检测VCCD公网通路",ip:"172.16.100.2"},{NetName:"VCCD_private_net",NetNameCn:"检测VCCD私网通路",ip:"172.16.102.2"},{NetName:"TBOX_inter_diag",NetNameCn:"检测TBOX内部诊断通路",ip:"172.16.33.66"},{NetName:"TBOX_outer_diag",NetNameCn:"检测TBOX外部诊断通路",ip:"169.254.65.66"},{NetName:"TBOX_reliable_DDS",NetNameCn:"检测TBOX可靠DDS的通路",ip:"172.16.45.66"},{NetName:"TBOX_unreliable_DDS",NetNameCn:"检测TBOX不可靠DDS的通路",ip:"172.16.46.66"},{NetName:"TBOX_public_net",NetNameCn:"检测TBOX公网通路",ip:"172.16.100.66"},{NetName:"TBOX_private_net",NetNameCn:"检测TBOX私网通路",ip:"172.16.102.66"},{NetName:"DCD_inter_diag",NetNameCn:"检测DCD内部诊断通路",ip:"172.16.33.33"},{NetName:"ADD_inter_diag",NetNameCn:"检测ADD内部诊断通路",ip:"172.16.33.98"},{NetName:"public_net",NetNameCn:"检测TSP通路",ip:"https://pre-oms.tsp.mioffice.cn/#/"}]}),watch:{closeFlag(e){0==this.onFlag&&this.showMessage({timeout:-1})}},computed:{pullDataValid(){return!!(this.directory&&this.tolerance&&this.SDBVal)},quitConfirm(){return!this.chartDataLoaded}},mounted(){N.report("trackPage",{page:"检查以太网状态",tip:"1174.3.0.1.27750"})},unmounted(){},methods:{choosePath(){i.choosePath({directory:this.directory,dialogType:"OPEN_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then((e=>{e.data.directory&&(this.directory=e.data.directory)}))},async startEthernet(){N.report("track","click",{element_name:"开始检查",asset_name:"开始检查以太网",tip:"1174.3.0.1.27751"}),this.onFlag=!1,this.chartDataLoaded=!1,t=new AbortController,this.consoleText=" 检查中...\n",await n.base.NetworkDiagStart(t.signal).then((e=>{let t=e.data;if(console.log("Etherres>>>>",t),"Failure"==t.TCP_state)this.consoleText+="\nTCP连接失败\n",this.stopEthernet();else{let a=this;async function o(){for(let e of a.EthernetArr){if(1==a.onFlag)break;let t=await n.base.NetworkDiag({NetName:e.NetName}).then((t=>{"Failure"==t.data[e.NetName]?a.consoleText+="\0🔴\0"+e.NetNameCn+" ("+e.ip+")\0\n":a.consoleText+="\0🟢\0"+e.NetNameCn+" ("+e.ip+")\0\n"})).catch((t=>{a.consoleText+="\0🔴\0"+e.NetNameCn+" ("+e.ip+")\0\n"})).finally((()=>{setTimeout((()=>{window.document.querySelector(".o-console-body")&&(window.document.querySelector(".o-console-body").scrollTop=99999999)}))}));console.log("res>>>>",t)}0==a.onFlag&&(a.consoleText+=" 网络状态检查完毕！\n"),a.stopEthernet()}o()}})).finally((()=>{this.chartDataLoaded=!0}))},async stopEthernet(){t.abort(),this.onFlag=!0,this.chartDataLoaded=!0,v=setTimeout((()=>{this.consoleText+="\n已中断检查\n"}),3e3),await n.base.NetworkDiagEnd().then((e=>{let t=e.data;console.log(t,"resp"),t.TCP_state})).catch((e=>{})),this.EthernetArr=[],clearInterval(0),clearTimeout(v)},async exportResult(){N.report("track","click",{element_name:"导出结果",asset_name:"",tip:"1174.3.0.1.27763"});let e="check-ethernet-quality"+(new Date).valueOf(),t=window.downloadPath;await i.choosePath({directory:t,dialogType:"SAVE_DIALOG",saveFilename:e+".txt",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then((a=>{a.data.directory&&(console.log("saveFilename2222",e,t),n.blf.exportExeLog({content:this.consoleText,directory:a.data.directory}).then((e=>{"0"==e.data.code&&this.showMessage({timeout:5e3,level:"success",content:"导出成功"})})).catch((e=>{console.log(e)})))}))},showMessage({level:e,content:t,timeout:a}){clearTimeout(T),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(T=setTimeout((()=>{this.message.visible=!1}),a))},hideMessage(){this.message.visible=!1},cannel(){this.modal.visible=!1},submit(){this.modal.visible=!1,this.onFlag=!this.onFlag,this.stopEthernet()},resultCannel(){this.modal.resultVisible=!1}}},w=e=>(_("data-v-4a196db3"),e=e(),y(),e),f={class:"pull-dt-page"},x={class:"o-pul-er"},k={key:0,class:"o-pul-p"},B=w((()=>p("i",{class:"play-icon"},null,-1))),S={key:1,class:"o-pul-p"},V=w((()=>p("i",{class:"stop-icon"},null,-1))),L=["data-empty"],E={class:"o-console-wrap"},F=w((()=>p("div",{class:"o-console-title"},"检查进度",-1))),O=["data-loading"],P={class:"o-modal-wrap"},M={class:"o-modal-header"},X={class:"o-modal-header-wrap"},A=w((()=>p("div",{class:"o-modal-title"},"提示",-1))),q=w((()=>p("div",{class:"o-modal-container"},[p("span",{class:"record-header-message"},"任务还在执行中，此时关闭TSP助手会终断此任务，确认要继续关闭吗？")],-1))),j={class:"o-modal-footer"},H={class:"o-modal-footer-wrap"};e("default",l(b,[["render",function(e,t,a,o,s,l){const i=r("Header"),n=r("Button"),N=r("Message");return C(),c("div",f,[d(i,{title:"检查以太网状态",quitConfirm:l.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),p("div",x,[s.onFlag?(C(),c("div",k,[d(n,{type:"primary",disabled:!l.pullDataValid,progress:s.pullLoadingProgress,loading:s.pullLoading,onClick:l.startEthernet},{default:m((()=>[B,D("开始检查")])),_:1},8,["disabled","progress","loading","onClick"])])):(C(),c("div",S,[d(n,{type:"primary",progress:s.pullLoadingProgress,loading:s.pullLoading,onClick:l.stopEthernet},{default:m((()=>[V,D("停止检查")])),_:1},8,["progress","loading","onClick"])]))]),p("div",{class:"o-console-er","data-empty":""===s.consoleText},[p("div",E,[F,h(d(n,{onClick:l.exportResult,class:"export-result"},{default:m((()=>[D("导出结果")])),_:1},8,["onClick"]),[[u,s.consoleText]])]),h(p("div",{class:"o-console-body","data-loading":!s.chartDataLoaded},g(s.consoleText),9,O),[[u,s.consoleText]])],8,L),h(p("div",P,[p("div",M,[p("div",X,[A,p("i",{class:"o-modal-title-close",onClick:t[0]||(t[0]=(...e)=>l.cannel&&l.cannel(...e))})]),q,p("div",j,[p("div",H,[d(n,{style:{width:"52px"},onClick:l.cannel},{default:m((()=>[D("取消")])),_:1},8,["onClick"]),d(n,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:l.submit},{default:m((()=>[D("确定")])),_:1},8,["onClick"])])])])],512),[[u,this.modal.visible]]),d(N,{message:s.message},null,8,["message"])])}],["__scopeId","data-v-4a196db3"]]))}}}));
