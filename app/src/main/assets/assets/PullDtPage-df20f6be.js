import{H as M}from"./Header-785b3a15.js";import{B as q}from"./Button-4b00caa8.js";import{M as P}from"./Message-606cdffe.js";import{_ as V,k as R,e as _,j as b,r as f,l as U,c as u,h as d,d as s,F as E,m as F,i as h,a as i,w as m,t as g,v as w,o as v,n as z,p as I,b as B}from"./index-51fb23a6.js";let D=0,C=0;const N={props:["store"],components:{Button:q,Header:M,Message:P},data(){let e={pullType:"total",chartDataLoaded:!0,directory:window.downloadPath,pullList:{total:{sshURL:1,label:"MS11全量采集数据",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool,/vde/pool/base,/vde/pool"},MX11DataLog:{sshURL:3,label:"MX11全量采集数据",size:"",paths:"/vde/pool"},dialogMaster:{sshURL:1,label:"DialogMaster日志",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"},dcd:{sshURL:2,label:"DCD日志",size:"",paths:"/var/log"},vdeLog:{sshURL:1,label:"vde日志",size:"",paths:"/log/vde,/persistence/vde/log/mgr,/vde/log/mgr"},shadowLog:{sshURL:1,label:"shadow日志",size:"",paths:"/log/shadow,/persistence/vde/log/shadow,/vde/log/shadow"},OTALog:{sshURL:1,label:"OTA日志",size:"",paths:"/persistence/otamaster,/log/A-core/OTA"}},pullLoading:!1,pullLoadingProgress:"",consoleText:"",message:{visible:!1,level:"",content:""},modal:{visible:!1},clearDataLoaded:!0};return window._debug||delete e.pullList.totalClearVccd,e},watch:{chartDataLoaded(e,t){e?(document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor=""):(document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".record-header").style.cursor="wait")},clearDataLoaded(e,t){e?(document.querySelector("#app").style.cursor="",document.querySelector(".o-body").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".o-body").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none")}},computed:{pullDataValid(){return!!(this.directory&&this.pullType)},quitConfirm(){return!!this.pullLoading}},mounted(){console.log(this.$props.store),b.report("trackPage",{page:"拉取日志&数据",tip:"1174.6.0.1.27753"})},unmounted(){},methods:{showInfo(){this.modal.visible=!0},choosePath(){R.choosePath({directory:this.directory,dialogType:"FOLDER_DIALOG",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then(({data:e})=>{e.directory&&(this.directory=e.directory)})},heartConsole(){_.pullData.getExeLog().then(({data:e})=>{this.consoleText+=e.data.join("\n").replace(/Active code page: 65001/g,"").replace(/^\s+/g,""),setTimeout(()=>{window.document.querySelector(".o-console-body")&&(window.document.querySelector(".o-console-body").scrollTop=99999999)})})},async pullFile(){this.pullLoading=!0,this.chartDataLoaded=!1,b.report("track","click",{element_name:"拉取数据",asset_name:this.directory+";"+JSON.stringify(this.pullType.label),tip:"1174.6.0.1.27754"}),C=setInterval(this.heartConsole,1500),this.pullLoadingProgress="0%";const e=this.pullList[this.pullType].sshURL,t=this.pullList[this.pullType].paths.split(",");let l=t.length,n=0;for(let c in t){let o=t[c],y=+c+1;this.showMessage({level:"loading",content:"下载中（".concat(y,"/").concat(t.length,"）").concat(o)});try{(await _.pullData.pullDestinationFolder({sshURL:e,destinationFolderPath:o,directory:this.directory})).data.code&&n++}catch(r){n++}this.pullLoadingProgress=Math.round((c+1)/l*100)+"%"}this.chartDataLoaded=!0,this.showMessage({level:n==l?"error":"success",content:n==l?"下载失败，请查看日志详情":"下载成功",timeout:1e4}),this.pullLoading=!1,this.pullLoadingProgress="",clearInterval(C)},showMessage({level:e,content:t,timeout:l}){clearTimeout(D),e!=null&&(this.message.level=e),t!=null&&(this.message.content=t),this.message.visible=!0,l>0&&(D=setTimeout(()=>{this.message.visible=!1},l))},hideMessage(){this.message.visible=!1},clearVdeFolder(){this.modal.visible=!0,console.log("111")},cannel(){this.modal.visible=!1},submit(){this.clearDataLoaded=!1,this.modal.visible=!1,_.pullData.clearVdeFolder().then(e=>{this.clearDataLoaded=!0,console.log("clearVde>>",e.data.msg),e.data.msg=="成功"||e.data.msg=="执行成功"?this.consoleText+="\n清除VCCD报文缓存成功\n":this.consoleText+="\n清除VCCD报文缓存失败\n"}).finally(()=>{this.clearDataLoaded=!0})}}},a=e=>(I("data-v-ebc4f5e9"),e=e(),B(),e),A={class:"pull-dt-page"},O={class:"o-pul-er"},x=a(()=>s("div",{class:"o-pul-title"},"数据拉取",-1)),H={class:"o-pul-p"},$=a(()=>s("span",{style:{color:"red"}},"* ",-1)),j=a(()=>s("span",{class:"record-header-message"},"数采类型：",-1)),X=["value"],G={class:"o-pul-p"},J=a(()=>s("span",{style:{color:"red"}},"* ",-1)),K=a(()=>s("span",{class:"record-header-message"},"保存目录：",-1)),Q={class:"o-pul-path"},W={class:"o-pul-p start-rec"},Y=["data-empty"],Z=a(()=>s("div",{class:"o-console-title"},"拉取进度 ",-1)),ee=["data-loading"],se={class:"o-modal-wrap"},te={class:"o-modal-header"},oe={class:"o-modal-header-wrap"},ae=a(()=>s("div",{class:"o-modal-title"},"提示",-1)),le=a(()=>s("div",{class:"o-modal-container"},[s("span",{class:"record-header-message"},"清除不可逆，确定要清除VCCD报文缓存吗？")],-1)),ie={class:"o-modal-footer"},re={class:"o-modal-footer-wrap"};function de(e,t,l,n,c,o){const y=f("Header"),r=f("Button"),T=f("Message"),S=U("tooltip");return v(),u("div",A,[d(y,{title:"拉取日志&数据",quitConfirm:o.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),s("div",O,[x,s("div",H,[$,j,(v(!0),u(E,null,F(e.pullList,(p,L)=>(v(),u("label",{class:"o-input",key:L},[m(s("input",{name:"pull_type",type:"radio","onUpdate:modelValue":t[0]||(t[0]=k=>e.pullType=k),value:L},null,8,X),[[z,e.pullType]]),i(g(p.label)+" "+g(p.size)+" ",1)]))),128))]),s("div",G,[J,K,d(r,{onClick:o.choosePath,class:"choose-path"},{default:h(()=>[i("选择路径")]),_:1},8,["onClick"]),i("  "),m((v(),u("span",Q,[i(g(e.directory),1)])),[[S,{content:e.directory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),s("div",W,[d(r,{type:"primary",disabled:!o.pullDataValid,progress:e.pullLoadingProgress,loading:e.pullLoading,onClick:o.pullFile},{default:h(()=>[i("拉取数据")]),_:1},8,["disabled","progress","loading","onClick"])])]),s("div",{class:"o-console-er","data-empty":e.consoleText===""},[Z,m(s("div",{class:"o-console-body","data-loading":!e.chartDataLoaded},g(e.consoleText),9,ee),[[w,e.consoleText]])],8,Y),m(s("div",se,[s("div",te,[s("div",oe,[ae,s("i",{class:"o-modal-title-close",onClick:t[1]||(t[1]=(...p)=>o.cannel&&o.cannel(...p))})]),le,s("div",ie,[s("div",re,[d(r,{style:{width:"52px"},onClick:o.cannel},{default:h(()=>[i("取消")]),_:1},8,["onClick"]),d(r,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:o.submit},{default:h(()=>[i("确定")]),_:1},8,["onClick"])])])])],512),[[w,this.modal.visible]]),d(T,{message:e.message},null,8,["message"])])}const he=V(N,[["render",de],["__scopeId","data-v-ebc4f5e9"]]);export{he as default};
