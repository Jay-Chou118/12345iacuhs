System.register(["./Button-legacy-9a048350.js","./Message-legacy-77c5c54f.js","./index-legacy-0328131b.js","./ButtonGroup-legacy-88542595.js"],(function(e,t){"use strict";var l,a,s,o,n,i,d,r,c,p,u,h,m,g,v,C,y,k,f,b,w,V;return{setters:[e=>{l=e.B},e=>{a=e.M},e=>{s=e._,o=e.k,n=e.s,i=e.e,d=e.S,r=e.r,c=e.l,p=e.c,u=e.d,h=e.t,m=e.h,g=e.i,v=e.a,C=e.w,y=e.v,k=e.j,f=e.o,b=e.p,w=e.b},e=>{V=e.B}],execute:function(){const D=""+new URL("logo-04bf574b.png",t.meta.url).href;let B=0;const U={props:["store"],components:{Button:l,ButtonGroup:V,Message:a},data:()=>({theme:{options:[{label:"跟随系统",value:"follow"},{label:"浅色",value:"light"},{label:"深色",value:"dark"}],mode:"follow"},user:window._userInfo,debug:window._debug,modal:{visible:!1},popUpdateModal:{visible:!1},newestVersion:"",localVersion:"",localDBCVersion:"",latestLocalDBCVersion:"",btnCheckFlag:"noChecked",updateDataLoaded:!0,updateLoading:!1,updateDBCVersionLoading:!1,updateProgress:"",updateDBCVersionProgress:"",updatePath:"",message:{visible:!1,level:"",content:""}}),watch:{"theme.mode"(e){document.documentElement.setAttribute("theme",e),this.$ls.set("theme",e)},updateDataLoaded(e,t){e?(document.querySelector("#app").style.cursor="",document.querySelector(".o-body").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".o-body").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none")}},computed:{pullDataValid(){return!(!this.directory||!this.pullType)},expDay(){return this.user.exp>0?parseInt((1e3*this.user.exp-Date.now())/24/36e5):0}},mounted(){this.checkUpset(),this.getLocalDBCVersion(),this.theme.mode=this.$ls.get("theme"),k.report("trackPage",{page:"设置",tip:"1174.9.0.1.27761"})},unmounted(){},methods:{setTheme(e){let t=document.querySelector("#theme-style");t&&"light"===e?t.parentElement.removeChild(t):t||"dark"!==e||(t=document.createElement("style"),t.innerHTML="html,img{filter: invert(.9) hue-rotate(.5turn)}img{opacity: .75}",document.body.appendChild(t))},cannelPopUpdateModal(){this.popUpdateModal.visible=!1},readChangelog(){o.openWeb("https://xiaomi.f.mioffice.cn/docx/doxk439aDwvVEaJ5T0ZFL0ajLFd")},goHelp(){o.openWeb("https://xiaomi.f.mioffice.cn/docx/doxk4UIXGVGMfVTv798lNcwlmWG")},goCs(){let e="lark://applink.feishu.cn/client/chat/chatter/add_by_link?link_token=1cfib1d2-9877-4062-bc03-6c41be677j6i";if("windows"==n){let t=document.createElement("iframe");t.src=e,t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",document.body.appendChild(t),setTimeout((()=>{document.body.removeChild(t)}),100)}else o.openWeb(e)},checkUpset(){"windows"===n&&(this.localVersion=o.getVersion(),i.base.GetLatestVersion().then((({data:e})=>{e.latest_version&&(this.newestVersion=e.latest_version,this.localVersion==this.newestVersion?this.btnCheckFlag="":(this.btnCheckFlag="update",this.popUpdateModal.visible=!0))})).catch((e=>{e&&(this.btnCheckFlag="noChecked")})))},async clickDBCVersionUpset(){this.updateDBCVersionLoading=!0,this.updateDataLoaded=!1,await i.confUpdate.update({file_type:"DBC",new_version:this.latestLocalDBCVersion}).then((async e=>{0===e.data.code&&(this.localDBCVersion=this.latestLocalDBCVersion,await i.confUpdate.get_newConf({file_type:"DBC"}).then((e=>{let t=e.data,l=[];for(let a in t){let e=[];for(let l in t[a]){let s=Object.keys(t[a][l]).map((e=>+e)),o=Array.from({length:Math.max(...s)+1},((e,o)=>s.includes(o)?t[a][l][""+o].replace(/^Channel \d+:/,""):""));e.unshift({label:l,value:l,comments:o})}l.push({label:a,value:a,children:e})}d.DEFAULT=l})))})).catch((e=>{this.showMessage({level:"error",content:e.msg,timeout:2e3})})).finally((()=>{this.updateDBCVersionLoading=!1,this.updateDataLoaded=!0}))},getLocalDBCVersion(){i.confUpdate.getCurrentVersion({file_type:"DBC"}).then((e=>{this.localDBCVersion=e.data.current_version}))},async clickUpset(){this.popUpdateModal.visible=!1,this.updateDataLoaded=!1,this.updateLoading=!0,B=setInterval((()=>{this.wheelGetVersion()}),1e3),await i.swUpdate.pullSoftware({latest_version:this.newestVersion}).then((e=>{this.updatePath=e.data})).finally((()=>{clearInterval(B),this.updateLoading=!1,this.updateDataLoaded=!0,this.modal.visible=!0}))},async wheelGetVersion(){let e=await i.swUpdate.getROP();this.updateProgress=e.data+"%"},async updateVersion(){await i.swUpdate.Update({load_path:this.updatePath})},submit(){this.updateVersion()},cannel(){this.modal.visible=!1},async checkUpsetVersion(){await i.confUpdate.getLastestConf({file_type:"DBC"}).then((e=>{200===e.status&&(this.latestLocalDBCVersion=e.data.DBC_latest_version)}))},showMessage({level:e,content:t,timeout:l}){clearTimeout(msgTimer),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,l>0&&(msgTimer=setTimeout((()=>{this.message.visible=!1}),l))}}},L=e=>(b("data-v-5227b5a4"),e=e(),w(),e),_={class:"setting-page"},x=L((()=>u("div",{class:"setting-page-header"},"设置",-1))),M={class:"setting-er"},P={class:"setting-content"},E=L((()=>u("h2",null,"App",-1))),T=L((()=>u("hr",null,null,-1))),S={key:0,class:"btn-wrap"},F=L((()=>u("span",null,"未监测到新版本。点击“检查更新”试试~",-1))),G={key:1,class:"btn-wrap"},j={key:2,class:"btn-wrap"},q=L((()=>u("hr",null,null,-1))),I={key:3,class:"btn-wrap"},A=L((()=>u("span",null,"未监测到新版本。点击“检查更新”试试~",-1))),H={key:4,class:"btn-wrap"},W={key:5,class:"btn-wrap"},N=L((()=>u("hr",null,null,-1))),O=L((()=>u("h3",null,"主题",-1))),R=L((()=>u("hr",null,null,-1))),$=L((()=>u("h3",null,"获取帮助",-1))),J=L((()=>u("br",null,null,-1))),X=L((()=>u("h2",null,"账户",-1))),Z=L((()=>u("hr",null,null,-1))),z=L((()=>u("h3",null,"你的账户",-1))),K={class:"avatar"},Q=["src"],Y=L((()=>u("br",null,null,-1))),ee=L((()=>u("br",null,null,-1))),te={class:"icon-ques"},le={class:"o-modal-wrap"},ae={class:"o-modal"},se={class:"o-modal-header"},oe={class:"o-modal-header-wrap"},ne=L((()=>u("div",{class:"o-modal-title"},"提示",-1))),ie=L((()=>u("div",{class:"o-modal-container"},[u("span",{class:"record-header-message"},"确认更新最新版本？")],-1))),de={class:"o-modal-footer"},re={class:"o-modal-footer-wrap"},ce={class:"o-modal-wrap"},pe={class:"o-modal"},ue={class:"o-modal-header"},he={class:"o-modal-header-wrap"},me=L((()=>u("div",{class:"o-modal-title"}," ",-1))),ge={class:"o-modal-container"},ve=L((()=>u("img",{src:D,class:"update-logo"},null,-1))),Ce=L((()=>u("br",null,null,-1))),ye={class:"record-header-message"},ke={class:"o-modal-footer"},fe={class:"o-modal-footer-wrap"};e("default",s(U,[["render",function(e,t,l,a,s,o){const n=r("Button"),i=r("ButtonGroup"),d=r("Message"),k=c("tooltip");return f(),p("div",_,[x,u("div",M,[u("div",P,[E,T,u("h3",null,"当前版本："+h(s.localVersion),1),u("div",null,[u("a",{class:"link",onClick:t[0]||(t[0]=(...e)=>o.readChangelog&&o.readChangelog(...e))},"阅读更新日志")]),"noChecked"==s.btnCheckFlag?(f(),p("div",S,[F,m(n,{style:{float:"right"},onClick:o.checkUpset},{default:g((()=>[v("检查更新")])),_:1},8,["onClick"])])):""==s.btnCheckFlag?(f(),p("div",G,[u("span",null,"（在线程序版本："+h(s.newestVersion)+"）你使用的是最新版本！",1),m(n,{style:{float:"right"},onClick:o.checkUpset},{default:g((()=>[v("检查更新")])),_:1},8,["onClick"])])):(f(),p("div",j,[u("span",null,"（在线程序版本："+h(s.newestVersion)+"）你使用的不是最新版本,请下载更新！",1),m(n,{style:{float:"right"},onClick:o.clickUpset,type:"primary",progress:s.updateProgress,loading:s.updateLoading},{default:g((()=>[v("下载更新")])),_:1},8,["onClick","progress","loading"])])),q,u("h3",null,"当前DBC版本："+h(s.localDBCVersion),1),""==s.latestLocalDBCVersion?(f(),p("div",I,[A,m(n,{style:{float:"right"},onClick:o.checkUpsetVersion},{default:g((()=>[v("检查更新")])),_:1},8,["onClick"])])):s.latestLocalDBCVersion==s.localDBCVersion?(f(),p("div",H,[u("span",null,"（在线程序版本："+h(s.latestLocalDBCVersion)+"）你使用的是最新版本！",1),m(n,{style:{float:"right"},onClick:o.checkUpsetVersion},{default:g((()=>[v("检查更新")])),_:1},8,["onClick"])])):(f(),p("div",W,[u("span",null,"（在线程序版本："+h(s.latestLocalDBCVersion)+"）你使用的不是最新版本,请下载更新！",1),m(n,{style:{float:"right"},onClick:o.clickDBCVersionUpset,type:"primary",progress:s.updateDBCVersionProgress,loading:s.updateDBCVersionLoading},{default:g((()=>[v("下载更新")])),_:1},8,["onClick","progress","loading"])])),N,O,u("div",null,[m(i,{options:s.theme.options,class:"theme-btn-group",modelValue:s.theme.mode,"onUpdate:modelValue":t[1]||(t[1]=e=>s.theme.mode=e)},null,8,["options","modelValue"])]),R,$,u("div",null,[v("获取关于使用软件的 "),u("a",{class:"link",onClick:t[2]||(t[2]=(...e)=>o.goHelp&&o.goHelp(...e))},"帮助手册"),m(n,{style:{float:"right"},onClick:o.goCs},{default:g((()=>[v("联系客服")])),_:1},8,["onClick"])]),J,X,Z,z,u("div",null,[u("span",K,[u("img",{src:s.user.avatar},null,8,Q)]),u("span",null,h(s.user.displayName)+"（"+h(s.user.email)+"）"+h(s.user.departmentName),1),Y,ee,u("span",null,"许可证将在 "+h(o.expDay)+" 天后过期",1),C(u("span",te,null,512),[[k,"离线持续使用超15天后许可证失效，需连接内网自动续期。",void 0,{right:!0}]])])])]),C(u("div",le,[u("div",ae,[u("div",se,[u("div",oe,[ne,u("i",{class:"o-modal-title-close",onClick:t[3]||(t[3]=(...e)=>o.cannel&&o.cannel(...e))})])]),ie,u("div",de,[u("div",re,[m(n,{style:{width:"52px"},onClick:o.cannel},{default:g((()=>[v("取消")])),_:1},8,["onClick"]),m(n,{type:"primary",style:{width:"82px",margin:"0 0px 0 10px"},onClick:o.submit},{default:g((()=>[v("退出并更新")])),_:1},8,["onClick"])])])])],512),[[y,this.modal.visible]]),C(u("div",ce,[u("div",pe,[u("div",ue,[u("div",he,[me,u("i",{class:"o-modal-title-close",onClick:t[4]||(t[4]=(...e)=>o.cannelPopUpdateModal&&o.cannelPopUpdateModal(...e))})])]),u("div",ge,[ve,Ce,u("div",ye,[u("b",null,"发现新版本 "+h(s.newestVersion),1)])]),u("div",ke,[u("div",fe,[m(n,{type:"primary",style:{width:"82px",margin:"0 0px 0 10px"},onClick:o.clickUpset},{default:g((()=>[v("下载更新")])),_:1},8,["onClick"])])])])],512),[[y,this.popUpdateModal.visible]]),m(d,{message:s.message},null,8,["message"])])}],["__scopeId","data-v-5227b5a4"]]))}}}));
