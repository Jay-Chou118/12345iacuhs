System.register(["./Header-legacy-497a3a4c.js","./Button-legacy-e4bab9f4.js","./Message-legacy-513a281d.js","./Cascader-legacy-4749ac65.js","./CopyPath-legacy-a3dd0953.js","./index-legacy-800c9beb.js","./index-legacy-41d7d2b4.js"],(function(e,t){"use strict";var o,s,l,a,n,c,i,r,d,u,p,h,m,y,g,v,b,C,T,f,x,k,S;return{setters:[e=>{o=e.H},e=>{s=e.B},e=>{l=e.M},e=>{a=e.C},e=>{n=e.C},e=>{c=e._,i=e.S,r=e.k,d=e.e,u=e.j,p=e.r,h=e.c,m=e.h,y=e.d,g=e.i,v=e.a,b=e.w,C=e.v,T=e.t,f=e.o,x=e.p,k=e.b},e=>{S=e.n}],execute:function(){let t=0,q=0,L=0,w=0;const E={props:["store","closeFlag"],components:{Button:s,Header:o,Message:l,Cascader:a,CopyPath:n},data(){return{tolerance:"0.2",chartDataLoaded:!0,directory:"",pullList:{total:{label:"全量采集数据",size:"",paths:"/persistence/vde/pool,/tmp/vde/pool"},dialogMaster:{label:"DialogMaster日志",size:"",paths:"/log/DiagMaster,/persistence/DiagMaster"}},modal:{visible:!1,resultVisible:!1},pullLoading:!1,pullLoadingProgress:"",consoleText:"",message:{visible:!1,level:"",content:""},onFlag:!0,dbcVal:[i.DEFAULT[0].value,i.DEFAULT[0].children[0].value],sdbCustom:this.$ls.get("blfread_sdbData")||[]}},watch:{closeFlag(e){0==this.onFlag&&this.showMessage({timeout:-1})},chartDataLoaded(e,t){e?(document.querySelector("#app").style.cursor="",document.querySelector(".choose-cation").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents="",document.querySelector(".start-rec").style.pointerEvents="",document.querySelector(".o-console-er").style.pointerEvents="",document.querySelector(".record-header").style.pointerEvents="",document.querySelector(".o-che-input").style.pointerEvents="",document.querySelector(".input-cation").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".choose-cation").style.pointerEvents="none",document.querySelector(".o-console-er").style.pointerEvents="none",document.querySelector(".record-header").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none",document.querySelector(".start-rec").style.pointerEvents="",document.querySelector(".o-che-input").style.pointerEvents="none",document.querySelector(".input-cation").style.pointerEvents="none")}},computed:{pullDataValid(){return!(!this.directory||!this.tolerance)},quitConfirm(){return!!this.directory},dbcVerOpts(){return[...i.DEFAULT,{label:"自定义模板",value:"自定义模板",children:this.sdbCustom.length>0?this.sdbCustom.map((e=>({label:e.sdb,value:e.sdb,files:e.files,comments:e.comments}))):null}]},curTpl(){if("自定义模板"===this.dbcVal[0]){let e=this.sdbCustom.find((e=>e.sdb===this.dbcVal[1]));return{carType:"custom",sdb:this.dbcVal[1],files:e?.files,comments:e?.comments}}return{carType:this.dbcVal[0],sdb:this.dbcVal[1]}}},mounted(){u.report("trackPage",{page:"检查通讯质量",tip:"1174.2.0.1.27748"})},unmounted(){},methods:{choosePath(){r.choosePath({directory:this.directory,dialogType:"OPEN_DIALOG",fileTypes:["BLF文件 (*.blf;*.BLF)"],allow_multiple:!1}).then((e=>{e.data.directory&&(this.directory=S(e.data.directory))}))},heartConsole(){console.log("heartTimer",q),d.blfCheck.getExeLog().then((({data:e})=>{e.data.length>0&&(this.consoleText+=e.data.join("\n").replace(/Active code page: 65001/g,"").replace(/^\s+/g,"")+"\n"),clearTimeout(w),w=setTimeout((()=>{console.log(w,"bodyTimer"),window.document.querySelector(".o-console-body")&&(window.document.querySelector(".o-console-body").scrollTop=99999999)}))}))},async cheFile(){u.report("track","click",{element_name:"开始检查",asset_name:this.directory+";"+this.dbcVal.join(),tip:"1174.2.0.1.27749"}),this.onFlag=!1,this.chartDataLoaded=!1,clearInterval(q),clearTimeout(L),q=setInterval(this.heartConsole,1500),this.consoleText="检查中...\n",await d.blfCheck.start_check({path:this.directory,tolerance:this.tolerance,...this.curTpl}).then((e=>{let t=e.data;200==e.status&&t.length>0&&(this.consoleText+=t.join("\n")+"\n")})).catch((e=>{this.consoleText+="\n检查中断\n"})).finally((()=>{this.onFlag=!0,clearTimeout(L),L=setTimeout((()=>{console.log(L,"endTimer"),clearInterval(q),this.consoleText+="\n检查结束\n"}),2e3)})),this.chartDataLoaded=!0},async stopCheFile(){this.onFlag=!0,this.chartDataLoaded=!0,this.dataLoading=!1,this.consoleText+="\n已中断检查\n",await d.blfCheck.stopAll().then((e=>{let t=e.data;200==e.status&&(this.consoleText+=t+"\n")})).catch((e=>{this.consoleText+="\n中断检查失败\n"})),clearInterval(q)},async exportResult(){u.report("track","click",{element_name:"导出结果",asset_name:this.directory+";"+this.dbcVal.join(),tip:"1174.2.0.1.27762"});let e=this.directory.split("/").slice(-1)[0],t=this.directory.split(e)[0];console.log("1"),console.log("directoryStr",t),await r.choosePath({directory:t,dialogType:"SAVE_DIALOG",saveFilename:e+".txt",fileTypes:["所有文件 (*.*)"],allow_multiple:!1}).then((e=>{e.data.directory&&d.blfCheck.exportExeLog({content:this.consoleText,directory:e.data.directory}).then((e=>{"0"==e.data.code&&this.showMessage({timeout:5e3,level:"success",content:"导出成功"})}))}))},showMessage({level:e,content:o,timeout:s}){clearTimeout(t),null!=e&&(this.message.level=e),null!=o&&(this.message.content=o),this.message.visible=!0,s>0&&(t=setTimeout((()=>{console.log(t,"msgTimer"),this.message.visible=!1}),s))},hideMessage(){this.message.visible=!1},cannel(){this.modal.visible=!1},submit(){this.modal.visible=!1,this.onFlag=!this.onFlag,this.stopCheFile()},resultCannel(){this.modal.resultVisible=!1}}},F=e=>(x("data-v-35036f13"),e=e(),k(),e),V={class:"pull-dt-page"},_={class:"o-pul-er"},D=F((()=>y("div",{class:"o-pul-title"},"blf文件导入配置",-1))),P={class:"o-pul-p choose-cation"},j=F((()=>y("span",{style:{color:"red"}},"* ",-1))),M=F((()=>y("span",{class:"record-header-message"},"blf 文件：",-1))),A={class:"o-pul-path"},B={class:"o-pul-p input-cation"},I=F((()=>y("span",{style:{color:"red"}},"* ",-1))),O=F((()=>y("span",{class:"record-header-message"},"DBC 版本：",-1))),H={class:"o-che-input"},N={key:0,class:"o-pul-p start-rec"},U=F((()=>y("i",{class:"play-icon"},null,-1))),$={key:1,class:"o-pul-p start-rec"},R=F((()=>y("i",{class:"stop-icon"},null,-1))),z=["data-empty"],G={class:"o-console-wrap"},J=F((()=>y("div",{class:"o-console-title"},"报文检查结果",-1))),K=["data-loading"],Q={class:"o-modal-wrap"},W={class:"o-modal-header"},X={class:"o-modal-header-wrap"},Y=F((()=>y("div",{class:"o-modal-title"},"提示",-1))),Z=F((()=>y("div",{class:"o-modal-container"},[y("span",{class:"record-header-message"},"任务还在执行中，此时关闭TSP助手会终断此任务，确认要继续关闭吗？")],-1))),ee={class:"o-modal-footer"},te={class:"o-modal-footer-wrap"};e("default",c(E,[["render",function(e,t,o,s,l,a){const n=p("Header"),c=p("Button"),i=p("CopyPath"),r=p("Cascader"),d=p("Message");return f(),h("div",V,[m(n,{title:"检查报文",quitConfirm:a.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),y("div",_,[D,y("div",P,[j,M,m(c,{onClick:a.choosePath,class:"choose-path"},{default:g((()=>[v("选择文件")])),_:1},8,["onClick"]),v("  "),y("span",A,[m(i,{path:l.directory,length:60},null,8,["path"])])]),y("div",B,[I,O,y("div",H,[m(r,{options:a.dbcVerOpts,modelValue:l.dbcVal,"onUpdate:modelValue":t[0]||(t[0]=e=>l.dbcVal=e)},null,8,["options","modelValue"])])]),l.onFlag?(f(),h("div",N,[m(c,{type:"primary",disabled:!a.pullDataValid,progress:l.pullLoadingProgress,loading:l.pullLoading,onClick:a.cheFile},{default:g((()=>[U,v("开始检查")])),_:1},8,["disabled","progress","loading","onClick"])])):(f(),h("div",$,[m(c,{type:"primary",progress:l.pullLoadingProgress,loading:l.pullLoading,onClick:a.stopCheFile},{default:g((()=>[R,v("停止检查")])),_:1},8,["progress","loading","onClick"])]))]),y("div",{class:"o-console-er","data-empty":""===l.consoleText},[y("div",G,[J,b(m(c,{onClick:t[1]||(t[1]=e=>a.exportResult()),class:"export-result"},{default:g((()=>[v("导出结果")])),_:1},512),[[C,l.consoleText]])]),b(y("div",{class:"o-console-body","data-loading":!l.chartDataLoaded},T(l.consoleText),9,K),[[C,l.consoleText]])],8,z),b(y("div",Q,[y("div",W,[y("div",X,[Y,y("i",{class:"o-modal-title-close",onClick:t[2]||(t[2]=(...e)=>a.cannel&&a.cannel(...e))})]),Z,y("div",ee,[y("div",te,[m(c,{style:{width:"52px"},onClick:a.cannel},{default:g((()=>[v("取消")])),_:1},8,["onClick"]),m(c,{type:"primary",style:{width:"52px",margin:"0 20px 0 10px"},onClick:a.submit},{default:g((()=>[v("确定")])),_:1},8,["onClick"])])])])],512),[[C,this.modal.visible]]),m(d,{message:l.message},null,8,["message"])])}],["__scopeId","data-v-35036f13"]]))}}}));
