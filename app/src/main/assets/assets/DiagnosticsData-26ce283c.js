import{H as S}from"./Header-62e530db.js";import{B as w}from"./Button-78779839.js";import{_ as C,k as f,j as v,e as T,r as D,l as F,c,h as u,d as t,i as _,a,w as g,t as i,v as N,F as L,m as q,o as d,p as E,b as P}from"./index-557cbaa3.js";const V={props:["store"],components:{Button:w,Header:S},data(){return{consoleText:"",errorNumber:0,directory:"",typeDirectory:"",onFlag:!0,resData:[],displayFlag:!0,chartDataLoaded:!0}},watch:{chartDataLoaded(e,r){e?(document.querySelector("#app").style.cursor="",document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor="",document.querySelector(".o-pul-er").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents=""):(document.querySelector("#app").style.cursor="wait",document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".o-pul-er").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none")}},computed:{pullDataValid(){if(this.directory&&this.typeDirectory&&this.displayFlag)return console.log("this.displayFlag",this.displayFlag),!0;console.log("this.displayFlag222",this.displayFlag),this.$nextTick(()=>!1)}},mounted(){v.report("trackPage",{page:"诊断数据表检查",tip:"1174.12.0.1.29257"})},methods:{choosePath(){f.choosePath({directory:this.directory,dialogType:"OPEN_DIALOG",fileTypes:["XlSX文件 (*.xlsx;*.XlSX)"],allow_multiple:!1}).then(({data:e})=>{e.directory&&(this.directory=e.directory)})},chooseType(){let e=this.directory||window.downloadPath+"/check.xlsx",r=e.replace(/[^\\]+$/,""),p=e.replace(r,"").replace(/\.xlsx/,".csv");f.choosePath({directory:r,saveFilename:p,dialogType:"SAVE_DIALOG",fileTypes:["CSV文件 (*.csv;*.CSV)"],allow_multiple:!1}).then(({data:l})=>{console.log("res>>>2",l),l.directory&&(this.typeDirectory=l.directory)})},async startCheck(){this.resData=[],this.displayFlag=!1,this.chartDataLoaded=!1,v.report("track","click",{element_name:"开始检查",asset_name:this.directory+";",tip:"1174.12.0.1.29258"}),await T.ddbCheck.start_check({xlsx_path:this.directory,log_path:this.typeDirectory}).then(e=>{console.log("诊断数据表结果>>",e);let r=[];r=e.data,this.errorNumber=r.data.count,console.log("resp.data.err_info.split",r.data.err_info.split("\n"));let p=JSON.parse(JSON.stringify(r.data.err_info.split("\n"))),l=[],s={};p.length>0&&(l=p.map(o=>o.split(",")),l.forEach(o=>{s={errTit:o[0],servicesTit:o[1],issueTit:o[2],errTag:o[3],errSid:o[4],errSub:o[5]},this.resData.push(JSON.parse(JSON.stringify(s)))}),this.resData=Array.from(this.resData),this.displayFlag=!0,this.chartDataLoaded=!0,console.log("this.resData>>>",this.resData))}).finally(()=>{this.displayFlag=!0,this.chartDataLoaded=!0})}}},n=e=>(E("data-v-f3030e13"),e=e(),P(),e),O={class:"diagnostics-data"},x={class:"o-pul-er",id:"el-record-form"},B=n(()=>t("div",{class:"o-pul-title"},"文件导入配置",-1)),A={class:"o-pul-p"},I=n(()=>t("span",{style:{color:"red"}},"* ",-1)),H=n(()=>t("span",{class:"record-header-message"},"对象文件：",-1)),J={class:"o-pul-path"},X={class:"o-pul-p"},j=n(()=>t("span",{style:{color:"red"}},"* ",-1)),G=n(()=>t("span",{class:"record-header-message"},"检查结果：",-1)),R={class:"o-pul-path"},z={key:0,class:"o-pul-p start-rec"},K=n(()=>t("i",{class:"play-icon"},null,-1)),M={key:1,class:"o-pul-p start-rec"},Q=n(()=>t("i",{class:"stop-icon"},null,-1)),U=["data-empty"],W={class:"o-console-title"},Y=["data-loading"],Z={class:"o-table"},$={class:"o-table-tbody"},ee={class:"o-table-cell o-width-short"},te={class:"o-table-cell o-width-short"},se={class:"o-table-cell o-width-short"},oe={class:"o-table-cell o-width-short"},re={class:"o-table-cell"};function ae(e,r,p,l,s,o){const b=D("Header"),y=D("Button"),m=F("tooltip");return d(),c("div",O,[u(b,{title:"诊断数据表检查",quitConfirm:e.quitConfirm,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["quitConfirm","carNum","connectStatus","recentTest"]),t("div",x,[B,t("div",A,[I,H,u(y,{onClick:o.choosePath,disabled:!s.displayFlag,class:"choose-path"},{default:_(()=>[a("选择文件")]),_:1},8,["onClick","disabled"]),a("  "),g((d(),c("span",J,[a(i(s.directory),1)])),[[m,{content:s.directory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),t("div",X,[j,G,u(y,{onClick:o.chooseType,disabled:!s.displayFlag,class:"choose-path"},{default:_(()=>[a("保存到文件")]),_:1},8,["onClick","disabled"]),a("  "),g((d(),c("span",R,[a(i(s.typeDirectory),1)])),[[m,{content:s.typeDirectory,skidding:0,arrowPadding:9999},void 0,{"top-start":!0}]])]),s.onFlag?(d(),c("div",z,[u(y,{type:"primary",disabled:!o.pullDataValid,progress:e.recLoadingProgress,loading:e.recLoading,onClick:o.startCheck},{default:_(()=>[K,a("开始检查")]),_:1},8,["disabled","progress","loading","onClick"])])):(d(),c("div",M,[u(y,{type:"primary",disabled:!o.pullDataValid,progress:e.recLoadingProgress,loading:e.recLoading,onClick:e.endCheck},{default:_(()=>[Q,a(" 暂停检查")]),_:1},8,["disabled","progress","loading","onClick"])]))]),t("div",{class:"o-console-er","data-empty":s.resData.length===0,id:"el-record-console"},[t("div",W,"检查结果: "+i(s.errorNumber)+" Error",1),g(t("div",{class:"o-console-body","data-loading":!s.chartDataLoaded},[t("table",Z,[t("tbody",$,[(d(!0),c(L,null,q(s.resData,(h,k)=>(d(),c("tr",{key:k},[t("td",ee,i(h.errTit),1),t("td",te,i(h.servicesTit),1),t("td",se,i(h.issueTit),1),t("td",oe,i(h.errTag),1),t("td",re,i(h.errSid),1)]))),128))])])],8,Y),[[N,s.resData.length>0]])],8,U)])}const de=C(V,[["render",ae],["__scopeId","data-v-f3030e13"]]);export{de as default};
