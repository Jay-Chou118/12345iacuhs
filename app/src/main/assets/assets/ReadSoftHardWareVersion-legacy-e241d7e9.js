System.register(["./Header-legacy-b62f8f94.js","./Button-legacy-6868fe05.js","./Message-legacy-8919c457.js","./index-legacy-37c13ffb.js","./Spin-legacy-8e2c918d.js"],(function(e,t){"use strict";var s,l,a,o,r,n,i,c,u,d,p,h,g,m,b,f,v,V,S,C,y;return{setters:[e=>{s=e.H},e=>{l=e.B},e=>{a=e.M},e=>{o=e._,r=e.e,n=e.k,i=e.r,c=e.c,u=e.h,d=e.d,p=e.i,h=e.B,g=e.F,m=e.m,b=e.j,f=e.o,v=e.a,V=e.t,S=e.p,C=e.b},e=>{y=e.S}],execute:function(){function t(e){if(""==e||null==e)return"--";{let t=e.split("S");if(t.splice(0,1),t.length>=1)return t=t.map(((e,t)=>(e="App"+(t+1)+": S"+e,console.log("el>>>>",e),e))),t=t.join(","),t=t.toString().replace(/[,]/g,"$&\n"),t}}let E=0,L=0;const F={props:["store","closeFlag"],components:{Button:l,Header:s,Message:a,Spin:y},data:()=>({tableList:[],ECUVersion:"ACU,ADD,AMP,BCP,BCS,BLEM,BLEA,BMDM,BMS,CCU,DCD,EPS,EPS2,ETC,FEDS,FLRL,FLSR,FRSR,FZCU,LRR,LSL,LZCU,NEM,REDS,RLSR,RRSR,RSL,RZCU,SCU,SWM,TBOX,TZCU,VCCD,WPC".split(",").sort(),didList:new Set,softStatus:"未上报,正常,即将到期,超期,豁免,未安装".split(","),ECUVal:"",DIDVal:[{value:"0xF1A0"}],SoftStatusVal:"",carInfo:{VINNumber:""},pullLocalLoading:!1,pullCloudLoading:!1,pullLoadingProgress:0,comparisonFlag:!1,saveExportCar:[],tableDataFlag:!1,barProgress:0,message:{visible:!1,level:"success",content:""}}),watch:{tableDataFlag(e,t){e?(document.querySelector("#app").style.cursor="wait",document.querySelector(".back-icon").style.pointerEvents="none",document.querySelector(".record-header").style.pointerEvents="none",document.querySelector(".o-console-er").style.pointerEvents="none",document.querySelector(".o-pul-er").style.pointerEvents="none",document.querySelector(".o-menu").style.pointerEvents="none"):(document.querySelector("#app").style.cursor="",document.querySelector(".back-icon").style.pointerEvents="",document.querySelector(".record-header").style.cursor="",document.querySelector(".o-console-er").style.pointerEvents="",document.querySelector(".o-pul-er").style.pointerEvents="",document.querySelector(".o-menu").style.pointerEvents="")}},computed:{DIDVersion(){return[...new Set(this.tableList.map((e=>e.did)))].map((e=>({value:e})))},filterTableList(){let e=JSON.parse(JSON.stringify(this.tableList.slice()));if(console.log("this.tableList1111",e,this.SoftStatusVal),this.ECUVal&&(e=e.filter((e=>e.ecu==this.ECUVal))),this.DIDVal.length>0){e=e.filter((e=>this.DIDVal.some((t=>t.value==e.did))));let t=[];t=this.DIDVal.map((e=>e.value)),"0xF1A0"==t.toString()&&this.tableList.some((e=>e.currentVersion))?this.comparisonFlag=!0:this.comparisonFlag=!1}return e.length>0&&e.forEach(((t,s)=>{"VCCD"===t.ecu&&(t.did.includes("F193")&&(e[s].level="HWBN"),t.did.includes("F180")&&(e[s].level="SPBL"),t.did.includes("F1A0")&&(e[s].level="SFA/SFC/SFCP"),t.did.includes("F103")&&(e[s].level="SWDI"),t.did.includes("F104")&&(e[s].level="SWDI"),t.did.includes("F105")&&(e[s].level="SWDI"))})),console.log("newTabList",e),this.SoftStatusVal&&(e=e.filter((e=>e.status==this.SoftStatusVal))),console.log("newTabList",e),e}},mounted:async function(){b.report("trackPage",{page:"读取软硬件版本号",tip:"1174.7.0.1.27755"}),this.tableList=this.$ls.get("tableList")||[],await this.getCarVinCode(),await this.pullCloudECU()},methods:{showMessage({level:e,content:t,timeout:s}){clearTimeout(E),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,s>0&&(E=setTimeout((()=>{console.log(E,"msgTimer"),this.message.visible=!1}),s))},hideMessage(){this.message.visible=!1},async clickSearch(){await this.pullCloudECU()},reSet(){this.ECUVal="",this.DIDVal=[],this.SoftStatusVal=""},async pullCloudECU(){b.report("track","click",{element_name:"拉云端",asset_name:"",tip:"1174.7.0.1.27756"}),console.log("this.carInfo.VINNumber",this.carInfo.VINNumber),this.showMessage({level:"loading",content:"同步中..."}),r.ecuver.getEcuVer({vin:this.carInfo.VINNumber,vehicleConfig:"低配"}).then((e=>{if(console.log("ecuver.res>>",e.data),"S00"==e.data.code){this.showMessage({timeout:3e3,level:"success",content:"同步云端成功"});let s=e.data.content;const l=JSON.parse(s||"[]").respData||[];l.forEach((e=>{[e["0xF193"],e["0xF180"],e["0xF1A0"],e["0xF17F"]]=e.version.match(/([^,]+),([^,]+),([^,]+),([^,]+)/).slice(1),e["0xF1A0"]=t(e["0xF1A0"])})),l.forEach((e=>{["0xF193","0xF180","0xF1A0","0xF17F"].forEach((t=>{let s=this.tableList.find((s=>s.ecu===e.ecu&&s.did===t));s||(this.tableList.push({ecu:"",did:"",level:"",status:"",currentVersion:"",version:"",deadline:""}),s=this.tableList[this.tableList.length-1]),s.ecu=e.ecu,s.did=t,s.version=e[t],s.deadline=null===e.deadline?"--":e.deadline}))})),this.$ls.set("tableList",this.tableList)}else this.showMessage({timeout:3e3,level:"success",content:"云端无数据"})})).catch((()=>{this.showMessage({timeout:3e3,level:"error",content:"未同步，云端无数据"})}))},async getCarVinCode(){let e=await r.base.getCarVin(),t=e.data;200==e.status&&(this.carInfo.VINNumber=t,this.carInfo.VINNumber||(this.carInfo.VINNumber="LKBCC2MS8NK108013"))},async pullECUVersion(){b.report("track","click",{element_name:"拉本地",asset_name:"",tip:"1174.7.0.1.27757"}),this.tableDataFlag=!0,this.addProgress(),r.doip.getEcuInfoWithDID().then((e=>{let s=e.data;this.saveExportCar=s,s.forEach((e=>{Object.keys(e).forEach((s=>{e[s].forEach((e=>{const l=Object.keys(e)[0];let a=e[l];"0xF1A0"===l&&(a=t(a));let o=this.tableList.find((e=>e.ecu===s&&e.did===l));o||(this.tableList.push({ecu:"",did:"",level:"",status:"",currentVersion:"",version:"",deadline:""}),o=this.tableList[this.tableList.length-1]),o.ecu=s,o.did=l,o.currentVersion=a}))}))})),this.barProgress=100,this.tableDataFlag=!1,clearInterval(L),this.$ls.set("tableList",this.tableList)})).catch((e=>{this.pullDataLoaded=!0})).finally((e=>{this.barProgress=100,this.tableDataFlag=!1,clearInterval(L)}))},async exportResult(){b.report("track","click",{element_name:"导出结果",asset_name:"",tip:"1174.7.0.1.27764"});let e="pull-car-ECU"+(new Date).valueOf();await n.choosePath({directory:"",dialogType:"SAVE_DIALOG",saveFilename:e+".csv",fileTypes:["CSV文件 (*.csv;*.CSV)"],allow_multiple:!1}).then((t=>{if(console.log("saveFilename2222",e,""),t.data.directory){let e=new Map,s=[],l=[];this.tableList.forEach((t=>{let a=t.ecu+"-"+t.did;e.set(a,t.currentVersion),s.push(t.ecu),l.push(t.did)})),s=[...new Set(s)].sort(),l=[...new Set(l)].sort();let a=[],o=[];o.push("编号"),o.push(...s),a.push(o),l.forEach(((t,l)=>{let o=[];o.push(t),a.push(o),s.forEach((s=>{let o=s+"-"+t;console.log("newKey",o),a[l+1].push(e.get(o)||"")}))})),console.log("tabArr",a),a=a.map((e=>e.map((e=>'"'+e+'"')).join())),console.log("tabArr",a);let n=a.join("\n");console.log("finArr",n),r.blf.exportExeLog({content:n,directory:t.data.directory}).then((e=>{"0"==e.data.code&&this.showMessage({timeout:5e3,level:"success",content:"导出成功"})})).catch((e=>{console.log(e)}))}}))},addProgress(){let e=3e5;L=setInterval((()=>{this.barProgress+=100/300,e--,0===e&&clearInterval(L)}),3e4)}}},D=e=>(S("data-v-c5e69224"),e=e(),C(),e),w=["data-disabled"],I={class:"o-pul-er"},k={class:"o-btn-wrap"},U=["data-empty"],x=D((()=>d("div",{class:"o-console-wrap"},[d("div",{class:"o-console-title"},"搜素结果")],-1))),N={class:"o-select-er"},M={class:"o-select-wrap"},A={class:"select-ecu-wrap"},P=D((()=>d("span",{class:"record-header-message"},"ECU：",-1))),R={class:"select-did-wrap"},_=D((()=>d("span",{class:"record-header-message"},"DID：",-1))),B={class:"select-soft-status-wrap"},T=D((()=>d("span",{class:"record-header-message"},"软件状态：",-1))),q={class:"o-button-wrap"},j={key:0,class:"board-spin-er"},O={class:"board-spin"},W={class:"board-progress"},$=D((()=>d("div",{class:"board-spin-text"},"正在拉取车辆ECU版本，整个过程需要几分钟…",-1))),H={key:1,class:"o-table"},Z=D((()=>d("thead",{class:"o-table-thead"},[d("tr",null,[d("th",{class:"o-table-cell"},"ECU"),d("th",{class:"o-table-cell"},"DID"),d("th",{class:"o-table-cell"},"软件层级"),d("th",{class:"o-table-cell"},"软件状态"),d("th",{class:"o-table-cell"},"当前版本号"),d("th",{class:"o-table-cell"},"SRC最新版本号"),d("th",{class:"o-table-cell"},"版本更新截止日期")])],-1))),J={class:"o-table-tbody"},K={class:"o-cell"},G={class:"o-cell"};e("default",o(F,[["render",function(e,t,s,l,a,o){const r=i("Header"),n=i("Button"),b=i("v-select"),S=i("Message");return f(),c("div",{class:"pull-dt-page","data-disabled":a.tableDataFlag},[u(r,{title:"读取软硬件版本号",quitConfirm:!0,showRight:!0,carNum:e.$props.store.connectCar.carNum,connectStatus:e.$props.store.connectCar.status,recentTest:e.$props.store.connectCar.latest},null,8,["carNum","connectStatus","recentTest"]),d("div",I,[d("div",k,[u(n,{style:{"margin-right":"8px"},type:"primary",progress:a.pullLoadingProgress,loading:a.pullLocalLoading,onClick:o.pullECUVersion},{default:p((()=>[v("拉取车辆ECU版本")])),_:1},8,["progress","loading","onClick"]),u(n,{progress:a.pullLoadingProgress,loading:a.pullCloudLoading,onClick:o.pullCloudECU},{default:p((()=>[v("同步云端SRC版本号")])),_:1},8,["progress","loading","onClick"])])]),d("div",{class:"o-console-er","data-empty":0===a.tableList.length},[x,d("div",N,[d("div",M,[d("div",A,[P,u(b,{options:a.ECUVersion,label:"value",modelValue:a.ECUVal,"onUpdate:modelValue":t[0]||(t[0]=e=>a.ECUVal=e),class:"chf-input-ecu"},null,8,["options","modelValue"])]),d("div",R,[_,u(b,{options:o.DIDVersion,label:"value",modelValue:a.DIDVal,"onUpdate:modelValue":t[1]||(t[1]=e=>a.DIDVal=e),multiple:"",class:"chf-input-did"},null,8,["options","modelValue"])]),d("div",B,[T,u(b,{options:a.softStatus,label:"value",modelValue:a.SoftStatusVal,"onUpdate:modelValue":t[2]||(t[2]=e=>a.SoftStatusVal=e),class:"chf-input-status"},null,8,["options","modelValue"])])]),d("div",q,[u(n,{type:"primary",onClick:o.clickSearch},{default:p((()=>[v("搜 索")])),_:1},8,["onClick"]),u(n,{onClick:o.reSet},{default:p((()=>[v("重 置")])),_:1},8,["onClick"]),u(n,{onClick:o.exportResult},{default:p((()=>[v("导出结果")])),_:1},8,["onClick"])])]),a.tableDataFlag?(f(),c("div",j,[d("div",O,[d("div",W,[d("div",{class:"board-progress-bar",style:h("--percent:"+a.barProgress)},null,4)])]),$])):(f(),c("table",H,[Z,d("tbody",J,[(f(!0),c(g,null,m(o.filterTableList,((e,t)=>(f(),c("tr",{key:t},[d("td",{class:"o-table-cell o-width-short",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},V(e.ecu),5),d("td",{class:"o-table-cell o-width-short",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},V(e.did),5),d("td",{class:"o-table-cell o-width-medium",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},V(e.level),5),d("td",{class:"o-table-cell o-width-short",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},V(e.status),5),d("td",{class:"o-table-cell o-overflow-hidden o-width-long",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},[d("span",K,V(e.currentVersion),1)],4),d("td",{class:"o-table-cell o-overflow-hidden o-width-long",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},[d("span",G,V(e.version),1)],4),d("td",{class:"o-table-cell o-width-medium",style:h(a.comparisonFlag&&e.currentVersion!==e.srcVersion&&"--"!==e.currentVersion?"background-color:#fff2f2":"")},V(e.deadline),5)])))),128))])]))],8,U),u(S,{message:a.message},null,8,["message"])],8,w)}],["__scopeId","data-v-c5e69224"]]))}}}));
