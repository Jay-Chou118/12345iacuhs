System.register(["./Button-legacy-3969e1e6.js","./Header-legacy-9fc8bb72.js","./index-legacy-26b1f70b.js","./index-legacy-67568046.js","./num-legacy-b60967d7.js","./ImportFileDialog-legacy-c0b8948f.js","./CopyPath-legacy-40044031.js","./time-legacy-9e872c4a.js","./ev-timeplot-legacy-b5416461.js","./Message-legacy-cfa039c3.js","./Cascader-legacy-be668b80.js","./Spin-legacy-6a0e8699.js"],(function(e,t){"use strict";var a,i,l,s,o,r,n,d,c,h,m,p,u,g,f,b,y,C,w,v,S,D,T,k,x,F,M,I,V,N,$,L,A,_,E;return{setters:[e=>{a=e.B},e=>{i=e.H},e=>{l=e.n},e=>{s=e._,o=e.o,r=e.c,n=e.d,d=e.t,c=e.x,h=e.B,m=e.w,p=e.v,u=e.r,g=e.h,f=e.i,b=e.p,y=e.b,C=e.q,w=e.e,v=e.F,S=e.m,D=e.A,T=e.f,k=e.g,x=e.a,F=e.s,M=e.k,I=e.j},e=>{V=e.b},e=>{N=e.I},e=>{$=e.b},e=>{L=e.s},e=>{A=e.W,_=e.P},e=>{E=e.M},null,null],execute:function(){let t;const H=["data-disable"],B=["data-active"],P={class:"block-title"},q={class:"line-title"},U=["data-active"],O=s({name:"ScrollBar",props:["modelValue","start","end","disable","timeFilter","startTime"],emits:["update:modelValue","change"],data:()=>({lineTop:0,scrollTop:0,lineTitle:"",scrollTitle:"",lineVisible:!1,dragging:!1,dragHover:!1}),methods:{enterHandler(){this.dragging||(this.lineVisible=!0)},leaveHandler(){this.lineVisible=!1},moveHandler(e){this.lineVisible&&(e.offsetY<0||e.offsetY>=this.$refs.root.clientHeight-28||(this.lineTop=e.offsetY,this.lineTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*e.offsetY/(this.$refs.root.clientHeight-28))))},clickHandler(e){this.scrollTop=e.offsetY;const t=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",t),this.$emit("change",t)},tooltipFormatter:e=>parseInt(e)/1e3,timeStrFilter(e){return"absolute"===this.$props.timeFilter?new Date(1e3*e+(this.$props.startTime||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"}):e},blockDownHandler(){this.dragging=!0,t=void 0},blockUphandler(){if(this.dragging){this.dragging=!1;const e=this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28);this.$emit("update:modelValue",e),this.$emit("change",e)}},blockLeaveHandler(){this.enterHandler(),this.dragHover=!1},blockEnterHandler(){this.leaveHandler(),this.dragHover=!0},blockMoveHandler(e){if(this.dragging){let a=0;null!=t&&(a=e.pageY-t),t=e.pageY,console.log("move",e.pageY);let i=this.scrollTop+a;const l=this.$refs.root.clientHeight;if(i<0){if(0===this.scrollTop)return;i=0}else if(i>l-28){if(this.scrollTop===l-28)return;i=l-28}this.scrollTop=i,this.scrollTitle=this.tooltipFormatter(this.$props.start+(this.$props.end-this.$props.start)*this.scrollTop/(this.$refs.root.clientHeight-28))}}},watch:{modelValue(e){if(this.dragging)return;let t=(e-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(t*(this.$refs.root.clientHeight-28)),this.scrollTitle=this.tooltipFormatter(e),this.dragging=!1,this.dragHover=!1},end(e){if(this.dragging)return;let t=(this.$props.modelValue-this.$props.start)/(this.$props.end-this.$props.start);this.scrollTop=parseInt(t*(this.$refs.root.clientHeight-28))}},mounted(){window.addEventListener("mouseup",this.blockUphandler),window.addEventListener("mousemove",this.blockMoveHandler)},unmounted(){window.removeEventListener("mouseup",this.blockUphandler),window.removeEventListener("mousemove",this.blockMoveHandler)}},[["render",function(e,t,a,i,l,s){return o(),r("div",{class:"bar-er","data-disable":e.$props.disable,ref:"root",onClick:t[5]||(t[5]=c(((...e)=>s.clickHandler&&s.clickHandler(...e)),["prevent","stop"])),onMousemove:t[6]||(t[6]=(...e)=>s.moveHandler&&s.moveHandler(...e)),onMouseenter:t[7]||(t[7]=(...e)=>s.enterHandler&&s.enterHandler(...e)),onMouseleave:t[8]||(t[8]=(...e)=>s.leaveHandler&&s.leaveHandler(...e))},[n("div",{class:"bar-block","data-active":l.dragging,onClick:t[0]||(t[0]=c((()=>{}),["prevent","stop"])),onMousedown:t[1]||(t[1]=(...e)=>s.blockDownHandler&&s.blockDownHandler(...e)),onMouseup:t[2]||(t[2]=(...e)=>s.blockUphandler&&s.blockUphandler(...e)),onMouseleave:t[3]||(t[3]=(...e)=>s.blockLeaveHandler&&s.blockLeaveHandler(...e)),onMouseenter:t[4]||(t[4]=(...e)=>s.blockEnterHandler&&s.blockEnterHandler(...e)),style:h({transform:"translateY("+l.scrollTop+"px)"})},[n("div",P,d(s.timeStrFilter(l.scrollTitle)),1)],44,B),m(n("div",{class:"bar-line",style:h({transform:"translateY("+l.lineTop+"px)"})},[n("div",q,d(s.timeStrFilter(l.lineTitle)),1)],4),[[p,l.lineVisible]]),n("div",{class:"scroll-title","data-active":l.dragging},d(s.timeStrFilter(l.scrollTitle)),9,U)],40,H)}],["__scopeId","data-v-6f06aac4"]]),R={props:["col","asyncData"],emits:["change"],data:()=>({options:[],loading:!1,current:[]}),methods:{async onMouseEnter(){this.loading=!0,this.options=[];try{this.options=await this.$props.asyncData(this.$props.col)}catch(e){}this.loading=!1},onModelValueChange(e){this.current=e,this.$emit("change",e)}},watch:{col:{handler(e){this.current=e.value},deep:!0}}},j=["data-active"],z=(e=>(b("data-v-a6880894"),e=e(),y(),e))((()=>n("div",null,null,-1)));let W=0,Y=0;const X={props:["rowData","columnsDef","columnsFilter","from","filters"],emits:["toggleExpand","scrollRow","scrollAction","filterItem","colFilterChange","updatePadding","dataFilterChange"],components:{RecycleScroller:C,FilterItem:s(R,[["render",function(e,t,a,i,l,s){const d=u("v-select");return o(),r("div",{class:"select-icon","data-active":l.current?.length>0,onMouseenter:t[0]||(t[0]=(...e)=>s.onMouseEnter&&s.onMouseEnter(...e))},[n("div",{class:"flt-er",style:h({width:e.$props.col.width+40+"px"})},[g(d,{loading:l.loading,options:l.options,dropdownShouldOpen:()=>!0,searchable:!0,modelValue:l.current,"onUpdate:modelValue":s.onModelValueChange,multiple:""},{"no-options":f((()=>[z])),_:1},8,["loading","options","modelValue","onUpdate:modelValue"])],4)],40,j)}],["__scopeId","data-v-a6880894"]]),Button:a},created(){this.$_scrollTimer=0},data:()=>({selectionActive:!1,isChildTit:!1,searchVal:"",isOpenSearch:!1,selectFilterList:[],showSelect:!1,curId:-1,filterChnItem:"",filterValItem:"",formData:{},filterList:{channel:"",canId:"",name:"",canType:"",dir:"",dlc:""},left:0,timeFilterOptions:[{label:"Time 绝对时间",value:"absolute"},{label:"Time 相对时间",value:"relative"},{label:"ΔTime 时间差",value:"diff"}],timeFilterMode:{label:"Time 绝对时间",value:"absolute"},filterNumberShow:!1,filterDataNumber:"",showWrongMsg:!1,filterWarnLabel:"请输入0~9或者a~f"}),computed:{fullWidth(){return"calc("+this.$props.columnsDef.map((e=>"number"==typeof e.width?e.width+"px":e.width)).join(" + ")+")"}},watch:{rowData:{handler(){if(this.selectionActive){this.selectionActive=!1;let e=window.getSelection();e.removeAllRanges(),e=null}setTimeout((()=>{console.log("updateVisibleItems"),this.$refs.scroller.updateVisibleItems(!0)}),0)},deep:!0},timeFilterMode(e){this.onTimeModelChange(e.value)}},mounted(){this.nativeScroll(),setTimeout((()=>{document.body.addEventListener("mousedown",this.clickHandler)}),300)},unmounted(){document.body.removeEventListener("mousedown",this.clickHandler)},methods:{onScrollX(e){this.left=-e.target.scrollLeft+"px"},onTableClick(e){if(e.target.className.includes("table-td")){this.selectionActive=!0;let t=window.getSelection();t.removeAllRanges();let a=document.createRange();a.selectNodeContents(e.target),t.addRange(a),t=a=null}},filterHex:e=>void 0===e?"":(e>=0?V(e):e).toString().replace(/^(00)+/g,"")||"00",update(e,t,a,i){W=a,Y=this.$props.rowData.length-i,this.$emit("updatePadding",{visibleStartIndex:a,visibleEndIndex:i})},searchInfo(){this.isOpenSearch=!1},onOpenSearch(){this.isOpenSearch=!0},scrollToBottom(){this.$refs.scroller?.scrollToItem(this.$props.rowData.length-1)},scrollToItem(e){this.$refs.scroller?.scrollToItem(e)},nativeScroll(){const e=this.$refs.scroller.$el;e.addEventListener("scroll",(e=>{if(clearTimeout(this.$_scrollTimer),this.selectionActive){this.selectionActive=!1;let e=window.getSelection();e.removeAllRanges(),e=null}this.$_scrollTimer=setTimeout((()=>{console.log("updateVisibleItems"),this.$refs.scroller.updateVisibleItems(!0)}),100)})),e.addEventListener("wheel",(e=>{this.$emit("scrollAction",{topPadding:W,bottomPadding:Y}),e.deltaY>0||e.deltaX>0?Y<=40&&this.$emit("scrollRow","down"):(e.deltaY<0||e.deltaX<0)&&W<=40&&this.$emit("scrollRow","up")}))},filterItem(e,t){this.filterChnItem=e,this.curId=t,this.$emit("filterItem"),this.selectFilterList=[],w.blfLogging.getFiltItems({selectItem:e,channel:"",canId:"",name:"",canType:"",dir:"",dlc:""}).then((e=>{let t=e.data.data;t.length>0&&t.forEach((e=>{e&&this.selectFilterList.push({value:e,label:e,selected:!1})}))}))},onChooseFilterItem(e,t){e.selected=!0,this.$emit("reDrawTable",e,t,this.selectFilterList)},onTimeModelChange(e){this.$emit("timeModeChange",e)},onMouseEnter(){this.filterNumberShow=!0},filterData(){this.filterDataNumber=this.filterDataNumber.toString(),this.filterDataNumber?/^[0-9a-f\s]+$/i.test(this.filterDataNumber)?(this.showWrongMsg=!1,this.filterNumberShow=!1,this.$emit("dataFilterChange",this.filterDataNumber)):(this.showWrongMsg=!0,this.filterNumberShow=!0):(this.showWrongMsg=!1,this.filterNumberShow=!1,this.$emit("dataFilterChange",this.filterDataNumber)),console.log("this.filterDataNumber",this.filterDataNumber)},clickHandler(e){console.log("020304this.$refs",this.$refs.filterRoot,e.target),0==this.$refs.filterRoot[0]?.contains(e.target)&&(console.log("020304"),this.filterNumberShow=!1)}}},G=e=>(b("data-v-9181fa72"),e=e(),y(),e),K={style:{position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"inherit","flex-direction":"inherit","align-items":"inherit"}},Z={key:1,class:"o-pul-time-option-warp"},J=["data-active"],Q=G((()=>n("i",{class:"div-select-icon"},null,-1))),ee={class:"o-pul-data-filter-input-item"},te={key:0,class:"warn-label"},ae=G((()=>n("i",{class:"i-warning"},null,-1))),ie=G((()=>n("div",{class:"table-header",style:{height:"32px","line-height":"32px"}},null,-1))),le=["data-even"],se=["onMousedown"],oe=["onMousedown"],re=[G((()=>n("span",{class:"container-tit",style:{width:"205px"}},"信号名",-1))),G((()=>n("span",{class:"container-tit",style:{width:"200px"}},"信号物理值",-1))),G((()=>n("span",{class:"container-tit",style:{width:"80px"}},"HEX",-1))),G((()=>n("span",{class:"container-tit",style:{width:"calc(100vw - 487px)"}},"信号描述",-1)))],ne={class:"table-parent-tr o-table-expand-child"},de={class:"table-td",style:{width:"205px"}},ce={class:"table-td",style:{width:"200px"}},he={class:"table-td",style:{width:"80px"}},me={class:"table-td",style:{width:"calc(100vw - 487px)"}},pe=s(X,[["render",function(e,t,a,i,l,s){const b=u("FilterItem"),y=u("v-select"),C=u("RecycleScroller");return o(),r("div",{class:"table",onClick:t[5]||(t[5]=(...e)=>s.onTableClick&&s.onTableClick(...e))},[n("div",{class:"table-header",style:h({height:"32px",lineHeight:"32px",transform:"translateX("+l.left+")",width:s.fullWidth,position:"absolute",zIndex:1})},[n("div",K,[(o(!0),r(v,null,S(e.$props.columnsDef,((a,i)=>(o(),r("div",{class:"header-tit",key:i,style:h({width:a.width>0?a.width+"px":a.width})},[n("span",null,d(a.titName),1),a.filterShow?(o(),D(b,{key:0,onChange:t=>e.$emit("colFilterChange",{keyName:a.keyName,value:t}),col:a,asyncData:e.$props.columnsFilter},null,8,["onChange","col","asyncData"])):T("",!0),"timestamp"==a.keyName||"diff"==a.keyName?(o(),r("div",Z,[g(y,{options:l.timeFilterOptions,clearable:!1,searchable:!1,label:"label",value:"value",modelValue:l.timeFilterMode,"onUpdate:modelValue":t[0]||(t[0]=e=>l.timeFilterMode=e),class:"canoe-frame-vselect"},null,8,["options","modelValue"])])):T("",!0),"data"==a.keyName?(o(),r("div",{key:2,class:"o-pul-data-filter","data-active":l.filterDataNumber&&!l.filterNumberShow,onMouseenter:t[3]||(t[3]=(...e)=>s.onMouseEnter&&s.onMouseEnter(...e))},[Q,m(n("div",{class:"o-pul-data-filter-input-er",ref_for:!0,ref:"filterRoot"},[n("div",ee,[m(n("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.filterDataNumber=e),placeholder:"请输入数据",class:"o-pul-data-filter-input"},null,512),[[k,l.filterDataNumber]]),n("div",{onClick:t[2]||(t[2]=(...e)=>s.filterData&&s.filterData(...e)),class:"chs-btn confirm"},"确定")]),l.showWrongMsg?(o(),r("div",te,[ae,n("span",null,d(l.filterWarnLabel),1)])):T("",!0)],512),[[p,l.filterNumberShow]])],40,J)):T("",!0)],4)))),128))])],4),ie,g(C,{items:e.$props.rowData,"item-size":24,"key-field":"id",emitUpdate:!0,onUpdate:s.update,ref:"scroller",class:"frame-class"},{default:f((({item:t,index:a})=>[t.isParent?(o(),r("div",{key:0,class:"table-parent-tr","data-even":a%2==0,style:h({transform:"translateX("+l.left+")",width:s.fullWidth})},[(o(!0),r(v,null,S(e.$props.columnsDef,(i=>(o(),r("div",{class:"table-td",style:h({width:"number"==typeof i.width?i.width+"px":i.width}),key:i.keyName},[i.custom?(o(),r(v,{key:0},[t.isExpand&&t.isParent&&t.name?(o(),r("i",{key:0,class:"collapse-icon",onMousedown:c((t=>e.$emit("toggleExpand",a)),["stop","prevent"])},null,40,se)):T("",!0),!1===t.isExpand&&t.isParent&&t.name?(o(),r("i",{key:1,class:"expand-icon",onMousedown:c((t=>e.$emit("toggleExpand",a)),["stop","prevent"])},null,40,oe)):T("",!0)],64)):(o(),r(v,{key:1},[x(d(i.displayMap?i.displayMap(t[i.keyName]):t[i.keyName]),1)],64))],4)))),128))],12,le)):(o(),r(v,{key:1},[t.isChildTit?(o(),r("div",{key:0,class:"table-header o-table-expand-child",style:h({transform:"translateX("+l.left+")",width:s.fullWidth})},re,4)):(o(),r("div",{key:1,class:"table-parent",style:h({transform:"translateX("+l.left+")",width:s.fullWidth})},[n("div",ne,[n("span",de,d(t.name),1),n("span",ce,d(t.value),1),n("span",he,d(s.filterHex(t.hex)),1),n("span",me,d(t.comment),1)])],4))],64))])),_:1},8,["items","onUpdate"]),n("div",{class:"table-scroll-x",onScroll:t[4]||(t[4]=(...e)=>s.onScrollX&&s.onScrollX(...e))},[n("div",{class:"table-scroll-x-bar",style:h({width:s.fullWidth})},null,4)],32)])}],["__scopeId","data-v-9181fa72"]]);let ue,ge=0,fe=0;const be={props:["store","closeFlag"],emits:["connect","showMessage","getCarCode"],components:{Button:a,Header:i,ImportFileDialog:N,Button:a,ScrollBar:O,TableRecycleScroller:pe,EvTimeplot:A,ProgressBar:_,Message:E},data(){let e=this.$ls.get("blfread_treeData")?.map((e=>({...e,checkedListIndex:[],carType:e.carType||"MS11",sdb:e.sdb||"E4",children:e.children.map((t=>({...t,warning:!1,pid:e.id,color:t.color||"blue"}))),signals:{}})));if(e&&0!==e?.length||(e=[]),e=e.filter((e=>!("MS11"===e.carType&&"E4U1"===e.sdb&&"默认视图"===e.text&&0===e.children.length))),!e.some((e=>"MS11"===e.carType&&"E4U1"===e.sdb))){let t=Date.now();e.push({id:t,text:"默认视图",type:"view",editable:!1,carType:"MS11",sdb:"E4U1",deleteConfirm:!1,children:[{id:"PwrModSts",msg:198,channel:3,text:"PwrModSts",node_type:"signal",comment:"PowerMode Status",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::PwrModSts::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-PwrModSts",pid:t,color:"purple"},{id:"VCUActGearLvr",msg:198,channel:3,text:"VCUActGearLvr",node_type:"signal",comment:"Actual gear level 车辆实际档位\\\\nP R N D挡位",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUActGearLvr::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUActGearLvr",pid:t,color:"blue",warning:!1},{id:"VCUAccrPedlRat",msg:198,channel:3,text:"VCUAccrPedlRat",node_type:"signal",comment:"加速油门踏板开度",remark:"VCCD::BCP/BCS/EPS/SCUC/SWM::VCCD_ChassisCANFD_0xC6::VCUAccrPedlRat::CANFD signal",checked:!0,_id:"3-3_VCCD_ChassisCANFD_0xC6(0xc6)-VCUAccrPedlRat",pid:t,color:"cerulean",warning:!1},{id:"HvBattSoCAct",msg:449,channel:5,text:"HvBattSoCAct",node_type:"signal",comment:"HV battery SoC actual",remark:"BMS::VCCD/VECU::BMS_PTCANFD_0x1C1::HvBattSoCAct::CANFD signal",checked:!0,_id:"5-5_BMS_PTCANFD_0x1C1(0x1c1)-HvBattSoCAct",pid:t,color:"cyan",warning:!1},{id:"VehSpd",msg:179,channel:3,text:"VehSpd",node_type:"signal",comment:"Vehicle speed",remark:"BCS::ADD/VCCD/BCP/EPS/SCUC/SWM::BCS_ChassisCANFD_0xB3::VehSpd::CANFD signal",checked:!0,_id:"3-3_BCS_ChassisCANFD_0xB3(0xb3)-VehSpd",pid:t,color:"green",warning:!1},{id:"SwtHiBeam",msg:419,channel:3,text:"SwtHiBeam",node_type:"signal",comment:"组合开关远光灯请求命令",remark:"SWM::BCP/BCS/VCCD::SWM_ChassisCANFD_0x1A3::SwtHiBeam::CANFD signal",checked:!0,_id:"3-3_SWM_ChassisCANFD_0x1A3(0x1a3)-SwtHiBeam",pid:t,color:"lime",warning:!1}]})}return this.$ls.set("blfread_treeData",e),{system:F,timeFilterModeVal:"absolute",tableLoading:!1,isParsing:!1,onceLooped:!1,backBlock:!1,exportTypeOptions:[{label:"asc(*.asc)",value:"asc"},{label:"csv(*.csv)",value:"csv"},{label:"blf(*.blf)",value:"blf"}],exportCycleOptions:[{label:"默认",value:""}],exportTypeValue:"blf",exportCycleValue:"",modal:{title:"导入文件",visible:!1},message:{visible:!1,level:"",content:""},columnsDef:[{titName:"",width:30,keyName:"id",type:"number",value:[],filterShow:!1,custom:!0},{titName:"",width:164,keyName:"diff"===this.timeFilterModeVal?"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let t=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return t.toFixed(6);case"absolute":return new Date(1e3*e+(1e3*this.startSecond||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,hourCycle:"h23",timeZone:"Asia/Shanghai"});case"relative":return e.toFixed(6);default:return e}}},{titName:"Chn",width:60,keyName:"channel",type:"number",value:[],filterShow:!0},{titName:"ID",width:60,keyName:"canId",type:"number",value:[],filterShow:!0,displayMap:e=>"0x"+e.toString(16)},{titName:"NAME",width:200,keyName:"name",type:"string",value:[],filterShow:!0},{titName:"Event",width:80,keyName:"canType",type:"string",value:[],filterShow:!0},{titName:"Dir",width:60,keyName:"dir",type:"string",value:[],filterShow:!0},{titName:"Dlc",width:60,keyName:"dlc",type:"number",value:[],filterShow:!0},{titName:"DATA",width:1380,keyName:"data",type:"string",value:[],filterShow:!1,displayMap:e=>e.map((e=>e.toString(16).padStart(2,"0"))).join(" ")}],rowData:[],barChartData:[],directorySize:{label:"",value:0,durationMaybe:0,durationMaybeLabel:"0秒"},carType:"MS11",sdb:"E4U3_1115",directory:"",expandKeys:new Set,sliderMsVal:0,lastMsecond:1,startSecond:0,startSqlId:0,endSqlId:0,filterCanData:"",treeData:e.map((e=>(e.children.forEach((e=>{e.warning=!1})),e))),curView:{label:e[0]?.text,value:0,tag:e[0]?.sdb}}},mounted(){w.blfTraceFromLogging.removeSql(),I.report("trackPage",{page:"帧分析",tip:"1174.17.0.1.33179"})},beforeUnmount(){w.blfTraceFromLogging.removeSql(),clearTimeout(ge),ue?.abort()},watch:{directory:{async handler(e){const t=await M.getFileSize(e),a=+(t/1024/1024).toFixed(1);console.log("bt",t,a),this.directorySize={label:$(t),value:t,durationMaybe:1e3*a,durationMaybeLabel:L(a)}}},colComputed(){this.columnsDef[1]={titName:"",width:164,keyName:"diff"===this.timeFilterModeVal?"diff":"timestamp",type:"number",value:[],filterShow:!1,displayMap:e=>{let t=parseFloat(e);switch(this.timeFilterModeVal){case"diff":return t.toFixed(6);case"absolute":return new Date(1e3*e+(1e3*this.startSecond||0)).toLocaleString("zh-Hans-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit",hourCycle:"h23",timeZone:"Asia/Shanghai"})+"."+t.toFixed(6).split(".")[1];case"relative":return e.toFixed(6);default:return e}}}}},computed:{quitConfirm(){return!!this.directory.trim()},showData(){let e={mode:"all"};return this.columnsDef.forEach((t=>{t.filterShow&&(e[t.keyName]=(t.value||[]).map((e=>e.value)))})),e},directoryLabel(){let e=this.directory.split("/").pop();return e.length>25?e.slice(0,10)+"..."+e.slice(-15):e},carTypeLabel(){return this.carType&&"custom"!==this.carType?this.carType+" / ":""},colComputed(){return this.timeFilterModeVal+this.startSecond+this.mode},diffRowData(){return this.rowData.map(((e,t,a)=>({...e,diff:0===t?0:a[t].timestamp-a[t-1].timestamp})))},view(){return this.treeData[this.curView.value]}},methods:{async colFilter(e){const t="name"===e.keyName?null:"";let a,i={selectItem:e.keyName,...this.showData,[e.keyName]:t};try{a=await w.blfTraceFromLogging.getFiltItems(i)}catch(s){}console.log(a);let l=(a?.data?.data||[]).map((t=>({value:t,label:"canId"===e.keyName?"0x"+t.toString(16):""===t?" 空":t}))).sort(((t,a)=>("number"===e.type?+t.value>+a.value:t.value>a.value)?1:-1));return console.log(l,111111111),l},importFile(){this.modal.visible=!0},onCancelImportFile(){this.modal.visible=!1},resetTimeData(){clearTimeout(ge),this.directory="",this.backBlock=!1,this.tableLoading=!1,this.isParsing=!1,this.onceLooped=!1,this.expandKeys.clear(),this.barChartData=[],this.sliderMsVal=0,this.lastMsecond=1,this.startSecond=0,this.startSqlId=0,this.endSqlId=0,this.rowData=[],this.columnsDef.forEach((e=>{e.value="name"===e.keyName?null:""}))},startParse(){this.isParsing=!0,ue=new AbortController,w.blfTraceFromLogging.initBlf({filePath:this.directory},{signal:ue.signal}).finally((()=>{this.isParsing=!1,clearTimeout(ge),this.getTableChartData(!0)}))},loopGetData(){clearTimeout(ge),ge=setTimeout((async()=>{try{await this.getTableChartData(!0)}catch(e){}this.isParsing&&this.loopGetData()}),2e3)},async getTableChartData(e){let t,a;this.onceLooped&&e||(this.tableLoading=!0);try{a=e?this.onceLooped?"":0:(this.sliderMsVal||0)/1e3||"",t=await w.blfTraceFromLogging.showLoggingMessage({moreThanTimeStamp:a,lessThanTimeStamp:"",moreThanSqlID:"",lessThanSqlID:"",...this.showData,sqlId:"",numbers:100,canData:this.filterCanData})}catch(s){return void(this.tableLoading=!1)}let i,l=t.data;this.onceLooped&&e||(l.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=""+e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),0!==l.length&&(this.startSqlId=l[0].sqlId,this.endSqlId=l[l.length-1].sqlId,this.sliderMsVal=1e3*l[0].timestamp),this.rowData=Object.freeze(l),this.$refs.table?.scrollToItem(0)),this.tableLoading=!1,0===l.length||this.onceLooped||(this.onceLooped=!0);try{i=await w.blfTraceFromLogging.getGroupCount({...this.showData})}catch(s){return}this.barChartData=[],null!=i.data.startTime&&(this.startSecond=i.data.startTime),i.data.data.length<2&&(i.data.data.unshift([0,0]),i.data.data.push([parseInt(this.lastMsecond/1e3+1),0])),i.data.data.length>0&&(this.lastMsecond=1e3*i.data.data.map((e=>e[0])).sort(((e,t)=>t-e))[0]),this.$nextTick((()=>{this.barChartData=Object.freeze([{name:"帧数/秒",t:i.data.data.map((e=>e[0]+this.startSecond)),v:i.data.data.map((e=>{let t=new Number(e[1]);return t.toString=()=>e[1],t.valueOf=()=>Math.sqrt(Math.sqrt(e[1])),t})),color:"#EC7F00",enums:[],cycle:Number.MAX_SAFE_INTEGER}])}))},getSelectData(e){if(this.tableLoading)return;let t="",a="",i="";switch(e){case"up":i=this.startSqlId;break;case"down":a=this.endSqlId;break;case"pick":this.expandKeys.clear(),this.rowData=[],t=this.sliderMsVal/1e3}this.tableLoading=!0,w.blfTraceFromLogging.selectData({moreThanTimeStamp:t,lessThanTimeStamp:"",moreThanSqlID:a,lessThanSqlID:i,...this.showData,sqlId:"",numbers:100,canData:this.filterCanData}).then((t=>{if(t?.data?.data?.length>=0){let a=t.data.data;switch("number"==typeof a[0]?.timestamp&&(this.sliderMsVal=1e3*a[0].timestamp),a.forEach((e=>{e.isExpand=!1,e.isParent=!0,e.id=e.sqlId,e.canId=e.arbitrationId,delete e.arbitrationId})),e){case"up":a=a.filter((e=>!this.rowData.some((t=>t.sqlId===e.sqlId)))),this.rowData=Object.freeze([...a,...this.rowData.map((e=>({...e})))]),"number"==typeof t.data.startSqlId&&(this.startSqlId=t.data.startSqlId),this.$nextTick((()=>{this.$refs.table.scrollToItem(t.data.data.length-1)}));break;case"down":a=a.filter((e=>!this.rowData.some((t=>t.sqlId===e.sqlId)))),this.rowData=Object.freeze([...this.rowData.map((e=>({...e}))),...a]),"number"==typeof t.data.endSqlId&&(this.endSqlId=t.data.endSqlId);break;case"pick":"number"==typeof t.data.startSqlId&&(this.startSqlId=t.data.startSqlId),"number"==typeof t.data.endSqlId&&(this.endSqlId=t.data.endSqlId),this.rowData=Object.freeze(a),this.$nextTick((()=>{this.$refs.table.scrollToItem(0)}))}}})).finally((()=>{this.tableLoading=!1}))},onClicked(){},onScrollAction(e){},onBodyScrollEnd(e){this.getSelectData(e)},onCheckView(e){console.log("data121212",e),this.resetTimeData(),this.$nextTick((()=>{this.modal.visible=!1,this.carType=e.carType,this.sdb=e.sdb,this.directory=l(e.directory),this.files=e.files.length?e.files:void 0,this.comments=e.comments.length?e.comments:void 0,this.fileType=e.fileType,this.$nextTick((async()=>{"custom"===this.carType?await w.blfTraceFromLogging.getDBC({carType:this.carType,sdb:this.sdb,files:this.files,comments:this.comments}).then((e=>{this.defaultOptions=Object.freeze(e.data)})):await w.blfTraceFromLogging.reAdjust(e.sendReAdjust),this.startParse(),this.loopGetData()}))})),I.report("track","click",{element_name:"帧分析",asset_name:this.directory+";",tip:"1174.17.0.1.33180"})},async onToggleExpand(e,t,a){if(this.tableLoading)return;this.tableLoading=!0;const i=t.map((e=>({...e}))),l=i[e],s=l.channel+"-"+l.canId;if(a||!l.isExpand){let t;this.expandKeys.add(s),this.tableLoading=!0;try{t=await w.blfTraceFromLogging.parsedSignal({channel:l.channel,canId:""+l.canId,canData:(l.data||[]).map((e=>e.toString(16)))})}catch(o){}this.tableLoading=!1;let r=(t?.data||[]).sort(((e,t)=>e.name<t.name?-1:1))||[],n=l.sqlId;if(r.forEach(((e,t)=>{e.channel=l.channel,e.canId=""+l.canId,e.isParent=!1,e.isExpand=!0,e.isChildTit=!1,e.id=n+"-"+e.name})),r.unshift({channel:l.channel,canId:""+l.canId,isParent:!1,isExpand:!0,isChildTit:!0,id:n+"-"}),i.splice(e+1,0,...r),l.isExpand=r.length,a)return this.tableLoading=!1,r;this.rowData=Object.freeze(i)}else this.expandKeys.delete(s),i.splice(e+1,i[e].isExpand),i[e].isExpand=!1,this.rowData=Object.freeze(i);this.tableLoading=!1},onSliderChange(e){this.sliderMsVal=e,this.getSelectData("pick")},async onColFilterChange(e){console.log("filterch",e);let t=this.columnsDef.find((t=>e.keyName===t.keyName));t&&(t.value=e.value),this.rowData=[],this.getTableChartData()},showMessage({level:e,content:t,timeout:a}){clearTimeout(fe),null!=e&&(this.message.level=e),null!=t&&(this.message.content=t),this.message.visible=!0,a>0&&(fe=setTimeout((()=>{this.message.visible=!1}),a))},onClickDot(e){e.start>0&&(this.sliderMsVal=1e3*(e.start-this.startSecond),this.getSelectData("pick"))},timestampToTime(e){var t=new Date(e),a=t.getHours(),i=t.getMinutes(),l=i<10?"0"+i:i,s=t.getSeconds();return a+":"+l+":"+(s<10?"0"+s:s)},onExportArea(e,t){e.startTime=(e.startTime-this.startSecond).toFixed(6),e.endTime=(e.endTime-this.startSecond).toFixed(6);let a="blf",i="BLF文件 (*.blf;*.BLF)";switch(e.type){case"blf":a="blf",i="BLF文件 (*.blf;*.BLF)";break;case"csv":a="csv",i="CSV文件 (*.csv;*.CSV)";break;case"asc":a="asc",i="ASC文件 (*.asc;*.ASC)"}M.choosePath({directory:this.directory.replace(/\/[^\/]+$/,""),saveFilename:this.directory.match(/\/([^\/]+)$/)[1].replace(/.blf|.dat|.mdf|.mf4|.asc|.log/i,`_cut-${e.start}-${e.end}.${a}`),dialogType:"SAVE_DIALOG",fileTypes:[i],allow_multiple:!1}).then((t=>{if(t.data.directory){const a=l(t.data.directory);l(this.directory),this.showMessage({level:"loading",content:"导出中..."});let i="";i="mac"==F?a.includes(e.type)?a:a+e.type:a;let s={conditions:{startTimeStamp:e.startTime,endTimeStamp:e.endTime,channel:this.showData.channel,canId:this.showData.canId,name:this.showData.name,canType:this.showData.canType,dir:this.showData.dir,dlc:this.showData.dlc,timeType:this.timeFilterModeVal},outFile:i};w.blfTraceFromLogging.getExportFile({data:s}).then((e=>{console.log(e),"success"==e.data.msg?(this.showMessage({level:"success",content:"导出成功",timeout:2e3}),this.downloadMessage.path=i,this.downloadMessage.show=!0):this.showMessage({level:"error",content:"导出失败",timeout:2e3})})).catch((e=>{console.log(e)}))}})),I.report("track","click",{element_name:"帧分析",asset_name:this.directory+";",tip:"1174.17.0.1.33643"})},onTimeModeChange(e){this.timeFilterModeVal=e},onDataFilterChange(e){this.filterCanData=e,this.rowData=[],this.getTableChartData(),console.log("this.filterCanData",this.filterCanData)}}},ye={class:"frame-analysis"},Ce=(e=>(b("data-v-71448008"),e=e(),y(),e))((()=>n("i",{class:"lead-icon"},null,-1))),we={class:"record-header-message"},ve={class:"record-header-message-imp"},Se={class:"record-header-message-imp"},De={class:"o-pul-er"},Te={class:"o-chart-wrap"},ke=["data-empty"],xe={key:1,class:"o-console-progress"},Fe={class:"o-table-wrap"},Me={key:0,class:"spin-er"};e("default",s(be,[["render",function(e,t,a,i,l,s){const c=u("Button"),h=u("Header"),b=u("EvTimeplot"),y=u("ProgressBar"),C=u("ScrollBar"),w=u("TableRecycleScroller"),v=u("ImportFileDialog"),S=u("Message");return o(),r("div",ye,[g(h,{title:"查看报文-帧分析",quitConfirm:s.quitConfirm,backBlock:l.backBlock},{default:f((()=>[g(c,{type:"primary",class:"header-import-btn",disabled:l.isParsing,onClick:s.importFile},{default:f((()=>[Ce,x("导入文件")])),_:1},8,["disabled","onClick"]),n("span",we,[x("  文件："),n("span",ve,d(s.directoryLabel||"--"),1),m(n("span",{style:{color:"#333","text-shadow":"0 0.3px currentColor"}},"（"+d(l.directorySize.label)+"）",513),[[p,l.directorySize.value]]),x("  DBC配置："),n("span",Se,d(s.carTypeLabel)+d(l.sdb||"--"),1)])])),_:1},8,["quitConfirm","backBlock"]),n("div",De,[n("div",Te,[n("div",{class:"o-console-er","data-empty":0===l.barChartData.length&&0===l.directorySize.durationMaybe},[l.barChartData.length?(o(),D(b,{key:0,timeData:l.barChartData,startTime:l.startSecond,exportCycleValue:l.exportCycleValue,exportTypeValue:l.exportTypeValue,exportCycleOptions:l.exportCycleOptions,exportTypeOptions:l.exportTypeOptions,onExportAreaData:s.onExportArea,onClickDot:s.onClickDot,timeFilter:l.timeFilterModeVal,path:"bars",fill:!0,mode:"shifted"},null,8,["timeData","startTime","exportCycleValue","exportTypeValue","exportCycleOptions","exportTypeOptions","onExportAreaData","onClickDot","timeFilter"])):T("",!0),l.directorySize.durationMaybe&&l.isParsing?(o(),r("div",xe,[g(y,{style:{top:"0"},second:l.directorySize.durationMaybe},null,8,["second"])])):T("",!0)],8,ke)]),n("div",Fe,[g(C,{modelValue:l.sliderMsVal,"onUpdate:modelValue":t[0]||(t[0]=e=>l.sliderMsVal=e),start:0,end:l.lastMsecond,startTime:1e3*l.startSecond,timeFilter:"relative"!=l.timeFilterModeVal?"absolute":"relative",onChange:s.onSliderChange},null,8,["modelValue","end","startTime","timeFilter","onChange"]),g(w,{rowData:s.diffRowData,filters:s.showData,columnsDef:l.columnsDef,onToggleExpand:t[1]||(t[1]=e=>s.onToggleExpand(e,l.rowData)),onScrollRow:s.onBodyScrollEnd,onScrollAction:s.onScrollAction,onClick:s.onClicked,columnsFilter:s.colFilter,from:"frameAnalysis",onColFilterChange:s.onColFilterChange,onTimeModeChange:s.onTimeModeChange,onDataFilterChange:s.onDataFilterChange,ref:"table",style:{height:"100%"}},null,8,["rowData","filters","columnsDef","onScrollRow","onScrollAction","onClick","columnsFilter","onColFilterChange","onTimeModeChange","onDataFilterChange"]),l.tableLoading?(o(),r("div",Me)):T("",!0)])]),l.modal.visible?(o(),D(v,{key:0,from:"frameAnalysis",title:l.modal.title,onCancel:s.onCancelImportFile,curViewInx:l.curView.value,onImportFileSubmit:s.onCheckView,hisDirectory:l.directory,carType:l.carType,sdb:l.sdb},null,8,["title","onCancel","curViewInx","onImportFileSubmit","hisDirectory","carType","sdb"])):T("",!0),g(S,{message:l.message},null,8,["message"])])}],["__scopeId","data-v-71448008"]]))}}}));
